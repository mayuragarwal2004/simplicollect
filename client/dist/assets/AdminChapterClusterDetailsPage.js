import{r as t,c as f,Q as d,j as e,C as A,f as w,g as P,i as M,B as S,X as H,e as R}from"./index.js";import{B as U}from"./Breadcrumb.js";import{T as O,a as Q,b as L,c as E}from"./tabs.js";import{I as G}from"./input.js";import{S as V}from"./scroll-area.js";import{T as D,a as $,b as g,c as o,d as I,e as i}from"./table2.js";import{A as X,a as Y,b as q,c as J,f as K,d as W,g as Z,h as _}from"./alert-dialog.js";import{S as ee}from"./search.js";import{P as se}from"./plus.js";import{U as ae}from"./users.js";import{P as re}from"./package.js";import"./chevron-right.js";import"./index4.js";import"./index13.js";import"./index11.js";import"./index9.js";import"./index6.js";import"./index10.js";import"./index3.js";import"./index5.js";const te=({clusterId:c,onMembersChange:l})=>{const[x,v]=t.useState([]),[b,m]=t.useState([]),[C,j]=t.useState(""),[h,N]=t.useState(null),[n,a]=t.useState(!1),[r,u]=t.useState(!0);t.useEffect(()=>{p()},[c]);const p=async()=>{try{u(!0);const s=await f.get(`/api/clusters/${c}/members`);v(s.data),l==null||l(s.data)}catch{d.error("Failed to fetch cluster members")}finally{u(!1)}},k=async s=>{var y;if(!s.trim()){m([]);return}try{const T=await f.get(`/api/clusters/${c}/search-members`,{params:{search:s}});m(T.data)}catch(T){console.error("Search error:",((y=T.response)==null?void 0:y.data)||T.message),d.error("Failed to search members")}},B=s=>{s.isInOtherCluster?(N(s),a(!0)):F(s.memberId)},F=async s=>{try{await f.post(`/api/clusters/${c}/members`,{memberId:s}),d.success("Member added to cluster"),j(""),m([]),N(null),a(!1),p()}catch{d.error("Failed to add member to cluster")}},z=async s=>{try{await f.delete(`/api/clusters/${c}/members/${s}`),d.success("Member removed from cluster"),p()}catch{d.error("Failed to remove member from cluster")}};return r?e.jsx("div",{children:"Loading members..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(A,{children:[e.jsx(w,{children:e.jsx(P,{children:"Add Members"})}),e.jsxs(M,{children:[e.jsx("div",{className:"flex gap-4 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search members...",value:C,onChange:s=>{j(s.target.value),k(s.target.value)},className:"pl-8"})]})}),b.length>0&&e.jsx(A,{className:"mt-4",children:e.jsx(V,{className:"h-[200px]",children:e.jsxs(D,{children:[e.jsx($,{children:e.jsxs(g,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Phone"}),e.jsx(o,{className:"text-right",children:"Action"})]})}),e.jsx(I,{children:b.map(s=>e.jsxs(g,{children:[e.jsx(i,{children:`${s.firstName} ${s.lastName||""}`.trim()}),e.jsx(i,{children:s.email}),e.jsx(i,{children:s.phoneNumber}),e.jsx(i,{className:"text-right",children:s.isInCluster?e.jsx(S,{size:"sm",variant:"outline",disabled:!0,className:"text-muted-foreground",children:"Already in cluster"}):e.jsxs(S,{size:"sm",onClick:()=>B(s),children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add to cluster"]})})]},s.memberId))})]})})})]})]}),e.jsxs(A,{children:[e.jsx(w,{children:e.jsx(P,{children:"Current Members"})}),e.jsx(M,{children:e.jsx("div",{className:"rounded-lg border",children:e.jsxs(D,{children:[e.jsx($,{children:e.jsxs(g,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Phone"}),e.jsx(o,{})]})}),e.jsx(I,{children:x.length===0?e.jsx(g,{children:e.jsx(i,{colSpan:4,className:"text-center text-muted-foreground",children:"No members in this cluster yet"})}):x.map(s=>e.jsxs(g,{children:[e.jsx(i,{children:`${s.firstName} ${s.lastName||""}`.trim()}),e.jsx(i,{children:s.email}),e.jsx(i,{children:s.phoneNumber}),e.jsx(i,{className:"text-right",children:e.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>z(s.memberId),children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Remove member"})]})})]},s.memberId))})]})})})]}),e.jsx(X,{open:n,onOpenChange:a,children:e.jsxs(Y,{children:[e.jsxs(q,{children:[e.jsx(J,{children:"Move Member to This Cluster?"}),e.jsx(K,{children:h&&e.jsxs(e.Fragment,{children:['This member is currently in cluster "',h.clusterName,'". Moving them will remove them from their current cluster. Are you sure you want to proceed?']})})]}),e.jsxs(W,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(_,{onClick:()=>h&&F(h.memberId),children:"Yes, Move Member"})]})]})})]})},ce=({clusterId:c,onPackagesChange:l})=>{const[x,v]=t.useState({}),[b,m]=t.useState(!1),[C,j]=t.useState(!0);t.useEffect(()=>{h()},[c]);const h=async()=>{try{j(!0);const n=await f.get(`/api/clusters/${c}/packages`),r=n.data.reduce((u,p)=>{const k=p.termId;return u[k]||(u[k]={termName:p.termName,packages:[]}),u[k].packages.push(p),u},{});v(r),l==null||l(n.data)}catch{d.error("Failed to fetch cluster packages")}finally{j(!1)}},N=async(n,a)=>{const r=document.querySelector("[data-radix-scroll-area-viewport]"),u=(r==null?void 0:r.scrollTop)||0;try{m(!0),a?(await f.delete(`/api/clusters/${c}/packages/${n}`),d.success("Package removed from cluster")):(await f.post(`/api/clusters/${c}/packages`,{packageId:n}),d.success("Package added to cluster")),await h(),setTimeout(()=>{r&&(r.scrollTop=u),m(!1)},0)}catch{m(!1),d.error("Failed to update package assignment")}};return C?e.jsx("div",{children:"Loading packages..."}):e.jsx("div",{className:"space-y-4",children:Object.entries(x).map(([n,a])=>e.jsxs(A,{children:[e.jsx(w,{children:e.jsx(P,{children:a.termName})}),e.jsx(M,{children:e.jsx("div",{className:"rounded-lg border",children:e.jsxs(D,{children:[e.jsx($,{children:e.jsxs(g,{children:[e.jsx(o,{children:"Package Name"}),e.jsx(o,{children:"Amount"}),e.jsx(o,{children:"Access"})]})}),e.jsx(I,{children:a.packages.length===0?e.jsx(g,{children:e.jsx(i,{colSpan:3,className:"text-center text-muted-foreground",children:"No packages available in this term"})}):a.packages.map(r=>e.jsxs(g,{children:[e.jsx(i,{children:r.packageName}),e.jsx(i,{children:r.packageFeeAmount}),e.jsx(i,{children:e.jsx(S,{variant:r.isIncluded?"default":"outline",size:"sm",disabled:b,onClick:()=>N(r.packageId,r.isIncluded),children:r.isIncluded?"Remove Access":"Grant Access"})})]},r.packageId))})]})})})]},n))})},le=()=>{const{chapterSlug:c,clusterId:l}=R(),[x,v]=t.useState(null),[b,m]=t.useState("members"),[C,j]=t.useState(!0);t.useEffect(()=>{h()},[l]);const h=async()=>{try{j(!0);const a=await f.get(`/api/clusters/${l}`);v(a.data)}catch{d.error("Failed to fetch cluster details")}finally{j(!1)}},N=a=>{console.log("Members updated:",a.length)},n=a=>{console.log("Packages updated:",a.length)};return C?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:x==null?void 0:x.clusterName}),e.jsxs(O,{value:b,onValueChange:m,className:"space-y-4",children:[e.jsxs(Q,{children:[e.jsxs(L,{value:"members",className:"flex items-center",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Members"]}),e.jsxs(L,{value:"packages",className:"flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Packages"]})]}),e.jsx(E,{value:"members",className:"space-y-4",children:e.jsx(te,{clusterId:l,onMembersChange:N})}),e.jsx(E,{value:"packages",className:"space-y-4",children:e.jsx(ce,{clusterId:l,onPackagesChange:n})})]})]})},Se=()=>{const{chapterSlug:c,clusterId:l}=R();return e.jsxs(e.Fragment,{children:[e.jsx(U,{items:[{name:"Dashboard",link:"/admin"},{name:"Chapter",link:"/admin/chapters"},{name:"Chapter Clusters",link:`/admin/chapters/${c}/clusters`},{name:"Cluster Details",link:`/admin/chapters/${c}/clusters/${l}`}]}),e.jsx(le,{})]})};export{Se as default};
