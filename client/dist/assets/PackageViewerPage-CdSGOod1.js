import{g as Y,r as h,c as T,Q as E,j as e,B as V,n as Ve,w as He,_ as We,s as qe,J as he,R as O,e as ae}from"./index-eKwCJLll.js";import{B as Qe}from"./Breadcrumb-kGt-xtkX.js";import{f as q,C as ze}from"./ChooseMemberPopoverCommand-CiPQnlA5.js";import{T as Ye,a as Ge,b as de,c as me}from"./tabs-DuNG8T3N.js";import{B as Ke}from"./badge-Cc92_WeI.js";import{C as X}from"./circle-alert-DVRrhPGh.js";import{B as Z}from"./banknote-DiCzQvr4.js";import{C as ee}from"./credit-card-BaTEO-D5.js";import{C as ue}from"./chevron-right-B55Ri9eq.js";import{U as Je}from"./user-CF6jDIqC.js";import{S as Xe}from"./skeleton-BVvV9rTW.js";import{S as Ze}from"./switch-Dup2dCzI.js";import{L as et}from"./label-DUERygKs.js";import{C as tt,S as at,a as st,b as nt,c as rt,d as it}from"./select-D6qXgB-2.js";import{C as pe}from"./chevron-down-G1SJ-oEn.js";import{U as ot}from"./upload-94Veaai2.js";import{C as fe}from"./chevron-left-Bxolz191.js";import{A as lt,a as ct,b as dt,c as mt,f as ht,d as ut,g as pt,h as ft}from"./alert-dialog-BXfYvETV.js";import{D as gt,f as xt,a as vt}from"./dialog-B-Dd4jtF.js";import{B as Q,T as yt,a as bt}from"./Tabs-xW4w4fZt.js";import{B as wt}from"./Button-1Vre1TpV.js";import{I as jt}from"./input-BhMSVbBI.js";import{c as ge,a as se,u as xe,P as W,b as ve,e as Nt}from"./index-p0A_8czo.js";import{c as Ct}from"./index-DBSIu3jP.js";import{P as It}from"./index-CMxenybS.js";import{u as Pt}from"./index-Bn6wwOXp.js";import"./popover-SP_ZoDj-.js";import"./index-D9_AVXgF.js";import"./index-Irvr_6j-.js";import"./index-DCu9mJZ4.js";import"./command-CwJtseYa.js";import"./index-Jch0bHuG.js";import"./search-6lUvAzAk.js";import"./chevrons-up-down-B9hjxIQB.js";import"./index-CzuTh-Sf.js";import"./index-BdQq_4o_.js";import"./TransitionGroupContext-B__exIwg.js";import"./useSlot-Bs_SfgP3.js";import"./CircularProgress-yOawTry_.js";const ye=(o,t,a,s)=>{const n=new Date(t.packagePayableEndDate);if(typeof t.meetingIds=="string"&&(t.meetingIds=JSON.parse(t.meetingIds)),t.status==="pending")return{message:"You have applied for this package. Please wait for approval",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(t.status==="rejected")return{message:"Your package application has been rejected",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(t.status==="approved")return{message:"Your package application has been approved",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(t.packagePayableStartDate&&o<new Date(t.packagePayableStartDate))return{message:"Package is not open to payable yet",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(!t.allowAfterEndDate&&o>n)return{message:"Package is not open to payable anymore",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(t.allowPackagePurchaseIfFeesPaid&&At(t,a))return{message:"Package has overlapping payments",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};let i=t.packageFeeAmount,r=0,d=0;const c=(l,j)=>{switch(l){case"Daily":return j;case"Weekly":return Math.ceil(j/7);case"Monthly":return Math.ceil(j/30);case"Quarterly":return Math.ceil(j/90);case"lumpsum":case"Meetingly":return 1;default:return 0}};if(o<=new Date(t.discountEndDate)){const l=Math.ceil((new Date(t.discountEndDate)-o)/864e5);d=c(t.discountType,l)*t.discountAmount}if(o>n&&t.allowPenaltyPayableAfterEndDate){const l=Math.ceil((o-n)/864e5);r=c(t.penaltyType,l)*t.penaltyAmount}let y=i+r-d,u=0;return u=Array.isArray(t.meetingIds)?t.meetingIds.reduce((l,j)=>{const w=a.find(f=>f.meetingId===j);return l+(w&&w.isPaid?w.meetingFeeMembers:0)},0):0,{totalAmount:y-s,penaltyAmount:r,discountAmount:d,paidFees:u,previousBalance:s,isDisabled:!t.allowAfterEndDate&&o>n}},At=(o,t)=>{var a;return(a=o.meetingIds)==null?void 0:a.some(s=>{const n=t.find(i=>i.meetingId===s);return n&&n.isPaid})},be=h.createContext(),_t=({children:o})=>{const{chapterData:t}=Y(),[a,s]=h.useState(new Date),n=h.useRef(!0),i=h.useRef(!1),[r,d]=h.useState({selectedReceiver:null,saveReceiverSelection:!1,selectedReceiverObject:null,receivers:[],selectedPackage:null,pendingPayments:[],packageData:null,parentType:null,packageParents:[],chapterMeetings:void 0,balance:void 0,lastUpdated:null,lastSelectedPackageTime:null,selectedMemberId:null,terms:[],selectedTermId:null}),c=()=>{d(m=>({...m,selectedPackage:null,selectedReceiver:null,selectedReceiverObject:null,saveReceiverSelection:!1,lastSelectedPackageTime:null}))},y=m=>{d(g=>({...g,selectedPackage:m,lastSelectedPackageTime:new Date}))},u=h.useCallback(async()=>{if(t!=null&&t.chapterId)try{const m=await T.get(`/api/feeReceiver/current/${t.chapterId}`,{params:{date:q(a)}});d(g=>({...g,receivers:m.data}))}catch(m){console.error("Error fetching current receivers:",m),E.error("Failed to fetch fee receivers")}},[t==null?void 0:t.chapterId,a]),v=async()=>{if(!(t!=null&&t.chapterId)){console.warn("Chapter ID is not available. Skipping terms fetch.");return}try{const m=await T.get(`/api/term/chapter/${t.chapterId}`),g=m.data.filter(P=>P.status==="active");let C=r.selectedTermId;if(!C||!g.find(P=>P.termId===C)){const P=new Date,_=g.find(N=>{const S=new Date(N.startDate),D=new Date(N.endDate);return P>=S&&P<=D});if(_)C=_.termId;else if(g.length>0){const N=g.filter(S=>new Date(S.startDate)>P);N.length>0?C=N.reduce((D,M)=>new Date(D.startDate)<new Date(M.startDate)?D:M).termId:C=g[0].termId}}d(P=>({...P,terms:m.data,selectedTermId:C}))}catch(m){console.error("Error fetching terms:",m),E.error("Failed to fetch terms")}},l=h.useCallback(async(m,g=null)=>{if(!(g||r.selectedTermId)||!(t!=null&&t.chapterId)){console.warn("No term selected or chapter ID missing. Skipping meetings fetch.");return}try{const P=await T.get(`/api/meetings/meetings/${t.chapterId}`,{params:{memberId:m||""}});d(_=>({..._,chapterMeetings:P.data}))}catch(P){console.error("Error fetching chapter meetings:",P),E.error("Failed to fetch meetings")}},[t==null?void 0:t.chapterId,r.selectedTermId]),j=h.useCallback(async m=>{if(t!=null&&t.chapterId)try{const g=await T.get(`/api/payment/balance/${t.chapterId}`,{params:{memberId:m||""}});d(C=>({...C,balance:g.data.balance}))}catch(g){console.error("Error fetching balance amounts:",g),E.error("Failed to fetch balance")}},[t==null?void 0:t.chapterId]),w=h.useCallback(async(m,g=null,C=null,P=null)=>{var D;const _=g||r.selectedTermId,N=C||r.chapterMeetings,S=P!==null?P:r.balance;if(!_||!(t!=null&&t.chapterId)){console.warn("No term selected or chapter ID missing. Skipping packages fetch.");return}try{const M=await T.get(`/api/packages/all/${t.chapterId}/term/${_}`,{params:{memberId:m||"",date:q(a)}}),F=[...new Set(M.data.map(b=>b.packageParent))].sort((b,k)=>b.localeCompare(k));console.log("Processing packages with:",{packages:((D=M.data)==null?void 0:D.length)||0,meetings:(N==null?void 0:N.length)||0,balance:S});const U=f(M.data,S,N);d(b=>({...b,packageParents:F,packageData:U,lastUpdated:new Date}))}catch(M){console.error("Error fetching packages:",M),E.error("Failed to fetch packages")}},[t==null?void 0:t.chapterId,r.selectedTermId,r.chapterMeetings,r.balance,a]),f=(m,g,C)=>(console.log("processPackageData called with:",{packagesCount:(m==null?void 0:m.length)||0,packagesValid:Array.isArray(m),meetingsCount:(C==null?void 0:C.length)||0,meetingsValid:!!C,balance:g}),!C||!Array.isArray(m)?(console.warn("Missing required data for package processing",{meetings:!!C,packages:Array.isArray(m)}),[]):m.map(P=>{const _=ye(a,P,C,g||0);return{...P,..._}})),R=h.useCallback(async m=>{try{const g=await T.get("/api/payment/pendingPayments",{params:{memberId:m||""}});d(C=>({...C,pendingPayments:g.data}))}catch(g){console.error("Error fetching pending payments:",g),E.error("Failed to fetch pending payments")}},[]),p=async m=>{try{await T.delete(`/api/payment/deleteRequest/${m}`),await x(r.selectedMemberId),E.success("Request deleted successfully")}catch(g){console.error("Error deleting request:",g),E.error("Failed to delete request")}},x=h.useCallback(async(m=r.selectedMemberId)=>{var g;if(!(t!=null&&t.chapterId)||i.current){console.warn("Chapter ID not available or already loading");return}i.current=!0,console.log("Starting fetchAllData for member:",m);try{d(N=>({...N,selectedMemberId:m})),await Promise.all([u(),R(m)]);const C=await T.get(`/api/term/chapter/${t.chapterId}`),P=C.data.filter(N=>N.status==="active");let _=r.selectedTermId;if(!_||!P.find(N=>N.termId===_)){const N=new Date,S=P.find(D=>{const M=new Date(D.startDate),F=new Date(D.endDate);return N>=M&&N<=F});if(S)_=S.termId;else if(P.length>0){const D=P.filter(M=>new Date(M.startDate)>N);D.length>0?_=D.reduce((F,U)=>new Date(F.startDate)<new Date(U.startDate)?F:U).termId:_=P[0].termId}}if(console.log("Selected term ID:",_),d(N=>({...N,terms:C.data,selectedTermId:_})),_){console.log("Fetching meetings and balance...");const[N,S]=await Promise.all([T.get(`/api/meetings/meetings/${t.chapterId}`,{params:{memberId:m||""}}),T.get(`/api/payment/balance/${t.chapterId}`,{params:{memberId:m||""}})]);console.log("Meetings fetched:",((g=N.data)==null?void 0:g.length)||0),console.log("Balance fetched:",S.data.balance),d(D=>({...D,chapterMeetings:N.data,balance:S.data.balance})),console.log("Fetching packages with fresh data..."),await w(m,_,N.data,S.data.balance),console.log("All data fetched successfully")}else console.warn("No term ID available to fetch dependent data")}catch(C){console.error("Error in fetchAllData:",C),E.error("Failed to fetch payment data")}finally{i.current=!1,n.current=!1}},[t==null?void 0:t.chapterId,r.selectedTermId,u,R,w]);return h.useEffect(()=>{t!=null&&t.chapterId&&n.current&&(console.log("Initial load triggered for chapter:",t.chapterId),x(r.selectedMemberId))},[t==null?void 0:t.chapterId,x]),h.useEffect(()=>{!n.current&&(t!=null&&t.chapterId)&&(console.log("Calculation date changed, refetching data"),x(r.selectedMemberId))},[a]),h.useEffect(()=>{r.selectedTermId&&r.selectedMemberId&&(l(r.selectedMemberId,r.selectedTermId),j(r.selectedMemberId))},[r.selectedTermId]),h.useEffect(()=>{if(r.selectedReceiver){const m=r.receivers.find(g=>g.receiverId===r.selectedReceiver);d(g=>({...g,selectedReceiverObject:m}))}},[r.selectedReceiver]),h.useEffect(()=>{const C=setInterval(()=>{const P=new Date,_=r.lastUpdated,N=r.lastSelectedPackageTime;_&&P-_>3e5&&(r.selectedPackage&&N?P-N>6e5?(E.warn("Payment window will timeout in 10 seconds..."),setTimeout(()=>{E.warn("Payment window has timed out. Refreshing data now..."),c(),x(r.selectedMemberId)},1e4)):E.info("Data will be refreshed soon due to inactivity"):(E.info("Data is stale. Refreshing now..."),x(r.selectedMemberId)))},6e4);return()=>clearInterval(C)},[r.lastUpdated,r.lastSelectedPackageTime,r.selectedPackage,r.selectedMemberId]),console.log({mainData:r.packageData}),e.jsx(be.Provider,{value:{calculationDate:a,setCalculationDate:s,paymentData:r,setPaymentData:d,resetPaymentData:c,selectPackage:y,fetchAllData:x,handleDeletePendingRequest:p,setSelectedTermId:m=>d(g=>({...g,selectedTermId:m})),fetchCurrentReceivers:u,fetchTerms:v,fetchMeetings:l,fetchDueAmount:j,fetchPackages:w,fetchPendingPayments:R},children:o})},H=()=>{const o=h.useContext(be);if(!o)throw new Error("usePaymentData must be used within a PaymentDataProvider");return o},St=({setStep:o,handlePackagePayModalClose:t})=>{const{paymentData:a,setPaymentData:s}=H(),[n,i]=h.useState(!1),[r,d]=h.useState(""),c=()=>{a.paymentMethod?a.selectedReceiver?a.receivers.filter(u=>u.receiverId===a.selectedReceiver&&u.paymentType===a.paymentMethod).length===0?d("Invalid Receiver for the selected payment method"):(d(""),o(2)):d("Please select a receiver"):d("Please select a payment method")},y=u=>{const v=a.receivers.filter(l=>l.paymentType===u);return v.length===0?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center p-8 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["No ",u==="cash"?"Cash":"Online"," Receivers Available"]}),e.jsxs("p",{className:"text-gray-500 mb-4",children:["There are currently no ",u==="cash"?"cash collection":"online payment"," receivers set up for this chapter."]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Please contact your chapter admin to set up ",u==="cash"?"cash":"online"," receivers."]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[u==="cash"?e.jsx(Z,{className:"h-5 w-5 text-green-600"}):e.jsx(ee,{className:"h-5 w-5 text-blue-600"}),e.jsxs("h3",{className:"text-lg font-medium",children:["Select a ",u==="cash"?"Cash":"Online"," Receiver"]})]}),e.jsx("div",{className:"grid gap-3 max-h-60 overflow-y-auto pr-2",children:v.map(l=>e.jsx(Ve,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${a.selectedReceiver===l.receiverId?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300"}`,onClick:()=>{s(j=>({...j,selectedReceiver:l.receiverId})),d("")},children:e.jsx(He,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center ${a.selectedReceiver===l.receiverId?"bg-blue-100":"bg-gray-100"}`,children:e.jsx(Je,{className:`h-4 w-4 sm:h-5 sm:w-5 ${a.selectedReceiver===l.receiverId?"text-blue-600":"text-gray-600"}`})})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:l.receiverName})})]}),a.selectedReceiver===l.receiverId&&e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]})})},l.receiverId))}),r&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx(X,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:r})]})]})};return h.useEffect(()=>{const u=a.receivers.filter(l=>l.paymentType==="cash"),v=a.receivers.filter(l=>l.paymentType==="online");u.length>0&&v.length>0?(s(l=>({...l,paymentMethod:l.paymentMethod||"cash"})),i(!0)):u.length>0?(s(l=>({...l,paymentMethod:"cash"})),i(!1)):(v.length>0&&s(l=>({...l,paymentMethod:"online"})),i(!1))},[a.receivers]),e.jsxs("div",{className:"flex flex-col h-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 pb-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:n?"Select Payment Method":"Payment Method"}),a.receivers.length===0&&e.jsx("p",{className:"text-gray-600 text-sm",children:"Choose how you'd like to make your payment"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto py-4 space-y-6 min-h-0",children:a.receivers.length===0?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center p-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(X,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-3",children:"No Payment Receivers Available"}),e.jsx("p",{className:"text-gray-600 mb-4 leading-relaxed",children:"There are currently no payment receivers set up for this chapter. Payment receivers are required to process your fee payment."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-blue-800 text-sm font-medium mb-2",children:"What you can do:"}),e.jsxs("ul",{className:"text-blue-700 text-sm space-y-1 text-left",children:[e.jsx("li",{children:"• Contact your chapter administrator"}),e.jsx("li",{children:"• Ask them to set up cash or online receivers"}),e.jsx("li",{children:"• Try again once receivers are configured"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Chapter admins can set up receivers in the Fee Receiver management section"})]})})}):e.jsxs(Ye,{value:a.paymentMethod,className:"w-full",onValueChange:u=>{s(v=>({...v,paymentMethod:u,selectedReceiver:""})),d("")},children:[n?e.jsxs(Ge,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(de,{value:"cash",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Cash"]}),e.jsxs(de,{value:"online",className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Online"]})]}):e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.paymentMethod==="cash"?e.jsx(Z,{className:"h-5 w-5 text-blue-600"}):e.jsx(ee,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:a.paymentMethod==="cash"?"Cash Payment":"Online Payment"}),e.jsx(Ke,{variant:"secondary",className:"ml-auto",children:"Only Available Method"})]})}),e.jsx(me,{value:"cash",className:"mt-0",children:y("cash")}),e.jsx(me,{value:"online",className:"mt-0",children:y("online")})]})}),e.jsx("div",{className:"flex-shrink-0 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx(V,{variant:"outline",onClick:()=>t(),children:"Cancel"}),a.receivers.length>0&&e.jsxs(V,{onClick:c,disabled:!a.selectedReceiver,children:["Next",e.jsx(ue,{className:"h-4 w-4 ml-1"})]})]})})]})};class I{constructor(t,a,s,n,i){this._legacyCanvasSize=I.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=t,this.$canvas=document.createElement("canvas"),s&&typeof s=="object"?this._onDecode=a:(console.warn(s||n||i?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=a),a=typeof s=="object"?s:{},this._onDecodeError=a.onDecodeError||(typeof s=="function"?s:this._onDecodeError),this._calculateScanRegion=a.calculateScanRegion||(typeof n=="function"?n:this._calculateScanRegion),this._preferredCamera=a.preferredCamera||i||this._preferredCamera,this._legacyCanvasSize=typeof s=="number"?s:typeof n=="number"?n:this._legacyCanvasSize,this._maxScansPerSecond=a.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),t.disablePictureInPicture=!0,t.playsInline=!0,t.muted=!0;let r=!1;if(t.hidden&&(t.hidden=!1,r=!0),document.body.contains(t)||(document.body.appendChild(t),r=!0),s=t.parentElement,a.highlightScanRegion||a.highlightCodeOutline){if(n=!!a.overlay,this.$overlay=a.overlay||document.createElement("div"),i=this.$overlay.style,i.position="absolute",i.display="none",i.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!n&&a.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}s.insertBefore(this.$overlay,this.$video.nextSibling)}a.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(t),requestAnimationFrame(()=>{let d=window.getComputedStyle(t);d.display==="none"&&(t.style.setProperty("display","block","important"),r=!0),d.visibility!=="visible"&&(t.style.setProperty("visibility","visible","important"),r=!0),r&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),t.style.opacity="0",t.style.width="0",t.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),t.addEventListener("play",this._onPlay),t.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=I.createQrEngine()}static set WORKER_PATH(t){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await I.listCameras(!1)).length}catch{return!1}}static async listCameras(t=!1){if(!navigator.mediaDevices)return[];let a=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput"),s;try{t&&(await a()).every(n=>!n.label)&&(s=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await a()).map((n,i)=>({id:n.deviceId,label:n.label||(i===0?"Default Camera":`Camera ${i+1}`)}))}finally{s&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),I._stopVideoStream(s))}}async hasFlash(){let t;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;t=this.$video.srcObject}else t=(await this._getCameraStream()).stream;return"torch"in t.getVideoTracks()[0].getSettings()}catch{return!1}finally{t&&t!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),I._stopVideoStream(t))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(t){throw this._flashOn=!1,t}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),I._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:t,facingMode:a}=await this._getCameraStream();!this._active||this._paused?I._stopVideoStream(t):(this._setVideoMirror(a),this.$video.srcObject=t,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(t){if(!this._paused)throw this._active=!1,t}}stop(){this.pause(),this._active=!1}async pause(t=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let a=()=>{this.$video.srcObject instanceof MediaStream&&(I._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return t?(a(),!0):(await new Promise(s=>setTimeout(s,300)),this._paused?(a(),!0):!1)}async setCamera(t){t!==this._preferredCamera&&(this._preferredCamera=t,await this._restartVideoStream())}static async scanImage(t,a,s,n,i=!1,r=!1){let d,c=!1;a&&("scanRegion"in a||"qrEngine"in a||"canvas"in a||"disallowCanvasResizing"in a||"alsoTryWithoutScanRegion"in a||"returnDetailedScanResult"in a)?(d=a.scanRegion,s=a.qrEngine,n=a.canvas,i=a.disallowCanvasResizing||!1,r=a.alsoTryWithoutScanRegion||!1,c=!0):console.warn(a||s||n||i||r?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),a=!!s;try{let y,u;[s,y]=await Promise.all([s||I.createQrEngine(),I._loadImage(t)]),[n,u]=I._drawToCanvas(y,d,n,i);let v;if(s instanceof Worker){let l=s;a||I._postWorkerMessageSync(l,"inversionMode","both"),v=await new Promise((j,w)=>{let f,R,p,x=-1;R=g=>{g.data.id===x&&(l.removeEventListener("message",R),l.removeEventListener("error",p),clearTimeout(f),g.data.data!==null?j({data:g.data.data,cornerPoints:I._convertPoints(g.data.cornerPoints,d)}):w(I.NO_QR_CODE_FOUND))},p=g=>{l.removeEventListener("message",R),l.removeEventListener("error",p),clearTimeout(f),w("Scanner error: "+(g?g.message||g:"Unknown Error"))},l.addEventListener("message",R),l.addEventListener("error",p),f=setTimeout(()=>p("timeout"),1e4);let m=u.getImageData(0,0,n.width,n.height);x=I._postWorkerMessageSync(l,"decode",m,[m.data.buffer])})}else v=await Promise.race([new Promise((l,j)=>window.setTimeout(()=>j("Scanner error: timeout"),1e4)),(async()=>{try{var[l]=await s.detect(n);if(!l)throw I.NO_QR_CODE_FOUND;return{data:l.rawValue,cornerPoints:I._convertPoints(l.cornerPoints,d)}}catch(j){if(l=j.message||j,/not implemented|service unavailable/.test(l))return I._disableBarcodeDetector=!0,I.scanImage(t,{scanRegion:d,canvas:n,disallowCanvasResizing:i,alsoTryWithoutScanRegion:r});throw`Scanner error: ${l}`}})()]);return c?v:v.data}catch(y){if(!d||!r)throw y;let u=await I.scanImage(t,{qrEngine:s,canvas:n,disallowCanvasResizing:i});return c?u:u.data}finally{a||I._postWorkerMessage(s,"close")}}setGrayscaleWeights(t,a,s,n=!0){I._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:t,green:a,blue:s,useIntegerApproximation:n})}setInversionMode(t){I._postWorkerMessage(this._qrEnginePromise,"inversionMode",t)}static async createQrEngine(t){if(t&&console.warn("Specifying a worker path is not required and not supported anymore."),t=()=>We(()=>import("./qr-scanner-worker.min-D85Z9gVD.js"),[]).then(s=>s.createWorker()),!(!I._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return t();let a=navigator.userAgentData;return a&&a.brands.some(({brand:s})=>/Chromium/i.test(s))&&/mac ?OS/i.test(a.platform)&&await a.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:s,platformVersion:n})=>/arm/i.test(s||"arm")&&13<=parseInt(n||"13")).catch(()=>!0)?t():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(t){let a=Math.round(.6666666666666666*Math.min(t.videoWidth,t.videoHeight));return{x:Math.round((t.videoWidth-a)/2),y:Math.round((t.videoHeight-a)/2),width:a,height:a,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var t=this.$video,a=t.videoWidth,s=t.videoHeight,n=t.offsetWidth,i=t.offsetHeight,r=t.offsetLeft,d=t.offsetTop,c=window.getComputedStyle(t),y=c.objectFit,u=a/s,v=n/i;switch(y){case"none":var l=a,j=s;break;case"fill":l=n,j=i;break;default:(y==="cover"?u>v:u<v)?(j=i,l=j*u):(l=n,j=l/u),y==="scale-down"&&(l=Math.min(l,a),j=Math.min(j,s))}var[w,f]=c.objectPosition.split(" ").map((p,x)=>{const m=parseFloat(p);return p.endsWith("%")?(x?i-j:n-l)*m/100:m});c=this._scanRegion.width||a,v=this._scanRegion.height||s,y=this._scanRegion.x||0;var R=this._scanRegion.y||0;u=this.$overlay.style,u.width=`${c/a*l}px`,u.height=`${v/s*j}px`,u.top=`${d+f+R/s*j}px`,s=/scaleX\(-1\)/.test(t.style.transform),u.left=`${r+(s?n-w-l:w)+(s?a-y-c:y)/a*l}px`,u.transform=t.style.transform}})}static _convertPoints(t,a){if(!a)return t;let s=a.x||0,n=a.y||0,i=a.width&&a.downScaledWidth?a.width/a.downScaledWidth:1;a=a.height&&a.downScaledHeight?a.height/a.downScaledHeight:1;for(let r of t)r.x=r.x*i+s,r.y=r.y*a+n;return t}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var t=Date.now()-this._lastScanTimestamp,a=1e3/this._maxScansPerSecond;t<a&&await new Promise(n=>setTimeout(n,a-t)),this._lastScanTimestamp=Date.now();try{var s=await I.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(n){if(!this._active)return;this._onDecodeError(n)}!I._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=I.createQrEngine()),s?(this._onDecode?this._onDecode(s):this._legacyOnDecode&&this._legacyOnDecode(s.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",s.cornerPoints.map(({x:n,y:i})=>`${n},${i}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(t){t!==I.NO_QR_CODE_FOUND&&console.log(t)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let t=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",a=[{width:{min:1024}},{width:{min:768}},{}],s=a.map(n=>Object.assign({},n,{[t]:{exact:this._preferredCamera}}));for(let n of[...s,...a])try{let i=await navigator.mediaDevices.getUserMedia({video:n,audio:!1}),r=this._getFacingMode(i)||(n.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:i,facingMode:r}}catch{}throw"Camera not found."}async _restartVideoStream(){let t=this._paused;await this.pause(!0)&&!t&&this._active&&await this.start()}static _stopVideoStream(t){for(let a of t.getTracks())a.stop(),t.removeTrack(a)}_setVideoMirror(t){this.$video.style.transform="scaleX("+(t==="user"?-1:1)+")"}_getFacingMode(t){return(t=t.getVideoTracks()[0])?/rear|back|environment/i.test(t.label)?"environment":/front|user|face/i.test(t.label)?"user":null:null}static _drawToCanvas(t,a,s,n=!1){s=s||document.createElement("canvas");let i=a&&a.x?a.x:0,r=a&&a.y?a.y:0,d=a&&a.width?a.width:t.videoWidth||t.width,c=a&&a.height?a.height:t.videoHeight||t.height;return n||(n=a&&a.downScaledWidth?a.downScaledWidth:d,a=a&&a.downScaledHeight?a.downScaledHeight:c,s.width!==n&&(s.width=n),s.height!==a&&(s.height=a)),a=s.getContext("2d",{alpha:!1}),a.imageSmoothingEnabled=!1,a.drawImage(t,i,r,d,c,0,0,s.width,s.height),[s,a]}static async _loadImage(t){if(t instanceof Image)return await I._awaitImageLoad(t),t;if(t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement||t instanceof SVGImageElement||"OffscreenCanvas"in window&&t instanceof OffscreenCanvas||"ImageBitmap"in window&&t instanceof ImageBitmap)return t;if(t instanceof File||t instanceof Blob||t instanceof URL||typeof t=="string"){let a=new Image;a.src=t instanceof File||t instanceof Blob?URL.createObjectURL(t):t.toString();try{return await I._awaitImageLoad(a),a}finally{(t instanceof File||t instanceof Blob)&&URL.revokeObjectURL(a.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(t){t.complete&&t.naturalWidth!==0||await new Promise((a,s)=>{let n=i=>{t.removeEventListener("load",n),t.removeEventListener("error",n),i instanceof ErrorEvent?s("Image load error"):a()};t.addEventListener("load",n),t.addEventListener("error",n)})}static async _postWorkerMessage(t,a,s,n){return I._postWorkerMessageSync(await t,a,s,n)}static _postWorkerMessageSync(t,a,s,n){if(!(t instanceof Worker))return-1;let i=I._workerMessageId++;return t.postMessage({id:i,type:a,data:s},n),i}}I.DEFAULT_CANVAS_SIZE=400;I.NO_QR_CODE_FOUND="No QR code found";I._disableBarcodeDetector=!1;I._workerMessageId=0;const Rt=({onClose:o,onPaymentSuccess:t,setStep:a,handlePackagePayModalClose:s})=>{const{paymentData:{selectedPackage:n,chapterMeetings:i,receivers:r,selectedReceiver:d,selectedReceiverObject:c,receiverFeeAmount:y,paymentProof:u,platformFee:v,platformFeeAmount:l,platformFeeType:j},setPaymentData:w}=H(),{chapterData:f}=Y(),[R]=h.useState(new Date().toLocaleDateString()),[p,x]=h.useState(!1),[m,g]=h.useState([]),[C,P]=h.useState(!1),[_,N]=h.useState(!0),[S,D]=h.useState(n.totalAmount),[M,F]=h.useState(0);h.useEffect(()=>{if(n.meetingIds&&i){const b=i.filter(k=>n.meetingIds.includes(k.meetingId));g(b)}},[n.meetingIds,i]),h.useEffect(()=>{if(c)if(c.receiverAmountType==="lumpsum"&&_)w(b=>({...b,receiverFeeAmount:c.receiverAmount}));else if(c.receiverAmountType==="percentage"&&_){const b=n.totalAmount*c.receiverAmount/100;w(k=>({...k,receiverFeeAmount:b}))}else w(b=>({...b,receiverFeeAmount:0}))},[c,n,_]),h.useEffect(()=>{if(f)if(f.platformFeeCase!=="per-payment")w(b=>({...b,platformFeeAmount:0}));else if(f.platformFeeType==="Lumpsum")w(b=>({...b,platformFeeAmount:f.platformFee}));else if(f.platformFeeType==="Percentage"){const b=n.totalAmount*f.platformFee;w(k=>({...k,platformFeeAmount:b}))}else w(b=>({...b,platformFeeAmount:0}))},[f,n]);const U=b=>{const k=b.target.files[0];k&&w(L=>({...L,paymentProof:k}))};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[1000]",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg shadow-xl relative max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 text-center mb-4",children:"Payment Overview"}),e.jsxs("div",{className:"border p-4 rounded-lg mb-4 bg-gray-50",children:[e.jsx("p",{className:"text-gray-700 font-semibold text-lg",children:"Total Payable Amount:"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-600",children:["₹",parseInt(n.totalAmount)+(parseInt(y)||0)+(parseInt(l)||0)]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsxs("p",{children:["₹",n.packageFeeAmount," (Original Amount)"]}),n.penaltyAmount>0&&e.jsxs("p",{className:"text-red-500",children:["+ ₹",n.penaltyAmount," (Penalty)"]}),n.discountAmount>0&&e.jsxs("p",{className:"text-green-500",children:["- ₹",n.discountAmount," (Discount)"]}),n.previousBalance!==0&&e.jsxs("p",{className:"text-orange-500",children:[" ",n.previousBalance>0?"-":"+"," ₹",Math.abs(n.previousBalance)," (",n.previousBalance>0?"Advance":"Previous Due",")"]}),n.paidFees>0&&e.jsxs("p",{className:"text-blue-500",children:["- ₹",n.paidFees," (Paid Previously)"]}),y>0&&e.jsxs("p",{className:"text-blue-500",children:["+ ₹",y," (Receiver Fee)"]}),l>0&&e.jsxs("p",{className:"text-blue-500",children:["+ ₹",l," (Platform Fee)"]})]})]}),c.receiverFeeOptional!==0&&(c==null?void 0:c.receiverFeeOptional)&&e.jsxs("div",{className:"flex items-center space-x-4 my-4",children:[e.jsx(Ze,{checked:_,onCheckedChange:b=>N(b),className:"h-5"}),e.jsx(et,{className:"text-lg",children:(c==null?void 0:c.receiverFeeOptionalMessage)||"Would you like to pay the receiver fee? (charges applicable)"})," "]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 font-semibold",children:"Meetings Included:"}),e.jsxs("button",{onClick:()=>x(!p),className:"flex items-center text-lg font-medium text-blue-500 hover:underline focus:outline-none",children:[m.length," Meetings",p?e.jsx(tt,{className:"ml-2",size:18}):e.jsx(pe,{className:"ml-2",size:18})]}),p&&e.jsx("div",{className:"mt-2 max-h-[200px] overflow-y-auto",children:m.length>0?m==null?void 0:m.map(b=>e.jsxs("div",{className:`border p-2 rounded mb-2 ${b.isPaid?"bg-green-100":""}`,children:[e.jsx("p",{children:e.jsx("strong",{children:b.meetingName})}),e.jsxs("p",{children:[q(b.meetingDate)," at"," ",b.meetingTime]}),b.isPaid&&e.jsx("p",{className:"text-green-500 font-semibold",children:"Paid"})]},b.meetingId)):e.jsx("p",{children:"No meetings found"})})]}),e.jsxs("div",{children:["You are paying to ",c==null?void 0:c.receiverName,".",e.jsx("p",{className:"text-blue-500 cursor-pointer",onClick:()=>a(1),children:"Click here to change receiver."})]}),c&&c.qrImageLink&&e.jsxs("div",{className:"mt-4",children:[e.jsx(Dt,{imageUrl:c.qrImageLink}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx(V,{variant:"outline",onClick:()=>{E.warn("This feature may not work on all browsers. If it doesn't work, please download the QR Code and scan it using a QR Code scanner app."),fetch(c.qrImageLink).then(b=>b.blob()).then(b=>{const k=URL.createObjectURL(b),L=new Image;L.crossOrigin="Anonymous",L.src=k,L.onload=async()=>{try{const A=await I.scanImage(L);URL.revokeObjectURL(k),A.indexOf("://")||A.startsWith("http://")||A.startsWith("https://")?window.open(A,"_blank"):E.error("QR Code does not contain a valid link.")}catch(A){console.error("QR decoding failed:",A),E.error("Failed to decode QR Code.")}}}).catch(b=>{E.error("Error fetching QR Code image"),console.error(b)})},children:"Open QR Link"}),e.jsx(V,{variant:"outline",onClick:()=>{fetch(c.qrImageLink).then(b=>b.blob()).then(b=>{const k=document.createElement("a");k.href=URL.createObjectURL(b);const L=`QR_Code_${c.receiverName}.png`;k.download=L,k.click(),URL.revokeObjectURL(k.href)}).catch(b=>{E.error("Error downloading QR Code"),console.error(b)})},children:"Download QR Code"})]}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Upload Payment Proof:"}),e.jsxs("label",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 p-4 rounded-lg cursor-pointer hover:bg-gray-100 transition",children:[e.jsx(ot,{className:"text-gray-500",size:24}),e.jsx("span",{className:"text-gray-600 mt-2 text-sm",children:"Click to select or drag and drop an image here"}),e.jsx("input",{type:"file",name:"file",accept:"image/*",onChange:U,className:"hidden"})]}),u&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Uploaded: ",u.name]})]}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsxs(V,{variant:"outline",onClick:()=>a(1),children:[e.jsx(fe,{}),"Back"]}),e.jsxs(V,{onClick:()=>{w(b=>({...b,totalPayableAmount:(parseInt(n.totalAmount)||0)+(parseInt(y)||0)+(parseInt(l)||0)})),a(3)},children:["Next",e.jsx(ue,{})]})]})]})})},Dt=({imageUrl:o})=>{const[t,a]=h.useState(!0);return e.jsxs("div",{className:"relative",children:[t&&e.jsx(Xe,{className:"w-full h-32 rounded-lg"})," ",e.jsx("img",{src:o,alt:"QR Code",className:`mb-2 rounded-lg ${t?"hidden":"block"}`,onLoad:()=>a(!1)})]})},kt=({setStep:o,handlePackagePayModalClose:t})=>{const{paymentData:{selectedPackage:a,chapterMeetings:s,receivers:n,selectedReceiver:i,paymentProof:r,paymentDate:d,selectedReceiverObject:c,receiverFeeAmount:y,platformFeeAmount:u,totalPayableAmount:v,selectedMemberId:l},fetchAllData:j}=H(),{chapterData:w}=Y(),[f,R]=h.useState(v),p=f-v,[x,m]=h.useState(!1),[g,C]=h.useState(!1),P=async()=>{C(!0);let _="";if(r){const S=new FormData;S.append("image",r),S.append("folderName","memberPaymentProofs"),_=await T.post("/api/image-upload",S,{headers:{"Content-Type":"multipart/form-data"}}).then(D=>D.data.imageUrl)}const N={memberId:l,packageId:a.packageId,meetingIds:a.meetingIds,chapterId:w.chapterId,transactionType:"Package Payment",paidAmount:f,payableAmount:v,originalPayableAmount:parseFloat(a.packageFeeAmount),discountAmount:a.discountAmount,penaltyAmount:a.penaltyAmount,receiverFee:y,amountPaidToChapter:(parseFloat(f)||0)-(parseFloat(u)||0)-(parseFloat(y)||0),amountExpectedToChapter:a.totalAmount,platformFee:u,balanceAmount:p,paymentType:c==null?void 0:c.paymentType,paymentDate:d,paymentImageLink:_,paymentReceivedById:(c==null?void 0:c.memberId)||"",paymentReceivedByName:(c==null?void 0:c.receiverName)||""};await T.post("/api/payment/addPayment",N).then(S=>{j(),t(),E.success("Payment submitted successfully")}).catch(S=>{console.error("Error submitting payment:",S),C(!1)}).finally(()=>{C(!1)})};return e.jsxs("div",{className:"p-6 max-w-md mx-auto bg-white rounded-xl shadow-md space-y-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Total Payable Amount: ₹",v]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:"Enter Amount to Pay:"}),e.jsx("input",{type:"number",value:f,onChange:_=>{let N=Number(_.target.value);N<0&&(N=0),R(N)},className:"w-full p-2 border border-gray-300 rounded text-center"})]}),f===v?e.jsx("h3",{className:"text-xl font-semibold text-green-700",children:"You have paid the exact amount"}):f<v?e.jsxs("h3",{className:"text-xl font-semibold text-red-700",children:["You will be due by ₹",Math.abs(p)]}):e.jsxs("h3",{className:"text-xl font-semibold text-green-700",children:["You will pay advance of ₹",Math.abs(p)]}),e.jsxs("h5",{className:"text-sm font-semibold text-gray-700",children:["Amount will be received by: ",c==null?void 0:c.receiverName]}),e.jsxs(lt,{open:x,onOpenChange:m,children:[e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsxs(V,{variant:"outline",onClick:()=>o(2),children:[e.jsx(fe,{}),"Back"]}),e.jsx(V,{onClick:()=>m(!0),children:"Confirm"})]}),e.jsxs(ct,{children:[e.jsxs(dt,{children:[e.jsx(mt,{children:"Confirm Payment"}),e.jsxs(ht,{children:["Are you sure you want to confirm payment of ₹",f,"?",f>v&&e.jsxs("div",{className:"mt-2 text-green-700 font-semibold",children:["(You are paying ₹",Math.abs(p)," advance)"]}),f<v&&e.jsxs("div",{className:"mt-2 text-red-700 font-semibold",children:["(You will be due by ₹",Math.abs(p),")"]})]})]}),e.jsxs(ut,{children:[e.jsx(pt,{disabled:g,children:"Cancel"}),e.jsxs(ft,{onClick:P,disabled:g,className:"flex items-center justify-center",children:[g&&e.jsx(qe,{className:"mr-2 h-4 w-4 animate-spin"}),g?"Processing...":"Confirm"]})]})]})]})]})},Et=({selectedPackage:o,pendingPayments:t,packageData:a,paymentSuccessHandler:s,parentType:n,chapterMeetings:i,handlePackagePayModalClose:r})=>{const{receivers:d}=H(),[c,y]=h.useState(1),[u,v]=h.useState(null),l=()=>{r()};return e.jsxs("div",{children:[c===1&&e.jsx(St,{selectedReceiver:u,setSelectedReceiver:v,packageData:a,setStep:y,handlePackagePayModalClose:r}),c===2&&e.jsx(Rt,{selectedPackage:o,pendingPayments:t,packageData:a,paymentSuccessHandler:s,parentType:n,chapterMeetings:i,receivers:d,setStep:y,handlePackagePayModalClose:l}),c===3&&e.jsx(kt,{setStep:y,handlePackagePayModalClose:l})]})},Mt=({pendingPayments:o,parentType:t,paymentSuccessHandler:a})=>{const{paymentData:{receivers:s,chapterMeetings:n,packageParents:i,selectedPackage:r,packageData:d},resetPaymentData:c,setPaymentData:y}=H(),[u,v]=h.useState(!1),[l,j]=h.useState(!0),w=()=>{c(),j(!1)};h.useEffect(()=>{j(!!r)},[r]);const f=p=>{j(!0),y(x=>({...x,selectedPackage:p,lastSelectedPackageTime:new Date}))},R=d.filter(p=>p.packageParent===t).filter(p=>!u||!p.isPaid).sort((p,x)=>p.isDisabled!==x.isDisabled?p.isDisabled-x.isDisabled:0);return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center p-4 hidden",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>v(!u),className:"form-checkbox"}),e.jsx("span",{children:"Show Unpaid Only"})]})})}),e.jsx(Q,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-4",children:R.map(p=>e.jsxs("div",{className:`bg-white shadow-md rounded-lg p-6 border border-gray-200 hover:shadow-lg ${p.isDisabled?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:p.packageName}),!p.isDisabled&&p.totalAmount!==null&&p.status!=="approved"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-700 mb-1",children:[`₹${p.packageFeeAmount}`,p.penaltyAmount>0&&e.jsxs("span",{className:"text-red-500",children:[" ","+ ₹",p.penaltyAmount]}),p.discountAmount>0&&e.jsxs("span",{className:"text-green-500",children:[" ","- ₹",p.discountAmount]}),p.previousBalance!==0&&e.jsxs("span",{className:"text-orange-500",children:[" ",p.previousBalance>0?"-":"+"," ₹",Math.abs(p.previousBalance)," (",p.previousBalance>0?"Advance":"Previous Due",")"]}),"= ₹",p.totalAmount]}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Payable End Date:"," ",q(p.packagePayableEndDate)]}),e.jsx(wt,{className:"mt-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700",variant:"contained",onClick:()=>f(p),disabled:p.isDisabled||(o==null?void 0:o.length)>0,children:"Pay Now"})]}):p.status==="approved"?e.jsx(e.Fragment,{children:e.jsxs("div",{children:["You have paid ₹",p.paidAmount," for this package on"," ",new Date(p.paymentDate).toLocaleDateString()," to"," ",e.jsx("b",{children:p.paymentReceivedByName})," by"," ",e.jsx("b",{children:p.paymentType})]})}):e.jsx("p",{className:"text-gray-700 mb-1",children:p.message||"Payment Not Allowed"})]},p.packageId))}),r&&s&&e.jsxs(gt,{open:l,onOpenChange:w,children:[e.jsx(xt,{}),e.jsx(vt,{className:"sm:max-w-[425px] p-4 max-w-[90%] rounded-lg",children:e.jsx(Et,{selectedPackage:r,pendingPayments:o,packageData:d,paymentSuccessHandler:a,parentType:t,chapterMeetings:n,receivers:s,handlePackagePayModalClose:w})})]})]})};var G="Collapsible",[Tt,we]=ge(G),[Ot,ne]=Tt(G),je=h.forwardRef((o,t)=>{const{__scopeCollapsible:a,open:s,defaultOpen:n,disabled:i,onOpenChange:r,...d}=o,[c,y]=se({prop:s,defaultProp:n??!1,onChange:r,caller:G});return e.jsx(Ot,{scope:a,disabled:i,contentId:xe(),open:c,onOpenToggle:h.useCallback(()=>y(u=>!u),[y]),children:e.jsx(W.div,{"data-state":ie(c),"data-disabled":i?"":void 0,...d,ref:t})})});je.displayName=G;var Ne="CollapsibleTrigger",Ce=h.forwardRef((o,t)=>{const{__scopeCollapsible:a,...s}=o,n=ne(Ne,a);return e.jsx(W.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":ie(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...s,ref:t,onClick:ve(o.onClick,n.onOpenToggle)})});Ce.displayName=Ne;var re="CollapsibleContent",Ie=h.forwardRef((o,t)=>{const{forceMount:a,...s}=o,n=ne(re,o.__scopeCollapsible);return e.jsx(It,{present:a||n.open,children:({present:i})=>e.jsx($t,{...s,ref:t,present:i})})});Ie.displayName=re;var $t=h.forwardRef((o,t)=>{const{__scopeCollapsible:a,present:s,children:n,...i}=o,r=ne(re,a),[d,c]=h.useState(s),y=h.useRef(null),u=he(t,y),v=h.useRef(0),l=v.current,j=h.useRef(0),w=j.current,f=r.open||d,R=h.useRef(f),p=h.useRef(void 0);return h.useEffect(()=>{const x=requestAnimationFrame(()=>R.current=!1);return()=>cancelAnimationFrame(x)},[]),Nt(()=>{const x=y.current;if(x){p.current=p.current||{transitionDuration:x.style.transitionDuration,animationName:x.style.animationName},x.style.transitionDuration="0s",x.style.animationName="none";const m=x.getBoundingClientRect();v.current=m.height,j.current=m.width,R.current||(x.style.transitionDuration=p.current.transitionDuration,x.style.animationName=p.current.animationName),c(s)}},[r.open,s]),e.jsx(W.div,{"data-state":ie(r.open),"data-disabled":r.disabled?"":void 0,id:r.contentId,hidden:!f,...i,ref:u,style:{"--radix-collapsible-content-height":l?`${l}px`:void 0,"--radix-collapsible-content-width":w?`${w}px`:void 0,...o.style},children:f&&n})});function ie(o){return o?"open":"closed"}var Ft=je,Lt=Ce,Bt=Ie,$="Accordion",Ut=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[oe,Vt,Ht]=Ct($),[K]=ge($,[Ht,we]),le=we(),Pe=O.forwardRef((o,t)=>{const{type:a,...s}=o,n=s,i=s;return e.jsx(oe.Provider,{scope:o.__scopeAccordion,children:a==="multiple"?e.jsx(zt,{...i,ref:t}):e.jsx(Qt,{...n,ref:t})})});Pe.displayName=$;var[Ae,Wt]=K($),[_e,qt]=K($,{collapsible:!1}),Qt=O.forwardRef((o,t)=>{const{value:a,defaultValue:s,onValueChange:n=()=>{},collapsible:i=!1,...r}=o,[d,c]=se({prop:a,defaultProp:s??"",onChange:n,caller:$});return e.jsx(Ae,{scope:o.__scopeAccordion,value:O.useMemo(()=>d?[d]:[],[d]),onItemOpen:c,onItemClose:O.useCallback(()=>i&&c(""),[i,c]),children:e.jsx(_e,{scope:o.__scopeAccordion,collapsible:i,children:e.jsx(Se,{...r,ref:t})})})}),zt=O.forwardRef((o,t)=>{const{value:a,defaultValue:s,onValueChange:n=()=>{},...i}=o,[r,d]=se({prop:a,defaultProp:s??[],onChange:n,caller:$}),c=O.useCallback(u=>d((v=[])=>[...v,u]),[d]),y=O.useCallback(u=>d((v=[])=>v.filter(l=>l!==u)),[d]);return e.jsx(Ae,{scope:o.__scopeAccordion,value:r,onItemOpen:c,onItemClose:y,children:e.jsx(_e,{scope:o.__scopeAccordion,collapsible:!0,children:e.jsx(Se,{...i,ref:t})})})}),[Yt,J]=K($),Se=O.forwardRef((o,t)=>{const{__scopeAccordion:a,disabled:s,dir:n,orientation:i="vertical",...r}=o,d=O.useRef(null),c=he(d,t),y=Vt(a),v=Pt(n)==="ltr",l=ve(o.onKeyDown,j=>{var N;if(!Ut.includes(j.key))return;const w=j.target,f=y().filter(S=>{var D;return!((D=S.ref.current)!=null&&D.disabled)}),R=f.findIndex(S=>S.ref.current===w),p=f.length;if(R===-1)return;j.preventDefault();let x=R;const m=0,g=p-1,C=()=>{x=R+1,x>g&&(x=m)},P=()=>{x=R-1,x<m&&(x=g)};switch(j.key){case"Home":x=m;break;case"End":x=g;break;case"ArrowRight":i==="horizontal"&&(v?C():P());break;case"ArrowDown":i==="vertical"&&C();break;case"ArrowLeft":i==="horizontal"&&(v?P():C());break;case"ArrowUp":i==="vertical"&&P();break}const _=x%p;(N=f[_].ref.current)==null||N.focus()});return e.jsx(Yt,{scope:a,disabled:s,direction:n,orientation:i,children:e.jsx(oe.Slot,{scope:a,children:e.jsx(W.div,{...r,"data-orientation":i,ref:c,onKeyDown:s?void 0:l})})})}),z="AccordionItem",[Gt,ce]=K(z),Re=O.forwardRef((o,t)=>{const{__scopeAccordion:a,value:s,...n}=o,i=J(z,a),r=Wt(z,a),d=le(a),c=xe(),y=s&&r.value.includes(s)||!1,u=i.disabled||o.disabled;return e.jsx(Gt,{scope:a,open:y,disabled:u,triggerId:c,children:e.jsx(Ft,{"data-orientation":i.orientation,"data-state":Oe(y),...d,...n,ref:t,disabled:u,open:y,onOpenChange:v=>{v?r.onItemOpen(s):r.onItemClose(s)}})})});Re.displayName=z;var De="AccordionHeader",ke=O.forwardRef((o,t)=>{const{__scopeAccordion:a,...s}=o,n=J($,a),i=ce(De,a);return e.jsx(W.h3,{"data-orientation":n.orientation,"data-state":Oe(i.open),"data-disabled":i.disabled?"":void 0,...s,ref:t})});ke.displayName=De;var te="AccordionTrigger",Ee=O.forwardRef((o,t)=>{const{__scopeAccordion:a,...s}=o,n=J($,a),i=ce(te,a),r=qt(te,a),d=le(a);return e.jsx(oe.ItemSlot,{scope:a,children:e.jsx(Lt,{"aria-disabled":i.open&&!r.collapsible||void 0,"data-orientation":n.orientation,id:i.triggerId,...d,...s,ref:t})})});Ee.displayName=te;var Me="AccordionContent",Te=O.forwardRef((o,t)=>{const{__scopeAccordion:a,...s}=o,n=J($,a),i=ce(Me,a),r=le(a);return e.jsx(Bt,{role:"region","aria-labelledby":i.triggerId,"data-orientation":n.orientation,...r,...s,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...o.style}})});Te.displayName=Me;function Oe(o){return o?"open":"closed"}var Kt=Pe,Jt=Re,Xt=ke,$e=Ee,Fe=Te;const Zt=Kt,Le=h.forwardRef(({className:o,...t},a)=>e.jsx(Jt,{ref:a,className:ae("border-b",o),...t}));Le.displayName="AccordionItem";const Be=h.forwardRef(({className:o,children:t,...a},s)=>e.jsx(Xt,{className:"flex",children:e.jsxs($e,{ref:s,className:ae("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",o),...a,children:[t,e.jsx(pe,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Be.displayName=$e.displayName;const Ue=h.forwardRef(({className:o,children:t,...a},s)=>e.jsx(Fe,{ref:s,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:e.jsx("div",{className:ae("pb-4 pt-0",o),children:t})}));Ue.displayName=Fe.displayName;const ea=({pendingPayments:o,handleDeletePendingRequest:t,fetchAllData:a})=>o.length===0?null:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-yellow-100 rounded-md",children:[e.jsxs("p",{className:"text-base font-medium text-yellow-800 dark:text-yellow-200",children:["You have ",e.jsx("strong",{children:"pending payments"}),". Please contact admin to approve requests to continue."]}),e.jsx("button",{className:"px-4 py-2 text-sm font-semibold text-yellow-800 bg-yellow-300 rounded-md hover:bg-yellow-400 dark:text-yellow-200 dark:bg-yellow-400 transition-colors",onClick:a,children:"Refresh"})]}),e.jsx("div",{className:"mt-4 space-y-4",children:o.map(s=>{var n,i,r,d;return e.jsxs("div",{className:"p-4 sm:p-6 border border-yellow-300 rounded-lg bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl sm:text-2xl font-semibold text-yellow-900 dark:text-yellow-100 mb-1",children:s.packageName}),e.jsxs("p",{className:"text-base text-yellow-700 dark:text-yellow-300",children:[s.packageFeeType," • ",new Date(s.paymentDate).toLocaleDateString()]})]}),e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200 self-start sm:self-center",children:s.status.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[s.paidAmount===s.payableAmount?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Amount:"}),e.jsxs("span",{className:"text-lg font-semibold text-blue-700 dark:text-blue-400",children:["₹",(n=s.paidAmount)==null?void 0:n.toLocaleString()]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Paid:"}),e.jsxs("span",{className:"text-lg font-semibold text-green-700 dark:text-green-400",children:["₹",(i=s.paidAmount)==null?void 0:i.toLocaleString()]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Original Amount:"}),e.jsxs("span",{className:"text-lg font-semibold text-blue-700 dark:text-blue-400",children:["₹",(r=s.payableAmount)==null?void 0:r.toLocaleString()]})]})]}),s.balanceAmount!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Balance:"}),e.jsxs("span",{className:`text-lg font-semibold ${s.balanceAmount<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:["₹",(d=Math.abs(s.balanceAmount))==null?void 0:d.toLocaleString(),s.balanceAmount<0?" Due":" Advance"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center pt-4 border-t border-yellow-200 gap-3",children:[e.jsxs("div",{className:"text-base text-yellow-700 dark:text-yellow-300",children:[e.jsx("span",{className:"capitalize font-medium",children:s.paymentType}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:s.paymentReceivedByName||"Unknown"})]}),e.jsx("button",{className:"px-4 py-2 text-base font-medium text-red-700 bg-red-100 border border-red-300 rounded-md hover:bg-red-200 dark:bg-red-900/30 dark:text-red-200 dark:border-red-600 transition-colors self-start sm:self-center",onClick:()=>t(s.transactionId),children:"Delete Request"})]})]},s.transactionId)})})]}),ta=()=>{const{paymentData:{receivers:o,chapterMeetings:t,balance:a,packageParents:s,packageData:n,pendingPayments:i,terms:r,selectedTermId:d},calculationDate:c,setCalculationDate:y,setPaymentData:u,fetchAllData:v,handleDeletePendingRequest:l,setSelectedTermId:j}=H(),{chapterData:w,memberData:f}=Y(),[R,p]=O.useState(0),[x,m]=h.useState({value:f==null?void 0:f.memberId,label:`${f==null?void 0:f.firstName} ${f==null?void 0:f.lastName}`}),[g,C]=h.useState([]),[P,_]=h.useState([]),[N,S]=h.useState(!1),[D,M]=h.useState(!1),[F,U]=h.useState(!1);h.useEffect(()=>{f!=null&&f.memberId&&!x.value&&m({value:f==null?void 0:f.memberId,label:`${f==null?void 0:f.firstName} ${f==null?void 0:f.lastName}`})},[f]);const b=()=>{v(x.value)},k=(A,B)=>{p(B)},L=async()=>{try{const A=await T.get("/api/member/all",{params:{chapterId:w==null?void 0:w.chapterId}});_(A.data),C(A.data)}catch{toast.error("Error fetching members")}};return h.useEffect(()=>{w!=null&&w.chapterId&&D&&L()},[w,D]),h.useEffect(()=>{x&&(v(x.value),u(A=>({...A,selectedMemberId:x.value,selectedMemberName:x.label})))},[x]),h.useEffect(()=>{w!=null&&w.chapterId&&(T.get(`/api/rights/anyMemberMaketransaction/${w.chapterId}`).then(A=>{M(A.data.allowed)}).catch(A=>{console.error("Error fetching member transaction rights:",A)}),T.get(`/api/rights/changeDate/${w.chapterId}`).then(A=>{U(A.data.allowed)}).catch(A=>{console.error("Error fetching change date rights:",A)}))},[w]),e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-3 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:[e.jsx(ea,{pendingPayments:i,handleDeletePendingRequest:l,fetchAllData:()=>v(x.value)}),e.jsxs("div",{className:"flex justify-between items-start flex-wrap",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 text-nowrap",children:"Current Date:"}),e.jsx("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 text-nowrap",children:e.jsx(sa,{})})]}),(F||D)&&e.jsx(Zt,{type:"single",collapsible:!0,children:e.jsxs(Le,{value:"item-1",children:[e.jsx(Be,{children:"Additional Settings"}),e.jsxs(Ue,{children:[F&&e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(jt,{type:"date",value:c.toISOString().split("T")[0],onChange:A=>{const B=new Date(A.target.value);y(B),ye(B,n,t,u)},placeholder:"Calculation Date"})}),D&&e.jsx("div",{className:"flex items-center space-x-4 mt-4",children:e.jsx(ze,{members:P,selectedMember:x,setSelectedMember:m})})]})]})}),r&&r.filter(A=>A.status==="active").length>1&&e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsx("label",{className:"text-md font-semibold",children:"Select Active Term:"}),e.jsxs(at,{value:d||"",onValueChange:A=>{j(A),v(x==null?void 0:x.value)},children:[e.jsx(st,{className:"w-[200px]",children:e.jsx(nt,{placeholder:"Select term"})}),e.jsx(rt,{children:r.filter(A=>A.status==="active").map(A=>e.jsx(it,{value:A.termId,children:A.termName},A.termId))})]})]})]}),!!a&&e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center space-x-2 text-nowrap",children:[e.jsxs("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:[a>0?"Advance Amount":"Due Amount",":"]}),e.jsxs("p",{className:`text-lg font-semibold ${a>0?"text-green-500":"text-red-500"}`,children:["₹",Math.abs(a)]})]})})]}),e.jsxs(Q,{sx:{width:"100%"},children:[e.jsx(Q,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsx(yt,{value:R,onChange:k,"aria-label":"fee tabs",children:s==null?void 0:s.map((A,B)=>e.jsx(bt,{label:A},B))})}),o&&(s==null?void 0:s.map((A,B)=>e.jsx(aa,{value:R,index:B,children:e.jsx(Mt,{pendingPayments:i,packageData:n,paymentSuccessHandler:b,parentType:A,receivers:o})},B)))]})]})};function aa(o){const{children:t,value:a,index:s,...n}=o;return e.jsx("div",{role:"tabpanel",hidden:a!==s,id:`simple-tabpanel-${s}`,"aria-labelledby":`simple-tab-${s}`,...n,children:a===s&&e.jsx(Q,{sx:{p:3},children:t})})}const sa=()=>{const[o,t]=h.useState(new Date);return h.useEffect(()=>{const a=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(a)},[]),e.jsxs("span",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:[o.getDate(),"-",o.getMonth()+1,"-",o.getFullYear()," ",o.getHours(),":",o.getMinutes().toString().padStart(2,"0"),":",o.getSeconds().toString().padStart(2,"0")]})},Ha=()=>e.jsxs(e.Fragment,{children:[e.jsx(Qe,{items:[{name:"Packages",link:"/member/packages"}]}),e.jsx(_t,{children:e.jsx(ta,{})})]});export{Ha as default};
