import{j as e,r as l,B as k,g as ae,c as A,Q as v}from"./index.js";import{u as we}from"./useWindowDimensions.js";import{B as Ce}from"./Breadcrumb.js";import{c as se}from"./CircularProgress.js";import{T as Ae,a as Se,b as K,c as Z}from"./tabs2.js";import{D as te,f as Ie,a as re,b as ne,c as le,d as Te,g as De,e as Pe}from"./dialog.js";import{I as oe}from"./input.js";import{L as U}from"./label.js";import{S as Me,a as Re,b as Ee,c as Fe,d as Be}from"./select.js";import{C as $e,a as _e,b as ze,c as Oe,e as Le}from"./command.js";import{T as ie,a as ce,b as L,c as T,d as de,e as S}from"./table.js";import{A as qe,e as Ye,a as He,b as Ve,c as Qe,d as We,g as Ue,h as Xe}from"./alert-dialog.js";import{T as Ge}from"./textarea.js";import{I as Je}from"./IconButton.js";import"./chevron-right.js";import"./TransitionGroupContext.js";import"./index4.js";import"./index11.js";import"./index9.js";import"./index6.js";import"./index3.js";import"./index5.js";import"./index10.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./search.js";const Ke=se(e.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),Ze=({receivedAmount:o,setReceivedAmount:d,selectedReceiver:n,setSelectedReceiver:u,selectedPaymentMode:r,setSelectedPaymentMode:m,receiverList:g,allMembers:w,showAllMembers:f,setShowAllMembers:b,paymentModes:C,selectedFee:t,canChangeReceiver:s,setCanChangeReceiver:P,onCancel:x,onSave:h,onApprove:D,saveDisabled:N,approveDisabled:M})=>{const[$,_]=l.useState(!1),[E,q]=l.useState(null),[Y,z]=l.useState(null);l.useEffect(()=>{if(!t)return;const i=parseFloat(o)||0,F=parseFloat(t.payableAmount)||0,R=parseFloat(t.platformFee)||0,H=parseFloat(t.receiverFee)||0;q(i-F),z(i-R-H)},[o,t]);const O=g.find(i=>i.memberId===n);return e.jsxs("div",{className:"space-y-4 py-4 w-full max-w-md mx-auto sm:max-w-lg md:max-w-xl lg:max-w-2xl px-2 sm:px-4",style:{maxWidth:"100vw",overflowX:"hidden"},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Member Details:"}),e.jsxs("p",{className:"text-sm",children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}),e.jsxs("p",{className:"text-sm",children:["Package: ",t==null?void 0:t.packageName]}),e.jsxs("p",{className:"text-sm",children:["Original Payable Amount: â‚¹",t==null?void 0:t.payableAmount]}),e.jsxs("p",{className:"text-sm",children:["Expected Amount: â‚¹",t==null?void 0:t.paidAmount]}),e.jsxs("p",{className:"text-sm",children:["Dues: â‚¹",t==null?void 0:t.balanceAmount]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"amount",children:"Amount Received"}),e.jsx(oe,{id:"amount",type:"number",value:o,onChange:i=>d(i.target.value),placeholder:"Enter amount received",className:"w-full"}),e.jsxs("div",{className:"flex flex-col gap-1 mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Live Balance Amount: ",e.jsxs("span",{className:E===0?"text-green-700 dark:text-green-300":E<0?"text-red-700 dark:text-red-300":"text-yellow-700 dark:text-yellow-300",children:["â‚¹",E??"-"]})]}),e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Amount Paid to Chapter: ",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300",children:["â‚¹",Y??"-"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"receiver",children:"Receiver"}),!s&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-2",children:O?e.jsxs(e.Fragment,{children:[O.receiverName," is the receiver for this payment."," ",e.jsx("button",{className:"text-blue-600 underline ml-1",type:"button",onClick:()=>P(!0),children:"Not the receiver? Click here to change"})]}):e.jsxs(e.Fragment,{children:["Receiver not found."," ",e.jsx("button",{className:"text-blue-600 underline ml-1",type:"button",onClick:()=>P(!0),children:"Click here to select"})]})}),s&&e.jsxs("div",{className:"relative",children:[e.jsxs(k,{type:"button",variant:"outline",className:"w-full flex justify-between items-center",onClick:()=>_(i=>!i),children:[(()=>{const i=(f?w:g).find(F=>F.memberId===n);return i?i.receiverName||i.firstName+" "+i.lastName:"Select receiver"})(),e.jsx("span",{className:"ml-2",children:"â–¼"})]}),$&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white dark:bg-boxdark border rounded shadow-lg max-h-60 overflow-y-auto",children:e.jsxs($e,{className:"w-full border-none shadow-none",children:[e.jsx(_e,{placeholder:"Search receiver..."}),e.jsxs(ze,{children:[(f?w:g).length===0&&e.jsx(Oe,{children:"No receivers found."}),(f?w:g).map(i=>e.jsx(Le,{value:i.memberId,onSelect:()=>{u(i.memberId),_(!1)},className:n===i.memberId?"bg-blue-100 dark:bg-blue-700":"",children:i.receiverName||i.firstName+" "+i.lastName},i.memberId))]})]})}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>b(!f),id:"showAllMembers",className:"mr-2"}),e.jsx("label",{htmlFor:"showAllMembers",className:"text-xs",children:"Show all members"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"paymentMode",children:"Payment Mode"}),e.jsxs(Me,{value:r,onValueChange:m,children:[e.jsx(Re,{className:"w-full",children:e.jsx(Ee,{placeholder:"Select payment mode"})}),e.jsx(Fe,{className:"max-h-60 overflow-y-auto",children:C.map(i=>e.jsx(Be,{value:i.value,children:i.label},i.value))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[x&&e.jsx(k,{variant:"outline",onClick:x,children:"Cancel"}),e.jsx(k,{variant:"secondary",onClick:h,disabled:N,children:"Save Changes"}),e.jsx(k,{onClick:D,disabled:M,children:"Save & Approve"})]})]})},ea=o=>{if(!o&&o!==0)return"0";const d=parseFloat(o);if(isNaN(d))return"0";const n=d.toString().split("."),u=n[0],r=n[1]?`.${n[1]}`:"";return u.replace(/\B(?=(\d{2})*(\d{3})(?!\d))/g,",")+r},Q=(o,d=!0)=>{const n=ea(o);return d?`â‚¹${n}`:n},aa=({metaData:o})=>e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-meta-4 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Total Collected"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:Q(o.totalCollected)})]}),e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Pending Approvals"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:Q(o.pendingAmount)})]}),e.jsxs("div",{className:"bg-green-100 dark:bg-green-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Approved Fees"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:Q(o.approvedAmount)})]}),e.jsxs("div",{className:"bg-blue-100 dark:bg-blue-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Transferred to Chapter"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:Q(o.totalTransferredToChapter)})]})]}),ee=se(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),sa=({pendingFees:o,approvedFees:d,currentTab:n,config:u,width:r,loadingApprovals:m,onDirectApproval:g,onOpenApproveDialog:w,onMoveToPending:f,selectedApprovals:b,onConfirmSelectedFees:C})=>{const t=n==="pending"?o:d;return r>700?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto rounded-lg border border-solid",children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs(L,{children:[e.jsx(T,{children:"Member Name"}),e.jsx(T,{children:"Package Name"}),e.jsx(T,{children:"Date"}),e.jsx(T,{children:"Amount Paid"}),e.jsx(T,{children:"Balance"}),u.currentState==="all_members_approval"&&n==="pending"&&e.jsx(T,{children:"Received By"}),e.jsx(T,{children:n==="pending"?"Approve":"Actions"})]})}),e.jsx(de,{children:(t==null?void 0:t.length)===0?e.jsx(L,{children:e.jsx(S,{colSpan:n==="pending"&&u.currentState==="all_members_approval"?7:6,className:"text-center",children:n==="pending"?"No pending fees to approve.":"No approved fees."})}):t==null?void 0:t.map(s=>e.jsxs(L,{children:[e.jsxs(S,{children:[s.firstName," ",s.lastName]}),e.jsx(S,{children:s.packageName}),e.jsx(S,{children:new Date(s.transactionDate).toLocaleDateString()}),e.jsx(S,{children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:2}).format(s.paidAmount)}),e.jsx(S,{children:e.jsxs("span",{className:s.balanceAmount<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400",children:[new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:2}).format(Math.abs(s.balanceAmount)),s.balanceAmount<0?" (Due)":" (Advance)"]})}),u.currentState==="all_members_approval"&&n==="pending"&&e.jsx(S,{children:s.paymentReceivedByName||"-"}),e.jsx(S,{children:n==="pending"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>g(s.transactionId),className:"h-8 px-2",disabled:m[s.transactionId],children:m[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Quick Approve"})}),e.jsx(k,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>w(s),disabled:m[s.transactionId],children:e.jsxs("span",{className:"text-xs flex items-center",children:[e.jsx(ee,{fontSize:"small",className:"mr-1"}),"Edit"]})})]}):e.jsx(k,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>f(s.transactionId),disabled:m[s.transactionId],children:m[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Move to Pending"})})})]},s.transactionId))})]})}),n==="pending"&&(b==null?void 0:b.length)>0&&e.jsx("button",{className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",onClick:C,children:"Confirm Selected Approvals"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col space-y-4",children:(t==null?void 0:t.length)===0?e.jsx("p",{className:"text-center text-black dark:text-white",children:n==="pending"?"No pending fees to approve.":"No approved fees."}):t==null?void 0:t.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 shadow-md dark:border-strokedark bg-white dark:bg-boxdark flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-black dark:text-white font-medium text-base",children:[s.firstName," ",s.lastName]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Package:"," ",e.jsx("span",{className:"font-semibold",children:s.packageName})]}),u.currentState==="all_members_approval"&&n==="pending"&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Received By:"," ",e.jsx("span",{className:"font-semibold",children:s.paymentReceivedByName||"-"})]})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(s.transactionDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-2",children:[e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400",children:"Amount Paid"}),e.jsxs("span",{className:"block text-base font-semibold text-green-700 dark:text-green-300",children:["â‚¹",s.paidAmount]})]}),e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400",children:"Balance"}),e.jsxs("span",{className:`block text-base font-semibold ${s.balanceAmount<0?"text-red-700 dark:text-red-300":"text-green-700 dark:text-green-300"}`,children:["â‚¹",Math.abs(s.balanceAmount)," ",s.balanceAmount<0?"(Due)":"(Advance)"]})]})]}),e.jsx("div",{className:"flex gap-2 mt-4",children:n==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>g(s.transactionId),className:"h-8 px-2",disabled:m[s.transactionId],children:m[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Quick Approve"})}),e.jsx(k,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>w(s),disabled:m[s.transactionId],children:e.jsxs("span",{className:"text-xs flex items-center",children:[e.jsx(ee,{fontSize:"small",className:"mr-1"}),"Edit"]})})]}):e.jsx(k,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>f(s.transactionId),disabled:m[s.transactionId],children:m[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Move to Pending"})})})]},s.transactionId))}),n==="pending"&&(b==null?void 0:b.length)>0&&e.jsx("button",{className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",onClick:C,children:"Confirm Selected Approvals"})]})},ta=({config:o,currentTab:d,onConfigChange:n,onTabChange:u})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex mb-4",children:[e.jsx("button",{className:`px-4 py-2 rounded-l ${d==="pending"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>u("pending"),children:"Pending"}),e.jsx("button",{className:`px-4 py-2 rounded-r ${d==="approved"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>u("approved"),children:"Approved"})]}),o.allowAllMembersApproval&&e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("label",{className:"mr-2 text-black dark:text-white",children:"Approval Mode:"}),e.jsx("button",{className:`px-4 py-2 rounded ${o.currentState==="self_approval"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>{n(r=>({...r,currentState:r.currentState==="self_approval"?"all_members_approval":"self_approval"}))},children:o.currentState==="self_approval"?"Switch To All Requests":"Switch To My Requests"})]})]}),ra=()=>{const{chapterData:o}=ae(),[d,n]=l.useState(!1),[u,r]=l.useState([]),[m,g]=l.useState(0),[w,f]=l.useState(""),[b,C]=l.useState(""),[t,s]=l.useState(!1),P=()=>{f(""),C(""),s(!1),n(!1)};l.useEffect(()=>{d&&(async()=>{try{const N=(await A(`/api/chapter-payment/${o.chapterId}/approved-transactions`)).data;r(N.transactions),g(N.totalAmount)}catch(D){console.error("Error fetching transactions:",D)}})()},[d]);const x=async()=>{try{(await A.post(`/api/chapter-payment/${o.chapterId}/pay-to-chapter`,{totalAmount:m,transferredAmount:w,remark:b})).data.success&&(v.success("Amount transferred successfully"),P())}catch(h){console.error("Error transferring amount:",h),v.error("Error transferring amount")}};return e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Transfer Collected Fees"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Transfer all approved & untransferred transactions to your chapter."}),e.jsxs(te,{open:d,onOpenChange:n,children:[e.jsx(Ie,{asChild:!0,children:e.jsx(k,{onClick:()=>n(!0),children:"Transfer Now"})}),e.jsxs(re,{className:"max-w-xl",children:[e.jsx(ne,{className:"mb-4",children:e.jsx(le,{children:"Confirm Transfer Details"})}),e.jsxs("div",{className:"mb-4 space-y-4",children:[e.jsx("div",{className:"overflow-y-auto rounded-md border max-h-64",children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs(L,{children:[e.jsx(T,{children:"Sr No."}),e.jsx(T,{children:"Member Name"}),e.jsx(T,{children:"Amount"}),e.jsx(T,{children:"Payment Type"})]})}),e.jsx(de,{children:u.map((h,D)=>e.jsxs(L,{children:[e.jsx(S,{children:D+1}),e.jsxs(S,{children:[h.firstName," ",h.lastName]}),e.jsx(S,{children:h.paidAmount}),e.jsx(S,{children:h.paymentType})]},h.id))})]})}),e.jsx("div",{children:e.jsxs("p",{className:"font-medium",children:["Original Total Amount: ",m]})}),e.jsx(oe,{type:"number",value:w,onChange:h=>f(h.target.value),placeholder:"Enter amount you are transferring"}),e.jsx(Ge,{placeholder:"Add a remark (optional)",value:b,onChange:h=>C(h.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(na,{showAlert:t,setShowAlert:s,totalAmount:m,amount:w,remark:b,handleTransfer:x})}),e.jsx(Te,{className:"mt-4",children:e.jsx(De,{asChild:!0,children:e.jsx(k,{variant:"outline",onClick:P,children:"Cancel & Reset"})})})]})]})]})},na=({showAlert:o,setShowAlert:d,totalAmount:n,amount:u,remark:r,handleTransfer:m})=>{const g=n-Number(u);return e.jsxs(qe,{open:o,onOpenChange:d,children:[e.jsx(Ye,{asChild:!0,children:e.jsx(k,{variant:"default",onClick:()=>d(!0),children:"Confirm Transfer"})}),e.jsxs(He,{children:[e.jsx(Ve,{children:e.jsx(Qe,{children:"Are you sure you want to transfer?"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["Total Collected: â‚¹",n]}),e.jsxs("p",{children:["Transfer Amount: â‚¹",u]}),e.jsx("p",{className:"text-yellow-600",children:g!==0&&`Note: Difference of â‚¹${g>0?g:-g}`}),r&&e.jsxs("p",{children:["Remark: ",r]})]}),e.jsxs(We,{children:[e.jsx(Ue,{children:"Cancel"}),e.jsx(Xe,{onClick:m,children:"Confirm"})]})]})]})},la=({metaData:o})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(aa,{metaData:o}),o.remainingToTransfer>0?e.jsx(ra,{}):e.jsxs("div",{className:"text-center text-gray-600 dark:text-gray-300 mt-4 p-8 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 dark:text-green-200 mb-2",children:"All Set!"}),e.jsx("p",{className:"text-green-700 dark:text-green-300",children:"All approved fees have been transferred to the chapter!"})]})]}),oa=[{value:"cash",label:"Cash"},{value:"online",label:"Online/UPI/QR"},{value:"cheque",label:"Cheque"},{value:"other",label:"Other"}],Oa=()=>{const[o,d]=l.useState([]),[n,u]=l.useState([]),{chapterData:r}=ae(),{width:m}=we(),[g,w]=l.useState([]),[f,b]=l.useState({allowAllMembersApproval:!1,currentState:"self_approval"}),[C,t]=l.useState("pending"),[s,P]=l.useState({totalCollected:0,pendingAmount:0,approvedAmount:0,totalTransferredToChapter:0,remainingToTransfer:0}),[x,h]=l.useState(null),[D,N]=l.useState({}),[M,$]=l.useState(""),[_,E]=l.useState([]),[q,Y]=l.useState([]),[z,O]=l.useState(!1),[i,F]=l.useState(""),[R,H]=l.useState(""),[ia,X]=l.useState(!1),[ca,da]=l.useState(),[ma,G]=l.useState(!1),[me,J]=l.useState(!1),[pe,V]=l.useState(!1);console.log({pendingFees:o}),l.useEffect(()=>{r!=null&&r.chapterId&&(B(),ge())},[r]),l.useEffect(()=>{r!=null&&r.chapterId&&(B(),je())},[f.currentState,C,r]);const xe=a=>{const c=a.getDate().toString().padStart(2,"0"),p=(a.getMonth()+1).toString().padStart(2,"0"),j=a.getFullYear();return`${c}-${p}-${j}`},he=async()=>{if(r!=null&&r.chapterId)try{const a=await A.get(`/api/feeReceiver/current/${r.chapterId}`,{params:{date:xe(new Date)}});E(a.data||[])}catch{E([])}},ue=async()=>{if(r!=null&&r.chapterId)try{const a=await A.get(`/api/member/all?chapterId=${r.chapterId}`);Y(a.data||[])}catch{Y([])}},ge=async()=>{try{const a=await A.get(`/api/rights/anyMemberApprovePayment/${r==null?void 0:r.chapterId}`);console.log({response:a}),b(c=>{var p;return{...c,allowAllMembersApproval:(p=a==null?void 0:a.data)==null?void 0:p.allowed}})}catch(a){console.error("Fetching rights failed:",a)}},B=async(a=C)=>{try{const c=await A.post(`/api/payment/paymentRequests/${r==null?void 0:r.chapterId}`,{status:a,currentState:f.currentState});console.log({response:c}),console.log({got:c.data}),a==="pending"?d(c.data):u(c.data)}catch(c){console.error("Fetching fees failed:",c)}},je=async()=>{try{const a=await A.get(`/api/payment/metaData/${r==null?void 0:r.chapterId}`);console.log({response:a}),P(a.data)}catch(a){console.error("Fetching metadata failed:",a)}};console.log({selectedApprovals:g});const fe=async()=>{try{const a=o.filter(c=>g.includes(c.transactionId));console.log({data:a}),await A.put("/api/payment/approvePendingPayment",{transactionDetails:a}),d(c=>c.filter(p=>!g.includes(p.transactionId))),w([]),v.success("Fees confirmed successfully")}catch(a){v.error("Could not confirm fees. Please try again later."),console.error("Confirming fees failed:",a)}},be=async a=>{var c,p;try{N(I=>({...I,[a]:!0}));const j=o.find(I=>I.transactionId===a),y=await A.put("/api/payment/approvePendingPayment",{transactionDetails:[j]});y.data.success?(d(I=>I.filter(W=>W.transactionId!==a)),v.success("Fee approved successfully")):v.error(y.data.message||"Could not approve fee")}catch(j){console.error("Approving fee failed:",j),v.error(((p=(c=j.response)==null?void 0:c.data)==null?void 0:p.message)||"Could not approve fee. Please try again later.")}finally{N(j=>({...j,[a]:!1}))}},ye=async a=>{var c,p;try{N(I=>({...I,[a]:!0}));const j=n.find(I=>I.transactionId===a),y=await A.put("/api/payment/moveApprovedToPending",{transactionDetails:[j]});y.data.success?(u(I=>I.filter(W=>W.transactionId!==a)),v.success("Fee moved to pending successfully"),B("pending")):v.error(y.data.message||"Could not move fee")}catch(j){console.error("Moving fee to pending failed:",j),v.error(((p=(c=j.response)==null?void 0:c.data)==null?void 0:p.message)||"Could not move fee. Please try again later.")}finally{N(j=>({...j,[a]:!1}))}},ve=a=>{h(a),$(a.paidAmount.toString()),F(a.paymentReceivedById||""),H(a.paymentType||""),G(!1),O(!1),J(!1),he(),V(!0)};l.useEffect(()=>{z&&ue()},[z]),l.useEffect(()=>{x&&G(M!==x.paidAmount.toString()||i!==(x.paymentReceivedById||"")||R!==(x.paymentType||""))},[M,i,R,x]);const Ne=async()=>{var a,c,p,j;if(X(!1),!!x){N(y=>({...y,[x.transactionId]:!0}));try{await A.put("/api/payment/saveEditedFeeDetails",{transactionId:x.transactionId,updateFields:{paidAmount:parseFloat(M),paymentReceivedById:i,paymentType:R,paymentReceivedByName:((a=q.find(y=>y.memberId===i))==null?void 0:a.firstName)||((c=_.find(y=>y.memberId===i))==null?void 0:c.receiverName)||"",payableAmount:x.payableAmount}}),v.success("Details saved successfully"),B(),h(null),V(!1)}catch(y){v.error(((j=(p=y.response)==null?void 0:p.data)==null?void 0:j.message)||"Could not save changes")}finally{N(y=>({...y,[x.transactionId]:!1}))}}},ke=async()=>{var a,c;if(X(!1),!!x){N(p=>({...p,[x.transactionId]:!0}));try{await A.put("/api/payment/approvePendingPayment",{transactionDetails:[{...x,paidAmount:parseFloat(M),paymentReceivedById:i,paymentType:R,status:"approved"}]}),v.success("Fee approved successfully"),B(),h(null)}catch(p){v.error(((c=(a=p.response)==null?void 0:a.data)==null?void 0:c.message)||"Could not approve fee")}finally{N(p=>({...p,[x.transactionId]:!1}))}}};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{items:[{name:"Member Fee Approval"}]}),e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-3 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium dark:text-white",children:"Member Fee Approvals"}),e.jsx(Je,{"aria-label":"refresh",onClick:()=>B(),children:e.jsx(Ke,{className:"dark:text-white"})})]}),e.jsxs(Ae,{defaultValue:"approval",className:"w-full",children:[e.jsxs(Se,{className:"grid w-full grid-cols-2",children:[e.jsx(K,{value:"approval",children:"Fee Approval"}),e.jsx(K,{value:"transfer",children:"Transfer & Dashboard"})]}),e.jsxs(Z,{value:"approval",className:"space-y-4",children:[e.jsx(ta,{config:f,currentTab:C,onConfigChange:b,onTabChange:t}),e.jsx(sa,{pendingFees:o,approvedFees:n,currentTab:C,config:f,width:m,loadingApprovals:D,onDirectApproval:be,onOpenApproveDialog:ve,onMoveToPending:ye,selectedApprovals:g,onConfirmSelectedFees:fe})]}),e.jsx(Z,{value:"transfer",className:"space-y-4",children:e.jsx(la,{metaData:s})})]})]}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(te,{open:pe,onOpenChange:V,children:e.jsx(re,{className:"!p-0",style:{width:"100%",maxHeight:"calc(100vh - 20px)",overflowY:"auto",borderRadius:12,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Edit Fee Payment"}),e.jsx(Pe,{children:"Edit details, change receiver, payment mode, or approve/save changes"})]}),e.jsx(Ze,{receivedAmount:M,setReceivedAmount:$,selectedReceiver:i,setSelectedReceiver:F,selectedPaymentMode:R,setSelectedPaymentMode:H,receiverList:_,allMembers:q,showAllMembers:z,setShowAllMembers:O,paymentModes:oa,selectedFee:x,canChangeReceiver:me,setCanChangeReceiver:J,onCancel:()=>{V(!1),h(null),$("")},onSave:Ne,onApprove:ke})]})})})})]})};export{Oa as default};
