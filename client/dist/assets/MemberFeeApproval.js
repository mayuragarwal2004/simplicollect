import{r as i,j as e,o as De,B as w,l as le,c as I,Q as C}from"./index.js";import{u as Re}from"./useWindowDimensions.js";import{B as Pe}from"./Breadcrumb.js";import{e as Be,B as Me,m as Z,b as ee,C as ze,c as oe}from"./CircularProgress.js";import{T as $e,a as Ee,b as ae,c as se}from"./tabs.js";import{D as ie,f as Fe,a as ce,b as de,c as me,d as Oe,g as Le,e as _e}from"./dialog.js";import{I as pe}from"./input.js";import{L as X}from"./label.js";import{S as We,a as qe,b as Ve,c as Ye,d as He}from"./select.js";import{C as Ue,a as Qe,b as Xe,c as Ge,e as Je}from"./command.js";import{T as xe,a as ue,b as W,c as R,d as he,e as S}from"./table.js";import{A as Ke,e as Ze,a as ea,b as aa,c as sa,d as ta,g as ra,h as na}from"./alert-dialog.js";import{T as la}from"./textarea.js";import{a as oa,g as ia,u as ca,s as ge,h as E,e as da,b as te}from"./TransitionGroupContext.js";import"./chevron-right.js";import"./index4.js";import"./index13.js";import"./index11.js";import"./index9.js";import"./index6.js";import"./index3.js";import"./index5.js";import"./index10.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./search.js";function ma(a){return ia("MuiIconButton",a)}const re=oa("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge","loading","loadingIndicator","loadingWrapper"]),pa=a=>{const{classes:l,disabled:r,color:m,edge:n,size:p,loading:x}=a,v={root:["root",x&&"loading",r&&"disabled",m!=="default"&&`color${E(m)}`,n&&`edge${E(n)}`,`size${E(p)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]};return da(v,ma,l)},xa=ge(Me,{name:"MuiIconButton",slot:"Root",overridesResolver:(a,l)=>{const{ownerState:r}=a;return[l.root,r.loading&&l.loading,r.color!=="default"&&l[`color${E(r.color)}`],r.edge&&l[`edge${E(r.edge)}`],l[`size${E(r.size)}`]]}})(Z(({theme:a})=>({textAlign:"center",flex:"0 0 auto",fontSize:a.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(a.vars||a).palette.action.active,transition:a.transitions.create("background-color",{duration:a.transitions.duration.shortest}),variants:[{props:l=>!l.disableRipple,style:{"--IconButton-hoverBg":a.vars?`rgba(${a.vars.palette.action.activeChannel} / ${a.vars.palette.action.hoverOpacity})`:te(a.palette.action.active,a.palette.action.hoverOpacity),"&:hover":{backgroundColor:"var(--IconButton-hoverBg)","@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),Z(({theme:a})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(a.palette).filter(ee()).map(([l])=>({props:{color:l},style:{color:(a.vars||a).palette[l].main}})),...Object.entries(a.palette).filter(ee()).map(([l])=>({props:{color:l},style:{"--IconButton-hoverBg":a.vars?`rgba(${(a.vars||a).palette[l].mainChannel} / ${a.vars.palette.action.hoverOpacity})`:te((a.vars||a).palette[l].main,a.palette.action.hoverOpacity)}})),{props:{size:"small"},style:{padding:5,fontSize:a.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:a.typography.pxToRem(28)}}],[`&.${re.disabled}`]:{backgroundColor:"transparent",color:(a.vars||a).palette.action.disabled},[`&.${re.loading}`]:{color:"transparent"}}))),ua=ge("span",{name:"MuiIconButton",slot:"LoadingIndicator",overridesResolver:(a,l)=>l.loadingIndicator})(({theme:a})=>({display:"none",position:"absolute",visibility:"visible",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:(a.vars||a).palette.action.disabled,variants:[{props:{loading:!0},style:{display:"flex"}}]})),ha=i.forwardRef(function(l,r){const m=ca({props:l,name:"MuiIconButton"}),{edge:n=!1,children:p,className:x,color:v="default",disabled:f=!1,disableFocusRipple:b=!1,size:k="medium",id:o,loading:s=null,loadingIndicator:P,...h}=m,u=Be(o),A=P??e.jsx(ze,{"aria-labelledby":u,color:"inherit",size:16}),y={...m,edge:n,color:v,disabled:f,disableFocusRipple:b,loading:s,loadingIndicator:A,size:k},T=pa(y);return e.jsxs(xa,{id:s?u:o,className:De(T.root,x),centerRipple:!0,focusRipple:!b,disabled:f||s,ref:r,...h,ownerState:y,children:[typeof s=="boolean"&&e.jsx("span",{className:T.loadingWrapper,style:{display:"contents"},children:e.jsx(ua,{className:T.loadingIndicator,ownerState:y,children:s&&A})}),p]})}),ga=oe(e.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),fa=({receivedAmount:a,setReceivedAmount:l,selectedReceiver:r,setSelectedReceiver:m,selectedPaymentMode:n,setSelectedPaymentMode:p,receiverList:x,allMembers:v,showAllMembers:f,setShowAllMembers:b,paymentModes:k,selectedFee:o,canChangeReceiver:s,setCanChangeReceiver:P,onCancel:h,onSave:u,onApprove:A,saveDisabled:y,approveDisabled:T})=>{const[F,O]=i.useState(!1),[M,q]=i.useState(null),[V,L]=i.useState(null);i.useEffect(()=>{if(!o)return;const c=parseFloat(a)||0,z=parseFloat(o.payableAmount)||0,B=parseFloat(o.platformFee)||0,Y=parseFloat(o.receiverFee)||0;q(c-z),L(c-B-Y)},[a,o]);const _=x.find(c=>c.memberId===r);return e.jsxs("div",{className:"space-y-4 py-4 w-full max-w-md mx-auto sm:max-w-lg md:max-w-xl lg:max-w-2xl px-2 sm:px-4",style:{maxWidth:"100vw",overflowX:"hidden"},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Member Details:"}),e.jsxs("p",{className:"text-sm",children:[o==null?void 0:o.firstName," ",o==null?void 0:o.lastName]}),e.jsxs("p",{className:"text-sm",children:["Package: ",o==null?void 0:o.packageName]}),e.jsxs("p",{className:"text-sm",children:["Original Payable Amount: ₹",o==null?void 0:o.payableAmount]}),e.jsxs("p",{className:"text-sm",children:["Expected Amount: ₹",o==null?void 0:o.paidAmount]}),e.jsxs("p",{className:"text-sm",children:["Dues: ₹",o==null?void 0:o.balanceAmount]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"amount",children:"Amount Received"}),e.jsx(pe,{id:"amount",type:"number",value:a,onChange:c=>l(c.target.value),placeholder:"Enter amount received",className:"w-full"}),e.jsxs("div",{className:"flex flex-col gap-1 mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Live Balance Amount: ",e.jsxs("span",{className:M===0?"text-green-700 dark:text-green-300":M<0?"text-red-700 dark:text-red-300":"text-yellow-700 dark:text-yellow-300",children:["₹",M??"-"]})]}),e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Amount Paid to Chapter: ",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300",children:["₹",V??"-"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"receiver",children:"Receiver"}),!s&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-2",children:_?e.jsxs(e.Fragment,{children:[_.receiverName," is the receiver for this payment."," ",e.jsx("button",{className:"text-blue-600 underline ml-1",type:"button",onClick:()=>P(!0),children:"Not the receiver? Click here to change"})]}):e.jsxs(e.Fragment,{children:["Receiver not found."," ",e.jsx("button",{className:"text-blue-600 underline ml-1",type:"button",onClick:()=>P(!0),children:"Click here to select"})]})}),s&&e.jsxs("div",{className:"relative",children:[e.jsxs(w,{type:"button",variant:"outline",className:"w-full flex justify-between items-center",onClick:()=>O(c=>!c),children:[(()=>{const c=(f?v:x).find(z=>z.memberId===r);return c?c.receiverName||c.firstName+" "+c.lastName:"Select receiver"})(),e.jsx("span",{className:"ml-2",children:"▼"})]}),F&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white dark:bg-boxdark border rounded shadow-lg max-h-60 overflow-y-auto",children:e.jsxs(Ue,{className:"w-full border-none shadow-none",children:[e.jsx(Qe,{placeholder:"Search receiver..."}),e.jsxs(Xe,{children:[(f?v:x).length===0&&e.jsx(Ge,{children:"No receivers found."}),(f?v:x).map(c=>e.jsx(Je,{value:c.memberId,onSelect:()=>{m(c.memberId),O(!1)},className:r===c.memberId?"bg-blue-100 dark:bg-blue-700":"",children:c.receiverName||c.firstName+" "+c.lastName},c.memberId))]})]})}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>b(!f),id:"showAllMembers",className:"mr-2"}),e.jsx("label",{htmlFor:"showAllMembers",className:"text-xs",children:"Show all members"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"paymentMode",children:"Payment Mode"}),e.jsxs(We,{value:n,onValueChange:p,children:[e.jsx(qe,{className:"w-full",children:e.jsx(Ve,{placeholder:"Select payment mode"})}),e.jsx(Ye,{className:"max-h-60 overflow-y-auto",children:k.map(c=>e.jsx(He,{value:c.value,children:c.label},c.value))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[h&&e.jsx(w,{variant:"outline",onClick:h,children:"Cancel"}),e.jsx(w,{variant:"secondary",onClick:u,disabled:y,children:"Save Changes"}),e.jsx(w,{onClick:A,disabled:T,children:"Save & Approve"})]})]})},ba=a=>{if(!a&&a!==0)return"0";const l=parseFloat(a);if(isNaN(l))return"0";const r=l.toString().split("."),m=r[0],n=r[1]?`.${r[1]}`:"";return m.replace(/\B(?=(\d{2})*(\d{3})(?!\d))/g,",")+n},U=(a,l=!0)=>{const r=ba(a);return l?`₹${r}`:r},ja=({metaData:a})=>e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-meta-4 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Total Collected"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:U(a.totalCollected)})]}),e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Pending Approvals"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:U(a.pendingAmount)})]}),e.jsxs("div",{className:"bg-green-100 dark:bg-green-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Approved Fees"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:U(a.approvedAmount)})]}),e.jsxs("div",{className:"bg-blue-100 dark:bg-blue-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Transferred to Chapter"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:U(a.totalTransferredToChapter)})]})]}),ne=oe(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),ya=({pendingFees:a,approvedFees:l,currentTab:r,config:m,width:n,loadingApprovals:p,onDirectApproval:x,onOpenApproveDialog:v,onMoveToPending:f,selectedApprovals:b,onConfirmSelectedFees:k})=>{const o=r==="pending"?a:l;return n>700?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto rounded-lg border border-solid",children:e.jsxs(xe,{children:[e.jsx(ue,{children:e.jsxs(W,{children:[e.jsx(R,{children:"Member Name"}),e.jsx(R,{children:"Package Name"}),e.jsx(R,{children:"Date"}),e.jsx(R,{children:"Amount Paid"}),e.jsx(R,{children:"Balance"}),m.currentState==="all_members_approval"&&r==="pending"&&e.jsx(R,{children:"Received By"}),e.jsx(R,{children:r==="pending"?"Approve":"Actions"})]})}),e.jsx(he,{children:(o==null?void 0:o.length)===0?e.jsx(W,{children:e.jsx(S,{colSpan:r==="pending"&&m.currentState==="all_members_approval"?7:6,className:"text-center",children:r==="pending"?"No pending fees to approve.":"No approved fees."})}):o==null?void 0:o.map(s=>e.jsxs(W,{children:[e.jsxs(S,{children:[s.firstName," ",s.lastName]}),e.jsx(S,{children:s.packageName}),e.jsx(S,{children:new Date(s.transactionDate).toLocaleDateString()}),e.jsx(S,{children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:2}).format(s.paidAmount)}),e.jsx(S,{children:e.jsxs("span",{className:s.balanceAmount<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400",children:[new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:2}).format(Math.abs(s.balanceAmount)),s.balanceAmount<0?" (Due)":" (Advance)"]})}),m.currentState==="all_members_approval"&&r==="pending"&&e.jsx(S,{children:s.paymentReceivedByName||"-"}),e.jsx(S,{children:r==="pending"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:()=>x(s.transactionId),className:"h-8 px-2",disabled:p[s.transactionId],children:p[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Quick Approve"})}),e.jsx(w,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>v(s),disabled:p[s.transactionId],children:e.jsxs("span",{className:"text-xs flex items-center",children:[e.jsx(ne,{fontSize:"small",className:"mr-1"}),"Edit"]})})]}):e.jsx(w,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>f(s.transactionId),disabled:p[s.transactionId],children:p[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Move to Pending"})})})]},s.transactionId))})]})}),r==="pending"&&(b==null?void 0:b.length)>0&&e.jsx("button",{className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",onClick:k,children:"Confirm Selected Approvals"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col space-y-4",children:(o==null?void 0:o.length)===0?e.jsx("p",{className:"text-center text-black dark:text-white",children:r==="pending"?"No pending fees to approve.":"No approved fees."}):o==null?void 0:o.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 shadow-md dark:border-strokedark bg-white dark:bg-boxdark flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-black dark:text-white font-medium text-base",children:[s.firstName," ",s.lastName]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Package:"," ",e.jsx("span",{className:"font-semibold",children:s.packageName})]}),m.currentState==="all_members_approval"&&r==="pending"&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Received By:"," ",e.jsx("span",{className:"font-semibold",children:s.paymentReceivedByName||"-"})]})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(s.transactionDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-2",children:[e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400",children:"Amount Paid"}),e.jsxs("span",{className:"block text-base font-semibold text-green-700 dark:text-green-300",children:["₹",s.paidAmount]})]}),e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400",children:"Balance"}),e.jsxs("span",{className:`block text-base font-semibold ${s.balanceAmount<0?"text-red-700 dark:text-red-300":"text-green-700 dark:text-green-300"}`,children:["₹",Math.abs(s.balanceAmount)," ",s.balanceAmount<0?"(Due)":"(Advance)"]})]})]}),e.jsx("div",{className:"flex gap-2 mt-4",children:r==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outline",size:"sm",onClick:()=>x(s.transactionId),className:"h-8 px-2",disabled:p[s.transactionId],children:p[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Quick Approve"})}),e.jsx(w,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>v(s),disabled:p[s.transactionId],children:e.jsxs("span",{className:"text-xs flex items-center",children:[e.jsx(ne,{fontSize:"small",className:"mr-1"}),"Edit"]})})]}):e.jsx(w,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>f(s.transactionId),disabled:p[s.transactionId],children:p[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Move to Pending"})})})]},s.transactionId))}),r==="pending"&&(b==null?void 0:b.length)>0&&e.jsx("button",{className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",onClick:k,children:"Confirm Selected Approvals"})]})},va=({config:a,currentTab:l,onConfigChange:r,onTabChange:m})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex mb-4",children:[e.jsx("button",{className:`px-4 py-2 rounded-l ${l==="pending"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>m("pending"),children:"Pending"}),e.jsx("button",{className:`px-4 py-2 rounded-r ${l==="approved"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>m("approved"),children:"Approved"})]}),a.allowAllMembersApproval&&e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("label",{className:"mr-2 text-black dark:text-white",children:"Approval Mode:"}),e.jsx("button",{className:`px-4 py-2 rounded ${a.currentState==="self_approval"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>{r(n=>({...n,currentState:n.currentState==="self_approval"?"all_members_approval":"self_approval"}))},children:a.currentState==="self_approval"?"Switch To All Requests":"Switch To My Requests"})]})]}),Na=()=>{const{chapterData:a}=le(),[l,r]=i.useState(!1),[m,n]=i.useState([]),[p,x]=i.useState(0),[v,f]=i.useState(""),[b,k]=i.useState(""),[o,s]=i.useState(!1),P=()=>{f(""),k(""),s(!1),r(!1)};i.useEffect(()=>{l&&(async()=>{try{const y=(await I(`/api/chapter-payment/${a.chapterId}/approved-transactions`)).data;n(y.transactions),x(y.totalAmount)}catch(A){console.error("Error fetching transactions:",A)}})()},[l]);const h=async()=>{try{(await I.post(`/api/chapter-payment/${a.chapterId}/pay-to-chapter`,{totalAmount:p,transferredAmount:v,remark:b})).data.success&&(C.success("Amount transferred successfully"),P())}catch(u){console.error("Error transferring amount:",u),C.error("Error transferring amount")}};return e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Transfer Collected Fees"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Transfer all approved & untransferred transactions to your chapter."}),e.jsxs(ie,{open:l,onOpenChange:r,children:[e.jsx(Fe,{asChild:!0,children:e.jsx(w,{onClick:()=>r(!0),children:"Transfer Now"})}),e.jsxs(ce,{className:"max-w-xl",children:[e.jsx(de,{className:"mb-4",children:e.jsx(me,{children:"Confirm Transfer Details"})}),e.jsxs("div",{className:"mb-4 space-y-4",children:[e.jsx("div",{className:"overflow-y-auto rounded-md border max-h-64",children:e.jsxs(xe,{children:[e.jsx(ue,{children:e.jsxs(W,{children:[e.jsx(R,{children:"Sr No."}),e.jsx(R,{children:"Member Name"}),e.jsx(R,{children:"Amount"}),e.jsx(R,{children:"Payment Type"})]})}),e.jsx(he,{children:m.map((u,A)=>e.jsxs(W,{children:[e.jsx(S,{children:A+1}),e.jsxs(S,{children:[u.firstName," ",u.lastName]}),e.jsx(S,{children:u.paidAmount}),e.jsx(S,{children:u.paymentType})]},u.id))})]})}),e.jsx("div",{children:e.jsxs("p",{className:"font-medium",children:["Original Total Amount: ",p]})}),e.jsx(pe,{type:"number",value:v,onChange:u=>f(u.target.value),placeholder:"Enter amount you are transferring"}),e.jsx(la,{placeholder:"Add a remark (optional)",value:b,onChange:u=>k(u.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(ka,{showAlert:o,setShowAlert:s,totalAmount:p,amount:v,remark:b,handleTransfer:h})}),e.jsx(Oe,{className:"mt-4",children:e.jsx(Le,{asChild:!0,children:e.jsx(w,{variant:"outline",onClick:P,children:"Cancel & Reset"})})})]})]})]})},ka=({showAlert:a,setShowAlert:l,totalAmount:r,amount:m,remark:n,handleTransfer:p})=>{const x=r-Number(m);return e.jsxs(Ke,{open:a,onOpenChange:l,children:[e.jsx(Ze,{asChild:!0,children:e.jsx(w,{variant:"default",onClick:()=>l(!0),children:"Confirm Transfer"})}),e.jsxs(ea,{children:[e.jsx(aa,{children:e.jsx(sa,{children:"Are you sure you want to transfer?"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["Total Collected: ₹",r]}),e.jsxs("p",{children:["Transfer Amount: ₹",m]}),e.jsx("p",{className:"text-yellow-600",children:x!==0&&`Note: Difference of ₹${x>0?x:-x}`}),n&&e.jsxs("p",{children:["Remark: ",n]})]}),e.jsxs(ta,{children:[e.jsx(ra,{children:"Cancel"}),e.jsx(na,{onClick:p,children:"Confirm"})]})]})]})},Ca=({metaData:a})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(ja,{metaData:a}),a.remainingToTransfer>0?e.jsx(Na,{}):e.jsxs("div",{className:"text-center text-gray-600 dark:text-gray-300 mt-4 p-8 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🎉"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 dark:text-green-200 mb-2",children:"All Set!"}),e.jsx("p",{className:"text-green-700 dark:text-green-300",children:"All approved fees have been transferred to the chapter!"})]})]}),wa=[{value:"cash",label:"Cash"},{value:"online",label:"Online/UPI/QR"},{value:"cheque",label:"Cheque"},{value:"other",label:"Other"}],rs=()=>{const[a,l]=i.useState([]),[r,m]=i.useState([]),{chapterData:n}=le(),{width:p}=Re(),[x,v]=i.useState([]),[f,b]=i.useState({allowAllMembersApproval:!1,currentState:"self_approval"}),[k,o]=i.useState("pending"),[s,P]=i.useState({totalCollected:0,pendingAmount:0,approvedAmount:0,totalTransferredToChapter:0,remainingToTransfer:0}),[h,u]=i.useState(null),[A,y]=i.useState({}),[T,F]=i.useState(""),[O,M]=i.useState([]),[q,V]=i.useState([]),[L,_]=i.useState(!1),[c,z]=i.useState(""),[B,Y]=i.useState(""),[Ia,G]=i.useState(!1),[Sa,Aa]=i.useState(),[Ta,J]=i.useState(!1),[fe,K]=i.useState(!1),[be,H]=i.useState(!1);console.log({pendingFees:a}),i.useEffect(()=>{n!=null&&n.chapterId&&($(),Ne())},[n]),i.useEffect(()=>{n!=null&&n.chapterId&&($(),ke())},[f.currentState,k,n]);const je=t=>{const d=t.getDate().toString().padStart(2,"0"),g=(t.getMonth()+1).toString().padStart(2,"0"),j=t.getFullYear();return`${d}-${g}-${j}`},ye=async()=>{if(n!=null&&n.chapterId)try{const t=await I.get(`/api/feeReceiver/current/${n.chapterId}`,{params:{date:je(new Date)}});M(t.data||[])}catch{M([])}},ve=async()=>{if(n!=null&&n.chapterId)try{const t=await I.get(`/api/member/all?chapterId=${n.chapterId}`);V(t.data||[])}catch{V([])}},Ne=async()=>{try{const t=await I.get(`/api/rights/anyMemberApprovePayment/${n==null?void 0:n.chapterId}`);console.log({response:t}),b(d=>{var g;return{...d,allowAllMembersApproval:(g=t==null?void 0:t.data)==null?void 0:g.allowed}})}catch(t){console.error("Fetching rights failed:",t)}},$=async(t=k)=>{try{const d=await I.post(`/api/payment/paymentRequests/${n==null?void 0:n.chapterId}`,{status:t,currentState:f.currentState});console.log({response:d}),console.log({got:d.data}),t==="pending"?l(d.data):m(d.data)}catch(d){console.error("Fetching fees failed:",d)}},ke=async()=>{try{const t=await I.get(`/api/payment/metaData/${n==null?void 0:n.chapterId}`);console.log({response:t}),P(t.data)}catch(t){console.error("Fetching metadata failed:",t)}};console.log({selectedApprovals:x});const Ce=async()=>{try{const t=a.filter(d=>x.includes(d.transactionId));console.log({data:t}),await I.put("/api/payment/approvePendingPayment",{transactionDetails:t}),l(d=>d.filter(g=>!x.includes(g.transactionId))),v([]),C.success("Fees confirmed successfully")}catch(t){C.error("Could not confirm fees. Please try again later."),console.error("Confirming fees failed:",t)}},we=async t=>{var d,g;try{y(D=>({...D,[t]:!0}));const j=a.find(D=>D.transactionId===t),N=await I.put("/api/payment/approvePendingPayment",{transactionDetails:[j]});N.data.success?(l(D=>D.filter(Q=>Q.transactionId!==t)),C.success("Fee approved successfully")):C.error(N.data.message||"Could not approve fee")}catch(j){console.error("Approving fee failed:",j),C.error(((g=(d=j.response)==null?void 0:d.data)==null?void 0:g.message)||"Could not approve fee. Please try again later.")}finally{y(j=>({...j,[t]:!1}))}},Ie=async t=>{var d,g;try{y(D=>({...D,[t]:!0}));const j=r.find(D=>D.transactionId===t),N=await I.put("/api/payment/moveApprovedToPending",{transactionDetails:[j]});N.data.success?(m(D=>D.filter(Q=>Q.transactionId!==t)),C.success("Fee moved to pending successfully"),$("pending")):C.error(N.data.message||"Could not move fee")}catch(j){console.error("Moving fee to pending failed:",j),C.error(((g=(d=j.response)==null?void 0:d.data)==null?void 0:g.message)||"Could not move fee. Please try again later.")}finally{y(j=>({...j,[t]:!1}))}},Se=t=>{u(t),F(t.paidAmount.toString()),z(t.paymentReceivedById||""),Y(t.paymentType||""),J(!1),_(!1),K(!1),ye(),H(!0)};i.useEffect(()=>{L&&ve()},[L]),i.useEffect(()=>{h&&J(T!==h.paidAmount.toString()||c!==(h.paymentReceivedById||"")||B!==(h.paymentType||""))},[T,c,B,h]);const Ae=async()=>{var t,d,g,j;if(G(!1),!!h){y(N=>({...N,[h.transactionId]:!0}));try{await I.put("/api/payment/saveEditedFeeDetails",{transactionId:h.transactionId,updateFields:{paidAmount:parseFloat(T),paymentReceivedById:c,paymentType:B,paymentReceivedByName:((t=q.find(N=>N.memberId===c))==null?void 0:t.firstName)||((d=O.find(N=>N.memberId===c))==null?void 0:d.receiverName)||"",payableAmount:h.payableAmount}}),C.success("Details saved successfully"),$(),u(null),H(!1)}catch(N){C.error(((j=(g=N.response)==null?void 0:g.data)==null?void 0:j.message)||"Could not save changes")}finally{y(N=>({...N,[h.transactionId]:!1}))}}},Te=async()=>{var t,d;if(G(!1),!!h){y(g=>({...g,[h.transactionId]:!0}));try{await I.put("/api/payment/approvePendingPayment",{transactionDetails:[{...h,paidAmount:parseFloat(T),paymentReceivedById:c,paymentType:B,status:"approved"}]}),C.success("Fee approved successfully"),$(),u(null)}catch(g){C.error(((d=(t=g.response)==null?void 0:t.data)==null?void 0:d.message)||"Could not approve fee")}finally{y(g=>({...g,[h.transactionId]:!1}))}}};return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{items:[{name:"Member Fee Approval"}]}),e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-3 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium dark:text-white",children:"Member Fee Approvals"}),e.jsx(ha,{"aria-label":"refresh",onClick:()=>$(),children:e.jsx(ga,{className:"dark:text-white"})})]}),e.jsxs($e,{defaultValue:"approval",className:"w-full",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-2",children:[e.jsx(ae,{value:"approval",children:"Fee Approval"}),e.jsx(ae,{value:"transfer",children:"Transfer & Dashboard"})]}),e.jsxs(se,{value:"approval",className:"space-y-4",children:[e.jsx(va,{config:f,currentTab:k,onConfigChange:b,onTabChange:o}),e.jsx(ya,{pendingFees:a,approvedFees:r,currentTab:k,config:f,width:p,loadingApprovals:A,onDirectApproval:we,onOpenApproveDialog:Se,onMoveToPending:Ie,selectedApprovals:x,onConfirmSelectedFees:Ce})]}),e.jsx(se,{value:"transfer",className:"space-y-4",children:e.jsx(Ca,{metaData:s})})]})]}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(ie,{open:be,onOpenChange:H,children:e.jsx(ce,{className:"!p-0",style:{width:"100%",maxHeight:"calc(100vh - 20px)",overflowY:"auto",borderRadius:12,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs(de,{children:[e.jsx(me,{children:"Edit Fee Payment"}),e.jsx(_e,{children:"Edit details, change receiver, payment mode, or approve/save changes"})]}),e.jsx(fa,{receivedAmount:T,setReceivedAmount:F,selectedReceiver:c,setSelectedReceiver:z,selectedPaymentMode:B,setSelectedPaymentMode:Y,receiverList:O,allMembers:q,showAllMembers:L,setShowAllMembers:_,paymentModes:wa,selectedFee:h,canChangeReceiver:fe,setCanChangeReceiver:K,onCancel:()=>{H(!1),u(null),F("")},onSave:Ae,onApprove:Te})]})})})})]})};export{rs as default};
