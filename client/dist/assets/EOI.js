import{j as e,r as p,f as W,c as E}from"./index.js";import{B as q}from"./Breadcrumb.js";import{A as G}from"./Alerts.js";import"./chevron-right.js";const f=({label:m,type:v="text",disabled:h=!1,className:k="",status:u="default",errorMessage:i,parentClassName:y="",...x})=>{const w=`
    w-full rounded-lg border-[1.5px] py-3 px-5 text-black outline-none transition
    dark:text-white
  `,N=`
    border-stroke bg-transparent focus:border-primary active:border-primary 
    dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary
  `,I=`
    cursor-default bg-whiter dark:bg-black
  `,C={error:"border-red-500 focus:border-red-500 text-red-600 dark:text-red-500",success:"border-green-500 focus:border-green-500 text-green-600 dark:text-green-500",default:""};return e.jsxs("div",{className:`input-wrapper ${y}`,children:[m&&e.jsx("label",{className:"mb-2.5 mt-5 block text-black dark:text-white",children:m}),e.jsx("input",{type:v,disabled:h,className:`${w} ${h?I:N} ${C[u]} ${k}`,...x}),u==="error"&&i&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:i})]})},B=({children:m,variant:v="primary",fullWidth:h=!1,disabled:k=!1,className:u="",...i})=>{const y=`
    flex items-center justify-center rounded p-3 font-medium transition
  `,x={primary:"bg-primary text-white hover:bg-opacity-90",secondary:"bg-secondary text-white hover:bg-opacity-90",danger:"bg-red-500 text-white hover:bg-opacity-90"};return e.jsx("button",{disabled:k,className:`
        ${y} 
        ${x[v]} 
        ${h?"w-full":""} 
        ${k?"cursor-not-allowed opacity-50":""} 
        ${u}
      `,...i,children:m})},M=({label:m="Select an option",name:v,options:h,placeholder:k="Please select an option",className:u="",parentClassName:i="",value:y,onChange:x,status:w="default",errorMessage:N="",...I})=>{const C=y!=="",F=()=>{switch(w){case"error":return"border-red-500 focus:border-red-500 active:border-red-500";case"success":return"border-green-500 focus:border-green-500 active:border-green-500";default:return"border-stroke focus:border-primary active:border-primary dark:border-form-strokedark dark:focus:border-primary"}};return e.jsxs("div",{className:`mb-4.5 ${i}`,children:[m&&e.jsx("label",{className:"mb-2.5 mt-5 block text-black dark:text-white",children:m}),e.jsxs("div",{className:"relative z-20 bg-transparent dark:bg-form-input",children:[e.jsxs("select",{value:y,name:v,onChange:x,className:`relative z-20 w-full appearance-none rounded border bg-transparent py-3 px-5 outline-none transition dark:bg-form-input ${F()} ${C?"text-black dark:text-white":""} ${u}`,...I,children:[e.jsx("option",{value:"",disabled:!0,className:"text-body dark:text-bodydark",children:k}),h.map(g=>e.jsx("option",{value:g.value,disabled:g.disabled,className:"text-body dark:text-bodydark",children:g.label},g.value))]}),e.jsx("span",{className:"absolute top-1/2 right-4 z-30 -translate-y-1/2",children:e.jsx("svg",{className:"fill-current",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("g",{opacity:"0.8",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.29289 8.29289C5.68342 7.90237 6.31658 7.90237 6.70711 8.29289L12 13.5858L17.2929 8.29289C17.6834 7.90237 18.3166 7.90237 18.7071 8.29289C19.0976 8.68342 19.0976 9.31658 18.7071 9.70711L12.7071 15.7071C12.3166 16.0976 11.6834 16.0976 11.2929 15.7071L5.29289 9.70711C4.90237 9.31658 4.90237 8.68342 5.29289 8.29289Z",fill:""})})})})]}),w==="error"&&N&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N})]})},O=({label:m="Time Picker",placeholder:v="Select time",timeFormat:h="24",onTimeChange:k,initialValue:u="",parentClassName:i=""})=>{const[y,x]=p.useState(u?new Date(`1970-01-01T${u}:00`):null);return e.jsx("div",{className:`${i}`,children:m&&e.jsx("label",{className:"mb-3 mt-5 block text-black dark:text-white",children:m})})},o={value:"",disabled:!1,status:"default",errorMessage:""},J=()=>{const{chapterSlug:m}=W(),[v,h]=p.useState(),[k,u]=p.useState(""),[i,y]=p.useState({}),[x,w]=p.useState(""),[N,I]=p.useState(!1),[C,F]=p.useState(!1),[g,L]=p.useState(!1),[D,V]=p.useState(1),[S,A]=p.useState({upcoming:[],recent:[]}),[a,j]=p.useState({invitedBy:{...o},chapterVisitDate:{...o},heardAboutBNI:{...o},firstName:{...o},lastName:{...o},companyName:{...o},classification:{...o},industry:{...o},email:{...o},mobileNumber:{...o},feedbackScore:{...o},feedbackComments:{...o},nextStep:{...o},arrivalTime:{...o},feelWelcome:{...o,value:!1},visitedBniBefore:{...o,value:!1},referralGroupExperience:{...o},meetingId:{...o}});p.useEffect(()=>{(async()=>{try{const t=await E.get(`/api/visitor/verifyVisitorLink/${m}`),s=t.data;if(t.status!==200)throw new Error(s.message);if(!s.chapterId){h(!1),u(s.message||"Chapter not found");return}h(!0),y(s);const l=await E(`/api/visitor/getChapterMeetings/${s.chapterId}`),c=await l.data;if(console.log({meetingsResponse:l,meetingsResult:c}),l.status===200){const n=b=>new Date(b).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),$={upcoming:(c.upcoming||[]).map(b=>({...b,displayDate:n(b.meetingDate)})),recent:(c.recent||[]).map(b=>({...b,displayDate:n(b.meetingDate)}))};A($),$.upcoming.length>0&&j(b=>({...b,meetingId:{...b.meetingId,value:$.upcoming[0].meetingId},chapterVisitDate:{...b.chapterVisitDate,value:$.upcoming[0].meetingDate}}))}}catch(t){console.error("Error fetching data:",t),h(!1),u("Failed to load chapter information")}})()},[m]);const R=async r=>{r.preventDefault();try{const t=await E.get(`/api/visitor/checkVisitor?phone=${x}`),s=t.data;if(t.status!==200)throw new Error(s.message);if(s.exists){I(!0),F(!0);const{visitor:l}=s,c={...a};for(const n in l)n in c&&(c[n]={...c[n],value:l[n]});j(c)}else V(2),j(l=>({...l,mobileNumber:{...l.mobileNumber,value:x}}))}catch(t){console.error("Error checking visitor:",t)}},d=r=>{const{name:t,value:s}=r.target;j(l=>({...l,[t]:{...l[t],value:s}}))},T=r=>{j(t=>({...t,arrivalTime:{...t.arrivalTime,value:r}}))},Y=()=>{let r=!0;return["firstName","lastName","companyName","classification","email","mobileNumber","meetingId"].forEach(s=>{a[s].value?j(l=>({...l,[s]:{...l[s],status:"success",errorMessage:""}})):(r=!1,j(l=>({...l,[s]:{...l[s],status:"error",errorMessage:`${s==="meetingId"?"Meeting selection":s} is required`}})))}),a.mobileNumber.value.length!==10&&(r=!1,j(s=>({...s,mobileNumber:{...s.mobileNumber,status:"error",errorMessage:"Mobile Number must be 10 digits"}}))),r},P=async r=>{if(r.preventDefault(),!!Y())try{const t={};for(const c in a){const n=a[c].value;n!=null&&n!==""&&(t[c]=n)}if(t.chapterId=i.chapterId,t.meetingId){const c=[...S.upcoming,...S.recent].find(n=>n.meetingId===t.meetingId);if(c){const n=new Date(c.meetingDate);t.chapterVisitDate=n.toISOString().split("T")[0]}}const s=N?"addFeedback":"addVisitor",l=await E.post(`/api/visitor/${s}`,t);if(l.status===200)L(!0),V(3);else throw new Error(l.data.message||"Error saving visitor details")}catch(t){console.error("Error saving visitor:",t),alert(t.message)}};return v===void 0?e.jsx("div",{children:"Loading..."}):v?e.jsxs("div",{className:"app-container p-6 bg-gray-100 dark:bg-gray-900 min-h-screen",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4",children:[i.chapterName," - ",i.region]}),e.jsx(q,{items:[{name:"Visitor Registration"}]}),!N&&!g&&D===1&&e.jsxs("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke py-4 px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Visitor Login"})}),e.jsx("form",{action:"#",children:e.jsx("div",{className:"p-6.5",children:e.jsx("div",{className:"mb-4.5 flex flex-col gap-6 xl:flex-row",children:e.jsx("div",{className:"w-full xl:w-1/2",children:e.jsxs("div",{className:"phone-section",children:[e.jsx(f,{label:"Enter your phone number to continue:",placeholder:"12345 67890",value:x,onChange:r=>w(r.target.value)}),e.jsx("br",{}),e.jsx(B,{onClick:r=>R(r),children:"Submit"})]})})})})})]}),!C&&!g&&D===2&&e.jsxs("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke py-4 px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Enter New Visitor Details"})}),e.jsx("form",{action:"#",children:e.jsx("div",{className:"p-6.5",children:e.jsx("div",{className:"mb-4.5 flex flex-col gap-6 xl:flex-row",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex w-full m-auto justify-evenly flex-wrap gap-x-5",children:[e.jsx(f,{label:"Who Invited You to this Meeting?*",type:"text",name:"invitedBy",placeholder:"Name of Member",value:a.invitedBy.value,onChange:d,parentClassName:"w-auto flex-1 whitespace-nowrap"}),e.jsx(M,{label:"Select Meeting*",placeholder:"Select a meeting",parentClassName:"w-auto flex-1 whitespace-nowrap",name:"meetingId",value:a.meetingId.value,options:[...S.recent.length>0?[{label:"─── Past Meetings ───",value:"",disabled:!0},...S.recent.map(r=>({label:`${r.meetingName} - ${r.displayDate}`,value:r.meetingId}))]:[],...S.upcoming.length>0?[{label:"─── Upcoming Meetings ───",value:"",disabled:!0},...S.upcoming.map(r=>({label:`${r.meetingName} - ${r.displayDate}`,value:r.meetingId}))]:[]],onChange:d,status:a.meetingId.status,errorMessage:a.meetingId.errorMessage,required:!0})]}),e.jsx("hr",{}),e.jsxs("div",{className:"sm:flex justify-evenly flex-wrap gap-x-5",children:[e.jsx(f,{label:"First Name*",type:"text",name:"firstName",placeholder:"John",value:a.firstName.value,onChange:d,parentClassName:"w-auto flex-1",status:a.firstName.status,errorMessage:a.firstName.errorMessage}),e.jsx(f,{label:"Last Name*",type:"text",name:"lastName",placeholder:"Doe",value:a.lastName.value,onChange:d,parentClassName:"w-auto flex-1",status:a.lastName.status,errorMessage:a.lastName.errorMessage})]}),e.jsxs("div",{className:"sm:flex justify-evenly flex-wrap gap-x-5",children:[e.jsx(f,{label:"Company Name*",type:"text",name:"companyName",placeholder:"ABC Corp",value:a.companyName.value,onChange:d,parentClassName:"w-auto flex-1",status:a.companyName.status,errorMessage:a.companyName.errorMessage}),e.jsx(f,{label:"Professional Classification*",type:"text",name:"classification",placeholder:"eg. Real Estate Agent, Lawyer",value:a.classification.value,onChange:d,parentClassName:"w-auto flex-1",status:a.classification.status,errorMessage:a.classification.errorMessage})]}),e.jsx(f,{label:"Email*",type:"email",name:"email",placeholder:"john.doe@abc.com",value:a.email.value,onChange:d,status:a.email.status,errorMessage:a.email.errorMessage}),e.jsx(f,{label:"Mobile Number*",type:"tel",name:"mobileNumber",placeholder:"12345 67890",value:a.mobileNumber.value,onChange:d,status:a.mobileNumber.status,errorMessage:a.mobileNumber.errorMessage,disabled:!N}),e.jsx("div",{className:"flex justify-center mt-10",children:e.jsx(B,{onClick:P,children:"Save & Pay"})})]})})})})]}),C&&!g&&e.jsxs("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke py-4 px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Visitor Feedback"})}),e.jsx("form",{action:"#",children:e.jsx("div",{className:"p-6.5",children:e.jsx("div",{className:"mb-4.5 flex flex-col gap-6 xl:flex-row",children:e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"flex w-full m-auto justify-evenly flex-wrap gap-x-5",children:e.jsxs("div",{className:"feedback-form",children:[e.jsx(M,{label:"Given your experience today, which option best describes the next steps for you?",placeholder:"Select an option",parentClassName:"w-auto flex-1 whitespace-nowrap",name:"nextStep",value:a.nextStep.value,options:[{label:"I'd like to apply today",value:"I'd like to apply today"},{label:"Yes, I like it - I just have some questions that need answering",value:"Yes, I like it - I just have some questions that need answering"},{label:"I like it - I'm just not able to make the commitments at the moment",value:"I like it - I'm just not able to make the commitments at the moment"}],onChange:d}),e.jsx(O,{label:"What time did you arrive at the meeting?",timeFormat:"12",onTimeChange:T}),e.jsx(M,{label:"Did the Chapter make you feel welcome?",placeholder:"Select an option",parentClassName:"w-auto flex-1 whitespace-nowrap",name:"feelWelcome",value:a.feelWelcome.value,options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],onChange:d}),e.jsx(M,{label:"Have you visited BNI before?",placeholder:"Select an option",parentClassName:"w-auto flex-1 whitespace-nowrap",name:"visitedBniBefore",value:a.visitedBniBefore.value,options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],onChange:d}),e.jsx(f,{label:"Have you been involved in a business referral group before? (If yes, how did it compare?)",type:"text",name:"referralGroupExperience",placeholder:"Your response here",value:a.referralGroupExperience.value,onChange:d,status:a.referralGroupExperience.status,errorMessage:a.referralGroupExperience.errorMessage}),e.jsx(M,{label:"On a scale of 1-10, How was your experience in this meeting?",placeholder:"Select an option",parentClassName:"w-auto flex-1 whitespace-nowrap",name:"feedbackScore",value:a.feedbackScore.value,options:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"},{label:"6",value:"6"},{label:"7",value:"7"},{label:"8",value:"8"},{label:"9",value:"9"},{label:"10",value:"10"}],onChange:d}),e.jsx(f,{label:"Do you have any suggestions or feedback?",type:"text",name:"feedbackComments",placeholder:"Your response here",value:a.feedbackComments.value,onChange:d}),N?e.jsx(B,{className:"mt-10",onClick:P,children:"Save & Complete"}):e.jsx(B,{className:"mt-10",onClick:P,children:"Save & Pay"})]})})})})})})]}),g&&D===3&&e.jsx("div",{className:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded dark:bg-green-900 dark:border-green-700 dark:text-green-200",children:"Form has been filled successfully and recorded."}),g&&D===3&&e.jsx("div",{className:"qr-payment",children:e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-5 shadow-default dark:border-strokedark dark:bg-boxdark",children:[i.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-stroke py-4 px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Please scan the QR code below to pay:"})}),e.jsx("p",{}),e.jsx("img",{src:"https://simplicollect.s3.ap-south-1.amazonaws.com/web_app/abc.jpg",alt:"QR Code for Payment"})]}),e.jsx("p",{className:"ml-2 text-gray-800 dark:text-gray-200",children:"Note: "}),e.jsxs("ul",{className:"list-disc ml-10 text-gray-800 dark:text-gray-200",children:[e.jsxs("li",{children:[!i.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Amount:"})," ₹"," ",i.visitorPerMeetingFee]}),i.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Amount:"})," ₹ 600/800"]})]}),e.jsx("li",{children:"To confirm your payment, please show the payment proof on the visitor registration desk."})]})]})})]}):e.jsx(G,{alert:{type:"error",title:"Invalid Link",message:k}})};export{J as default};
