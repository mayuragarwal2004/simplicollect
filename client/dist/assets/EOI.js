import{j as e,f as W,r as u,c as $}from"./index.js";import{B as q}from"./Breadcrumb.js";import{A as G}from"./Alerts.js";import"./chevron-right.js";const h=({label:p,type:k="text",disabled:b=!1,className:y="",status:x="default",errorMessage:n,parentClassName:N="",...f})=>{const j=`
    w-full rounded-lg border-[1.5px] py-3 px-5 text-black outline-none transition
    dark:text-white
  `,v=`
    border-stroke bg-transparent focus:border-primary active:border-primary 
    dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary
  `,I=`
    cursor-default bg-whiter dark:bg-black
  `,C={error:"border-red-500 focus:border-red-500 text-red-600 dark:text-red-500",success:"border-green-500 focus:border-green-500 text-green-600 dark:text-green-500",default:""};return e.jsxs("div",{className:`input-wrapper ${N}`,children:[p&&e.jsx("label",{className:"mb-2.5 mt-5 block text-black dark:text-white",children:p}),e.jsx("input",{type:k,disabled:b,className:`${j} ${b?I:v} ${C[x]} ${y}`,...f}),x==="error"&&n&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:n})]})},E=({children:p,variant:k="primary",fullWidth:b=!1,disabled:y=!1,className:x="",...n})=>{const N=`
    flex items-center justify-center rounded p-3 font-medium transition
  `,f={primary:"bg-primary text-white hover:bg-opacity-90",secondary:"bg-secondary text-white hover:bg-opacity-90",danger:"bg-red-500 text-white hover:bg-opacity-90"};return e.jsx("button",{disabled:y,className:`
        ${N} 
        ${f[k]} 
        ${b?"w-full":""} 
        ${y?"cursor-not-allowed opacity-50":""} 
        ${x}
      `,...n,children:p})},B=({label:p="Select an option",name:k,options:b,placeholder:y="Please select an option",className:x="",parentClassName:n="",value:N,onChange:f,status:j="default",errorMessage:v="",...I})=>{const C=N!=="",V=()=>{switch(j){case"error":return"border-red-500 focus:border-red-500 active:border-red-500";case"success":return"border-green-500 focus:border-green-500 active:border-green-500";default:return"border-stroke focus:border-primary active:border-primary dark:border-form-strokedark dark:focus:border-primary"}};return e.jsxs("div",{className:`mb-4.5 ${n}`,children:[p&&e.jsx("label",{className:"mb-2.5 mt-5 block text-black dark:text-white",children:p}),e.jsxs("div",{className:"relative z-20 bg-transparent dark:bg-form-input",children:[e.jsxs("select",{value:N,name:k,onChange:f,className:`relative z-20 w-full appearance-none rounded border bg-transparent py-3 px-5 outline-none transition dark:bg-form-input ${V()} ${C?"text-black dark:text-white":""} ${x}`,...I,children:[e.jsx("option",{value:"",disabled:!0,className:"text-body dark:text-bodydark",children:y}),b.map(g=>e.jsx("option",{value:g.value,disabled:g.disabled,className:"text-body dark:text-bodydark",children:g.label},g.value))]}),e.jsx("span",{className:"absolute top-1/2 right-4 z-30 -translate-y-1/2",children:e.jsx("svg",{className:"fill-current",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("g",{opacity:"0.8",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.29289 8.29289C5.68342 7.90237 6.31658 7.90237 6.70711 8.29289L12 13.5858L17.2929 8.29289C17.6834 7.90237 18.3166 7.90237 18.7071 8.29289C19.0976 8.68342 19.0976 9.31658 18.7071 9.70711L12.7071 15.7071C12.3166 16.0976 11.6834 16.0976 11.2929 15.7071L5.29289 9.70711C4.90237 9.31658 4.90237 8.68342 5.29289 8.29289Z",fill:""})})})})]}),j==="error"&&v&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v})]})},o={value:"",disabled:!1,status:"default",errorMessage:""},U=()=>{const{chapterSlug:p}=W(),[k,b]=u.useState(),[y,x]=u.useState(""),[n,N]=u.useState({}),[f,j]=u.useState(""),[v,I]=u.useState(!1),[C,V]=u.useState(!1),[g,P]=u.useState(!1),[M,F]=u.useState(1),[S,A]=u.useState({upcoming:[],recent:[]}),[a,w]=u.useState({invitedBy:{...o},chapterVisitDate:{...o},heardAboutBNI:{...o},firstName:{...o},lastName:{...o},companyName:{...o},classification:{...o},industry:{...o},email:{...o},mobileNumber:{...o},feedbackScore:{...o},feedbackComments:{...o},nextStep:{...o},arrivalTime:{...o},feelWelcome:{...o,value:!1},visitedBniBefore:{...o,value:!1},referralGroupExperience:{...o},meetingId:{...o}});u.useEffect(()=>{(async()=>{try{const r=await $.get(`/api/visitor/verifyVisitorLink/${p}`),s=r.data;if(r.status!==200)throw new Error(s.message);if(!s.chapterId){b(!1),x(s.message||"Chapter not found");return}b(!0),N(s);const l=await $(`/api/visitor/getChapterMeetings/${s.chapterId}`),c=await l.data;if(console.log({meetingsResponse:l,meetingsResult:c}),l.status===200){const i=m=>new Date(m).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),D={upcoming:(c.upcoming||[]).map(m=>({...m,displayDate:i(m.meetingDate)})),recent:(c.recent||[]).map(m=>({...m,displayDate:i(m.meetingDate)}))};A(D),D.upcoming.length>0&&w(m=>({...m,meetingId:{...m.meetingId,value:D.upcoming[0].meetingId},chapterVisitDate:{...m.chapterVisitDate,value:D.upcoming[0].meetingDate}}))}}catch(r){console.error("Error fetching data:",r),b(!1),x("Failed to load chapter information")}})()},[p]);const R=async t=>{t.preventDefault();try{const r=await $.get(`/api/visitor/checkVisitor?phone=${f}`),s=r.data;if(r.status!==200)throw new Error(s.message);if(s.exists){I(!0),V(!0);const{visitor:l}=s,c={...a};for(const i in l)i in c&&(c[i]={...c[i],value:l[i]});w(c)}else F(2),w(l=>({...l,mobileNumber:{...l.mobileNumber,value:f}}))}catch(r){console.error("Error checking visitor:",r)}},d=t=>{const{name:r,value:s}=t.target;w(l=>({...l,[r]:{...l[r],value:s}}))},Y=()=>{let t=!0;return["firstName","lastName","companyName","classification","email","mobileNumber","meetingId"].forEach(s=>{a[s].value?w(l=>({...l,[s]:{...l[s],status:"success",errorMessage:""}})):(t=!1,w(l=>({...l,[s]:{...l[s],status:"error",errorMessage:`${s==="meetingId"?"Meeting selection":s} is required`}})))}),a.mobileNumber.value.length!==10&&(t=!1,w(s=>({...s,mobileNumber:{...s.mobileNumber,status:"error",errorMessage:"Mobile Number must be 10 digits"}}))),t},L=async t=>{if(t.preventDefault(),!!Y())try{const r={};for(const c in a){const i=a[c].value;i!=null&&i!==""&&(r[c]=i)}if(r.chapterId=n.chapterId,r.meetingId){const c=[...S.upcoming,...S.recent].find(i=>i.meetingId===r.meetingId);if(c){const i=new Date(c.meetingDate);r.chapterVisitDate=i.toISOString().split("T")[0]}}const s=v?"addFeedback":"addVisitor",l=await $.post(`/api/visitor/${s}`,r);if(l.status===200)P(!0),F(3);else throw new Error(l.data.message||"Error saving visitor details")}catch(r){console.error("Error saving visitor:",r),alert(r.message)}};return k===void 0?e.jsx("div",{children:"Loading..."}):k?e.jsxs("div",{className:"app-container p-4 md:p-6 bg-gray-100 dark:bg-gray-900 min-h-screen",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 break-words",children:[n.chapterName," - ",n.region]}),e.jsx(q,{items:[{name:"Visitor Registration"}]}),!v&&!g&&M===1&&e.jsxs("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke py-4 px-4 md:px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Visitor Login"})}),e.jsx("form",{action:"#",children:e.jsx("div",{className:"p-4 md:p-6.5",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"phone-section",children:[e.jsx(h,{label:"Enter your phone number to continue:",placeholder:"12345 67890",value:f,onChange:t=>j(t.target.value)}),e.jsx("div",{className:"mt-6",children:e.jsx(E,{className:"w-full",onClick:t=>R(t),children:"Submit"})})]})})})})]}),!C&&!g&&M===2&&e.jsxs("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke py-4 px-4 md:px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Enter New Visitor Details"})}),e.jsx("form",{action:"#",children:e.jsx("div",{className:"p-4 md:p-6.5",children:e.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsx(h,{label:"Who Invited You to this Meeting?*",type:"text",name:"invitedBy",placeholder:"Name of Member",value:a.invitedBy.value,onChange:d,parentClassName:"w-full"}),e.jsx(B,{label:"Select Meeting*",placeholder:"Select a meeting",parentClassName:"w-full",name:"meetingId",value:a.meetingId.value,options:[...S.recent.length>0?[{label:"─── Past Meetings ───",value:"",disabled:!0},...S.recent.map(t=>({label:`${t.meetingName} - ${t.displayDate}`,value:t.meetingId}))]:[],...S.upcoming.length>0?[{label:"─── Upcoming Meetings ───",value:"",disabled:!0},...S.upcoming.map(t=>({label:`${t.meetingName} - ${t.displayDate}`,value:t.meetingId}))]:[]],onChange:d,status:a.meetingId.status,errorMessage:a.meetingId.errorMessage,required:!0})]}),e.jsx("hr",{className:"border-stroke dark:border-strokedark"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsx(h,{label:"First Name*",type:"text",name:"firstName",placeholder:"John",value:a.firstName.value,onChange:d,parentClassName:"w-full",status:a.firstName.status,errorMessage:a.firstName.errorMessage}),e.jsx(h,{label:"Last Name*",type:"text",name:"lastName",placeholder:"Doe",value:a.lastName.value,onChange:d,parentClassName:"w-full",status:a.lastName.status,errorMessage:a.lastName.errorMessage})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsx(h,{label:"Company Name*",type:"text",name:"companyName",placeholder:"ABC Corp",value:a.companyName.value,onChange:d,parentClassName:"w-full",status:a.companyName.status,errorMessage:a.companyName.errorMessage}),e.jsx(h,{label:"Professional Classification*",type:"text",name:"classification",placeholder:"eg. Real Estate Agent, Lawyer",value:a.classification.value,onChange:d,parentClassName:"w-full",status:a.classification.status,errorMessage:a.classification.errorMessage})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsx(h,{label:"Email*",type:"email",name:"email",placeholder:"john.doe@abc.com",value:a.email.value,onChange:d,status:a.email.status,errorMessage:a.email.errorMessage}),e.jsx(h,{label:"Mobile Number*",type:"tel",name:"mobileNumber",placeholder:"12345 67890",value:a.mobileNumber.value,onChange:d,status:a.mobileNumber.status,errorMessage:a.mobileNumber.errorMessage,disabled:!v})]}),e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx(E,{className:"w-full max-w-xs",onClick:L,children:"Save & Pay"})})]})})})]}),C&&!g&&e.jsxs("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke py-4 px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Visitor Feedback"})}),e.jsx("form",{action:"#",children:e.jsx("div",{className:"p-4 md:p-6.5",children:e.jsx("div",{className:"w-full max-w-4xl mx-auto",children:e.jsxs("div",{className:"feedback-form space-y-6",children:[e.jsx(B,{label:"Given your experience today, which option best describes the next steps for you?",placeholder:"Select an option",parentClassName:"w-full",name:"nextStep",value:a.nextStep.value,options:[{label:"I'd like to apply today",value:"I'd like to apply today"},{label:"Yes, I like it - I just have some questions that need answering",value:"Yes, I like it - I just have some questions that need answering"},{label:"I like it - I'm just not able to make the commitments at the moment",value:"I like it - I'm just not able to make the commitments at the moment"}],onChange:d}),e.jsx(h,{label:"What time did you arrive at the meeting?",type:"text",name:"arrivalTime",placeholder:"e.g., 9:30 AM",value:a.arrivalTime.value,onChange:d}),e.jsx(B,{label:"Did the Chapter make you feel welcome?",placeholder:"Select an option",parentClassName:"w-full",name:"feelWelcome",value:a.feelWelcome.value,options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],onChange:d}),e.jsx(B,{label:"Have you visited BNI before?",placeholder:"Select an option",parentClassName:"w-full",name:"visitedBniBefore",value:a.visitedBniBefore.value,options:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}],onChange:d}),e.jsx(h,{label:"Have you been involved in a business referral group before? (If yes, how did it compare?)",type:"text",name:"referralGroupExperience",placeholder:"Your response here",value:a.referralGroupExperience.value,onChange:d,status:a.referralGroupExperience.status,errorMessage:a.referralGroupExperience.errorMessage}),e.jsxs("div",{className:"mb-4.5 w-full",children:[e.jsx("label",{className:"mb-2.5 mt-5 block text-black dark:text-white",children:"On a scale of 1-10, How was your experience in this meeting?"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[[1,2,3,4,5,6,7,8,9,10].map(t=>e.jsx("button",{type:"button",onClick:()=>{w(r=>({...r,feedbackScore:{...r.feedbackScore,value:t.toString()}}))},className:`flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all duration-200 ${parseInt(a.feedbackScore.value)>=t?"bg-yellow-400 border-yellow-400 text-white":"bg-gray-100 border-gray-300 text-gray-600 hover:bg-yellow-100 hover:border-yellow-300"} dark:${parseInt(a.feedbackScore.value)>=t?"bg-yellow-500 border-yellow-500 text-white":"bg-gray-700 border-gray-600 text-gray-300 hover:bg-yellow-600 hover:border-yellow-500"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})},t)),a.feedbackScore.value&&e.jsxs("span",{className:"ml-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:["Rating: ",a.feedbackScore.value,"/10"]})]})]}),e.jsx(h,{label:"Do you have any suggestions or feedback?",type:"text",name:"feedbackComments",placeholder:"Your response here",value:a.feedbackComments.value,onChange:d}),e.jsx("div",{className:"flex justify-center pt-6",children:v?e.jsx(E,{className:"w-full max-w-xs",onClick:L,children:"Save & Complete"}):e.jsx(E,{className:"w-full max-w-xs",onClick:L,children:"Save & Pay"})})]})})})})]}),g&&M===3&&e.jsx("div",{className:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded dark:bg-green-900 dark:border-green-700 dark:text-green-200",children:"Form has been filled successfully and recorded."}),g&&M===3&&e.jsx("div",{className:"qr-payment",children:e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-4 md:p-5 shadow-default dark:border-strokedark dark:bg-boxdark",children:[n.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-stroke py-4 px-2 md:px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white text-center md:text-left",children:"Please scan the QR code below to pay:"})}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://simplicollect.s3.ap-south-1.amazonaws.com/web_app/abc.jpg",alt:"QR Code for Payment",className:"max-w-full h-auto max-h-80 md:max-h-96"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"ml-2 text-gray-800 dark:text-gray-200 font-medium",children:"Note: "}),e.jsxs("ul",{className:"list-disc ml-6 md:ml-10 text-gray-800 dark:text-gray-200 space-y-2",children:[e.jsxs("li",{children:[!n.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Amount:"})," ₹"," ",n.visitorPerMeetingFee]}),n.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Amount:"})," ₹ 600/800"]})]}),e.jsx("li",{children:"To confirm your payment, please show the payment proof on the visitor registration desk."})]})]})]})})]}):e.jsx(G,{alert:{type:"error",title:"Invalid Link",message:y}})};export{U as default};
