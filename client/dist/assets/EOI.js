import{e as _,r as h,j as e,C as S,f as C,g as M,h as L,i as F,B as b,c as w}from"./index.js";import{B as K}from"./Breadcrumb.js";import{A as X}from"./Alerts.js";import{I as u}from"./input.js";import{L as l}from"./label.js";import{S as Z,a as ee,b as se,c as ae,d as G}from"./select.js";import{T}from"./textarea.js";import{P as W}from"./phone-input.js";import{R as D,a as g}from"./radio-group.js";import{S as re}from"./star.js";import"./chevron-right.js";import"./index4.js";import"./index10.js";import"./index11.js";import"./index9.js";import"./index5.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./check.js";import"./chevron-up.js";import"./index2.js";import"./command.js";import"./index3.js";import"./index6.js";import"./dialog.js";import"./search.js";import"./popover.js";import"./scroll-area.js";import"./chevrons-up-down.js";import"./index13.js";import"./circle.js";const o={value:"",disabled:!1,status:"default",errorMessage:""},Ge=()=>{const{chapterSlug:E}=_(),[B,k]=h.useState(),[Y,V]=h.useState(""),[p,q]=h.useState({}),[I,$]=h.useState(""),[j,O]=h.useState(!1),[P,H]=h.useState(!1),[N,Q]=h.useState(!1),[v,R]=h.useState(1),[f,z]=h.useState({upcoming:[],recent:[]}),[s,m]=h.useState({invitedBy:{...o},chapterVisitDate:{...o},heardAboutBNI:{...o},firstName:{...o},lastName:{...o},companyName:{...o},classification:{...o},industry:{...o},email:{...o},mobileNumber:{...o},feedbackScore:{...o},feedbackComments:{...o},nextStep:{...o},arrivalTime:{...o},feelWelcome:{...o},visitedBniBefore:{...o},referralGroupExperience:{...o},meetingId:{...o}});h.useEffect(()=>{(async()=>{try{const a=await w.get(`/api/visitor/verifyVisitorLink/${E}`),n=a.data;if(a.status!==200)throw new Error(n.message);if(!n.chapterId){k(!1),V(n.message||"Chapter not found");return}k(!0),q(n);const t=await w(`/api/visitor/getChapterMeetings/${n.chapterId}`),i=await t.data;if(console.log({meetingsResponse:t,meetingsResult:i}),t.status===200){const c=d=>new Date(d).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),y={upcoming:(i.upcoming||[]).map(d=>({...d,displayDate:c(d.meetingDate)})),recent:(i.recent||[]).map(d=>({...d,displayDate:c(d.meetingDate)}))};z(y),y.upcoming.length>0&&m(d=>({...d,meetingId:{...d.meetingId,value:y.upcoming[0].meetingId},chapterVisitDate:{...d.chapterVisitDate,value:y.upcoming[0].meetingDate}}))}}catch(a){console.error("Error fetching data:",a),k(!1),V("Failed to load chapter information")}})()},[E]);const U=async r=>{r.preventDefault();try{const a=await w.get(`/api/visitor/checkVisitor?phone=${encodeURIComponent(I)}`),n=a.data;if(a.status!==200)throw new Error(n.message);if(n.exists){O(!0),H(!0);const{visitor:t}=n,i={...s};for(const c in t)c in i&&(i[c]={...i[c],value:t[c]});m(i)}else R(2),m(t=>({...t,mobileNumber:{...t.mobileNumber,value:I}}))}catch(a){console.error("Error checking visitor:",a)}},x=r=>{const{name:a,value:n}=r.target;m(t=>({...t,[a]:{...t[a],value:n}}))},J=()=>{let r=!0;["firstName","lastName","companyName","classification","email","mobileNumber","meetingId"].forEach(t=>{s[t].value?m(i=>({...i,[t]:{...i[t],status:"success",errorMessage:""}})):(r=!1,m(i=>({...i,[t]:{...i[t],status:"error",errorMessage:`${t==="meetingId"?"Meeting selection":t} is required`}})))});const n=s.mobileNumber.value;if(n&&typeof n=="string"){const t=n.replace(/\D/g,"");(t.length<10||t.length>15)&&(r=!1,m(i=>({...i,mobileNumber:{...i.mobileNumber,status:"error",errorMessage:"Please enter a valid mobile number"}})))}return r},A=async r=>{if(r.preventDefault(),!!J())try{const a={};for(const i in s){const c=s[i].value;c!=null&&c!==""&&(a[i]=c)}if(a.chapterId=p.chapterId,a.meetingId){const i=[...f.upcoming,...f.recent].find(c=>c.meetingId===a.meetingId);if(i){const c=new Date(i.meetingDate);a.chapterVisitDate=c.toISOString().split("T")[0]}}const n=j?"addFeedback":"addVisitor",t=await w.post(`/api/visitor/${n}`,a);if(t.status===200)Q(!0),R(3);else throw new Error(t.data.message||"Error saving visitor details")}catch(a){console.error("Error saving visitor:",a),alert(a.message)}};return B===void 0?e.jsx("div",{children:"Loading..."}):B?e.jsxs("div",{className:"app-container p-4 md:p-6 bg-gray-100 dark:bg-gray-900 min-h-screen",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 break-words",children:[p.chapterName," - ",p.region]}),e.jsx(K,{items:[{name:"Visitor Registration"}]}),!j&&!N&&v===1&&e.jsxs(S,{className:"max-w-md mx-auto",children:[e.jsxs(C,{children:[e.jsx(M,{className:"text-center",children:"Visitor Login"}),e.jsx(L,{className:"text-center",children:"Enter your phone number to continue"})]}),e.jsx(F,{children:e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"phone",children:"Phone Number"}),e.jsx(W,{defaultCountry:"IN",value:I,onChange:r=>$(r||""),placeholder:"Enter your phone number"})]}),e.jsx(b,{type:"submit",className:"w-full",children:"Submit"})]})})]}),!P&&!N&&v===2&&e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(M,{children:"Enter New Visitor Details"})}),e.jsx(F,{children:e.jsx("form",{onSubmit:A,className:"space-y-6",children:e.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"invitedBy",children:"Who Invited You to this Meeting?*"}),e.jsx(u,{id:"invitedBy",name:"invitedBy",placeholder:"Name of Member",value:s.invitedBy.value,onChange:x,className:s.invitedBy.status==="error"?"border-red-500":""}),s.invitedBy.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.invitedBy.errorMessage})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"meetingId",children:"Select Meeting*"}),e.jsxs(Z,{name:"meetingId",value:s.meetingId.value,onValueChange:r=>{m(a=>({...a,meetingId:{...a.meetingId,value:r}}))},children:[e.jsx(ee,{className:s.meetingId.status==="error"?"border-red-500":"",children:e.jsx(se,{placeholder:"Select a meeting"})}),e.jsxs(ae,{children:[f.recent.length>0&&e.jsx(e.Fragment,{children:f.recent.map(r=>e.jsxs(G,{value:r.meetingId,children:[r.meetingName," - ",r.displayDate," ","(Past)"]},r.meetingId))}),f.upcoming.length>0&&e.jsx(e.Fragment,{children:f.upcoming.map(r=>e.jsxs(G,{value:r.meetingId,children:[r.meetingName," - ",r.displayDate]},r.meetingId))})]})]}),s.meetingId.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.meetingId.errorMessage})]})]}),e.jsx("hr",{className:"border-gray-200 dark:border-gray-700"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"firstName",children:"First Name*"}),e.jsx(u,{id:"firstName",name:"firstName",placeholder:"John",value:s.firstName.value,onChange:x,className:s.firstName.status==="error"?"border-red-500":""}),s.firstName.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.firstName.errorMessage})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"lastName",children:"Last Name*"}),e.jsx(u,{id:"lastName",name:"lastName",placeholder:"Doe",value:s.lastName.value,onChange:x,className:s.lastName.status==="error"?"border-red-500":""}),s.lastName.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.lastName.errorMessage})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"companyName",children:"Company Name*"}),e.jsx(u,{id:"companyName",name:"companyName",placeholder:"ABC Corp",value:s.companyName.value,onChange:x,className:s.companyName.status==="error"?"border-red-500":""}),s.companyName.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.companyName.errorMessage})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"classification",children:"Professional Classification*"}),e.jsx(u,{id:"classification",name:"classification",placeholder:"eg. Real Estate Agent, Lawyer",value:s.classification.value,onChange:x,className:s.classification.status==="error"?"border-red-500":""}),s.classification.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.classification.errorMessage})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email",children:"Email*"}),e.jsx(u,{id:"email",name:"email",type:"email",placeholder:"john.doe@abc.com",value:s.email.value,onChange:x,className:s.email.status==="error"?"border-red-500":""}),s.email.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.email.errorMessage})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"mobileNumber",children:"Mobile Number*"}),e.jsx(W,{defaultCountry:"IN",value:s.mobileNumber.value,onChange:r=>{m(a=>({...a,mobileNumber:{...a.mobileNumber,value:r||""}}))},placeholder:"Enter mobile number",disabled:!j,className:s.mobileNumber.status==="error"?"border-red-500":""}),s.mobileNumber.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.mobileNumber.errorMessage})]})]}),e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx(b,{type:"submit",className:"w-full max-w-xs",children:"Save & Pay"})})]})})})]}),P&&!N&&e.jsxs(S,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Visitor Feedback"}),e.jsx(L,{children:"Please share your experience with us"})]}),e.jsx(F,{children:e.jsx("form",{onSubmit:A,className:"space-y-6",children:e.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{children:"Given your experience today, which option best describes the next steps for you?"}),e.jsxs(D,{value:s.nextStep.value,onValueChange:r=>{m(a=>({...a,nextStep:{...a.nextStep,value:r}}))},className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(g,{value:"I'd like to apply today",id:"next-apply",className:"mt-1"}),e.jsx(l,{htmlFor:"next-apply",className:"cursor-pointer text-sm leading-relaxed",children:"I'd like to apply today"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(g,{value:"Yes, I like it - I just have some questions that need answering",id:"next-questions",className:"mt-1"}),e.jsx(l,{htmlFor:"next-questions",className:"cursor-pointer text-sm leading-relaxed",children:"Yes, I like it - I just have some questions that need answering"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(g,{value:"I like it - I'm just not able to make the commitments at the moment",id:"next-commitments",className:"mt-1"}),e.jsx(l,{htmlFor:"next-commitments",className:"cursor-pointer text-sm leading-relaxed",children:"I like it - I'm just not able to make the commitments at the moment"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"arrivalTime",children:"What time did you arrive at the meeting?"}),e.jsx(u,{id:"arrivalTime",name:"arrivalTime",placeholder:"e.g., 9:30 AM",value:s.arrivalTime.value,onChange:x})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Did the Chapter make you feel welcome?"}),e.jsxs(D,{value:s.feelWelcome.value,onValueChange:r=>{m(a=>({...a,feelWelcome:{...a.feelWelcome,value:r}}))},className:"flex flex-row space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Yes",id:"welcome-yes"}),e.jsx(l,{htmlFor:"welcome-yes",className:"cursor-pointer",children:"Yes"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"No",id:"welcome-no"}),e.jsx(l,{htmlFor:"welcome-no",className:"cursor-pointer",children:"No"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Have you visited BNI before?"}),e.jsxs(D,{value:s.visitedBniBefore.value,onValueChange:r=>{m(a=>({...a,visitedBniBefore:{...a.visitedBniBefore,value:r}}))},className:"flex flex-row space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Yes",id:"visited-yes"}),e.jsx(l,{htmlFor:"visited-yes",className:"cursor-pointer",children:"Yes"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"No",id:"visited-no"}),e.jsx(l,{htmlFor:"visited-no",className:"cursor-pointer",children:"No"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"referralGroupExperience",children:"Have you been involved in a business referral group before? (If yes, how did it compare?)"}),e.jsx(T,{id:"referralGroupExperience",name:"referralGroupExperience",placeholder:"Your response here",value:s.referralGroupExperience.value,onChange:x,className:s.referralGroupExperience.status==="error"?"border-red-500":""}),s.referralGroupExperience.errorMessage&&e.jsx("p",{className:"text-sm text-red-500",children:s.referralGroupExperience.errorMessage})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{children:"On a scale of 1-10, How was your experience in this meeting?"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[[1,2,3,4,5,6,7,8,9,10].map(r=>e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:()=>{m(a=>({...a,feedbackScore:{...a.feedbackScore,value:r.toString()}}))},className:`w-10 h-10 p-0 rounded-full transition-all duration-200 ${parseInt(s.feedbackScore.value)>=r?"bg-yellow-400 border-yellow-400 text-white hover:bg-yellow-500":"hover:bg-yellow-50 hover:border-yellow-300"}`,children:e.jsx(re,{className:`w-4 h-4 ${parseInt(s.feedbackScore.value)>=r?"fill-current":""}`})},r)),s.feedbackScore.value&&e.jsxs("span",{className:"ml-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:["Rating: ",s.feedbackScore.value,"/10"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"feedbackComments",children:"Do you have any suggestions or feedback?"}),e.jsx(T,{id:"feedbackComments",name:"feedbackComments",placeholder:"Your response here",value:s.feedbackComments.value,onChange:x})]}),e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx(b,{type:"submit",className:"w-full max-w-xs",children:j?"Save & Complete":"Save & Pay"})})]})})})]}),N&&v===3&&e.jsx("div",{className:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded dark:bg-green-900 dark:border-green-700 dark:text-green-200",children:"Form has been filled successfully and recorded."}),N&&v===3&&e.jsx("div",{className:"qr-payment",children:e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-4 md:p-5 shadow-default dark:border-strokedark dark:bg-boxdark",children:[p.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-stroke py-4 px-2 md:px-6.5 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white text-center md:text-left",children:"Please scan the QR code below to pay:"})}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://simplicollect.s3.ap-south-1.amazonaws.com/web_app/abc.jpg",alt:"QR Code for Payment",className:"max-w-full h-auto max-h-80 md:max-h-96"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"ml-2 text-gray-800 dark:text-gray-200 font-medium",children:["Note:"," "]}),e.jsxs("ul",{className:"list-disc ml-6 md:ml-10 text-gray-800 dark:text-gray-200 space-y-2",children:[e.jsxs("li",{children:[!p.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Amount:"})," ₹"," ",p.visitorPerMeetingFee]}),p.chapterName.startsWith("ABC")&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Amount:"})," ₹ 600/800"]})]}),e.jsx("li",{children:"To confirm your payment, please show the payment proof on the visitor registration desk."})]})]})]})})]}):e.jsx(X,{alert:{type:"error",title:"Invalid Link",message:Y}})};export{Ge as default};
