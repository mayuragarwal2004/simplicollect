import{u as X,a as U,r as o,j as e,X as P,f as z,c as v,Q as d,B as N}from"./index-6elQxnHd.js";import{u as G,a as J,f as B,c as Y,b as Z}from"./usePagination-BYw1nb5N.js";import{T as _,a as ee,b as k,c as ae,d as te,e as L}from"./table-CMz5QLeZ.js";import{C as $}from"./index-BIhwVmuG.js";import{I as K}from"./input-Dp_r379b.js";import{M as le}from"./multiSelect-DW6PEUB7.js";import{D as se,a as re,b as oe,c as ie,d as ne}from"./dialog-CT_lOUQb.js";import{A as ce,a as de,b as me,c as he,d as ue}from"./alert-dialog-BqU3jmle.js";import{S as O}from"./switch-0nZFpl0y.js";import{L as Q}from"./label-Duevo3Y3.js";import"./index-BGKEPXry.js";import"./separator-CQuc5foV.js";import"./badge-C8uzDnx2.js";import"./popover-D0OZeFQ8.js";import"./index-BLdKwkXj.js";import"./index-BXCPHgg9.js";import"./index-CE4AQY6s.js";import"./command-DbqVVo4r.js";import"./index-CgP8r1n9.js";import"./search-C_1baVLY.js";import"./chevron-down-BUZeX_Bt.js";import"./index-DSJunp_n.js";function fe({columns:u,data:c,searchInputField:s,filterField:S,filterFieldName:w,filterCategoriesList:C,totalRecord:I,children:x}){var y;const f=X(),{rows:p,onPaginationChange:g,page:m,pagination:H}=G(),A=U(),E=()=>{const r=new URLSearchParams(A.search),t=Y({rows:p,page:m},r);f(`?${t}`,{replace:!0})};o.useEffect(()=>{E()},[p,m]);const i=J({data:c,columns:u,getCoreRowModel:Z(),manualPagination:!0,onPaginationChange:g,state:{pagination:H},rowCount:I}),R=o.Children.map(x,r=>o.isValidElement(r)?o.cloneElement(r,{table:i,searchInputField:s,filterField:S,filterFieldName:w,filterCategoriesList:C}):r);return e.jsxs("div",{className:"space-y-4",children:[R,e.jsx("div",{className:"overflow-y-auto rounded-md border",children:e.jsxs(_,{children:[e.jsx(ee,{children:i.getHeaderGroups().map(r=>e.jsx(k,{children:r.headers.map(t=>e.jsx(ae,{className:"px-4 py-2 bg-newprimaryColor text-white font-raleway",colSpan:t.colSpan,children:t.isPlaceholder?null:B(t.column.columnDef.header,t.getContext())},t.id))},r.id))}),e.jsx(te,{className:"bg-adminBreadCrumbsBg font-raleway",children:(y=i.getRowModel().rows)!=null&&y.length?i.getRowModel().rows.map(r=>e.jsx(k,{"data-state":r.getIsSelected()&&"selected",children:r.getVisibleCells().map(t=>e.jsx(L,{className:"px-4 py-2",children:B(t.column.columnDef.cell,t.getContext())},t.id))},r.id)):e.jsx(k,{children:e.jsx(L,{colSpan:u.length,className:"h-24 text-center bg-adminBreadCrumbsBg font-raleway",children:"No results."})})})]})})]})}const pe=(u,c)=>[{id:"srno",header:()=>e.jsx("p",{children:"Sr. No."}),cell:s=>e.jsx("p",{children:s.row.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"roleName",header:()=>e.jsx("div",{children:"Role Name"}),cell:({row:s})=>e.jsx("p",{className:"text-sm font-medium",children:s.original.roleName}),enableSorting:!1,enableHiding:!1},{accessorKey:"roleDescription",header:()=>e.jsx("div",{children:"Role Description"}),cell:({row:s})=>e.jsx("p",{className:"text-sm font-medium",children:s.original.roleDescription}),enableSorting:!1,enableHiding:!1},{accessorKey:"rights",header:()=>e.jsx("div",{children:"Rights"}),cell:({row:s})=>e.jsx("p",{className:"text-sm font-medium",children:s.original.featureNames}),enableSorting:!1,enableHiding:!1},{accessorKey:"removable",header:()=>e.jsx("div",{children:"Removable"}),cell:({row:s})=>e.jsx("div",{className:"flex justify-center",children:s.original.removable?e.jsx($,{className:"h-5 w-5 text-green-500"}):e.jsx(P,{className:"h-5 w-5 text-red-500"})}),enableSorting:!1,enableHiding:!1},{accessorKey:"default",header:()=>e.jsx("div",{children:"Default"}),cell:({row:s})=>e.jsx("div",{className:"flex justify-center",children:s.original.default?e.jsx($,{className:"h-5 w-5 text-green-500"}):e.jsx(P,{className:"h-5 w-5 text-red-500"})}),enableSorting:!1,enableHiding:!1},{id:"actions",header:()=>e.jsx("div",{children:"Actions"}),cell:({row:s})=>e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>u(s.original),className:"text-primary hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>c(s.original.roleId),className:"text-danger hover:underline",children:"Delete"})]}),enableSorting:!1,enableHiding:!1}];function Le(){const[u,c]=o.useState([{roleId:1,roleName:"Admin",roleDescription:"Administrator role with full access",rights:"all",removable:!1},{roleId:2,roleName:"Editor",roleDescription:"Editor role with limited access",rights:"edit",removable:!0}]),[s,S]=o.useState([{featureId:1,featureName:"Feature 1"},{featureId:2,featureName:"Feature 2"},{featureId:3,featureName:"Feature 3"}]),[w,C]=o.useState(!0),[I,x]=o.useState(!1),[f,p]=o.useState(null),[g,m]=o.useState(null),[H,A]=o.useState(0),E=U(),{chapterSlug:i}=z(),R=new URLSearchParams(E.search),y=R.get("rows")||10,r=R.get("page")||0,[t,h]=o.useState({roleName:"",roleDescription:"",rights:[],removable:!1,default:!1});o.useEffect(()=>{F(),V()},[y,r]);const F=async()=>{try{const a=await v.get(`/api/admin/chapters/${i}/roles`),l=(a.data.data||a.data).map(n=>({...n,onEdit:()=>j(n),onDelete:()=>D(n.roleId)}));c(l),A(a.data.totalRecords||a.data.length),C(!1)}catch{d.error("Failed to fetch roles"),C(!1)}},V=async()=>{try{const a=await v.get("/api/admin/chapter-member-list/all-features");S(a.data)}catch{d.error("Failed to fetch features")}},j=(a=null)=>{a?(h({roleName:a.roleName,roleDescription:a.roleDescription,rights:Array.isArray(a.rights)?a.rights:a.rights.split(","),removable:a.removable||!1,default:a.default||!1}),p(a)):(h({roleName:"",roleDescription:"",rights:[],removable:!1,default:!1}),p(null)),x(!0)},M=()=>{x(!1),p(null),h({roleName:"",roleDescription:"",rights:[],removable:!1,default:!1})},q=a=>{h(l=>({...l,rights:Array.isArray(a)?a:[]}))},T=a=>{const{name:l,value:n}=a.target;h(b=>({...b,[l]:n}))},W=async a=>{if(a.preventDefault(),!t.roleName.trim()||!t.roleDescription.trim()||t.rights.length===0){d.error("All fields are required");return}try{let l;f?(l=await v.put(`/api/admin/chapters/${i}/editRole/${f.roleId}`,{...t,rights:(t.rights??[]).join(","),removable:t.removable?1:0,default:t.default?1:0}),c(n=>n.map(b=>b.roleId===f.roleId?{...b,...l.data,onEdit:()=>j(l.data),onDelete:()=>D(l.data.roleId)}:b)),F(),d.success("Role updated successfully")):(l=await v.post(`/api/admin/chapters/${i}/addRole`,{...t,rights:(t.rights??[]).join(","),removable:t.removable?1:0,default:t.default?1:0}),c(n=>[...n,{...l.data,onEdit:()=>j(l.data),onDelete:()=>D(l.data.roleId)}]),F(),d.success("Role created successfully")),M()}catch{d.error("An error occurred while saving")}},D=async()=>{if(g){try{await v.delete(`/api/admin/chapters/${i}/deleteRole/${g}`),c(a=>a.filter(l=>l.roleId!==g)),d.success("Role deleted successfully")}catch{d.error("Failed to delete role")}m(null)}};return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg mt-4 relative",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Set up Roles for the Chapters"}),w?e.jsx("p",{children:"Loading..."}):e.jsx(fe,{data:u,columns:pe(j,m)}),e.jsx("div",{className:"flex justify-center mt-5",children:e.jsx(N,{onClick:()=>j(),children:"Add Role"})}),e.jsx(ce,{open:!!g,onOpenChange:()=>m(null),children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsx(he,{children:"Confirm Deletion"})}),e.jsx("p",{children:"Are you sure you want to delete this role?"}),e.jsxs(ue,{children:[e.jsx(N,{variant:"secondary",onClick:()=>m(null),children:"Cancel"}),e.jsx(N,{variant:"destructive",onClick:D,children:"Delete"})]})]})}),e.jsx(se,{open:I,onOpenChange:x,children:e.jsxs(re,{children:[e.jsx(oe,{children:e.jsx(ie,{children:f?"Edit Role":"Add Role"})}),e.jsx(K,{name:"roleName",placeholder:"Role Name",value:t.roleName,onChange:T}),e.jsx(K,{name:"roleDescription",placeholder:"Role Description",value:t.roleDescription,onChange:T}),e.jsx(le,{options:s.map(a=>({label:a.featureName,value:a.featureId.toString()})),onValueChange:q,defaultValue:t.rights.map(String),placeholder:"Select Rights",maxCount:5}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Q,{htmlFor:"removable",children:"Removable"}),e.jsx(O,{id:"removable",checked:t.removable,onCheckedChange:a=>h(l=>({...l,removable:a}))})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Q,{htmlFor:"default",children:"Default"}),e.jsx(O,{id:"default",checked:t.default,onCheckedChange:a=>h(l=>({...l,default:a}))})]}),e.jsxs(ne,{children:[e.jsx(N,{onClick:M,variant:"secondary",children:"Cancel"}),e.jsx(N,{onClick:W,children:"Save"})]})]})})]})}export{Le as default};
