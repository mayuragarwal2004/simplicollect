import{r as d,R as Z,j as e,C as L,i as Q,B as E,c as b,Q as h,k as Ne,f as be,g as we,h as Ce,q as P}from"./index.js";import{T as Re,a as Te,b as _,c as ee}from"./tabs.js";import{B as I}from"./badge.js";import{D as oe,a as de,b as me,c as he,e as Ae}from"./dialog.js";import{A as Fe,a as De,b as Ie,c as Se,f as Oe,d as ke,g as Le,h as Qe}from"./alert-dialog.js";import{I as k}from"./input.js";import{L as f}from"./label.js";import{S as se,a as ae,b as re,c as te,d as V}from"./select.js";import{S as ne}from"./switch.js";import{T as Ee}from"./textarea.js";import{T as Me,a as qe,b as ce,c as y,d as $e,e as N}from"./table2.js";import{Q as q}from"./qr-code.js";import{B as Pe}from"./banknote.js";import{S as Be}from"./square-pen.js";import{T as ze}from"./trash-2.js";import{C as U}from"./credit-card.js";import{P as le}from"./plus.js";import"./index4.js";import"./index13.js";import"./index11.js";import"./index9.js";import"./index6.js";import"./index3.js";import"./index5.js";import"./index10.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./check.js";import"./chevron-up.js";const He=({formData:a,setFormData:x,membersList:i,onSubmit:S,onCancel:w,isEditMode:m,receiverType:C})=>{const[R,F]=d.useState(!1),[g,n]=d.useState("");Z.useEffect(()=>{(a.receiverAmountType||a.receiverAmount)&&F(!0)},[a.receiverAmountType,a.receiverAmount]),Z.useEffect(()=>{if(a.enableDate&&a.disableDate){const t=new Date(a.enableDate);new Date(a.disableDate)<t?n("Disable date cannot be before enable date"):n("")}else n("")},[a.enableDate,a.disableDate]);const s=t=>{const{name:p,value:A,files:M,type:l,checked:O}=t.target;x(p==="imageFile"?j=>({...j,[p]:M[0]}):l==="checkbox"?j=>({...j,[p]:O}):j=>({...j,[p]:A}))},c=(t,p)=>{x(A=>({...A,[t]:p}))},v=(t,p)=>{x(A=>({...A,[t]:p}))},D=t=>{F(t),t||x(p=>({...p,receiverAmountType:"",receiverAmount:""}))},o=C==="online",T=t=>{t.preventDefault(),!g&&S(t)};return e.jsx(L,{children:e.jsx(Q,{className:"p-6",children:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"memberId",className:"text-sm font-medium",children:"Member *"}),e.jsxs(se,{value:a.memberId,onValueChange:t=>c("memberId",t),children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"Select a member"})}),e.jsx(te,{children:i.map(t=>e.jsxs(V,{value:t.memberId,children:[t.firstName," ",t.lastName]},t.memberId))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{htmlFor:"receiverName",className:"text-sm font-medium",children:[o?"QR Code Name":"Receiver Name"," *"]}),e.jsx(k,{id:"receiverName",name:"receiverName",value:a.receiverName,onChange:s,placeholder:o?"Enter QR code name":"Enter receiver name",required:!0})]}),o&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{htmlFor:"imageFile",className:"text-sm font-medium",children:["QR Code Image ",!m&&"*"]}),e.jsx(k,{id:"imageFile",name:"imageFile",type:"file",onChange:s,accept:"image/*",required:!m}),m&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Leave empty to keep current image"})]})}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(f,{className:"text-sm font-medium",children:"Set Receiver Fee Amount"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Configure if this receiver should charge a fee and how much"})]}),e.jsx(ne,{checked:R,onCheckedChange:D})]}),R&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"receiverAmountType",className:"text-sm font-medium",children:"Amount Type"}),e.jsxs(se,{value:a.receiverAmountType||"",onValueChange:t=>c("receiverAmountType",t),children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"Select amount type"})}),e.jsxs(te,{children:[e.jsx(V,{value:"lumpsum",children:"Lumpsum"}),e.jsx(V,{value:"percentage",children:"Percentage"})]})]})]}),a.receiverAmountType==="lumpsum"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"receiverAmount",className:"text-sm font-medium",children:"Amount"}),e.jsx(k,{id:"receiverAmount",name:"receiverAmount",type:"number",value:a.receiverAmount||"",onChange:s,min:"0",step:"0.01",placeholder:"Enter amount"})]}),a.receiverAmountType==="percentage"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"receiverAmount",className:"text-sm font-medium",children:"Percentage (%)"}),e.jsx(k,{id:"receiverAmount",name:"receiverAmount",type:"number",value:a.receiverAmount||"",onChange:s,min:"0",max:"100",step:"0.1",placeholder:"Enter percentage"})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(f,{className:"text-sm font-medium",children:"Optional Receiver Fee"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Allow members to choose whether to pay the receiver fee"})]}),e.jsx(ne,{checked:a.receiverFeeOptional||!1,onCheckedChange:t=>v("receiverFeeOptional",t)})]}),a.receiverFeeOptional&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"receiverFeeOptionalMessage",className:"text-sm font-medium",children:"Optional Fee Message"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Enter the message to show when asking for optional fee..."}),e.jsx(Ee,{id:"receiverFeeOptionalMessage",name:"receiverFeeOptionalMessage",value:a.receiverFeeOptionalMessage||"",onChange:s,placeholder:"Would you like to pay the receiver fee? (charges applicable)",rows:3,className:"resize-none"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This message will be shown to members when they can choose to pay the receiver fee"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"enableDate",className:"text-sm font-medium",children:"Enable Date *"}),e.jsx(k,{id:"enableDate",name:"enableDate",type:"date",value:a.enableDate,onChange:s,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"disableDate",className:"text-sm font-medium",children:"Disable Date *"}),e.jsx(k,{id:"disableDate",name:"disableDate",type:"date",value:a.disableDate,onChange:s,min:a.enableDate||void 0,className:g?"border-red-500 focus:border-red-500":"",required:!0})]})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx("svg",{className:"h-4 w-4 text-red-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-red-700 text-sm",children:g})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6",children:[e.jsx(E,{type:"button",variant:"outline",onClick:w,children:"Cancel"}),e.jsxs(E,{type:"submit",disabled:!!g,children:[m?"Update":"Add"," ",o?"QR":"Cash"," ","Receiver"]})]})]})})})},ie=({receivers:a,receiverType:x,onEdit:i,onDelete:S,amountCollected:w})=>{const m=x==="online",[C,R]=d.useState({open:!1,src:"",receiverName:""}),F=s=>{const c=w.find(v=>v.receiverId===s);return c?parseFloat(c.totalAmountCollected||0).toFixed(2):"0.00"},g=(s,c)=>{R({open:!0,src:s,receiverName:c})},n=()=>{R({open:!1,src:"",receiverName:""})};return!a||a.length===0?e.jsx(L,{children:e.jsxs(Q,{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-4 mb-4",children:m?e.jsx(q,{className:"h-8 w-8 text-muted-foreground"}):e.jsx(Pe,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No receivers found"}),e.jsxs("p",{className:"text-muted-foreground",children:["No ",m?"QR":"cash"," receivers have been added yet."]})]})}):e.jsxs(L,{children:[e.jsx(Q,{className:"p-0",children:e.jsxs(Me,{children:[e.jsx(qe,{children:e.jsxs(ce,{children:[e.jsx(y,{children:"Receiver Name"}),e.jsx(y,{children:"Member Name"}),m&&e.jsx(y,{children:"QR Image"}),e.jsx(y,{children:"Amount Type"}),e.jsx(y,{children:"Amount"}),e.jsx(y,{children:"Optional Fee"}),e.jsx(y,{children:"Enable Date"}),e.jsx(y,{children:"Disable Date"}),e.jsx(y,{children:"Amount Collected"}),e.jsx(y,{className:"text-right",children:"Actions"})]})}),e.jsx($e,{children:a.map(s=>e.jsxs(ce,{children:[e.jsx(N,{className:"font-medium",children:s.receiverName}),e.jsx(N,{className:"text-muted-foreground",children:s.memberName}),m&&e.jsx(N,{children:s.qrImageLink?e.jsx("img",{src:s.qrImageLink,alt:"QR Code",className:"h-12 w-12 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>g(s.qrImageLink,s.receiverName),title:"Click to view full size"}):e.jsx("div",{className:"h-12 w-12 bg-muted rounded-md flex items-center justify-center",children:e.jsx(q,{className:"h-6 w-6 text-muted-foreground"})})}),e.jsx(N,{children:s.receiverAmountType?e.jsx(I,{variant:"secondary",className:"capitalize",children:s.receiverAmountType}):e.jsx("span",{className:"text-muted-foreground",children:"Not set"})}),e.jsx(N,{children:s.receiverAmountType==="lumpsum"?e.jsxs(I,{variant:"outline",children:["â‚¹",s.receiverAmount||0]}):s.receiverAmountType==="percentage"?e.jsxs(I,{variant:"outline",children:[s.receiverAmount||0,"%"]}):e.jsx("span",{className:"text-muted-foreground",children:"Not set"})}),e.jsx(N,{children:e.jsx(I,{variant:s.receiverFeeOptional?"default":"secondary",className:s.receiverFeeOptional?"bg-green-100 text-green-800":"",children:s.receiverFeeOptional?"Optional":"Required"})}),e.jsx(N,{className:"text-muted-foreground",children:new Date(s.enableDate).toLocaleDateString()}),e.jsx(N,{className:"text-muted-foreground",children:new Date(s.disableDate).toLocaleDateString()}),e.jsx(N,{children:e.jsxs(I,{variant:"default",className:"bg-green-100 text-green-800 hover:bg-green-100",children:["â‚¹",F(s.receiverId)]})}),e.jsx(N,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>i(s),className:"h-8 w-8 p-0",children:e.jsx(Be,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>S(s.receiverId,x),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:e.jsx(ze,{className:"h-4 w-4"})})]})})]},s.receiverId))})]})}),e.jsx(oe,{open:C.open,onOpenChange:n,children:e.jsxs(de,{className:"max-w-2xl",children:[e.jsx(me,{children:e.jsx(he,{className:"flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"QR Code - ",C.receiverName]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:C.src,alt:"QR Code Preview",className:"max-w-full max-h-96 object-contain rounded-lg border"})})]})})]})},Ve=a=>{const[x,i]=d.useState(!1);return{loading:x,fetchAllReceivers:async()=>{i(!0);try{return(await b.get(`/api/feeReceiver/${a}`)).data}catch(n){throw h.error("Failed to fetch fee receivers"),n}finally{i(!1)}},fetchReceiversByType:async n=>{i(!0);try{return(await b.get(`/api/feeReceiver/${a}?type=${n}`)).data}catch(s){throw h.error(`Failed to fetch ${n} receivers`),s}finally{i(!1)}},addReceiver:async(n,s=null)=>{i(!0);try{let c=null;if(s){const o=new FormData;o.append("image",s),o.append("folderName","memberQRCodes"),c=(await b.post("/api/image-upload",o,{headers:{"Content-Type":"multipart/form-data"}})).data.imageUrl}const v={...n,...c&&{qrImageLink:c}},D=await b.post(`/api/feeReceiver/${a}`,v);return h.success(`${n.paymentType==="cash"?"Cash":"QR"} receiver added successfully`),D.data}catch(c){throw h.error("Failed to add receiver"),c}finally{i(!1)}},updateReceiver:async(n,s,c=null)=>{i(!0);try{let v=s.qrImageLink;if(c){const T=new FormData;T.append("image",c),T.append("folderName","memberQRCodes"),v=(await b.post("/api/image-upload",T,{headers:{"Content-Type":"multipart/form-data"}})).data.imageUrl}const D={...s,qrImageLink:v},o=await b.put(`/api/feeReceiver/${a}/${n}`,D);return h.success(`${s.paymentType==="cash"?"Cash":"QR"} receiver updated successfully`),o.data}catch(v){throw h.error("Failed to update receiver"),v}finally{i(!1)}},deleteReceiver:async(n,s)=>{i(!0);try{const c=await b.delete(`/api/feeReceiver/${a}/${n}?paymentType=${s}`);return h.success(`${s==="cash"?"Cash":"QR"} receiver deleted successfully`),c.data}catch(c){throw h.error("Failed to delete receiver"),c}finally{i(!1)}},fetchAmountCollected:async()=>{try{return(await b.get(`/api/feeReceiver/amount-collected/${a}`)).data}catch(n){throw h.error("Failed to fetch amount collected"),n}},fetchCurrentReceivers:async n=>{try{return(await b.get(`/api/feeReceiver/current/${a}?date=${n}`)).data}catch(s){throw h.error("Failed to fetch current receivers"),s}}}},ws=()=>{const{chapterData:a}=Ne(),[x,i]=d.useState("cash"),[S,w]=d.useState(!1),[m,C]=d.useState(""),[R,F]=d.useState([]),[g,n]=d.useState([]),[s,c]=d.useState([]),[v,D]=d.useState([]),[o,T]=d.useState(null),[t,p]=d.useState(!1),[A,M]=d.useState({open:!1,receiverId:null,paymentType:null}),[l,O]=d.useState({receiverName:"",memberId:"",enableDate:"",disableDate:"",paymentType:"cash",imageFile:null,qrImageLink:"",receiverAmountType:"",receiverAmount:"",receiverFeeOptional:!1,receiverFeeOptionalMessage:""}),{loading:j,fetchReceiversByType:W,addReceiver:pe,updateReceiver:ue,deleteReceiver:xe,fetchAmountCollected:ve}=Ve(a.chapterId);d.useEffect(()=>{je()},[]);const je=async()=>{await Promise.all([ge(),B(),z(),H()])},ge=async()=>{try{const r=await b.get("/api/member/all",{params:{chapterId:a.chapterId}});c(r.data)}catch{h.error("Failed to fetch members list")}},B=async()=>{try{const r=await W("cash");F(r)}catch(r){console.error("Error fetching cash receivers:",r)}},z=async()=>{try{const r=await W("online");n(r)}catch(r){console.error("Error fetching online receivers:",r)}},H=async()=>{try{const r=await ve();D(r)}catch(r){console.error("Error fetching amount collected:",r)}},G=()=>{O({receiverName:"",memberId:"",enableDate:"",disableDate:"",paymentType:"cash",imageFile:null,qrImageLink:"",receiverAmountType:"",receiverAmount:"",receiverFeeOptional:!1,receiverFeeOptionalMessage:""}),T(null),p(!1)},J=r=>{G(),O(u=>({...u,paymentType:r})),C(r),w(!0)},fe=async r=>{if(r.preventDefault(),!l.memberId){h.error("Please select a member");return}if(!l.receiverName){h.error("Please enter a receiver name");return}if(!l.enableDate||!l.disableDate){h.error("Please select enable and disable dates");return}if(l.paymentType==="online"&&!t&&!l.imageFile){h.error("Please select a QR code image");return}try{const u={receiverName:l.receiverName,memberId:l.memberId,enableDate:l.enableDate,disableDate:l.disableDate,paymentType:l.paymentType,receiverFeeOptional:l.receiverFeeOptional,receiverFeeOptionalMessage:l.receiverFeeOptionalMessage,receiverAmountType:l.receiverAmountType,receiverAmount:l.receiverAmount,...l.paymentType==="online"&&{qrImageLink:(o==null?void 0:o.qrImageLink)||""}};t&&o?await ue(o.receiverId,u,l.imageFile):await pe(u,l.imageFile),l.paymentType==="cash"?await B():await z(),await H(),K()}catch(u){console.error("Error saving receiver:",u)}},K=()=>{w(!1),G()},X=r=>{T(r),p(!0);const u=$=>$?new Date($).toISOString().split("T")[0]:"";O({receiverName:r.receiverName,memberId:r.memberId,enableDate:u(r.enableDate),disableDate:u(r.disableDate),paymentType:r.paymentType,imageFile:null,qrImageLink:r.qrImageLink||"",receiverAmountType:r.receiverAmountType||"",receiverAmount:r.receiverAmount||"",receiverFeeOptional:r.receiverFeeOptional||!1,receiverFeeOptionalMessage:r.receiverFeeOptionalMessage||""}),C(r.paymentType),w(!0)},Y=async(r,u)=>{M({open:!0,receiverId:r,paymentType:u})},ye=async()=>{const{receiverId:r,paymentType:u}=A;try{await xe(r,u),u==="cash"?await B():await z(),await H()}catch($){console.error("Error deleting receiver:",$)}finally{M({open:!1,receiverId:null,paymentType:null})}};return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs(L,{children:[e.jsxs(be,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-6 w-6"}),"Fee Receivers Management"]}),e.jsx(Ce,{children:"Manage cash and online payment receivers for your chapter"})]}),e.jsx(Q,{children:e.jsxs(Re,{value:x,onValueChange:i,className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2",children:[e.jsxs(_,{value:"cash",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Cash Receivers",e.jsx(I,{variant:"secondary",className:"ml-1",children:R.length})]}),e.jsxs(_,{value:"online",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"QR Receivers",e.jsx(I,{variant:"secondary",className:"ml-1",children:g.length})]})]}),e.jsxs(ee,{value:"cash",className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cash Receivers"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Members who collect cash payments"})]}),e.jsxs(E,{onClick:()=>J("cash"),disabled:j,className:"flex items-center gap-2",children:[j?e.jsx(P,{className:"h-4 w-4 animate-spin"}):e.jsx(le,{className:"h-4 w-4"}),"Add Cash Receiver"]})]}),j?e.jsx(L,{children:e.jsx(Q,{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(P,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading receivers..."})]})})}):e.jsx(ie,{receivers:R,receiverType:"cash",onEdit:X,onDelete:Y,amountCollected:v})]}),e.jsxs(ee,{value:"online",className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"QR Code Receivers"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Members who collect online payments via QR codes"})]}),e.jsxs(E,{onClick:()=>J("online"),disabled:j,className:"flex items-center gap-2",children:[j?e.jsx(P,{className:"h-4 w-4 animate-spin"}):e.jsx(le,{className:"h-4 w-4"}),"Add QR Receiver"]})]}),j?e.jsx(L,{children:e.jsx(Q,{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(P,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading receivers..."})]})})}):e.jsx(ie,{receivers:g,receiverType:"online",onEdit:X,onDelete:Y,amountCollected:v})]})]})})]}),e.jsx(oe,{open:S,onOpenChange:w,children:e.jsxs(de,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[m==="cash"?e.jsx(U,{className:"h-5 w-5"}):e.jsx(q,{className:"h-5 w-5"}),t?"Edit":"Add"," ",m==="cash"?"Cash":"QR"," Receiver"]}),e.jsxs(Ae,{children:[t?"Update the":"Add a new"," ",m==="cash"?"cash":"QR code"," receiver for your chapter."]})]}),e.jsx(He,{formData:l,setFormData:O,membersList:s,onSubmit:fe,onCancel:K,isEditMode:t,receiverType:m})]})}),e.jsx(Fe,{open:A.open,onOpenChange:r=>!r&&M({open:!1,receiverId:null,paymentType:null}),children:e.jsxs(De,{children:[e.jsxs(Ie,{children:[e.jsx(Se,{children:"Are you sure?"}),e.jsxs(Oe,{children:["This action cannot be undone. This will permanently delete the ",A.paymentType," receiver and remove all associated data."]})]}),e.jsxs(ke,{children:[e.jsx(Le,{children:"Cancel"}),e.jsx(Qe,{onClick:ye,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})};export{ws as default};
