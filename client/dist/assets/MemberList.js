import{j as e,B as v,C as ee,u as se,a as J,r as n,c as E,Q as g,k as ae}from"./index.js";import{B as te}from"./Breadcrumb.js";import{D as H,a as O,b as V,c as F,d as B,e as z}from"./dialog.js";import{S as G,a as q,b as _,c as X,d as Y}from"./select.js";import{M as re}from"./multiSelect.js";import{I as M}from"./input.js";import{S as ne}from"./search-bar.js";import{f as U,u as le,g as oe,a as ie}from"./index14.js";import{T as ce,a as de,b as $,c as me,d as ue,e as K}from"./table2.js";import{u as he,c as pe}from"./usePagination.js";import{D as xe,C as ge,a as fe,b as je}from"./react-icons.esm.js";import{u as Ne}from"./useWindowDimensions.js";import{A as ve}from"./arrow-up-down.js";import{P as be,i as ye}from"./phone-input.js";import{f as W}from"./format.js";import"./chevron-right.js";import"./index3.js";import"./index4.js";import"./index5.js";import"./index6.js";import"./index10.js";import"./index11.js";import"./index9.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./check.js";import"./chevron-up.js";import"./separator.js";import"./badge.js";import"./popover.js";import"./command.js";import"./search.js";import"./wand-sparkles.js";import"./index2.js";import"./scroll-area.js";import"./chevrons-up-down.js";function Q({table:t,totalRecord:i}){return e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 px-2 lg:flex-row lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:flex-row sm:space-x-6 sm:space-y-0",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.getFilteredRowModel().rows.length," row(s)."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Rows per page"}),e.jsxs(G,{value:`${t.getState().pagination.pageSize}`,onValueChange:s=>{t.setPageSize(Number(s))},children:[e.jsx(q,{className:"h-8 w-[70px]",children:e.jsx(_,{placeholder:t.getState().pagination.pageSize})}),e.jsx(X,{side:"top",children:[5,10,20,30,40,50].map(s=>e.jsx(Y,{value:`${s}`,children:s},s))})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total Record: ",i]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",t.getState().pagination.pageIndex+1," of ",t.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(v,{variant:"outline",className:"h-8 w-8 p-0",disabled:!t.getCanPreviousPage(),onClick:()=>t.setPageIndex(0),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(xe,{className:"h-4 w-4"})]}),e.jsxs(v,{variant:"outline",className:"h-8 w-8 p-0",disabled:!t.getCanPreviousPage(),onClick:t.previousPage,children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(ge,{className:"h-4 w-4"})]}),e.jsxs(v,{variant:"outline",className:"h-8 w-8 p-0",disabled:!t.getCanNextPage(),onClick:t.nextPage,children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(fe,{className:"h-4 w-4"})]}),e.jsxs(v,{variant:"outline",className:"h-8 w-8 p-0",disabled:!t.getCanNextPage(),onClick:()=>t.setPageIndex(t.getPageCount()-1),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(je,{className:"h-4 w-4"})]})]})]})]})}function Ce({rows:t}){return t.length?e.jsx("div",{className:"flex flex-col gap-4",children:t.map(i=>{const s=i.original,r=i.getVisibleCells?i.getVisibleCells().find(C=>C.column.id==="actions"):null;return e.jsxs(ee,{className:"p-4 shadow-md border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"font-bold text-lg text-primary",children:[s.firstName," ",s.lastName]})}),e.jsxs("div",{className:"mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),e.jsxs("div",{className:"mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.phoneNumber]}),e.jsxs("div",{className:"mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Role:"})," ",s.roleNames]}),e.jsxs("div",{className:"mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Due:"})," ",e.jsx("span",{className:Number(s.balance)>0?"text-red-600":"text-green-600",children:s.balance})]}),r&&e.jsx("div",{className:"mt-3 flex gap-2",children:U(r.column.columnDef.cell,r.getContext())})]},i.id)})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No results."})}function we({columns:t,data:i,searchInputField:s,filterField:r,filterFieldName:C,filterCategoriesList:b,totalRecord:h,children:w}){var I;const f=se(),{rows:m,onPaginationChange:d,page:j,pagination:p}=he(),x=J(),{width:l}=Ne(),o=()=>{const y=new URLSearchParams(x.search),S=pe({rows:m,page:j},y);f(`?${S}`,{replace:!0})};n.useEffect(()=>{o()},[m,j]);const u=le({data:i,columns:t,getCoreRowModel:ie(),manualPagination:!0,onPaginationChange:d,state:{pagination:p},rowCount:h,getSortedRowModel:oe()}),N=n.Children.map(w,y=>n.isValidElement(y)?n.cloneElement(y,{table:u,searchInputField:s,filterField:r,filterFieldName:C,filterCategoriesList:b}):y);return l<768?e.jsxs("div",{className:"space-y-4",children:[N,e.jsx(Ce,{rows:u.getRowModel().rows,columns:t}),e.jsx(Q,{table:u,totalRecord:h})]}):e.jsxs("div",{className:"space-y-4",children:[N,e.jsx("div",{className:"overflow-y-auto rounded-md border",children:e.jsxs(ce,{children:[e.jsx(de,{children:u.getHeaderGroups().map(y=>e.jsx($,{children:y.headers.map(S=>e.jsx(me,{className:"px-4 py-2 bg-newprimaryColor text-white font-raleway",colSpan:S.colSpan,children:S.isPlaceholder?null:U(S.column.columnDef.header,S.getContext())},S.id))},y.id))}),e.jsx(ue,{className:"bg-adminBreadCrumbsBg font-raleway",children:(I=u.getRowModel().rows)!=null&&I.length?u.getRowModel().rows.map(y=>e.jsx($,{"data-state":y.getIsSelected()&&"selected",children:y.getVisibleCells().map(S=>e.jsx(K,{className:"px-4 py-2",children:U(S.column.columnDef.cell,S.getContext())},S.id))},y.id)):e.jsx($,{children:e.jsx(K,{colSpan:t.length,className:"h-24 text-center bg-adminBreadCrumbsBg font-raleway",children:"No results."})})})]})}),e.jsx(Q,{table:u,totalRecord:h})]})}const Se=({onChangeRole:t,onDueWaiveOff:i,onRemove:s})=>[{id:"srno",header:()=>e.jsx("p",{className:!0,children:"Sr. No."}),cell:r=>e.jsx("p",{children:r.row.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"firstName",header:({column:r})=>e.jsxs(v,{variant:"ghost",onClick:()=>r.toggleSorting(r.getIsSorted()==="asc"),children:["Full Name",e.jsx(ve,{})]}),cell:({row:r})=>e.jsxs("p",{className:"text-sm font-medium",children:[r.original.firstName," ",r.original.lastName]}),enableSorting:!0,enableHiding:!1},{accessorKey:"email",header:"Email",cell:({row:r})=>e.jsx("p",{children:r.original.email}),enableSorting:!0,enableHiding:!1},{accessorKey:"phoneNumber",header:"Phone",cell:({row:r})=>e.jsx("p",{children:r.original.phoneNumber}),enableSorting:!0,enableHiding:!1},{accessorKey:"roleNames",header:"Role",cell:({row:r})=>e.jsx("p",{children:r.original.roleNames}),enableSorting:!0,enableHiding:!1},{accessorKey:"balance",header:"Due",cell:({row:r})=>e.jsx("p",{children:r.original.balance}),enableSorting:!0,enableHiding:!1},{id:"actions",header:"Actions",cell:({row:r})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>t(r.original),children:"Change Role"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>i(r.original),children:"Due Waive Off"}),e.jsx(v,{variant:"destructive",size:"sm",onClick:()=>s(r.original),children:"Remove"})]}),enableSorting:!1,enableHiding:!1}];function Re({open:t,onOpenChange:i,chapterId:s,refresh:r}){const[C,b]=n.useState("search"),[h,w]=n.useState(""),[f,m]=n.useState([]),[d,j]=n.useState(null),[p,x]=n.useState(""),[l,o]=n.useState({firstName:"",lastName:"",email:"",phoneNumber:"",chapterId:s,joinDate:""}),[u,N]=n.useState(!1);n.useEffect(()=>{t||(b("search"),w(""),m([]),j(null),x(""),o({firstName:"",lastName:"",email:"",phoneNumber:"",chapterId:s,joinDate:""}))},[t,s]);const I=async()=>{if(h){N(!0);try{const a=await E.get(`/api/member/search?query=${encodeURIComponent(h)}`);m(a.data)}catch{m([])}finally{N(!1)}}},y=async()=>{var a,D,k,L,A;if(!(!d||!p)){N(!0);try{const R=await E.post("/api/member/add",[{memberId:d.memberId,chapterId:s,joinDate:p,email:d.email||null,phoneNumber:d.phoneNumber||null}]);(k=(D=(a=R.data)==null?void 0:a.results)==null?void 0:D[0])!=null&&k.error?g.error(R.data.results[0].error):(g.success("Member added to chapter"),i(!1),r())}catch(R){g.error(((A=(L=R==null?void 0:R.response)==null?void 0:L.data)==null?void 0:A.error)||"Error adding member")}finally{N(!1)}}},S=()=>l.firstName.trim()?!l.email.trim()&&!l.phoneNumber.trim()?(g.error("Either email or phone number must be provided"),!1):l.phoneNumber.trim()&&!ye(l.phoneNumber)?(g.error("Please enter a valid phone number"),!1):l.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)?(g.error("Please enter a valid email address"),!1):!0:(g.error("First name is required"),!1),T=async()=>{var a,D,k,L,A;if(S()){N(!0);try{const R=await E.post("/api/member/add",[{...l,chapterId:s,joinDate:l.joinDate||new Date().toISOString().slice(0,10),password:null}]);(k=(D=(a=R.data)==null?void 0:a.results)==null?void 0:D[0])!=null&&k.error?g.error(R.data.results[0].error):(g.success("New member invited and added"),i(!1),r())}catch(R){g.error(((A=(L=R==null?void 0:R.response)==null?void 0:L.data)==null?void 0:A.error)||"Error inviting member")}finally{N(!1)}}};return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(O,{children:[e.jsx(V,{children:e.jsx(F,{children:"Add Member"})}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(v,{variant:C==="search"?"default":"outline",onClick:()=>b("search"),children:"Search Existing"}),e.jsx(v,{variant:C==="addNew"?"default":"outline",onClick:()=>b("addNew"),children:"Invite New"})]}),C==="search"?e.jsxs("div",{children:[e.jsx(M,{placeholder:"Search by email, phone, or name",value:h,onChange:a=>w(a.target.value),onKeyDown:a=>a.key==="Enter"&&I(),className:"mb-2"}),e.jsx(v,{onClick:I,disabled:u||!h,className:"mb-2",children:u?"Searching...":"Search"}),e.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[f.length===0&&h&&!u&&e.jsx("div",{className:"text-gray-500",children:"No members found."}),f.map(a=>e.jsx("div",{className:`p-2 border rounded mb-2 cursor-pointer ${(d==null?void 0:d.memberId)===a.memberId?"bg-blue-100":""}`,onClick:()=>{j(a),x("")},children:e.jsxs("div",{children:[e.jsxs("b",{children:[a.firstName," ",a.lastName]})," ","(",a.email||a.phoneNumber,")"]})},a.memberId))]}),d&&e.jsx("div",{className:"mt-2",children:e.jsx(M,{type:"date",placeholder:"Join Date",value:p,onChange:a=>x(a.target.value)})}),e.jsx(B,{children:e.jsx(v,{onClick:y,disabled:!d||!p||u,className:"w-full mt-2",children:u?"Adding...":"Add to Chapter"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{placeholder:"First Name*",value:l.firstName,onChange:a=>o({...l,firstName:a.target.value})}),e.jsx(M,{placeholder:"Last Name",value:l.lastName,onChange:a=>o({...l,lastName:a.target.value})}),e.jsx(M,{placeholder:"Email",value:l.email,onChange:a=>o({...l,email:a.target.value})}),e.jsx(be,{placeholder:"Phone Number",value:l.phoneNumber,onChange:a=>o({...l,phoneNumber:a}),className:"w-full",defaultCountry:"IN"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500 text-nowrap",children:"Date of Joining"}),e.jsx(M,{placeholder:"Join Date",type:"date",value:l.joinDate,onChange:a=>o({...l,joinDate:a.target.value})})]}),e.jsx(B,{children:e.jsx(v,{onClick:T,className:"w-full",disabled:u||!l.firstName.trim()||!l.email.trim()&&!l.phoneNumber.trim(),children:u?"Inviting...":"Invite & Add"})})]})]})})}const De=["Correction","Payment Error","Admin Adjustment","Other"];function Me({open:t,onOpenChange:i,member:s,allRoles:r,refresh:C,chapterId:b}){const[h,w]=n.useState((s==null?void 0:s.roleNames)||""),[f,m]=n.useState(!1);n.useEffect(()=>{w((s==null?void 0:s.roleNames)||"")},[s]);const d=async()=>{var x,l;m(!0);try{(await E.post("/api/member/role_update",{memberId:s.memberId,roleIds:h,chapterId:b})).status===200?(i(!1),C(),g.success("Role changed successfully")):g.error("Failed to change role")}catch(o){g.error(((l=(x=o==null?void 0:o.response)==null?void 0:x.data)==null?void 0:l.error)||"Error changing role")}finally{m(!1)}},j=(s==null?void 0:s.roleIds.split(","))||[],p=x=>{w(x)};return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(O,{children:[e.jsxs(V,{children:[e.jsx(F,{children:"Change Role"}),e.jsxs(z,{children:["Change role for"," ",e.jsxs("b",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]})]})]}),e.jsx(re,{options:r.map(x=>({label:x.roleName,value:x.roleId.toString()})),onValueChange:p,defaultValue:j.map(String),placeholder:"Select Rights",maxCount:5}),e.jsx(B,{children:e.jsx(v,{onClick:d,disabled:f,children:f?"Saving...":"Confirm"})})]})})}function Ie({open:t,onOpenChange:i,member:s,reasons:r,refresh:C,chapterId:b}){const[h,w]=n.useState((s==null?void 0:s.balance)||""),[f,m]=n.useState(""),[d,j]=n.useState(""),[p,x]=n.useState(!1);n.useEffect(()=>{w((s==null?void 0:s.balance)||""),m(""),j("")},[s]);const l=async()=>{var o,u;x(!0);try{(await E.post("/api/member/balance_update",{memberId:s.memberId,newBalance:h,reason:f==="Other"?d:f,chapterId:b})).status===200?(w(""),m(""),j(""),i(!1),C(),g.success("Due updated successfully")):g.error("Failed to update due")}catch(N){g.error(((u=(o=N==null?void 0:N.response)==null?void 0:o.data)==null?void 0:u.error)||"Error updating due")}finally{x(!1)}};return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(O,{children:[e.jsxs(V,{children:[e.jsx(F,{children:"Due Waive Off"}),e.jsxs(z,{children:["Waive off due for"," ",e.jsxs("b",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]})]})]}),e.jsx(M,{type:"number",placeholder:"New Due Amount",value:h,onChange:o=>w(o.target.value),className:"mb-2"}),e.jsxs(G,{value:f,onValueChange:o=>{m(o),o!=="Other"&&j("")},children:[e.jsx(q,{children:e.jsx(_,{placeholder:"Select Reason"})}),e.jsx(X,{children:r.map(o=>e.jsx(Y,{value:o,children:o},o))})]}),f==="Other"&&e.jsx(M,{placeholder:"Enter custom reason",value:d,onChange:o=>j(o.target.value),className:"mt-2"}),e.jsx(B,{children:e.jsx(v,{onClick:l,disabled:p,children:p?"Saving...":"Confirm"})})]})})}function Pe({open:t,onOpenChange:i,member:s,refresh:r,chapterId:C}){const[b,h]=n.useState(W(new Date,"yyyy-MM-dd")),[w,f]=n.useState(!1);n.useEffect(()=>{h(W(new Date,"yyyy-MM-dd"))},[s]);const m=async()=>{var d,j;f(!0);try{(await E.post("/api/member/remove",{memberId:s.memberId,chapterId:C,leaveDate:b})).status===200?(h(W(new Date,"yyyy-MM-dd")),i(!1),r(),g.success("Member removed successfully")):g.error("Failed to remove member")}catch(p){g.error(((j=(d=p==null?void 0:p.response)==null?void 0:d.data)==null?void 0:j.error)||"Error removing member")}finally{f(!1)}};return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(O,{children:[e.jsxs(V,{children:[e.jsx(F,{children:"Remove Member"}),e.jsxs(z,{children:["Remove"," ",e.jsxs("b",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]})," ","from chapter?"]})]}),e.jsx(M,{type:"date",value:b,onChange:d=>h(d.target.value),className:"mb-2"}),e.jsx(B,{children:e.jsx(v,{variant:"destructive",onClick:m,disabled:w,children:w?"Removing...":"Remove"})})]})})}const xs=()=>{const t=J(),i=new URLSearchParams(t.search),{chapterData:s}=ae(),[r,C]=n.useState(0),[b,h]=n.useState([]),[w,f]=n.useState([]),[m,d]=n.useState(""),[j,p]=n.useState(!1),[x,l]=n.useState({open:!1,member:null}),[o,u]=n.useState({open:!1,member:null}),[N,I]=n.useState({open:!1,member:null}),[y,S]=n.useState([]),T=i.get("rows")||10,a=i.get("page")||0,D=async()=>{try{const c=await E.post(`/api/member/memberList?page=${a}&rows=${T}&searchQuery=${m}`,{chapterId:s.chapterId});h(c.data.data),f(c.data.data),C(c.data.totalRecords)}catch(c){console.error("Error fetching members:",c)}},k=async()=>{try{const c=await E.get(`/api/chapter/${s.chapterSlug}/roles`);S(c.data)}catch(c){console.error("Error fetching roles:",c)}};n.useEffect(()=>{!s||!(s!=null&&s.chapterId)||(D(),k())},[s,T,a,t.search,m]),n.useEffect(()=>{f(b.filter(c=>{var P;return(P=c.firstName)==null?void 0:P.toLowerCase().includes(m.toLowerCase())}))},[m,b]);const L=c=>{d(c.target.value)},A=c=>l({open:!0,member:c}),R=c=>u({open:!0,member:c}),Z=c=>I({open:!0,member:c});return s?e.jsxs("div",{className:"container mx-auto p-4 dark:bg-gray-800 dark:text-white",children:[e.jsx(te,{items:[{name:"Member List"}]}),e.jsxs("div",{className:"flex justify-between items-center mb-4 gap-4",children:[e.jsx(ne,{onChange:L,value:m,className:"mb-0 w-full"}),e.jsx(v,{onClick:()=>p(!0),children:"Add Member"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(we,{data:b,columns:Se({onChangeRole:A,onDueWaiveOff:R,onRemove:Z}),searchInputField:"firstName",totalRecord:r,pagination:{pageSize:T,pageIndex:a},state:{pagination:{pageSize:T,pageIndex:a}}})}),e.jsx(Re,{open:j,onOpenChange:p,chapterId:s.chapterId,refresh:D}),e.jsx(Me,{open:x.open,onOpenChange:c=>l(P=>({...P,open:c})),member:x.member,allRoles:y,refresh:D,chapterId:s.chapterId}),e.jsx(Ie,{open:o.open,onOpenChange:c=>u(P=>({...P,open:c})),member:o.member,reasons:De,refresh:D,chapterId:s.chapterId}),e.jsx(Pe,{open:N.open,onOpenChange:c=>I(P=>({...P,open:c})),member:N.member,refresh:D,chapterId:s.chapterId})]}):e.jsx("div",{children:"Loading..."})};export{xs as default};
