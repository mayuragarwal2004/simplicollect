import{d as ee,j as e,B as v,C as se,u as ae,a as J,r as n,c as E,Q as g,l as te}from"./index.js";import{B as re}from"./Breadcrumb.js";import{D as B,a as H,b as O,c as F,d as V,e as z}from"./dialog.js";import{S as _,a as q,b as G,c as X,d as Y}from"./select.js";import{M as ne}from"./multiSelect.js";import{I as M}from"./input.js";import{S as le}from"./search-bar.js";import{f as W,u as oe,a as ie,c as ce,g as de,b as me}from"./usePagination.js";import{T as he,a as ue,b as $,c as pe,d as xe,e as K}from"./table.js";import{D as ge,C as fe,a as je,b as Ne}from"./react-icons.esm.js";import{u as ve}from"./useWindowDimensions.js";import{P as ye,i as be}from"./phone-input.js";import{f as U}from"./format.js";import"./chevron-right.js";import"./index3.js";import"./index4.js";import"./index5.js";import"./index6.js";import"./index10.js";import"./index11.js";import"./index9.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./separator.js";import"./badge.js";import"./popover.js";import"./command.js";import"./search.js";import"./index2.js";import"./scroll-area.js";import"./chevrons-up-down.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Ce=ee("ArrowUpDown",we);function Q({table:t,totalRecord:i}){return e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 px-2 lg:flex-row lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:flex-row sm:space-x-6 sm:space-y-0",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.getFilteredRowModel().rows.length," row(s)."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Rows per page"}),e.jsxs(_,{value:`${t.getState().pagination.pageSize}`,onValueChange:s=>{t.setPageSize(Number(s))},children:[e.jsx(q,{className:"h-8 w-[70px]",children:e.jsx(G,{placeholder:t.getState().pagination.pageSize})}),e.jsx(X,{side:"top",children:[5,10,20,30,40,50].map(s=>e.jsx(Y,{value:`${s}`,children:s},s))})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total Record: ",i]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",t.getState().pagination.pageIndex+1," of ",t.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(v,{variant:"outline",className:"h-8 w-8 p-0",disabled:!t.getCanPreviousPage(),onClick:()=>t.setPageIndex(0),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(ge,{className:"h-4 w-4"})]}),e.jsxs(v,{variant:"outline",className:"h-8 w-8 p-0",disabled:!t.getCanPreviousPage(),onClick:t.previousPage,children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(fe,{className:"h-4 w-4"})]}),e.jsxs(v,{variant:"outline",className:"h-8 w-8 p-0",disabled:!t.getCanNextPage(),onClick:t.nextPage,children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(je,{className:"h-4 w-4"})]}),e.jsxs(v,{variant:"outline",className:"h-8 w-8 p-0",disabled:!t.getCanNextPage(),onClick:()=>t.setPageIndex(t.getPageCount()-1),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(Ne,{className:"h-4 w-4"})]})]})]})]})}function Se({rows:t}){return t.length?e.jsx("div",{className:"flex flex-col gap-4",children:t.map(i=>{const s=i.original,r=i.getVisibleCells?i.getVisibleCells().find(w=>w.column.id==="actions"):null;return e.jsxs(se,{className:"p-4 shadow-md border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"font-bold text-lg text-primary",children:[s.firstName," ",s.lastName]})}),e.jsxs("div",{className:"mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),e.jsxs("div",{className:"mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.phoneNumber]}),e.jsxs("div",{className:"mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Role:"})," ",s.roleNames]}),e.jsxs("div",{className:"mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Due:"})," ",e.jsx("span",{className:Number(s.balance)>0?"text-red-600":"text-green-600",children:s.balance})]}),r&&e.jsx("div",{className:"mt-3 flex gap-2",children:W(r.column.columnDef.cell,r.getContext())})]},i.id)})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No results."})}function Re({columns:t,data:i,searchInputField:s,filterField:r,filterFieldName:w,filterCategoriesList:y,totalRecord:u,children:C}){var I;const f=ae(),{rows:m,onPaginationChange:d,page:j,pagination:p}=oe(),x=J(),{width:l}=ve(),o=()=>{const b=new URLSearchParams(x.search),S=ce({rows:m,page:j},b);f(`?${S}`,{replace:!0})};n.useEffect(()=>{o()},[m,j]);const h=ie({data:i,columns:t,getCoreRowModel:me(),manualPagination:!0,onPaginationChange:d,state:{pagination:p},rowCount:u,getSortedRowModel:de()}),N=n.Children.map(C,b=>n.isValidElement(b)?n.cloneElement(b,{table:h,searchInputField:s,filterField:r,filterFieldName:w,filterCategoriesList:y}):b);return l<768?e.jsxs("div",{className:"space-y-4",children:[N,e.jsx(Se,{rows:h.getRowModel().rows,columns:t}),e.jsx(Q,{table:h,totalRecord:u})]}):e.jsxs("div",{className:"space-y-4",children:[N,e.jsx("div",{className:"overflow-y-auto rounded-md border",children:e.jsxs(he,{children:[e.jsx(ue,{children:h.getHeaderGroups().map(b=>e.jsx($,{children:b.headers.map(S=>e.jsx(pe,{className:"px-4 py-2 bg-newprimaryColor text-white font-raleway",colSpan:S.colSpan,children:S.isPlaceholder?null:W(S.column.columnDef.header,S.getContext())},S.id))},b.id))}),e.jsx(xe,{className:"bg-adminBreadCrumbsBg font-raleway",children:(I=h.getRowModel().rows)!=null&&I.length?h.getRowModel().rows.map(b=>e.jsx($,{"data-state":b.getIsSelected()&&"selected",children:b.getVisibleCells().map(S=>e.jsx(K,{className:"px-4 py-2",children:W(S.column.columnDef.cell,S.getContext())},S.id))},b.id)):e.jsx($,{children:e.jsx(K,{colSpan:t.length,className:"h-24 text-center bg-adminBreadCrumbsBg font-raleway",children:"No results."})})})]})}),e.jsx(Q,{table:h,totalRecord:u})]})}const De=({onChangeRole:t,onDueWaiveOff:i,onRemove:s})=>[{id:"srno",header:()=>e.jsx("p",{className:!0,children:"Sr. No."}),cell:r=>e.jsx("p",{children:r.row.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"firstName",header:({column:r})=>e.jsxs(v,{variant:"ghost",onClick:()=>r.toggleSorting(r.getIsSorted()==="asc"),children:["Full Name",e.jsx(Ce,{})]}),cell:({row:r})=>e.jsxs("p",{className:"text-sm font-medium",children:[r.original.firstName," ",r.original.lastName]}),enableSorting:!0,enableHiding:!1},{accessorKey:"email",header:"Email",cell:({row:r})=>e.jsx("p",{children:r.original.email}),enableSorting:!0,enableHiding:!1},{accessorKey:"phoneNumber",header:"Phone",cell:({row:r})=>e.jsx("p",{children:r.original.phoneNumber}),enableSorting:!0,enableHiding:!1},{accessorKey:"roleNames",header:"Role",cell:({row:r})=>e.jsx("p",{children:r.original.roleNames}),enableSorting:!0,enableHiding:!1},{accessorKey:"balance",header:"Due",cell:({row:r})=>e.jsx("p",{children:r.original.balance}),enableSorting:!0,enableHiding:!1},{id:"actions",header:"Actions",cell:({row:r})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>t(r.original),children:"Change Role"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>i(r.original),children:"Due Waive Off"}),e.jsx(v,{variant:"destructive",size:"sm",onClick:()=>s(r.original),children:"Remove"})]}),enableSorting:!1,enableHiding:!1}];function Me({open:t,onOpenChange:i,chapterId:s,refresh:r}){const[w,y]=n.useState("search"),[u,C]=n.useState(""),[f,m]=n.useState([]),[d,j]=n.useState(null),[p,x]=n.useState(""),[l,o]=n.useState({firstName:"",lastName:"",email:"",phoneNumber:"",chapterId:s,joinDate:""}),[h,N]=n.useState(!1);n.useEffect(()=>{t||(y("search"),C(""),m([]),j(null),x(""),o({firstName:"",lastName:"",email:"",phoneNumber:"",chapterId:s,joinDate:""}))},[t,s]);const I=async()=>{if(u){N(!0);try{const a=await E.get(`/api/member/search?query=${encodeURIComponent(u)}`);m(a.data)}catch{m([])}finally{N(!1)}}},b=async()=>{var a,D,k,L,A;if(!(!d||!p)){N(!0);try{const R=await E.post("/api/member/add",[{memberId:d.memberId,chapterId:s,joinDate:p,email:d.email||null,phoneNumber:d.phoneNumber||null}]);(k=(D=(a=R.data)==null?void 0:a.results)==null?void 0:D[0])!=null&&k.error?g.error(R.data.results[0].error):(g.success("Member added to chapter"),i(!1),r())}catch(R){g.error(((A=(L=R==null?void 0:R.response)==null?void 0:L.data)==null?void 0:A.error)||"Error adding member")}finally{N(!1)}}},S=()=>l.firstName.trim()?!l.email.trim()&&!l.phoneNumber.trim()?(g.error("Either email or phone number must be provided"),!1):l.phoneNumber.trim()&&!be(l.phoneNumber)?(g.error("Please enter a valid phone number"),!1):l.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)?(g.error("Please enter a valid email address"),!1):!0:(g.error("First name is required"),!1),T=async()=>{var a,D,k,L,A;if(S()){N(!0);try{const R=await E.post("/api/member/add",[{...l,chapterId:s,joinDate:l.joinDate||new Date().toISOString().slice(0,10),password:null}]);(k=(D=(a=R.data)==null?void 0:a.results)==null?void 0:D[0])!=null&&k.error?g.error(R.data.results[0].error):(g.success("New member invited and added"),i(!1),r())}catch(R){g.error(((A=(L=R==null?void 0:R.response)==null?void 0:L.data)==null?void 0:A.error)||"Error inviting member")}finally{N(!1)}}};return e.jsx(B,{open:t,onOpenChange:i,children:e.jsxs(H,{children:[e.jsx(O,{children:e.jsx(F,{children:"Add Member"})}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(v,{variant:w==="search"?"default":"outline",onClick:()=>y("search"),children:"Search Existing"}),e.jsx(v,{variant:w==="addNew"?"default":"outline",onClick:()=>y("addNew"),children:"Invite New"})]}),w==="search"?e.jsxs("div",{children:[e.jsx(M,{placeholder:"Search by email, phone, or name",value:u,onChange:a=>C(a.target.value),onKeyDown:a=>a.key==="Enter"&&I(),className:"mb-2"}),e.jsx(v,{onClick:I,disabled:h||!u,className:"mb-2",children:h?"Searching...":"Search"}),e.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[f.length===0&&u&&!h&&e.jsx("div",{className:"text-gray-500",children:"No members found."}),f.map(a=>e.jsx("div",{className:`p-2 border rounded mb-2 cursor-pointer ${(d==null?void 0:d.memberId)===a.memberId?"bg-blue-100":""}`,onClick:()=>{j(a),x("")},children:e.jsxs("div",{children:[e.jsxs("b",{children:[a.firstName," ",a.lastName]})," ","(",a.email||a.phoneNumber,")"]})},a.memberId))]}),d&&e.jsx("div",{className:"mt-2",children:e.jsx(M,{type:"date",placeholder:"Join Date",value:p,onChange:a=>x(a.target.value)})}),e.jsx(V,{children:e.jsx(v,{onClick:b,disabled:!d||!p||h,className:"w-full mt-2",children:h?"Adding...":"Add to Chapter"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{placeholder:"First Name*",value:l.firstName,onChange:a=>o({...l,firstName:a.target.value})}),e.jsx(M,{placeholder:"Last Name",value:l.lastName,onChange:a=>o({...l,lastName:a.target.value})}),e.jsx(M,{placeholder:"Email",value:l.email,onChange:a=>o({...l,email:a.target.value})}),e.jsx(ye,{placeholder:"Phone Number",value:l.phoneNumber,onChange:a=>o({...l,phoneNumber:a}),className:"w-full",defaultCountry:"IN"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500 text-nowrap",children:"Date of Joining"}),e.jsx(M,{placeholder:"Join Date",type:"date",value:l.joinDate,onChange:a=>o({...l,joinDate:a.target.value})})]}),e.jsx(V,{children:e.jsx(v,{onClick:T,className:"w-full",disabled:h||!l.firstName.trim()||!l.email.trim()&&!l.phoneNumber.trim(),children:h?"Inviting...":"Invite & Add"})})]})]})})}const Ie=["Correction","Payment Error","Admin Adjustment","Other"];function Pe({open:t,onOpenChange:i,member:s,allRoles:r,refresh:w,chapterId:y}){const[u,C]=n.useState((s==null?void 0:s.roleNames)||""),[f,m]=n.useState(!1);n.useEffect(()=>{C((s==null?void 0:s.roleNames)||"")},[s]);const d=async()=>{var x,l;m(!0);try{(await E.post("/api/member/role_update",{memberId:s.memberId,roleIds:u,chapterId:y})).status===200?(i(!1),w(),g.success("Role changed successfully")):g.error("Failed to change role")}catch(o){g.error(((l=(x=o==null?void 0:o.response)==null?void 0:x.data)==null?void 0:l.error)||"Error changing role")}finally{m(!1)}},j=(s==null?void 0:s.roleIds.split(","))||[],p=x=>{C(x)};return e.jsx(B,{open:t,onOpenChange:i,children:e.jsxs(H,{children:[e.jsxs(O,{children:[e.jsx(F,{children:"Change Role"}),e.jsxs(z,{children:["Change role for"," ",e.jsxs("b",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]})]})]}),e.jsx(ne,{options:r.map(x=>({label:x.roleName,value:x.roleId.toString()})),onValueChange:p,defaultValue:j.map(String),placeholder:"Select Rights",maxCount:5}),e.jsx(V,{children:e.jsx(v,{onClick:d,disabled:f,children:f?"Saving...":"Confirm"})})]})})}function Ee({open:t,onOpenChange:i,member:s,reasons:r,refresh:w,chapterId:y}){const[u,C]=n.useState((s==null?void 0:s.balance)||""),[f,m]=n.useState(""),[d,j]=n.useState(""),[p,x]=n.useState(!1);n.useEffect(()=>{C((s==null?void 0:s.balance)||""),m(""),j("")},[s]);const l=async()=>{var o,h;x(!0);try{(await E.post("/api/member/balance_update",{memberId:s.memberId,newBalance:u,reason:f==="Other"?d:f,chapterId:y})).status===200?(C(""),m(""),j(""),i(!1),w(),g.success("Due updated successfully")):g.error("Failed to update due")}catch(N){g.error(((h=(o=N==null?void 0:N.response)==null?void 0:o.data)==null?void 0:h.error)||"Error updating due")}finally{x(!1)}};return e.jsx(B,{open:t,onOpenChange:i,children:e.jsxs(H,{children:[e.jsxs(O,{children:[e.jsx(F,{children:"Due Waive Off"}),e.jsxs(z,{children:["Waive off due for"," ",e.jsxs("b",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]})]})]}),e.jsx(M,{type:"number",placeholder:"New Due Amount",value:u,onChange:o=>C(o.target.value),className:"mb-2"}),e.jsxs(_,{value:f,onValueChange:o=>{m(o),o!=="Other"&&j("")},children:[e.jsx(q,{children:e.jsx(G,{placeholder:"Select Reason"})}),e.jsx(X,{children:r.map(o=>e.jsx(Y,{value:o,children:o},o))})]}),f==="Other"&&e.jsx(M,{placeholder:"Enter custom reason",value:d,onChange:o=>j(o.target.value),className:"mt-2"}),e.jsx(V,{children:e.jsx(v,{onClick:l,disabled:p,children:p?"Saving...":"Confirm"})})]})})}function ke({open:t,onOpenChange:i,member:s,refresh:r,chapterId:w}){const[y,u]=n.useState(U(new Date,"yyyy-MM-dd")),[C,f]=n.useState(!1);n.useEffect(()=>{u(U(new Date,"yyyy-MM-dd"))},[s]);const m=async()=>{var d,j;f(!0);try{(await E.post("/api/member/remove",{memberId:s.memberId,chapterId:w,leaveDate:y})).status===200?(u(U(new Date,"yyyy-MM-dd")),i(!1),r(),g.success("Member removed successfully")):g.error("Failed to remove member")}catch(p){g.error(((j=(d=p==null?void 0:p.response)==null?void 0:d.data)==null?void 0:j.error)||"Error removing member")}finally{f(!1)}};return e.jsx(B,{open:t,onOpenChange:i,children:e.jsxs(H,{children:[e.jsxs(O,{children:[e.jsx(F,{children:"Remove Member"}),e.jsxs(z,{children:["Remove"," ",e.jsxs("b",{children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]})," ","from chapter?"]})]}),e.jsx(M,{type:"date",value:y,onChange:d=>u(d.target.value),className:"mb-2"}),e.jsx(V,{children:e.jsx(v,{variant:"destructive",onClick:m,disabled:C,children:C?"Removing...":"Remove"})})]})})}const hs=()=>{const t=J(),i=new URLSearchParams(t.search),{chapterData:s}=te(),[r,w]=n.useState(0),[y,u]=n.useState([]),[C,f]=n.useState([]),[m,d]=n.useState(""),[j,p]=n.useState(!1),[x,l]=n.useState({open:!1,member:null}),[o,h]=n.useState({open:!1,member:null}),[N,I]=n.useState({open:!1,member:null}),[b,S]=n.useState([]),T=i.get("rows")||10,a=i.get("page")||0,D=async()=>{try{const c=await E.post(`/api/member/memberList?page=${a}&rows=${T}&searchQuery=${m}`,{chapterId:s.chapterId});u(c.data.data),f(c.data.data),w(c.data.totalRecords)}catch(c){console.error("Error fetching members:",c)}},k=async()=>{try{const c=await E.get(`/api/chapter/${s.chapterSlug}/roles`);S(c.data)}catch(c){console.error("Error fetching roles:",c)}};n.useEffect(()=>{!s||!(s!=null&&s.chapterId)||(D(),k())},[s,T,a,t.search,m]),n.useEffect(()=>{f(y.filter(c=>{var P;return(P=c.firstName)==null?void 0:P.toLowerCase().includes(m.toLowerCase())}))},[m,y]);const L=c=>{d(c.target.value)},A=c=>l({open:!0,member:c}),R=c=>h({open:!0,member:c}),Z=c=>I({open:!0,member:c});return s?e.jsxs("div",{className:"container mx-auto p-4 dark:bg-gray-800 dark:text-white",children:[e.jsx(re,{items:[{name:"Member List"}]}),e.jsxs("div",{className:"flex justify-between items-center mb-4 gap-4",children:[e.jsx(le,{onChange:L,value:m,className:"mb-0 w-full"}),e.jsx(v,{onClick:()=>p(!0),children:"Add Member"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Re,{data:y,columns:De({onChangeRole:A,onDueWaiveOff:R,onRemove:Z}),searchInputField:"firstName",totalRecord:r,pagination:{pageSize:T,pageIndex:a},state:{pagination:{pageSize:T,pageIndex:a}}})}),e.jsx(Me,{open:j,onOpenChange:p,chapterId:s.chapterId,refresh:D}),e.jsx(Pe,{open:x.open,onOpenChange:c=>l(P=>({...P,open:c})),member:x.member,allRoles:b,refresh:D,chapterId:s.chapterId}),e.jsx(Ee,{open:o.open,onOpenChange:c=>h(P=>({...P,open:c})),member:o.member,reasons:Ie,refresh:D,chapterId:s.chapterId}),e.jsx(ke,{open:N.open,onOpenChange:c=>I(P=>({...P,open:c})),member:N.member,refresh:D,chapterId:s.chapterId})]}):e.jsx("div",{children:"Loading..."})};export{hs as default};
