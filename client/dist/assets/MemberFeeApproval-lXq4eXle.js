import{j as e,r as n,B as k,g as ae,c as A,Q as v}from"./index-eKwCJLll.js";import{u as we}from"./useWindowDimensions-BU2XBDYY.js";import{B as Ce}from"./Breadcrumb-kGt-xtkX.js";import{c as se}from"./CircularProgress-yOawTry_.js";import{T as Ae,a as Se,b as K,c as Z}from"./tabs-DuNG8T3N.js";import{D as te,f as Ie,a as re,b as ne,c as le,d as De,g as Te,e as Me}from"./dialog-B-Dd4jtF.js";import{I as oe}from"./input-BhMSVbBI.js";import{L as U}from"./label-DUERygKs.js";import{S as Re,a as Pe,b as Fe,c as Ee,d as Be}from"./select-D6qXgB-2.js";import{C as _e,a as $e,b as ze,c as Oe,e as Le}from"./command-CwJtseYa.js";import{T as ie,a as ce,b as L,c as D,d as de,e as S}from"./table-B33a0yXU.js";import{A as qe,e as Ye,a as He,b as Ve,c as Qe,d as We,g as Ue,h as Xe}from"./alert-dialog-BXfYvETV.js";import{T as Ge}from"./textarea-B33g_TqR.js";import{I as Je}from"./IconButton-Bt62Wd6g.js";import"./chevron-right-B55Ri9eq.js";import"./TransitionGroupContext-B__exIwg.js";import"./index-p0A_8czo.js";import"./index-DBSIu3jP.js";import"./index-Bn6wwOXp.js";import"./index-CMxenybS.js";import"./index-Jch0bHuG.js";import"./index-D9_AVXgF.js";import"./index-BdQq_4o_.js";import"./index-Irvr_6j-.js";import"./index-DCu9mJZ4.js";import"./index-CzuTh-Sf.js";import"./chevron-down-G1SJ-oEn.js";import"./search-6lUvAzAk.js";const Ke=se(e.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),Ze=({receivedAmount:i,setReceivedAmount:g,selectedReceiver:o,setSelectedReceiver:j,selectedPaymentMode:r,setSelectedPaymentMode:m,receiverList:h,allMembers:w,showAllMembers:f,setShowAllMembers:b,paymentModes:C,selectedFee:t,canChangeReceiver:s,setCanChangeReceiver:M,onCancel:p,onSave:x,onApprove:T,saveDisabled:N,approveDisabled:R})=>{const[_,$]=n.useState(!1),[F,q]=n.useState(null),[Y,z]=n.useState(null);n.useEffect(()=>{if(!t)return;const l=parseFloat(i)||0,E=parseFloat(t.payableAmount)||0,P=parseFloat(t.platformFee)||0,H=parseFloat(t.receiverFee)||0;q(l-E),z(l-P-H)},[i,t]);const O=h.find(l=>l.memberId===o);return e.jsxs("div",{className:"space-y-4 py-4 w-full max-w-md mx-auto sm:max-w-lg md:max-w-xl lg:max-w-2xl px-2 sm:px-4",style:{maxWidth:"100vw",overflowX:"hidden"},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Member Details:"}),e.jsxs("p",{className:"text-sm",children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}),e.jsxs("p",{className:"text-sm",children:["Package: ",t==null?void 0:t.packageName]}),e.jsxs("p",{className:"text-sm",children:["Original Payable Amount: ₹",t==null?void 0:t.payableAmount]}),e.jsxs("p",{className:"text-sm",children:["Expected Amount: ₹",t==null?void 0:t.paidAmount]}),e.jsxs("p",{className:"text-sm",children:["Dues: ₹",t==null?void 0:t.balanceAmount]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"amount",children:"Amount Received"}),e.jsx(oe,{id:"amount",type:"number",value:i,onChange:l=>g(l.target.value),placeholder:"Enter amount received",className:"w-full"}),e.jsxs("div",{className:"flex flex-col gap-1 mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Live Balance Amount: ",e.jsxs("span",{className:F===0?"text-green-700 dark:text-green-300":F<0?"text-red-700 dark:text-red-300":"text-yellow-700 dark:text-yellow-300",children:["₹",F??"-"]})]}),e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Amount Paid to Chapter: ",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300",children:["₹",Y??"-"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"receiver",children:"Receiver"}),!s&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-2",children:O?e.jsxs(e.Fragment,{children:[O.receiverName," is the receiver for this payment."," ",e.jsx("button",{className:"text-blue-600 underline ml-1",type:"button",onClick:()=>M(!0),children:"Not the receiver? Click here to change"})]}):e.jsxs(e.Fragment,{children:["Receiver not found."," ",e.jsx("button",{className:"text-blue-600 underline ml-1",type:"button",onClick:()=>M(!0),children:"Click here to select"})]})}),s&&e.jsxs("div",{className:"relative",children:[e.jsxs(k,{type:"button",variant:"outline",className:"w-full flex justify-between items-center",onClick:()=>$(l=>!l),children:[(()=>{const l=(f?w:h).find(E=>E.memberId===o);return l?l.receiverName||l.firstName+" "+l.lastName:"Select receiver"})(),e.jsx("span",{className:"ml-2",children:"▼"})]}),_&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white dark:bg-boxdark border rounded shadow-lg max-h-60 overflow-y-auto",children:e.jsxs(_e,{className:"w-full border-none shadow-none",children:[e.jsx($e,{placeholder:"Search receiver..."}),e.jsxs(ze,{children:[(f?w:h).length===0&&e.jsx(Oe,{children:"No receivers found."}),(f?w:h).map(l=>e.jsx(Le,{value:l.memberId,onSelect:()=>{j(l.memberId),$(!1)},className:o===l.memberId?"bg-blue-100 dark:bg-blue-700":"",children:l.receiverName||l.firstName+" "+l.lastName},l.memberId))]})]})}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>b(!f),id:"showAllMembers",className:"mr-2"}),e.jsx("label",{htmlFor:"showAllMembers",className:"text-xs",children:"Show all members"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"paymentMode",children:"Payment Mode"}),e.jsxs(Re,{value:r,onValueChange:m,children:[e.jsx(Pe,{className:"w-full",children:e.jsx(Fe,{placeholder:"Select payment mode"})}),e.jsx(Ee,{className:"max-h-60 overflow-y-auto",children:C.map(l=>e.jsx(Be,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[p&&e.jsx(k,{variant:"outline",onClick:p,children:"Cancel"}),e.jsx(k,{variant:"secondary",onClick:x,disabled:N,children:"Save Changes"}),e.jsx(k,{onClick:T,disabled:R,children:"Save & Approve"})]})]})},Q=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:2,notation:"compact",compactDisplay:"long"}),ea=({metaData:i})=>e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-meta-4 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Total Collected"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:Q.format(i.totalCollected)})]}),e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Pending Approvals"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:Q.format(i.pendingAmount)})]}),e.jsxs("div",{className:"bg-green-100 dark:bg-green-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Approved Fees"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:Q.format(i.approvedAmount)})]}),e.jsxs("div",{className:"bg-blue-100 dark:bg-blue-700 p-4 rounded-md shadow",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Transferred to Chapter"}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:Q.format(i.totalTransferredToChapter)})]})]}),ee=se(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),aa=({pendingFees:i,approvedFees:g,currentTab:o,config:j,width:r,loadingApprovals:m,onDirectApproval:h,onOpenApproveDialog:w,onMoveToPending:f,selectedApprovals:b,onConfirmSelectedFees:C})=>{const t=o==="pending"?i:g;return r>700?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto rounded-lg border border-solid",children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs(L,{children:[e.jsx(D,{children:"Member Name"}),e.jsx(D,{children:"Package Name"}),e.jsx(D,{children:"Date"}),e.jsx(D,{children:"Amount Paid"}),e.jsx(D,{children:"Balance"}),j.currentState==="all_members_approval"&&o==="pending"&&e.jsx(D,{children:"Received By"}),e.jsx(D,{children:o==="pending"?"Approve":"Actions"})]})}),e.jsx(de,{children:(t==null?void 0:t.length)===0?e.jsx(L,{children:e.jsx(S,{colSpan:o==="pending"&&j.currentState==="all_members_approval"?7:6,className:"text-center",children:o==="pending"?"No pending fees to approve.":"No approved fees."})}):t==null?void 0:t.map(s=>e.jsxs(L,{children:[e.jsxs(S,{children:[s.firstName," ",s.lastName]}),e.jsx(S,{children:s.packageName}),e.jsx(S,{children:new Date(s.transactionDate).toLocaleDateString()}),e.jsx(S,{children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:2}).format(s.paidAmount)}),e.jsx(S,{children:e.jsxs("span",{className:s.balanceAmount<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400",children:[new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:2}).format(Math.abs(s.balanceAmount)),s.balanceAmount<0?" (Due)":" (Advance)"]})}),j.currentState==="all_members_approval"&&o==="pending"&&e.jsx(S,{children:s.paymentReceivedByName||"-"}),e.jsx(S,{children:o==="pending"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>h(s.transactionId),className:"h-8 px-2",disabled:m[s.transactionId],children:m[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Quick Approve"})}),e.jsx(k,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>w(s),disabled:m[s.transactionId],children:e.jsxs("span",{className:"text-xs flex items-center",children:[e.jsx(ee,{fontSize:"small",className:"mr-1"}),"Edit"]})})]}):e.jsx(k,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>f(s.transactionId),disabled:m[s.transactionId],children:m[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Move to Pending"})})})]},s.transactionId))})]})}),o==="pending"&&(b==null?void 0:b.length)>0&&e.jsx("button",{className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",onClick:C,children:"Confirm Selected Approvals"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col space-y-4",children:(t==null?void 0:t.length)===0?e.jsx("p",{className:"text-center text-black dark:text-white",children:o==="pending"?"No pending fees to approve.":"No approved fees."}):t==null?void 0:t.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 shadow-md dark:border-strokedark bg-white dark:bg-boxdark flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-black dark:text-white font-medium text-base",children:[s.firstName," ",s.lastName]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Package:"," ",e.jsx("span",{className:"font-semibold",children:s.packageName})]}),j.currentState==="all_members_approval"&&o==="pending"&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Received By:"," ",e.jsx("span",{className:"font-semibold",children:s.paymentReceivedByName||"-"})]})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(s.transactionDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-2",children:[e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400",children:"Amount Paid"}),e.jsxs("span",{className:"block text-base font-semibold text-green-700 dark:text-green-300",children:["₹",s.paidAmount]})]}),e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400",children:"Balance"}),e.jsxs("span",{className:`block text-base font-semibold ${s.balanceAmount<0?"text-red-700 dark:text-red-300":"text-green-700 dark:text-green-300"}`,children:["₹",Math.abs(s.balanceAmount)," ",s.balanceAmount<0?"(Due)":"(Advance)"]})]})]}),e.jsx("div",{className:"flex gap-2 mt-4",children:o==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>h(s.transactionId),className:"h-8 px-2",disabled:m[s.transactionId],children:m[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Quick Approve"})}),e.jsx(k,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>w(s),disabled:m[s.transactionId],children:e.jsxs("span",{className:"text-xs flex items-center",children:[e.jsx(ee,{fontSize:"small",className:"mr-1"}),"Edit"]})})]}):e.jsx(k,{variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>f(s.transactionId),disabled:m[s.transactionId],children:m[s.transactionId]?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx("span",{className:"text-xs",children:"Move to Pending"})})})]},s.transactionId))}),o==="pending"&&(b==null?void 0:b.length)>0&&e.jsx("button",{className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",onClick:C,children:"Confirm Selected Approvals"})]})},sa=({config:i,currentTab:g,onConfigChange:o,onTabChange:j})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex mb-4",children:[e.jsx("button",{className:`px-4 py-2 rounded-l ${g==="pending"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>j("pending"),children:"Pending"}),e.jsx("button",{className:`px-4 py-2 rounded-r ${g==="approved"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>j("approved"),children:"Approved"})]}),i.allowAllMembersApproval&&e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("label",{className:"mr-2 text-black dark:text-white",children:"Approval Mode:"}),e.jsx("button",{className:`px-4 py-2 rounded ${i.currentState==="self_approval"?"bg-blue-600 text-white":"bg-gray-300 text-black dark:bg-gray-700 dark:text-white"}`,onClick:()=>{o(r=>({...r,currentState:r.currentState==="self_approval"?"all_members_approval":"self_approval"}))},children:i.currentState==="self_approval"?"Switch To All Requests":"Switch To My Requests"})]})]}),ta=()=>{const{chapterData:i}=ae(),[g,o]=n.useState(!1),[j,r]=n.useState([]),[m,h]=n.useState(0),[w,f]=n.useState(""),[b,C]=n.useState(""),[t,s]=n.useState(!1),M=()=>{f(""),C(""),s(!1),o(!1)};n.useEffect(()=>{g&&(async()=>{try{const N=(await A(`/api/chapter-payment/${i.chapterId}/approved-transactions`)).data;r(N.transactions),h(N.totalAmount)}catch(T){console.error("Error fetching transactions:",T)}})()},[g]);const p=async()=>{try{(await A.post(`/api/chapter-payment/${i.chapterId}/pay-to-chapter`,{totalAmount:m,transferredAmount:w,remark:b})).data.success&&(v.success("Amount transferred successfully"),M())}catch(x){console.error("Error transferring amount:",x),v.error("Error transferring amount")}};return e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Transfer Collected Fees"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Transfer all approved & untransferred transactions to your chapter."}),e.jsxs(te,{open:g,onOpenChange:o,children:[e.jsx(Ie,{asChild:!0,children:e.jsx(k,{onClick:()=>o(!0),children:"Transfer Now"})}),e.jsxs(re,{className:"max-w-xl",children:[e.jsx(ne,{className:"mb-4",children:e.jsx(le,{children:"Confirm Transfer Details"})}),e.jsxs("div",{className:"mb-4 space-y-4",children:[e.jsx("div",{className:"overflow-y-auto rounded-md border max-h-64",children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs(L,{children:[e.jsx(D,{children:"Sr No."}),e.jsx(D,{children:"Member Name"}),e.jsx(D,{children:"Amount"}),e.jsx(D,{children:"Payment Type"})]})}),e.jsx(de,{children:j.map((x,T)=>e.jsxs(L,{children:[e.jsx(S,{children:T+1}),e.jsxs(S,{children:[x.firstName," ",x.lastName]}),e.jsx(S,{children:x.paidAmount}),e.jsx(S,{children:x.paymentType})]},x.id))})]})}),e.jsx("div",{children:e.jsxs("p",{className:"font-medium",children:["Original Total Amount: ",m]})}),e.jsx(oe,{type:"number",value:w,onChange:x=>f(x.target.value),placeholder:"Enter amount you are transferring"}),e.jsx(Ge,{placeholder:"Add a remark (optional)",value:b,onChange:x=>C(x.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(ra,{showAlert:t,setShowAlert:s,totalAmount:m,amount:w,remark:b,handleTransfer:p})}),e.jsx(De,{className:"mt-4",children:e.jsx(Te,{asChild:!0,children:e.jsx(k,{variant:"outline",onClick:M,children:"Cancel & Reset"})})})]})]})]})},ra=({showAlert:i,setShowAlert:g,totalAmount:o,amount:j,remark:r,handleTransfer:m})=>{const h=o-Number(j);return e.jsxs(qe,{open:i,onOpenChange:g,children:[e.jsx(Ye,{asChild:!0,children:e.jsx(k,{variant:"default",onClick:()=>g(!0),children:"Confirm Transfer"})}),e.jsxs(He,{children:[e.jsx(Ve,{children:e.jsx(Qe,{children:"Are you sure you want to transfer?"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["Total Collected: ₹",o]}),e.jsxs("p",{children:["Transfer Amount: ₹",j]}),e.jsx("p",{className:"text-yellow-600",children:h!==0&&`Note: Difference of ₹${h>0?h:-h}`}),r&&e.jsxs("p",{children:["Remark: ",r]})]}),e.jsxs(We,{children:[e.jsx(Ue,{children:"Cancel"}),e.jsx(Xe,{onClick:m,children:"Confirm"})]})]})]})},na=({metaData:i})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(ea,{metaData:i}),i.remainingToTransfer>0?e.jsx(ta,{}):e.jsxs("div",{className:"text-center text-gray-600 dark:text-gray-300 mt-4 p-8 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🎉"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 dark:text-green-200 mb-2",children:"All Set!"}),e.jsx("p",{className:"text-green-700 dark:text-green-300",children:"All approved fees have been transferred to the chapter!"})]})]}),la=[{value:"cash",label:"Cash"},{value:"online",label:"Online/UPI/QR"},{value:"cheque",label:"Cheque"},{value:"other",label:"Other"}],za=()=>{const[i,g]=n.useState([]),[o,j]=n.useState([]),{chapterData:r}=ae(),{width:m}=we(),[h,w]=n.useState([]),[f,b]=n.useState({allowAllMembersApproval:!1,currentState:"self_approval"}),[C,t]=n.useState("pending"),[s,M]=n.useState({totalCollected:0,pendingAmount:0,approvedAmount:0,totalTransferredToChapter:0,remainingToTransfer:0}),[p,x]=n.useState(null),[T,N]=n.useState({}),[R,_]=n.useState(""),[$,F]=n.useState([]),[q,Y]=n.useState([]),[z,O]=n.useState(!1),[l,E]=n.useState(""),[P,H]=n.useState(""),[oa,X]=n.useState(!1),[ia,ca]=n.useState(),[da,G]=n.useState(!1),[me,J]=n.useState(!1),[pe,V]=n.useState(!1);console.log({pendingFees:i}),n.useEffect(()=>{r!=null&&r.chapterId&&(B(),ge())},[r]),n.useEffect(()=>{r!=null&&r.chapterId&&(B(),je())},[f.currentState,C,r]);const xe=a=>{const c=a.getDate().toString().padStart(2,"0"),d=(a.getMonth()+1).toString().padStart(2,"0"),u=a.getFullYear();return`${c}-${d}-${u}`},he=async()=>{if(r!=null&&r.chapterId)try{const a=await A.get(`/api/feeReceiver/current/${r.chapterId}`,{params:{date:xe(new Date)}});F(a.data||[])}catch{F([])}},ue=async()=>{if(r!=null&&r.chapterId)try{const a=await A.get(`/api/member/all?chapterId=${r.chapterId}`);Y(a.data||[])}catch{Y([])}},ge=async()=>{try{const a=await A.get(`/api/rights/anyMemberApprovePayment/${r==null?void 0:r.chapterId}`);console.log({response:a}),b(c=>{var d;return{...c,allowAllMembersApproval:(d=a==null?void 0:a.data)==null?void 0:d.allowed}})}catch(a){console.error("Fetching rights failed:",a)}},B=async(a=C)=>{try{const c=await A.post(`/api/payment/paymentRequests/${r==null?void 0:r.chapterId}`,{status:a,currentState:f.currentState});console.log({response:c}),console.log({got:c.data}),a==="pending"?g(c.data):j(c.data)}catch(c){console.error("Fetching fees failed:",c)}},je=async()=>{try{const a=await A.get(`/api/payment/metaData/${r==null?void 0:r.chapterId}`);console.log({response:a}),M(a.data)}catch(a){console.error("Fetching metadata failed:",a)}};console.log({selectedApprovals:h});const fe=async()=>{try{const a=i.filter(c=>h.includes(c.transactionId));console.log({data:a}),await A.put("/api/payment/approvePendingPayment",{transactionDetails:a}),g(c=>c.filter(d=>!h.includes(d.transactionId))),w([]),v.success("Fees confirmed successfully")}catch(a){v.error("Could not confirm fees. Please try again later."),console.error("Confirming fees failed:",a)}},be=async a=>{var c,d;try{N(I=>({...I,[a]:!0}));const u=i.find(I=>I.transactionId===a),y=await A.put("/api/payment/approvePendingPayment",{transactionDetails:[u]});y.data.success?(g(I=>I.filter(W=>W.transactionId!==a)),v.success("Fee approved successfully")):v.error(y.data.message||"Could not approve fee")}catch(u){console.error("Approving fee failed:",u),v.error(((d=(c=u.response)==null?void 0:c.data)==null?void 0:d.message)||"Could not approve fee. Please try again later.")}finally{N(u=>({...u,[a]:!1}))}},ye=async a=>{var c,d;try{N(I=>({...I,[a]:!0}));const u=o.find(I=>I.transactionId===a),y=await A.put("/api/payment/moveApprovedToPending",{transactionDetails:[u]});y.data.success?(j(I=>I.filter(W=>W.transactionId!==a)),v.success("Fee moved to pending successfully"),B("pending")):v.error(y.data.message||"Could not move fee")}catch(u){console.error("Moving fee to pending failed:",u),v.error(((d=(c=u.response)==null?void 0:c.data)==null?void 0:d.message)||"Could not move fee. Please try again later.")}finally{N(u=>({...u,[a]:!1}))}},ve=a=>{x(a),_(a.paidAmount.toString()),E(a.paymentReceivedById||""),H(a.paymentType||""),G(!1),O(!1),J(!1),he(),V(!0)};n.useEffect(()=>{z&&ue()},[z]),n.useEffect(()=>{p&&G(R!==p.paidAmount.toString()||l!==(p.paymentReceivedById||"")||P!==(p.paymentType||""))},[R,l,P,p]);const Ne=async()=>{var a,c,d,u;if(X(!1),!!p){N(y=>({...y,[p.transactionId]:!0}));try{await A.put("/api/payment/saveEditedFeeDetails",{transactionId:p.transactionId,updateFields:{paidAmount:parseFloat(R),paymentReceivedById:l,paymentType:P,paymentReceivedByName:((a=q.find(y=>y.memberId===l))==null?void 0:a.firstName)||((c=$.find(y=>y.memberId===l))==null?void 0:c.receiverName)||"",payableAmount:p.payableAmount}}),v.success("Details saved successfully"),B(),x(null),V(!1)}catch(y){v.error(((u=(d=y.response)==null?void 0:d.data)==null?void 0:u.message)||"Could not save changes")}finally{N(y=>({...y,[p.transactionId]:!1}))}}},ke=async()=>{var a,c;if(X(!1),!!p){N(d=>({...d,[p.transactionId]:!0}));try{await A.put("/api/payment/approvePendingPayment",{transactionDetails:[{...p,paidAmount:parseFloat(R),paymentReceivedById:l,paymentType:P,status:"approved"}]}),v.success("Fee approved successfully"),B(),x(null)}catch(d){v.error(((c=(a=d.response)==null?void 0:a.data)==null?void 0:c.message)||"Could not approve fee")}finally{N(d=>({...d,[p.transactionId]:!1}))}}};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{items:[{name:"Member Fee Approval"}]}),e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-3 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium dark:text-white",children:"Member Fee Approvals"}),e.jsx(Je,{"aria-label":"refresh",onClick:()=>B(),children:e.jsx(Ke,{className:"dark:text-white"})})]}),e.jsxs(Ae,{defaultValue:"approval",className:"w-full",children:[e.jsxs(Se,{className:"grid w-full grid-cols-2",children:[e.jsx(K,{value:"approval",children:"Fee Approval"}),e.jsx(K,{value:"transfer",children:"Transfer & Dashboard"})]}),e.jsxs(Z,{value:"approval",className:"space-y-4",children:[e.jsx(sa,{config:f,currentTab:C,onConfigChange:b,onTabChange:t}),e.jsx(aa,{pendingFees:i,approvedFees:o,currentTab:C,config:f,width:m,loadingApprovals:T,onDirectApproval:be,onOpenApproveDialog:ve,onMoveToPending:ye,selectedApprovals:h,onConfirmSelectedFees:fe})]}),e.jsx(Z,{value:"transfer",className:"space-y-4",children:e.jsx(na,{metaData:s})})]})]}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(te,{open:pe,onOpenChange:V,children:e.jsx(re,{className:"!p-0",style:{width:"100%",maxHeight:"calc(100vh - 20px)",overflowY:"auto",borderRadius:12,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Edit Fee Payment"}),e.jsx(Me,{children:"Edit details, change receiver, payment mode, or approve/save changes"})]}),e.jsx(Ze,{receivedAmount:R,setReceivedAmount:_,selectedReceiver:l,setSelectedReceiver:E,selectedPaymentMode:P,setSelectedPaymentMode:H,receiverList:$,allMembers:q,showAllMembers:z,setShowAllMembers:O,paymentModes:la,selectedFee:p,canChangeReceiver:me,setCanChangeReceiver:J,onCancel:()=>{V(!1),x(null),_("")},onSave:Ne,onApprove:ke})]})})})})]})};export{za as default};
