import{g as K,r as m,c as T,Q as E,j as e,B as U,n as ze,w as Ye,_ as Ge,s as Ke,J as xe,R as $,e as ne}from"./index.js";import{B as Je}from"./Breadcrumb.js";import{f as z,C as Xe}from"./ChooseMemberPopoverCommand.js";import{T as Ze,a as et,b as ue,c as pe}from"./tabs2.js";import{B as tt}from"./badge.js";import{C as te}from"./circle-alert.js";import{B as ae}from"./banknote.js";import{C as se}from"./credit-card.js";import{C as ve}from"./chevron-right.js";import{U as at}from"./user.js";import{S as st}from"./skeleton.js";import{S as ge}from"./switch.js";import{L as fe}from"./label.js";import{C as rt,S as nt,a as it,b as ot,c as lt,d as ct}from"./select.js";import{C as ye}from"./chevron-down.js";import{U as dt}from"./upload.js";import{C as be}from"./chevron-left.js";import{A as mt,a as ht,b as ut,c as pt,f as gt,d as ft,g as xt,h as vt}from"./alert-dialog.js";import{D as yt,f as bt,a as wt}from"./dialog.js";import{B as Y,T as jt,a as Nt}from"./Tabs.js";import{B as Ct}from"./Button.js";import{I as It}from"./input.js";import{c as we,a as ie,u as je,P as Q,b as Ne,e as At}from"./index4.js";import{c as Pt}from"./index11.js";import{P as St}from"./index6.js";import{u as _t}from"./index9.js";import"./popover.js";import"./index5.js";import"./index7.js";import"./index8.js";import"./command.js";import"./index3.js";import"./search.js";import"./chevrons-up-down.js";import"./index12.js";import"./index10.js";import"./TransitionGroupContext.js";import"./useSlot.js";import"./CircularProgress.js";const Ce=(l,t,a,s)=>{const r=new Date(t.packagePayableEndDate);if(typeof t.meetingIds=="string"&&(t.meetingIds=JSON.parse(t.meetingIds)),t.status==="pending")return{message:"You have applied for this package. Please wait for approval",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(t.status==="rejected")return{message:"Your package application has been rejected",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(t.status==="approved")return{message:"Your package application has been approved",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(t.packagePayableStartDate&&l<new Date(t.packagePayableStartDate))return{message:"Package is not open to payable yet",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(!t.allowAfterEndDate&&l>r)return{message:"Package is not open to payable anymore",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(t.allowPackagePurchaseIfFeesPaid&&kt(t,a))return{message:"Package has overlapping payments",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};let i=t.packageFeeAmount,n=0,d=0;const o=(c,j)=>{switch(c){case"Daily":return j;case"Weekly":return Math.ceil(j/7);case"Monthly":return Math.ceil(j/30);case"Quarterly":return Math.ceil(j/90);case"lumpsum":case"Meetingly":return 1;default:return 0}};if(l<=new Date(t.discountEndDate)){const c=Math.ceil((new Date(t.discountEndDate)-l)/864e5);d=o(t.discountType,c)*t.discountAmount}if(l>r&&t.allowPenaltyPayableAfterEndDate){const c=Math.ceil((l-r)/864e5);n=o(t.penaltyType,c)*t.penaltyAmount}let b=i+n-d,h=0;return h=Array.isArray(t.meetingIds)?t.meetingIds.reduce((c,j)=>{const y=a.find(x=>x.meetingId===j);return c+(y&&y.isPaid?y.meetingFeeMembers:0)},0):0,{totalAmount:b-s,penaltyAmount:n,discountAmount:d,paidFees:h,previousBalance:s,isDisabled:!t.allowAfterEndDate&&l>r}},kt=(l,t)=>{var a;return(a=l.meetingIds)==null?void 0:a.some(s=>{const r=t.find(i=>i.meetingId===s);return r&&r.isPaid})},Ie=m.createContext(),Rt=({children:l})=>{const{chapterData:t}=K(),[a,s]=m.useState(new Date),r=m.useRef(!0),i=m.useRef(!1),[n,d]=m.useState({selectedReceiver:null,saveReceiverSelection:!1,selectedReceiverObject:null,receivers:[],selectedPackage:null,pendingPayments:[],packageData:null,parentType:null,packageParents:[],chapterMeetings:void 0,balance:void 0,lastUpdated:null,lastSelectedPackageTime:null,selectedMemberId:null,terms:[],selectedTermId:null}),o=()=>{d(u=>({...u,selectedPackage:null,selectedReceiver:null,selectedReceiverObject:null,saveReceiverSelection:!1,lastSelectedPackageTime:null}))},b=u=>{d(g=>({...g,selectedPackage:u,lastSelectedPackageTime:new Date}))},h=m.useCallback(async()=>{if(t!=null&&t.chapterId)try{const u=await T.get(`/api/feeReceiver/current/${t.chapterId}`,{params:{date:z(a)}});d(g=>({...g,receivers:u.data}))}catch(u){console.error("Error fetching current receivers:",u),E.error("Failed to fetch fee receivers")}},[t==null?void 0:t.chapterId,a]),v=async()=>{if(!(t!=null&&t.chapterId)){console.warn("Chapter ID is not available. Skipping terms fetch.");return}try{const u=await T.get(`/api/term/chapter/${t.chapterId}`),g=u.data.filter(P=>P.status==="active");let A=n.selectedTermId;if(!A||!g.find(P=>P.termId===A)){const P=new Date,k=g.find(N=>{const R=new Date(N.startDate),_=new Date(N.endDate);return P>=R&&P<=_});if(k)A=k.termId;else if(g.length>0){const N=g.filter(R=>new Date(R.startDate)>P);N.length>0?A=N.reduce((_,M)=>new Date(_.startDate)<new Date(M.startDate)?_:M).termId:A=g[0].termId}}d(P=>({...P,terms:u.data,selectedTermId:A}))}catch(u){console.error("Error fetching terms:",u),E.error("Failed to fetch terms")}},c=m.useCallback(async(u,g=null)=>{if(!(g||n.selectedTermId)||!(t!=null&&t.chapterId)){console.warn("No term selected or chapter ID missing. Skipping meetings fetch.");return}try{const P=await T.get(`/api/meetings/meetings/${t.chapterId}`,{params:{memberId:u||""}});d(k=>({...k,chapterMeetings:P.data}))}catch(P){console.error("Error fetching chapter meetings:",P),E.error("Failed to fetch meetings")}},[t==null?void 0:t.chapterId,n.selectedTermId]),j=m.useCallback(async u=>{if(t!=null&&t.chapterId)try{const g=await T.get(`/api/payment/balance/${t.chapterId}`,{params:{memberId:u||""}});d(A=>({...A,balance:g.data.balance}))}catch(g){console.error("Error fetching balance amounts:",g),E.error("Failed to fetch balance")}},[t==null?void 0:t.chapterId]),y=m.useCallback(async(u,g=null,A=null,P=null)=>{var _;const k=g||n.selectedTermId,N=A||n.chapterMeetings,R=P!==null?P:n.balance;if(!k||!(t!=null&&t.chapterId)){console.warn("No term selected or chapter ID missing. Skipping packages fetch.");return}try{const M=await T.get(`/api/packages/all/${t.chapterId}/term/${k}`,{params:{memberId:u||"",date:z(a)}}),L=[...new Set(M.data.map(V=>V.packageParent))].sort((V,W)=>V.localeCompare(W));console.log("Processing packages with:",{packages:((_=M.data)==null?void 0:_.length)||0,meetings:(N==null?void 0:N.length)||0,balance:R});const H=x(M.data,R,N);d(V=>({...V,packageParents:L,packageData:H,lastUpdated:new Date}))}catch(M){console.error("Error fetching packages:",M),E.error("Failed to fetch packages")}},[t==null?void 0:t.chapterId,n.selectedTermId,n.chapterMeetings,n.balance,a]),x=(u,g,A)=>(console.log("processPackageData called with:",{packagesCount:(u==null?void 0:u.length)||0,packagesValid:Array.isArray(u),meetingsCount:(A==null?void 0:A.length)||0,meetingsValid:!!A,balance:g}),!A||!Array.isArray(u)?(console.warn("Missing required data for package processing",{meetings:!!A,packages:Array.isArray(u)}),[]):u.map(P=>{const k=Ce(a,P,A,g||0);return{...P,...k}})),I=m.useCallback(async u=>{try{const g=await T.get("/api/payment/pendingPayments",{params:{memberId:u||""}});d(A=>({...A,pendingPayments:g.data}))}catch(g){console.error("Error fetching pending payments:",g),E.error("Failed to fetch pending payments")}},[]),f=async u=>{try{await T.delete(`/api/payment/deleteRequest/${u}`),await p(n.selectedMemberId),E.success("Request deleted successfully")}catch(g){console.error("Error deleting request:",g),E.error("Failed to delete request")}},p=m.useCallback(async(u=n.selectedMemberId)=>{var g;if(!(t!=null&&t.chapterId)||i.current){console.warn("Chapter ID not available or already loading");return}i.current=!0,console.log("Starting fetchAllData for member:",u);try{d(N=>({...N,selectedMemberId:u})),await Promise.all([h(),I(u)]);const A=await T.get(`/api/term/chapter/${t.chapterId}`),P=A.data.filter(N=>N.status==="active");let k=n.selectedTermId;if(!k||!P.find(N=>N.termId===k)){const N=new Date,R=P.find(_=>{const M=new Date(_.startDate),L=new Date(_.endDate);return N>=M&&N<=L});if(R)k=R.termId;else if(P.length>0){const _=P.filter(M=>new Date(M.startDate)>N);_.length>0?k=_.reduce((L,H)=>new Date(L.startDate)<new Date(H.startDate)?L:H).termId:k=P[0].termId}}if(console.log("Selected term ID:",k),d(N=>({...N,terms:A.data,selectedTermId:k})),k){console.log("Fetching meetings and balance...");const[N,R]=await Promise.all([T.get(`/api/meetings/meetings/${t.chapterId}`,{params:{memberId:u||""}}),T.get(`/api/payment/balance/${t.chapterId}`,{params:{memberId:u||""}})]);console.log("Meetings fetched:",((g=N.data)==null?void 0:g.length)||0),console.log("Balance fetched:",R.data.balance),d(_=>({..._,chapterMeetings:N.data,balance:R.data.balance})),console.log("Fetching packages with fresh data..."),await y(u,k,N.data,R.data.balance),console.log("All data fetched successfully")}else console.warn("No term ID available to fetch dependent data")}catch(A){console.error("Error in fetchAllData:",A),E.error("Failed to fetch payment data")}finally{i.current=!1,r.current=!1}},[t==null?void 0:t.chapterId,n.selectedTermId,h,I,y]);return m.useEffect(()=>{t!=null&&t.chapterId&&r.current&&(console.log("Initial load triggered for chapter:",t.chapterId),p(n.selectedMemberId))},[t==null?void 0:t.chapterId,p]),m.useEffect(()=>{!r.current&&(t!=null&&t.chapterId)&&(console.log("Calculation date changed, refetching data"),p(n.selectedMemberId))},[a]),m.useEffect(()=>{n.selectedTermId&&n.selectedMemberId&&(c(n.selectedMemberId,n.selectedTermId),j(n.selectedMemberId))},[n.selectedTermId]),m.useEffect(()=>{if(n.selectedReceiver){const u=n.receivers.find(g=>g.receiverId===n.selectedReceiver);d(g=>({...g,selectedReceiverObject:u}))}},[n.selectedReceiver]),m.useEffect(()=>{const A=setInterval(()=>{const P=new Date,k=n.lastUpdated,N=n.lastSelectedPackageTime;k&&P-k>3e5&&(n.selectedPackage&&N?P-N>6e5?(E.warn("Payment window will timeout in 10 seconds..."),setTimeout(()=>{E.warn("Payment window has timed out. Refreshing data now..."),o(),p(n.selectedMemberId)},1e4)):E.info("Data will be refreshed soon due to inactivity"):(E.info("Data is stale. Refreshing now..."),p(n.selectedMemberId)))},6e4);return()=>clearInterval(A)},[n.lastUpdated,n.lastSelectedPackageTime,n.selectedPackage,n.selectedMemberId]),console.log({mainData:n.packageData}),e.jsx(Ie.Provider,{value:{calculationDate:a,setCalculationDate:s,paymentData:n,setPaymentData:d,resetPaymentData:o,selectPackage:b,fetchAllData:p,handleDeletePendingRequest:f,setSelectedTermId:u=>d(g=>({...g,selectedTermId:u})),fetchCurrentReceivers:h,fetchTerms:v,fetchMeetings:c,fetchDueAmount:j,fetchPackages:y,fetchPendingPayments:I},children:l})},q=()=>{const l=m.useContext(Ie);if(!l)throw new Error("usePaymentData must be used within a PaymentDataProvider");return l},Dt=({setStep:l,handlePackagePayModalClose:t})=>{const{paymentData:a,setPaymentData:s}=q(),[r,i]=m.useState(!1),[n,d]=m.useState(""),o=()=>{a.paymentMethod?a.selectedReceiver?a.receivers.filter(h=>h.receiverId===a.selectedReceiver&&h.paymentType===a.paymentMethod).length===0?d("Invalid Receiver for the selected payment method"):(d(""),l(2)):d("Please select a receiver"):d("Please select a payment method")},b=h=>{const v=a.receivers.filter(c=>c.paymentType===h);return v.length===0?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center p-8 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["No ",h==="cash"?"Cash":"Online"," Receivers Available"]}),e.jsxs("p",{className:"text-gray-500 mb-4",children:["There are currently no ",h==="cash"?"cash collection":"online payment"," receivers set up for this chapter."]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Please contact your chapter admin to set up ",h==="cash"?"cash":"online"," receivers."]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[h==="cash"?e.jsx(ae,{className:"h-5 w-5 text-green-600"}):e.jsx(se,{className:"h-5 w-5 text-blue-600"}),e.jsxs("h3",{className:"text-lg font-medium",children:["Select a ",h==="cash"?"Cash":"Online"," Receiver"]})]}),e.jsx("div",{className:"grid gap-3 max-h-60 overflow-y-auto pr-2",children:v.map(c=>e.jsx(ze,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${a.selectedReceiver===c.receiverId?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300"}`,onClick:()=>{s(j=>({...j,selectedReceiver:c.receiverId})),d("")},children:e.jsx(Ye,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center ${a.selectedReceiver===c.receiverId?"bg-blue-100":"bg-gray-100"}`,children:e.jsx(at,{className:`h-4 w-4 sm:h-5 sm:w-5 ${a.selectedReceiver===c.receiverId?"text-blue-600":"text-gray-600"}`})})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:c.receiverName})})]}),a.selectedReceiver===c.receiverId&&e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]})})},c.receiverId))}),n&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx(te,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:n})]})]})};return m.useEffect(()=>{const h=a.receivers.filter(c=>c.paymentType==="cash"),v=a.receivers.filter(c=>c.paymentType==="online");h.length>0&&v.length>0?(s(c=>({...c,paymentMethod:c.paymentMethod||"cash"})),i(!0)):h.length>0?(s(c=>({...c,paymentMethod:"cash"})),i(!1)):(v.length>0&&s(c=>({...c,paymentMethod:"online"})),i(!1))},[a.receivers]),e.jsxs("div",{className:"flex flex-col h-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 pb-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:r?"Select Payment Method":"Payment Method"}),a.receivers.length===0&&e.jsx("p",{className:"text-gray-600 text-sm",children:"Choose how you'd like to make your payment"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto py-4 space-y-6 min-h-0",children:a.receivers.length===0?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center p-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(te,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-3",children:"No Payment Receivers Available"}),e.jsx("p",{className:"text-gray-600 mb-4 leading-relaxed",children:"There are currently no payment receivers set up for this chapter. Payment receivers are required to process your fee payment."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-blue-800 text-sm font-medium mb-2",children:"What you can do:"}),e.jsxs("ul",{className:"text-blue-700 text-sm space-y-1 text-left",children:[e.jsx("li",{children:"• Contact your chapter administrator"}),e.jsx("li",{children:"• Ask them to set up cash or online receivers"}),e.jsx("li",{children:"• Try again once receivers are configured"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Chapter admins can set up receivers in the Fee Receiver management section"})]})})}):e.jsxs(Ze,{value:a.paymentMethod,className:"w-full",onValueChange:h=>{s(v=>({...v,paymentMethod:h,selectedReceiver:""})),d("")},children:[r?e.jsxs(et,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(ue,{value:"cash",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Cash"]}),e.jsxs(ue,{value:"online",className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Online"]})]}):e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.paymentMethod==="cash"?e.jsx(ae,{className:"h-5 w-5 text-blue-600"}):e.jsx(se,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:a.paymentMethod==="cash"?"Cash Payment":"Online Payment"}),e.jsx(tt,{variant:"secondary",className:"ml-auto",children:"Only Available Method"})]})}),e.jsx(pe,{value:"cash",className:"mt-0",children:b("cash")}),e.jsx(pe,{value:"online",className:"mt-0",children:b("online")})]})}),e.jsx("div",{className:"flex-shrink-0 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{variant:"outline",onClick:()=>t(),children:"Cancel"}),a.receivers.length>0&&e.jsxs(U,{onClick:o,disabled:!a.selectedReceiver,children:["Next",e.jsx(ve,{className:"h-4 w-4 ml-1"})]})]})})]})};class S{constructor(t,a,s,r,i){this._legacyCanvasSize=S.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=t,this.$canvas=document.createElement("canvas"),s&&typeof s=="object"?this._onDecode=a:(console.warn(s||r||i?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=a),a=typeof s=="object"?s:{},this._onDecodeError=a.onDecodeError||(typeof s=="function"?s:this._onDecodeError),this._calculateScanRegion=a.calculateScanRegion||(typeof r=="function"?r:this._calculateScanRegion),this._preferredCamera=a.preferredCamera||i||this._preferredCamera,this._legacyCanvasSize=typeof s=="number"?s:typeof r=="number"?r:this._legacyCanvasSize,this._maxScansPerSecond=a.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),t.disablePictureInPicture=!0,t.playsInline=!0,t.muted=!0;let n=!1;if(t.hidden&&(t.hidden=!1,n=!0),document.body.contains(t)||(document.body.appendChild(t),n=!0),s=t.parentElement,a.highlightScanRegion||a.highlightCodeOutline){if(r=!!a.overlay,this.$overlay=a.overlay||document.createElement("div"),i=this.$overlay.style,i.position="absolute",i.display="none",i.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!r&&a.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}s.insertBefore(this.$overlay,this.$video.nextSibling)}a.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(t),requestAnimationFrame(()=>{let d=window.getComputedStyle(t);d.display==="none"&&(t.style.setProperty("display","block","important"),n=!0),d.visibility!=="visible"&&(t.style.setProperty("visibility","visible","important"),n=!0),n&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),t.style.opacity="0",t.style.width="0",t.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),t.addEventListener("play",this._onPlay),t.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=S.createQrEngine()}static set WORKER_PATH(t){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await S.listCameras(!1)).length}catch{return!1}}static async listCameras(t=!1){if(!navigator.mediaDevices)return[];let a=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput"),s;try{t&&(await a()).every(r=>!r.label)&&(s=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await a()).map((r,i)=>({id:r.deviceId,label:r.label||(i===0?"Default Camera":`Camera ${i+1}`)}))}finally{s&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),S._stopVideoStream(s))}}async hasFlash(){let t;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;t=this.$video.srcObject}else t=(await this._getCameraStream()).stream;return"torch"in t.getVideoTracks()[0].getSettings()}catch{return!1}finally{t&&t!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),S._stopVideoStream(t))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(t){throw this._flashOn=!1,t}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),S._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:t,facingMode:a}=await this._getCameraStream();!this._active||this._paused?S._stopVideoStream(t):(this._setVideoMirror(a),this.$video.srcObject=t,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(t){if(!this._paused)throw this._active=!1,t}}stop(){this.pause(),this._active=!1}async pause(t=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let a=()=>{this.$video.srcObject instanceof MediaStream&&(S._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return t?(a(),!0):(await new Promise(s=>setTimeout(s,300)),this._paused?(a(),!0):!1)}async setCamera(t){t!==this._preferredCamera&&(this._preferredCamera=t,await this._restartVideoStream())}static async scanImage(t,a,s,r,i=!1,n=!1){let d,o=!1;a&&("scanRegion"in a||"qrEngine"in a||"canvas"in a||"disallowCanvasResizing"in a||"alsoTryWithoutScanRegion"in a||"returnDetailedScanResult"in a)?(d=a.scanRegion,s=a.qrEngine,r=a.canvas,i=a.disallowCanvasResizing||!1,n=a.alsoTryWithoutScanRegion||!1,o=!0):console.warn(a||s||r||i||n?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),a=!!s;try{let b,h;[s,b]=await Promise.all([s||S.createQrEngine(),S._loadImage(t)]),[r,h]=S._drawToCanvas(b,d,r,i);let v;if(s instanceof Worker){let c=s;a||S._postWorkerMessageSync(c,"inversionMode","both"),v=await new Promise((j,y)=>{let x,I,f,p=-1;I=g=>{g.data.id===p&&(c.removeEventListener("message",I),c.removeEventListener("error",f),clearTimeout(x),g.data.data!==null?j({data:g.data.data,cornerPoints:S._convertPoints(g.data.cornerPoints,d)}):y(S.NO_QR_CODE_FOUND))},f=g=>{c.removeEventListener("message",I),c.removeEventListener("error",f),clearTimeout(x),y("Scanner error: "+(g?g.message||g:"Unknown Error"))},c.addEventListener("message",I),c.addEventListener("error",f),x=setTimeout(()=>f("timeout"),1e4);let u=h.getImageData(0,0,r.width,r.height);p=S._postWorkerMessageSync(c,"decode",u,[u.data.buffer])})}else v=await Promise.race([new Promise((c,j)=>window.setTimeout(()=>j("Scanner error: timeout"),1e4)),(async()=>{try{var[c]=await s.detect(r);if(!c)throw S.NO_QR_CODE_FOUND;return{data:c.rawValue,cornerPoints:S._convertPoints(c.cornerPoints,d)}}catch(j){if(c=j.message||j,/not implemented|service unavailable/.test(c))return S._disableBarcodeDetector=!0,S.scanImage(t,{scanRegion:d,canvas:r,disallowCanvasResizing:i,alsoTryWithoutScanRegion:n});throw`Scanner error: ${c}`}})()]);return o?v:v.data}catch(b){if(!d||!n)throw b;let h=await S.scanImage(t,{qrEngine:s,canvas:r,disallowCanvasResizing:i});return o?h:h.data}finally{a||S._postWorkerMessage(s,"close")}}setGrayscaleWeights(t,a,s,r=!0){S._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:t,green:a,blue:s,useIntegerApproximation:r})}setInversionMode(t){S._postWorkerMessage(this._qrEnginePromise,"inversionMode",t)}static async createQrEngine(t){if(t&&console.warn("Specifying a worker path is not required and not supported anymore."),t=()=>Ge(()=>import("./qr-scanner-worker.min.js"),[]).then(s=>s.createWorker()),!(!S._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return t();let a=navigator.userAgentData;return a&&a.brands.some(({brand:s})=>/Chromium/i.test(s))&&/mac ?OS/i.test(a.platform)&&await a.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:s,platformVersion:r})=>/arm/i.test(s||"arm")&&13<=parseInt(r||"13")).catch(()=>!0)?t():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(t){let a=Math.round(.6666666666666666*Math.min(t.videoWidth,t.videoHeight));return{x:Math.round((t.videoWidth-a)/2),y:Math.round((t.videoHeight-a)/2),width:a,height:a,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var t=this.$video,a=t.videoWidth,s=t.videoHeight,r=t.offsetWidth,i=t.offsetHeight,n=t.offsetLeft,d=t.offsetTop,o=window.getComputedStyle(t),b=o.objectFit,h=a/s,v=r/i;switch(b){case"none":var c=a,j=s;break;case"fill":c=r,j=i;break;default:(b==="cover"?h>v:h<v)?(j=i,c=j*h):(c=r,j=c/h),b==="scale-down"&&(c=Math.min(c,a),j=Math.min(j,s))}var[y,x]=o.objectPosition.split(" ").map((f,p)=>{const u=parseFloat(f);return f.endsWith("%")?(p?i-j:r-c)*u/100:u});o=this._scanRegion.width||a,v=this._scanRegion.height||s,b=this._scanRegion.x||0;var I=this._scanRegion.y||0;h=this.$overlay.style,h.width=`${o/a*c}px`,h.height=`${v/s*j}px`,h.top=`${d+x+I/s*j}px`,s=/scaleX\(-1\)/.test(t.style.transform),h.left=`${n+(s?r-y-c:y)+(s?a-b-o:b)/a*c}px`,h.transform=t.style.transform}})}static _convertPoints(t,a){if(!a)return t;let s=a.x||0,r=a.y||0,i=a.width&&a.downScaledWidth?a.width/a.downScaledWidth:1;a=a.height&&a.downScaledHeight?a.height/a.downScaledHeight:1;for(let n of t)n.x=n.x*i+s,n.y=n.y*a+r;return t}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var t=Date.now()-this._lastScanTimestamp,a=1e3/this._maxScansPerSecond;t<a&&await new Promise(r=>setTimeout(r,a-t)),this._lastScanTimestamp=Date.now();try{var s=await S.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(r){if(!this._active)return;this._onDecodeError(r)}!S._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=S.createQrEngine()),s?(this._onDecode?this._onDecode(s):this._legacyOnDecode&&this._legacyOnDecode(s.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",s.cornerPoints.map(({x:r,y:i})=>`${r},${i}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(t){t!==S.NO_QR_CODE_FOUND&&console.log(t)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let t=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",a=[{width:{min:1024}},{width:{min:768}},{}],s=a.map(r=>Object.assign({},r,{[t]:{exact:this._preferredCamera}}));for(let r of[...s,...a])try{let i=await navigator.mediaDevices.getUserMedia({video:r,audio:!1}),n=this._getFacingMode(i)||(r.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:i,facingMode:n}}catch{}throw"Camera not found."}async _restartVideoStream(){let t=this._paused;await this.pause(!0)&&!t&&this._active&&await this.start()}static _stopVideoStream(t){for(let a of t.getTracks())a.stop(),t.removeTrack(a)}_setVideoMirror(t){this.$video.style.transform="scaleX("+(t==="user"?-1:1)+")"}_getFacingMode(t){return(t=t.getVideoTracks()[0])?/rear|back|environment/i.test(t.label)?"environment":/front|user|face/i.test(t.label)?"user":null:null}static _drawToCanvas(t,a,s,r=!1){s=s||document.createElement("canvas");let i=a&&a.x?a.x:0,n=a&&a.y?a.y:0,d=a&&a.width?a.width:t.videoWidth||t.width,o=a&&a.height?a.height:t.videoHeight||t.height;return r||(r=a&&a.downScaledWidth?a.downScaledWidth:d,a=a&&a.downScaledHeight?a.downScaledHeight:o,s.width!==r&&(s.width=r),s.height!==a&&(s.height=a)),a=s.getContext("2d",{alpha:!1}),a.imageSmoothingEnabled=!1,a.drawImage(t,i,n,d,o,0,0,s.width,s.height),[s,a]}static async _loadImage(t){if(t instanceof Image)return await S._awaitImageLoad(t),t;if(t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement||t instanceof SVGImageElement||"OffscreenCanvas"in window&&t instanceof OffscreenCanvas||"ImageBitmap"in window&&t instanceof ImageBitmap)return t;if(t instanceof File||t instanceof Blob||t instanceof URL||typeof t=="string"){let a=new Image;a.src=t instanceof File||t instanceof Blob?URL.createObjectURL(t):t.toString();try{return await S._awaitImageLoad(a),a}finally{(t instanceof File||t instanceof Blob)&&URL.revokeObjectURL(a.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(t){t.complete&&t.naturalWidth!==0||await new Promise((a,s)=>{let r=i=>{t.removeEventListener("load",r),t.removeEventListener("error",r),i instanceof ErrorEvent?s("Image load error"):a()};t.addEventListener("load",r),t.addEventListener("error",r)})}static async _postWorkerMessage(t,a,s,r){return S._postWorkerMessageSync(await t,a,s,r)}static _postWorkerMessageSync(t,a,s,r){if(!(t instanceof Worker))return-1;let i=S._workerMessageId++;return t.postMessage({id:i,type:a,data:s},r),i}}S.DEFAULT_CANVAS_SIZE=400;S.NO_QR_CODE_FOUND="No QR code found";S._disableBarcodeDetector=!1;S._workerMessageId=0;const Et=({onClose:l,onPaymentSuccess:t,setStep:a,handlePackagePayModalClose:s})=>{const{paymentData:{selectedPackage:r,chapterMeetings:i,receivers:n,selectedReceiver:d,selectedReceiverObject:o,receiverFeeAmount:b,paymentProof:h,platformFee:v,platformFeeAmount:c,platformFeeType:j},setPaymentData:y}=q(),{memberData:x,chapterData:I}=K(),[f]=m.useState(new Date().toLocaleDateString()),[p,u]=m.useState(!1),[g,A]=m.useState([]),[P,k]=m.useState(!1),[N,R]=m.useState(!0),[_,M]=m.useState(r.totalAmount),[L,H]=m.useState(0),[V,W]=m.useState(()=>(o==null?void 0:o.memberId)===(x==null?void 0:x.memberId));m.useEffect(()=>{if(r.meetingIds&&i){const w=i.filter(D=>r.meetingIds.includes(D.meetingId));A(w)}},[r.meetingIds,i]),m.useEffect(()=>{if(o)if(o.receiverAmountType==="lumpsum"&&N)y(w=>({...w,receiverFeeAmount:o.receiverAmount}));else if(o.receiverAmountType==="percentage"&&N){const w=r.totalAmount*o.receiverAmount/100;y(D=>({...D,receiverFeeAmount:w}))}else y(w=>({...w,receiverFeeAmount:0}))},[o,r,N]),m.useEffect(()=>{const w=(o==null?void 0:o.memberId)===(x==null?void 0:x.memberId);W(w),y(D=>({...D,autoApprove:w}))},[o,x,y]),m.useEffect(()=>{if(I)if(I.platformFeeCase!=="per-payment")y(w=>({...w,platformFeeAmount:0}));else if(I.platformFeeType==="Lumpsum")y(w=>({...w,platformFeeAmount:I.platformFee}));else if(I.platformFeeType==="Percentage"){const w=r.totalAmount*I.platformFee;y(D=>({...D,platformFeeAmount:w}))}else y(w=>({...w,platformFeeAmount:0}))},[I,r]);const ee=w=>{const D=w.target.files[0];D&&y(B=>({...B,paymentProof:D}))};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[1000]",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg shadow-xl relative max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 text-center mb-4",children:"Payment Overview"}),e.jsxs("div",{className:"border p-4 rounded-lg mb-4 bg-gray-50",children:[e.jsx("p",{className:"text-gray-700 font-semibold text-lg",children:"Total Payable Amount:"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-600",children:["₹",parseInt(r.totalAmount)+(parseInt(b)||0)+(parseInt(c)||0)]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsxs("p",{children:["₹",r.packageFeeAmount," (Original Amount)"]}),r.penaltyAmount>0&&e.jsxs("p",{className:"text-red-500",children:["+ ₹",r.penaltyAmount," (Penalty)"]}),r.discountAmount>0&&e.jsxs("p",{className:"text-green-500",children:["- ₹",r.discountAmount," (Discount)"]}),r.previousBalance!==0&&e.jsxs("p",{className:"text-orange-500",children:[" ",r.previousBalance>0?"-":"+"," ₹",Math.abs(r.previousBalance)," (",r.previousBalance>0?"Advance":"Previous Due",")"]}),r.paidFees>0&&e.jsxs("p",{className:"text-blue-500",children:["- ₹",r.paidFees," (Paid Previously)"]}),b>0&&e.jsxs("p",{className:"text-blue-500",children:["+ ₹",b," (Receiver Fee)"]}),c>0&&e.jsxs("p",{className:"text-blue-500",children:["+ ₹",c," (Platform Fee)"]})]})]}),o.receiverFeeOptional!==0&&(o==null?void 0:o.receiverFeeOptional)&&e.jsxs("div",{className:"flex items-center space-x-4 my-4",children:[e.jsx(ge,{checked:N,onCheckedChange:w=>R(w),className:"h-5"}),e.jsx(fe,{className:"text-lg",children:(o==null?void 0:o.receiverFeeOptionalMessage)||"Would you like to pay the receiver fee? (charges applicable)"})," "]}),(o==null?void 0:o.memberId)===(x==null?void 0:x.memberId)&&e.jsxs("div",{className:"flex items-center space-x-4 my-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(ge,{checked:V,onCheckedChange:w=>{W(w),y(D=>({...D,autoApprove:w}))},className:"h-5"}),e.jsxs("div",{children:[e.jsx(fe,{className:"text-lg font-medium text-blue-800",children:"Auto Approve Payment"}),e.jsx("p",{className:"text-sm text-blue-600",children:"(Payment will be automatically approved since you are the receiver)"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 font-semibold",children:"Meetings Included:"}),e.jsxs("button",{onClick:()=>u(!p),className:"flex items-center text-lg font-medium text-blue-500 hover:underline focus:outline-none",children:[g.length," Meetings",p?e.jsx(rt,{className:"ml-2",size:18}):e.jsx(ye,{className:"ml-2",size:18})]}),p&&e.jsx("div",{className:"mt-2 max-h-[200px] overflow-y-auto",children:g.length>0?g==null?void 0:g.map(w=>e.jsxs("div",{className:`border p-2 rounded mb-2 ${w.isPaid?"bg-green-100":""}`,children:[e.jsx("p",{children:e.jsx("strong",{children:w.meetingName})}),e.jsxs("p",{children:[z(w.meetingDate)," at"," ",w.meetingTime]}),w.isPaid&&e.jsx("p",{className:"text-green-500 font-semibold",children:"Paid"})]},w.meetingId)):e.jsx("p",{children:"No meetings found"})})]}),e.jsxs("div",{children:["You are paying to ",o==null?void 0:o.receiverName,".",e.jsx("p",{className:"text-blue-500 cursor-pointer",onClick:()=>a(1),children:"Click here to change receiver."})]}),o&&o.qrImageLink&&e.jsxs("div",{className:"mt-4",children:[e.jsx(Mt,{imageUrl:o.qrImageLink}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx(U,{variant:"outline",onClick:()=>{E.warn("This feature may not work on all browsers. If it doesn't work, please download the QR Code and scan it using a QR Code scanner app."),fetch(o.qrImageLink).then(w=>w.blob()).then(w=>{const D=URL.createObjectURL(w),B=new Image;B.crossOrigin="Anonymous",B.src=D,B.onload=async()=>{try{const C=await S.scanImage(B);URL.revokeObjectURL(D),C.indexOf("://")||C.startsWith("http://")||C.startsWith("https://")?window.open(C,"_blank"):E.error("QR Code does not contain a valid link.")}catch(C){console.error("QR decoding failed:",C),E.error("Failed to decode QR Code.")}}}).catch(w=>{E.error("Error fetching QR Code image"),console.error(w)})},children:"Open QR Link"}),e.jsx(U,{variant:"outline",onClick:()=>{fetch(o.qrImageLink).then(w=>w.blob()).then(w=>{const D=document.createElement("a");D.href=URL.createObjectURL(w);const B=`QR_Code_${o.receiverName}.png`;D.download=B,D.click(),URL.revokeObjectURL(D.href)}).catch(w=>{E.error("Error downloading QR Code"),console.error(w)})},children:"Download QR Code"})]}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Upload Payment Proof:"}),e.jsxs("label",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 p-4 rounded-lg cursor-pointer hover:bg-gray-100 transition",children:[e.jsx(dt,{className:"text-gray-500",size:24}),e.jsx("span",{className:"text-gray-600 mt-2 text-sm",children:"Click to select or drag and drop an image here"}),e.jsx("input",{type:"file",name:"file",accept:"image/*",onChange:ee,className:"hidden"})]}),h&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Uploaded: ",h.name]})]}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsxs(U,{variant:"outline",onClick:()=>a(1),children:[e.jsx(be,{}),"Back"]}),e.jsxs(U,{onClick:()=>{y(w=>({...w,totalPayableAmount:(parseInt(r.totalAmount)||0)+(parseInt(b)||0)+(parseInt(c)||0),autoApprove:V})),a(3)},children:["Next",e.jsx(ve,{})]})]})]})})},Mt=({imageUrl:l})=>{const[t,a]=m.useState(!0);return e.jsxs("div",{className:"relative",children:[t&&e.jsx(st,{className:"w-full h-32 rounded-lg"})," ",e.jsx("img",{src:l,alt:"QR Code",className:`mb-2 rounded-lg ${t?"hidden":"block"}`,onLoad:()=>a(!1)})]})},Tt=({setStep:l,handlePackagePayModalClose:t})=>{const{paymentData:{selectedPackage:a,chapterMeetings:s,receivers:r,selectedReceiver:i,paymentProof:n,paymentDate:d,selectedReceiverObject:o,receiverFeeAmount:b,platformFeeAmount:h,totalPayableAmount:v,selectedMemberId:c,autoApprove:j},fetchAllData:y}=q(),{chapterData:x}=K(),[I,f]=m.useState(v),p=I-v,[u,g]=m.useState(!1),[A,P]=m.useState(!1),k=async()=>{P(!0);let N="";if(n){const _=new FormData;_.append("image",n),_.append("folderName","memberPaymentProofs"),N=await T.post("/api/image-upload",_,{headers:{"Content-Type":"multipart/form-data"}}).then(M=>M.data.imageUrl)}const R={memberId:c,packageId:a.packageId,meetingIds:a.meetingIds,chapterId:x.chapterId,transactionType:"Package Payment",paidAmount:I,payableAmount:v,originalPayableAmount:parseFloat(a.packageFeeAmount),discountAmount:a.discountAmount,penaltyAmount:a.penaltyAmount,receiverFee:b,amountPaidToChapter:(parseFloat(I)||0)-(parseFloat(h)||0)-(parseFloat(b)||0),amountExpectedToChapter:a.totalAmount,platformFee:h,balanceAmount:p,paymentType:o==null?void 0:o.paymentType,paymentDate:d,paymentImageLink:N,paymentReceivedById:(o==null?void 0:o.memberId)||"",paymentReceivedByName:(o==null?void 0:o.receiverName)||"",autoApprove:j||!1};await T.post("/api/payment/addPayment",R).then(_=>{y(),t(),E.success("Payment submitted successfully")}).catch(_=>{console.error("Error submitting payment:",_),P(!1)}).finally(()=>{P(!1)})};return e.jsxs("div",{className:"p-6 max-w-md mx-auto bg-white rounded-xl shadow-md space-y-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Total Payable Amount: ₹",v]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:"Enter Amount to Pay:"}),e.jsx("input",{type:"number",value:I,onChange:N=>{let R=Number(N.target.value);R<0&&(R=0),f(R)},className:"w-full p-2 border border-gray-300 rounded text-center"})]}),I===v?e.jsx("h3",{className:"text-xl font-semibold text-green-700",children:"You have paid the exact amount"}):I<v?e.jsxs("h3",{className:"text-xl font-semibold text-red-700",children:["You will be due by ₹",Math.abs(p)]}):e.jsxs("h3",{className:"text-xl font-semibold text-green-700",children:["You will pay advance of ₹",Math.abs(p)]}),e.jsxs("h5",{className:"text-sm font-semibold text-gray-700",children:["Amount will be received by: ",o==null?void 0:o.receiverName]}),e.jsxs(mt,{open:u,onOpenChange:g,children:[e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsxs(U,{variant:"outline",onClick:()=>l(2),children:[e.jsx(be,{}),"Back"]}),e.jsx(U,{onClick:()=>g(!0),children:"Confirm"})]}),e.jsxs(ht,{children:[e.jsxs(ut,{children:[e.jsx(pt,{children:"Confirm Payment"}),e.jsxs(gt,{children:["Are you sure you want to confirm payment of ₹",I,"?",I>v&&e.jsxs("div",{className:"mt-2 text-green-700 font-semibold",children:["(You are paying ₹",Math.abs(p)," advance)"]}),I<v&&e.jsxs("div",{className:"mt-2 text-red-700 font-semibold",children:["(You will be due by ₹",Math.abs(p),")"]})]})]}),e.jsxs(ft,{children:[e.jsx(xt,{disabled:A,children:"Cancel"}),e.jsxs(vt,{onClick:k,disabled:A,className:"flex items-center justify-center",children:[A&&e.jsx(Ke,{className:"mr-2 h-4 w-4 animate-spin"}),A?"Processing...":"Confirm"]})]})]})]})]})},$t=({selectedPackage:l,pendingPayments:t,packageData:a,paymentSuccessHandler:s,parentType:r,chapterMeetings:i,handlePackagePayModalClose:n})=>{const{receivers:d}=q(),[o,b]=m.useState(1),[h,v]=m.useState(null),c=()=>{n()};return e.jsxs("div",{children:[o===1&&e.jsx(Dt,{selectedReceiver:h,setSelectedReceiver:v,packageData:a,setStep:b,handlePackagePayModalClose:n}),o===2&&e.jsx(Et,{selectedPackage:l,pendingPayments:t,packageData:a,paymentSuccessHandler:s,parentType:r,chapterMeetings:i,receivers:d,setStep:b,handlePackagePayModalClose:c}),o===3&&e.jsx(Tt,{setStep:b,handlePackagePayModalClose:c})]})},Ot=({pendingPayments:l,parentType:t,paymentSuccessHandler:a})=>{const{paymentData:{receivers:s,chapterMeetings:r,packageParents:i,selectedPackage:n,packageData:d},resetPaymentData:o,setPaymentData:b}=q(),[h,v]=m.useState(!1),[c,j]=m.useState(!0),y=()=>{o(),j(!1)};m.useEffect(()=>{j(!!n)},[n]);const x=f=>{j(!0),b(p=>({...p,selectedPackage:f,lastSelectedPackageTime:new Date}))},I=d.filter(f=>f.packageParent===t).filter(f=>!h||!f.isPaid).sort((f,p)=>f.isDisabled!==p.isDisabled?f.isDisabled-p.isDisabled:0);return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center p-4 hidden",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:()=>v(!h),className:"form-checkbox"}),e.jsx("span",{children:"Show Unpaid Only"})]})})}),e.jsx(Y,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-4",children:I.map(f=>e.jsxs("div",{className:`bg-white shadow-md rounded-lg p-6 border border-gray-200 hover:shadow-lg ${f.isDisabled?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:f.packageName}),!f.isDisabled&&f.totalAmount!==null&&f.status!=="approved"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-700 mb-1",children:[`₹${f.packageFeeAmount}`,f.penaltyAmount>0&&e.jsxs("span",{className:"text-red-500",children:[" ","+ ₹",f.penaltyAmount]}),f.discountAmount>0&&e.jsxs("span",{className:"text-green-500",children:[" ","- ₹",f.discountAmount]}),f.previousBalance!==0&&e.jsxs("span",{className:"text-orange-500",children:[" ",f.previousBalance>0?"-":"+"," ₹",Math.abs(f.previousBalance)," (",f.previousBalance>0?"Advance":"Previous Due",")"]}),"= ₹",f.totalAmount]}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Payable End Date:"," ",z(f.packagePayableEndDate)]}),e.jsx(Ct,{className:"mt-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700",variant:"contained",onClick:()=>x(f),disabled:f.isDisabled||(l==null?void 0:l.length)>0,children:"Pay Now"})]}):f.status==="approved"?e.jsx(e.Fragment,{children:e.jsxs("div",{children:["You have paid ₹",f.paidAmount," for this package on"," ",new Date(f.paymentDate).toLocaleDateString()," to"," ",e.jsx("b",{children:f.paymentReceivedByName})," by"," ",e.jsx("b",{children:f.paymentType})]})}):e.jsx("p",{className:"text-gray-700 mb-1",children:f.message||"Payment Not Allowed"})]},f.packageId))}),n&&s&&e.jsxs(yt,{open:c,onOpenChange:y,children:[e.jsx(bt,{}),e.jsx(wt,{className:"sm:max-w-[425px] p-4 max-w-[90%] rounded-lg",children:e.jsx($t,{selectedPackage:n,pendingPayments:l,packageData:d,paymentSuccessHandler:a,parentType:t,chapterMeetings:r,receivers:s,handlePackagePayModalClose:y})})]})]})};var J="Collapsible",[Ft,Ae]=we(J),[Lt,oe]=Ft(J),Pe=m.forwardRef((l,t)=>{const{__scopeCollapsible:a,open:s,defaultOpen:r,disabled:i,onOpenChange:n,...d}=l,[o,b]=ie({prop:s,defaultProp:r??!1,onChange:n,caller:J});return e.jsx(Lt,{scope:a,disabled:i,contentId:je(),open:o,onOpenToggle:m.useCallback(()=>b(h=>!h),[b]),children:e.jsx(Q.div,{"data-state":ce(o),"data-disabled":i?"":void 0,...d,ref:t})})});Pe.displayName=J;var Se="CollapsibleTrigger",_e=m.forwardRef((l,t)=>{const{__scopeCollapsible:a,...s}=l,r=oe(Se,a);return e.jsx(Q.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":ce(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...s,ref:t,onClick:Ne(l.onClick,r.onOpenToggle)})});_e.displayName=Se;var le="CollapsibleContent",ke=m.forwardRef((l,t)=>{const{forceMount:a,...s}=l,r=oe(le,l.__scopeCollapsible);return e.jsx(St,{present:a||r.open,children:({present:i})=>e.jsx(Vt,{...s,ref:t,present:i})})});ke.displayName=le;var Vt=m.forwardRef((l,t)=>{const{__scopeCollapsible:a,present:s,children:r,...i}=l,n=oe(le,a),[d,o]=m.useState(s),b=m.useRef(null),h=xe(t,b),v=m.useRef(0),c=v.current,j=m.useRef(0),y=j.current,x=n.open||d,I=m.useRef(x),f=m.useRef(void 0);return m.useEffect(()=>{const p=requestAnimationFrame(()=>I.current=!1);return()=>cancelAnimationFrame(p)},[]),At(()=>{const p=b.current;if(p){f.current=f.current||{transitionDuration:p.style.transitionDuration,animationName:p.style.animationName},p.style.transitionDuration="0s",p.style.animationName="none";const u=p.getBoundingClientRect();v.current=u.height,j.current=u.width,I.current||(p.style.transitionDuration=f.current.transitionDuration,p.style.animationName=f.current.animationName),o(s)}},[n.open,s]),e.jsx(Q.div,{"data-state":ce(n.open),"data-disabled":n.disabled?"":void 0,id:n.contentId,hidden:!x,...i,ref:h,style:{"--radix-collapsible-content-height":c?`${c}px`:void 0,"--radix-collapsible-content-width":y?`${y}px`:void 0,...l.style},children:x&&r})});function ce(l){return l?"open":"closed"}var Bt=Pe,Ut=_e,Ht=ke,F="Accordion",Wt=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[de,qt,Qt]=Pt(F),[X]=we(F,[Qt,Ae]),me=Ae(),Re=$.forwardRef((l,t)=>{const{type:a,...s}=l,r=s,i=s;return e.jsx(de.Provider,{scope:l.__scopeAccordion,children:a==="multiple"?e.jsx(Kt,{...i,ref:t}):e.jsx(Gt,{...r,ref:t})})});Re.displayName=F;var[De,zt]=X(F),[Ee,Yt]=X(F,{collapsible:!1}),Gt=$.forwardRef((l,t)=>{const{value:a,defaultValue:s,onValueChange:r=()=>{},collapsible:i=!1,...n}=l,[d,o]=ie({prop:a,defaultProp:s??"",onChange:r,caller:F});return e.jsx(De,{scope:l.__scopeAccordion,value:$.useMemo(()=>d?[d]:[],[d]),onItemOpen:o,onItemClose:$.useCallback(()=>i&&o(""),[i,o]),children:e.jsx(Ee,{scope:l.__scopeAccordion,collapsible:i,children:e.jsx(Me,{...n,ref:t})})})}),Kt=$.forwardRef((l,t)=>{const{value:a,defaultValue:s,onValueChange:r=()=>{},...i}=l,[n,d]=ie({prop:a,defaultProp:s??[],onChange:r,caller:F}),o=$.useCallback(h=>d((v=[])=>[...v,h]),[d]),b=$.useCallback(h=>d((v=[])=>v.filter(c=>c!==h)),[d]);return e.jsx(De,{scope:l.__scopeAccordion,value:n,onItemOpen:o,onItemClose:b,children:e.jsx(Ee,{scope:l.__scopeAccordion,collapsible:!0,children:e.jsx(Me,{...i,ref:t})})})}),[Jt,Z]=X(F),Me=$.forwardRef((l,t)=>{const{__scopeAccordion:a,disabled:s,dir:r,orientation:i="vertical",...n}=l,d=$.useRef(null),o=xe(d,t),b=qt(a),v=_t(r)==="ltr",c=Ne(l.onKeyDown,j=>{var N;if(!Wt.includes(j.key))return;const y=j.target,x=b().filter(R=>{var _;return!((_=R.ref.current)!=null&&_.disabled)}),I=x.findIndex(R=>R.ref.current===y),f=x.length;if(I===-1)return;j.preventDefault();let p=I;const u=0,g=f-1,A=()=>{p=I+1,p>g&&(p=u)},P=()=>{p=I-1,p<u&&(p=g)};switch(j.key){case"Home":p=u;break;case"End":p=g;break;case"ArrowRight":i==="horizontal"&&(v?A():P());break;case"ArrowDown":i==="vertical"&&A();break;case"ArrowLeft":i==="horizontal"&&(v?P():A());break;case"ArrowUp":i==="vertical"&&P();break}const k=p%f;(N=x[k].ref.current)==null||N.focus()});return e.jsx(Jt,{scope:a,disabled:s,direction:r,orientation:i,children:e.jsx(de.Slot,{scope:a,children:e.jsx(Q.div,{...n,"data-orientation":i,ref:o,onKeyDown:s?void 0:c})})})}),G="AccordionItem",[Xt,he]=X(G),Te=$.forwardRef((l,t)=>{const{__scopeAccordion:a,value:s,...r}=l,i=Z(G,a),n=zt(G,a),d=me(a),o=je(),b=s&&n.value.includes(s)||!1,h=i.disabled||l.disabled;return e.jsx(Xt,{scope:a,open:b,disabled:h,triggerId:o,children:e.jsx(Bt,{"data-orientation":i.orientation,"data-state":Be(b),...d,...r,ref:t,disabled:h,open:b,onOpenChange:v=>{v?n.onItemOpen(s):n.onItemClose(s)}})})});Te.displayName=G;var $e="AccordionHeader",Oe=$.forwardRef((l,t)=>{const{__scopeAccordion:a,...s}=l,r=Z(F,a),i=he($e,a);return e.jsx(Q.h3,{"data-orientation":r.orientation,"data-state":Be(i.open),"data-disabled":i.disabled?"":void 0,...s,ref:t})});Oe.displayName=$e;var re="AccordionTrigger",Fe=$.forwardRef((l,t)=>{const{__scopeAccordion:a,...s}=l,r=Z(F,a),i=he(re,a),n=Yt(re,a),d=me(a);return e.jsx(de.ItemSlot,{scope:a,children:e.jsx(Ut,{"aria-disabled":i.open&&!n.collapsible||void 0,"data-orientation":r.orientation,id:i.triggerId,...d,...s,ref:t})})});Fe.displayName=re;var Le="AccordionContent",Ve=$.forwardRef((l,t)=>{const{__scopeAccordion:a,...s}=l,r=Z(F,a),i=he(Le,a),n=me(a);return e.jsx(Ht,{role:"region","aria-labelledby":i.triggerId,"data-orientation":r.orientation,...n,...s,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...l.style}})});Ve.displayName=Le;function Be(l){return l?"open":"closed"}var Zt=Re,ea=Te,ta=Oe,Ue=Fe,He=Ve;const aa=Zt,We=m.forwardRef(({className:l,...t},a)=>e.jsx(ea,{ref:a,className:ne("border-b",l),...t}));We.displayName="AccordionItem";const qe=m.forwardRef(({className:l,children:t,...a},s)=>e.jsx(ta,{className:"flex",children:e.jsxs(Ue,{ref:s,className:ne("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",l),...a,children:[t,e.jsx(ye,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));qe.displayName=Ue.displayName;const Qe=m.forwardRef(({className:l,children:t,...a},s)=>e.jsx(He,{ref:s,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:e.jsx("div",{className:ne("pb-4 pt-0",l),children:t})}));Qe.displayName=He.displayName;const sa=({pendingPayments:l,handleDeletePendingRequest:t,fetchAllData:a})=>l.length===0?null:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-yellow-100 rounded-md",children:[e.jsxs("p",{className:"text-base font-medium text-yellow-800 dark:text-yellow-200",children:["You have ",e.jsx("strong",{children:"pending payments"}),". Please contact admin to approve requests to continue."]}),e.jsx("button",{className:"px-4 py-2 text-sm font-semibold text-yellow-800 bg-yellow-300 rounded-md hover:bg-yellow-400 dark:text-yellow-200 dark:bg-yellow-400 transition-colors",onClick:a,children:"Refresh"})]}),e.jsx("div",{className:"mt-4 space-y-4",children:l.map(s=>{var r,i,n,d;return e.jsxs("div",{className:"p-4 sm:p-6 border border-yellow-300 rounded-lg bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl sm:text-2xl font-semibold text-yellow-900 dark:text-yellow-100 mb-1",children:s.packageName}),e.jsxs("p",{className:"text-base text-yellow-700 dark:text-yellow-300",children:[s.packageFeeType," • ",new Date(s.paymentDate).toLocaleDateString()]})]}),e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200 self-start sm:self-center",children:s.status.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[s.paidAmount===s.payableAmount?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Amount:"}),e.jsxs("span",{className:"text-lg font-semibold text-blue-700 dark:text-blue-400",children:["₹",(r=s.paidAmount)==null?void 0:r.toLocaleString()]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Paid:"}),e.jsxs("span",{className:"text-lg font-semibold text-green-700 dark:text-green-400",children:["₹",(i=s.paidAmount)==null?void 0:i.toLocaleString()]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Original Amount:"}),e.jsxs("span",{className:"text-lg font-semibold text-blue-700 dark:text-blue-400",children:["₹",(n=s.payableAmount)==null?void 0:n.toLocaleString()]})]})]}),s.balanceAmount!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Balance:"}),e.jsxs("span",{className:`text-lg font-semibold ${s.balanceAmount<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:["₹",(d=Math.abs(s.balanceAmount))==null?void 0:d.toLocaleString(),s.balanceAmount<0?" Due":" Advance"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center pt-4 border-t border-yellow-200 gap-3",children:[e.jsxs("div",{className:"text-base text-yellow-700 dark:text-yellow-300",children:[e.jsx("span",{className:"capitalize font-medium",children:s.paymentType}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:s.paymentReceivedByName||"Unknown"})]}),e.jsx("button",{className:"px-4 py-2 text-base font-medium text-red-700 bg-red-100 border border-red-300 rounded-md hover:bg-red-200 dark:bg-red-900/30 dark:text-red-200 dark:border-red-600 transition-colors self-start sm:self-center",onClick:()=>t(s.transactionId),children:"Delete Request"})]})]},s.transactionId)})})]}),ra=()=>{const{paymentData:{receivers:l,chapterMeetings:t,balance:a,packageParents:s,packageData:r,pendingPayments:i,terms:n,selectedTermId:d},calculationDate:o,setCalculationDate:b,setPaymentData:h,fetchAllData:v,handleDeletePendingRequest:c,setSelectedTermId:j}=q(),{chapterData:y,memberData:x}=K(),[I,f]=$.useState(0),[p,u]=m.useState({value:x==null?void 0:x.memberId,label:`${x==null?void 0:x.firstName} ${x==null?void 0:x.lastName}`}),[g,A]=m.useState([]),[P,k]=m.useState([]),[N,R]=m.useState(!1),[_,M]=m.useState(!1),[L,H]=m.useState(!1),[V,W]=m.useState(()=>{try{return localStorage.getItem("packageViewer-additionalSettings-accordion")||""}catch(C){return console.warn("localStorage not available:",C),""}});m.useEffect(()=>{x!=null&&x.memberId&&!p.value&&u({value:x==null?void 0:x.memberId,label:`${x==null?void 0:x.firstName} ${x==null?void 0:x.lastName}`})},[x]);const ee=()=>{v(p.value)},w=(C,O)=>{f(O)},D=async()=>{try{const C=await T.get("/api/member/all",{params:{chapterId:y==null?void 0:y.chapterId}});k(C.data),A(C.data)}catch{toast.error("Error fetching members")}};m.useEffect(()=>{y!=null&&y.chapterId&&_&&D()},[y,_]),m.useEffect(()=>{p&&(v(p.value),h(C=>({...C,selectedMemberId:p.value,selectedMemberName:p.label})))},[p]),m.useEffect(()=>{y!=null&&y.chapterId&&(T.get(`/api/rights/anyMemberMaketransaction/${y.chapterId}`).then(C=>{M(C.data.allowed)}).catch(C=>{console.error("Error fetching member transaction rights:",C)}),T.get(`/api/rights/changeDate/${y.chapterId}`).then(C=>{H(C.data.allowed)}).catch(C=>{console.error("Error fetching change date rights:",C)}))},[y]);const B=C=>{W(C);try{localStorage.setItem("packageViewer-additionalSettings-accordion",C)}catch(O){console.warn("localStorage write failed:",O)}};return e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-3 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:[e.jsx(sa,{pendingPayments:i,handleDeletePendingRequest:c,fetchAllData:()=>v(p.value)}),e.jsxs("div",{className:"flex justify-between items-start flex-wrap",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 text-nowrap",children:"Current Date:"}),e.jsx("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 text-nowrap",children:e.jsx(ia,{})})]}),(L||_)&&e.jsx(aa,{type:"single",collapsible:!0,value:V,onValueChange:B,children:e.jsxs(We,{value:"item-1",children:[e.jsx(qe,{children:"Additional Settings"}),e.jsxs(Qe,{children:[L&&e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(It,{type:"date",value:o.toISOString().split("T")[0],onChange:C=>{const O=new Date(C.target.value);b(O),Ce(O,r,t,h)},placeholder:"Calculation Date"})}),_&&e.jsx("div",{className:"flex items-center space-x-4 mt-4",children:e.jsx(Xe,{members:P,selectedMember:p,setSelectedMember:u})})]})]})}),n&&n.filter(C=>C.status==="active").length>1&&e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsx("label",{className:"text-md font-semibold",children:"Select Active Term:"}),e.jsxs(nt,{value:d||"",onValueChange:C=>{j(C),v(p==null?void 0:p.value)},children:[e.jsx(it,{className:"w-[200px]",children:e.jsx(ot,{placeholder:"Select term"})}),e.jsx(lt,{children:n.filter(C=>C.status==="active").map(C=>e.jsx(ct,{value:C.termId,children:C.termName},C.termId))})]})]})]}),!!a&&e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center space-x-2 text-nowrap",children:[e.jsxs("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:[a>0?"Advance Amount":"Due Amount",":"]}),e.jsxs("p",{className:`text-lg font-semibold ${a>0?"text-green-500":"text-red-500"}`,children:["₹",Math.abs(a)]})]})})]}),e.jsxs(Y,{sx:{width:"100%"},children:[e.jsx(Y,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsx(jt,{value:I,onChange:w,"aria-label":"fee tabs",children:s==null?void 0:s.map((C,O)=>e.jsx(Nt,{label:C},O))})}),l&&(s==null?void 0:s.map((C,O)=>e.jsx(na,{value:I,index:O,children:e.jsx(Ot,{pendingPayments:i,packageData:r,paymentSuccessHandler:ee,parentType:C,receivers:l})},O)))]})]})};function na(l){const{children:t,value:a,index:s,...r}=l;return e.jsx("div",{role:"tabpanel",hidden:a!==s,id:`simple-tabpanel-${s}`,"aria-labelledby":`simple-tab-${s}`,...r,children:a===s&&e.jsx(Y,{sx:{p:3},children:t})})}const ia=()=>{const[l,t]=m.useState(new Date);return m.useEffect(()=>{const a=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(a)},[]),e.jsxs("span",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:[l.getDate(),"-",l.getMonth()+1,"-",l.getFullYear()," ",l.getHours(),":",l.getMinutes().toString().padStart(2,"0"),":",l.getSeconds().toString().padStart(2,"0")]})},Qa=()=>e.jsxs(e.Fragment,{children:[e.jsx(Je,{items:[{name:"Packages",link:"/member/packages"}]}),e.jsx(Rt,{children:e.jsx(ra,{})})]});export{Qa as default};
