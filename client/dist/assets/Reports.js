import{j as e,B as ne,u as Xe,a as Ue,r as p,k as Oe,c as oe,Q as ye,F as Ce,d as tt,C as $e,f as ze,i as Ke,g as st,q as at,a2 as xt}from"./index.js";import{B as gt}from"./Breadcrumb.js";import{S as je,a as be,b as we,c as ve,d as Ne,e as Pe,f as Te}from"./select.js";import{T as Ie,a as Ae,b as le,c as X,d as Me,e as w}from"./table2.js";import{u as ot,a as ct,f as Be}from"./index14.js";import{u as dt,c as ht}from"./usePagination.js";import{D as ut,C as mt,a as pt,b as ft}from"./react-icons.esm.js";import{B as Fe}from"./badge.js";import{T as yt,a as jt,b as bt,c as wt}from"./tooltip.js";import{A as vt,b as Nt,a as St}from"./alert.js";import{u as De,D as Le,M as _t,a as Ct}from"./download-dialog.js";import{I as rt}from"./info.js";import{S as Ee}from"./skeleton.js";import{C as kt,f as Rt}from"./ChooseMemberPopoverCommand.js";import{f as he}from"./format.js";import{C as Et}from"./checkbox.js";import"./jspdf.plugin.autotable.js";import{D as Pt,f as Tt,a as It,b as At,c as Mt,d as Ot}from"./dialog.js";import{L as We}from"./label.js";import{I as qe}from"./input.js";import{P as Ge,a as Qe,b as Ve}from"./popover.js";import{C as Je}from"./calendar2.js";import{C as Ye}from"./calendar.js";import{S as Dt}from"./switch.js";import"./chevron-right.js";import"./index10.js";import"./index4.js";import"./index11.js";import"./index9.js";import"./index5.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./check.js";import"./chevron-up.js";import"./index6.js";import"./circle-check-big.js";import"./share.js";import"./command.js";import"./index3.js";import"./search.js";import"./chevrons-up-down.js";import"./chevron-left.js";function Lt({table:r,totalRecord:K}){return e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 px-2 lg:flex-row lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:flex-row sm:space-x-6 sm:space-y-0",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.getFilteredRowModel().rows.length," row(s)."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Rows per page"}),e.jsxs(je,{value:`${r.getState().pagination.pageSize}`,onValueChange:v=>{r.setPageSize(Number(v))},children:[e.jsx(be,{className:"h-8 w-[70px]",children:e.jsx(we,{placeholder:r.getState().pagination.pageSize})}),e.jsx(ve,{side:"top",children:[5,10,20,30,40,50].map(v=>e.jsx(Ne,{value:`${v}`,children:v},v))})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total Record: ",K]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",r.getState().pagination.pageIndex+1," of ",r.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(ne,{variant:"outline",className:"h-8 w-8 p-0",disabled:!r.getCanPreviousPage(),onClick:()=>r.setPageIndex(0),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(ut,{className:"h-4 w-4"})]}),e.jsxs(ne,{variant:"outline",className:"h-8 w-8 p-0",disabled:!r.getCanPreviousPage(),onClick:r.previousPage,children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(mt,{className:"h-4 w-4"})]}),e.jsxs(ne,{variant:"outline",className:"h-8 w-8 p-0",disabled:!r.getCanNextPage(),onClick:r.nextPage,children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(pt,{className:"h-4 w-4"})]}),e.jsxs(ne,{variant:"outline",className:"h-8 w-8 p-0",disabled:!r.getCanNextPage(),onClick:()=>r.setPageIndex(r.getPageCount()-1),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(ft,{className:"h-4 w-4"})]})]})]})]})}function Ft({columns:r,data:K,searchInputField:v,filterField:u,filterFieldName:D,filterCategoriesList:R,totalRecord:j,children:L}){var F;const l=Xe(),{rows:o,onPaginationChange:c,page:I,pagination:y}=dt(),g=Ue(),G=()=>{const f=new URLSearchParams(g.search),d=ht({rows:o,page:I},f);l(`?${d}`,{replace:!0})};p.useEffect(()=>{G()},[o,I]);const _=ot({data:K,columns:r,getCoreRowModel:ct(),manualPagination:!0,onPaginationChange:c,state:{pagination:y},rowCount:j}),B=p.Children.map(L,f=>p.isValidElement(f)?p.cloneElement(f,{table:_,searchInputField:v,filterField:u,filterFieldName:D,filterCategoriesList:R}):f);return e.jsxs("div",{className:"space-y-4",children:[B,e.jsx("div",{className:"overflow-y-auto rounded-md border",children:e.jsxs(Ie,{children:[e.jsx(Ae,{children:_.getHeaderGroups().map(f=>e.jsx(le,{children:f.headers.map(d=>e.jsx(X,{className:"px-4 py-2 bg-newprimaryColor text-white font-raleway",colSpan:d.colSpan,children:d.isPlaceholder?null:Be(d.column.columnDef.header,d.getContext())},d.id))},f.id))}),e.jsx(Me,{className:"bg-adminBreadCrumbsBg font-raleway",children:(F=_.getRowModel().rows)!=null&&F.length?_.getRowModel().rows.map(f=>e.jsx(le,{"data-state":f.getIsSelected()&&"selected",children:f.getVisibleCells().map(d=>e.jsx(w,{className:"px-4 py-2",children:Be(d.column.columnDef.cell,d.getContext())},d.id))},f.id)):e.jsx(le,{children:e.jsx(w,{colSpan:r.length,className:"h-24 text-center bg-adminBreadCrumbsBg font-raleway",children:"No results."})})})]})}),e.jsx(Lt,{table:_,totalRecord:j})]})}const nt=[{id:"srno",header:()=>e.jsx("p",{className:"font-semibold",children:"Sr. No."}),cell:r=>e.jsx("p",{className:"text-muted-foreground",children:r.row.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"firstName",header:()=>e.jsx("div",{className:"font-semibold",children:"Member Name"}),cell:({row:r})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("p",{className:"font-medium",children:[r.original.firstName," ",r.original.lastName]}),r.original.email&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.original.email})]}),enableSorting:!1,enableHiding:!1}],$t=()=>{const r=Ue(),[K,v]=p.useState([]),{chapterData:u}=Oe(),[D,R]=p.useState(null),j=new URLSearchParams(r.search),[L,l]=p.useState([]),[o,c]=p.useState([]),[I,y]=p.useState([]),[g,G]=p.useState(""),[_,B]=p.useState(""),{downloadFromResponse:F,downloadDialogState:f,closeDownloadDialog:d}=De(),U=j.get("rows")||10,O=j.get("page")||0,Y=nt.map(({accessorKey:a,header:h})=>({label:h().props.children,key:a})),[T,t]=p.useState(Y.map(({label:a})=>a)),s=a=>{switch(a==null?void 0:a.toLowerCase()){case"approved":return e.jsx(Fe,{className:"bg-green-500 text-white",children:a});case"rejected":return e.jsx(Fe,{className:"bg-red-500 text-white",children:a});case"pending":return e.jsx(Fe,{className:"bg-yellow-500 text-white",children:"Pending Approval"});default:return e.jsx(Fe,{className:"bg-gray-500 text-white",children:"N/A"})}},n=()=>{u!=null&&u.chapterId&&(!g||!_||oe.get(`/api/report/${u.chapterId}/package-summary?rows=${U}&page=${O}`,{params:{chapterId:u.chapterId,rows:U,page:O,...g&&{termId:g}}}).then(a=>{var q;const h=(a.data.data||[]).map(b=>({...b,packageData:(b.packageData||[]).filter(H=>H.packageParent===_)}));v(h);const A=((q=h[0])==null?void 0:q.packageData)||[],Q=[];for(let b=0;b<A.length;b++)Q.push({accessorKey:`packageData_${b}`,header:()=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:A[b].packageName}),e.jsx(yt,{children:e.jsxs(jt,{children:[e.jsx(bt,{children:e.jsx(rt,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs(wt,{children:[e.jsxs("p",{children:["Package: ",A[b].packageName]}),e.jsx("p",{children:"Status indicates approval state"})]})]})})]}),cell:({row:H})=>{var ee,S,k;const m=H.original.packageData[b];return e.jsx("div",{className:"flex flex-col gap-1",children:m!=null&&m.status?s(m.status):(ee=m==null?void 0:m.calculatedResult)!=null&&ee.totalAmount?e.jsxs("span",{className:"font-medium",children:["₹",m.calculatedResult.totalAmount]}):((S=m==null?void 0:m.calculatedResult)==null?void 0:S.message)==="Package has overlapping payments"?e.jsx("span",{className:"text-green-500",children:"✔️"}):e.jsx("span",{className:"text-muted-foreground",children:((k=m==null?void 0:m.calculatedResult)==null?void 0:k.message)||"N/A"})})},enableSorting:!1,enableHiding:!1});l([...nt,...Q]),R(a.data.totalRecords)}).catch(a=>{console.error(a)}))};p.useEffect(()=>{u!=null&&u.chapterId&&oe.get(`/api/term/chapter/${u.chapterId}`).then(a=>c(a.data)).catch(()=>c([]))},[u]),p.useEffect(()=>{if(!(u!=null&&u.chapterId)||!g){y([]),B("");return}oe.get(`/api/packages/parents/${u.chapterId}?termId=${g}`).then(a=>y(a.data)).catch(()=>y([]))},[u,g]),p.useEffect(()=>{n()},[u,U,O,r.search,g,_]);const i=async()=>{f.shareCallback&&await f.shareCallback()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Le,{isOpen:f.isOpen,onClose:d,filename:f.filename,onShare:i}),e.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Member Due Summary Report"})}),e.jsxs(vt,{variant:"info",className:"mb-6",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx(Nt,{children:"Report Information"}),e.jsx(St,{children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"This report shows member package statuses. Approved packages are marked in green, rejected in red, and pending approvals in yellow."}),e.jsx("li",{children:"The package data includes the package name, status, and total amount if applicable."}),e.jsx("li",{children:"The amount shows the total for each package if available if the respective user chooses to pay for the package."}),e.jsx("li",{children:"N/A indicates no data available for that package as the user need not pay for the package."})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(je,{value:g,onValueChange:G,children:[e.jsx(be,{className:"w-[180px]",children:e.jsx(we,{placeholder:"Select Term"})}),e.jsx(ve,{children:e.jsxs(Pe,{children:[e.jsx(Te,{children:"Term"}),o.map(a=>e.jsx(Ne,{value:a.termId||a.id,children:a.termName||a.name||a.termId},a.termId||a.id))]})})]}),e.jsxs(je,{value:_,onValueChange:B,children:[e.jsx(be,{className:"w-[180px]",children:e.jsx(we,{placeholder:"Select Package Parent"})}),e.jsx(ve,{children:e.jsxs(Pe,{children:[e.jsx(Te,{children:"Package Parent"}),I.map(a=>e.jsx(Ne,{value:a,children:a},a))]})})]}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition",onClick:async()=>{if(!(!(u!=null&&u.chapterId)||!g))try{const a=await oe.get(`/api/report/${u.chapterId}/all-members-excel?termId=${g}`,{responseType:"blob"});F(a,"all-members-report.xlsx")}catch(a){console.error("Failed to download Excel file:",a)}},disabled:!g,children:"Export to Excel"})]}),L&&e.jsx("div",{className:"rounded-md border",children:e.jsx(Ft,{data:K,columns:L,searchInputField:"firstName",totalRecord:D,pagination:{pageSize:U,pageIndex:O},state:{pagination:{pageSize:U,pageIndex:O}}})})]})},Bt=()=>{const{chapterData:r}=Oe(),{downloadFromResponse:K,downloadDialogState:v,closeDownloadDialog:u}=De(),[D,R]=p.useState([]),[j,L]=p.useState([]),[l,o]=p.useState(null),[c,I]=p.useState(!1),[y,g]=p.useState(""),[G,_]=p.useState([]),[B,F]=p.useState(!1),[f,d]=p.useState(!1),U=async()=>{try{const t=await oe.get("/api/member/all",{params:{chapterId:r==null?void 0:r.chapterId}});R(t.data),L(t.data)}catch{ye.error("Error fetching members")}};p.useEffect(()=>{r!=null&&r.chapterId&&U()},[r]),p.useEffect(()=>{l&&Y()},[l]);const O=async()=>{if(!l){ye.error("Please select a member"),console.error("[MemberLedger] Export attempted without selecting member");return}d(!0);try{const t=`${l.label} - ${he(new Date,"dd-MM-yyyy")} - Member Ledger.xlsx`,s=await oe.get(`/api/report/${r==null?void 0:r.chapterId}/member-ledger`,{params:{memberId:l.value},responseType:"blob"});await K(s,t,{showSuccessToast:!0,allowShare:!0})}catch(t){console.error("[MemberLedger] Export failed:",JSON.stringify({error:t.message,stack:t.stack,memberInfo:{memberId:l==null?void 0:l.value,memberName:l==null?void 0:l.label},chapterId:r==null?void 0:r.chapterId}))}finally{d(!1)}},Y=async()=>{if(l){F(!0),_([]);try{const t=await oe.get(`/api/report/${r==null?void 0:r.chapterId}/member-ledger-json`,{params:{memberId:l.value}});_(t.data),F(!1)}catch{ye.error("Error fetching ledger data"),F(!1)}}},T=async()=>{v.shareCallback&&await v.shareCallback()};return!r||!(r!=null&&r.chapterId)?null:e.jsxs("div",{className:"flex flex-col gap-4 mt-5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(kt,{members:D,selectedMember:l,setSelectedMember:o}),e.jsx(ne,{onClick:O,disabled:f||!l,children:f?"Exporting...":"Export Data"})]}),B?e.jsx(Ee,{className:"h-10 w-full mb-4"}):l?e.jsx(_t,{data:G,columns:Ct,searchInputField:"firstName",totalRecord:0,pagination:{pageSize:10,pageIndex:0},state:{pagination:{pageSize:10,pageIndex:0}}}):null,e.jsx(Le,{isOpen:v.isOpen,onClose:u,filename:v.filename||v.fileName,onShare:T})]})};function Ut({table:r,totalRecord:K}){return e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 px-2 lg:flex-row lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:flex-row sm:space-x-6 sm:space-y-0",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.getFilteredRowModel().rows.length," row(s)."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Rows per page"}),e.jsxs(je,{value:`${r.getState().pagination.pageSize}`,onValueChange:v=>{r.setPageSize(Number(v))},children:[e.jsx(be,{className:"h-8 w-[70px]",children:e.jsx(we,{placeholder:r.getState().pagination.pageSize})}),e.jsx(ve,{side:"top",children:[5,10,20,30,40,50].map(v=>e.jsx(Ne,{value:`${v}`,children:v},v))})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total Record: ",K]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",r.getState().pagination.pageIndex+1," of ",r.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(ne,{variant:"outline",className:"h-8 w-8 p-0",disabled:!r.getCanPreviousPage(),onClick:()=>r.setPageIndex(0),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(ut,{className:"h-4 w-4"})]}),e.jsxs(ne,{variant:"outline",className:"h-8 w-8 p-0",disabled:!r.getCanPreviousPage(),onClick:r.previousPage,children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(mt,{className:"h-4 w-4"})]}),e.jsxs(ne,{variant:"outline",className:"h-8 w-8 p-0",disabled:!r.getCanNextPage(),onClick:r.nextPage,children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(pt,{className:"h-4 w-4"})]}),e.jsxs(ne,{variant:"outline",className:"h-8 w-8 p-0",disabled:!r.getCanNextPage(),onClick:()=>r.setPageIndex(r.getPageCount()-1),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(ft,{className:"h-4 w-4"})]})]})]})]})}function Ht({columns:r,data:K,searchInputField:v,filterField:u,filterFieldName:D,filterCategoriesList:R,totalRecord:j,children:L}){var F;const l=Xe(),{rows:o,onPaginationChange:c,page:I,pagination:y}=dt(),g=Ue(),G=()=>{const f=new URLSearchParams(g.search),d=ht({rows:o,page:I},f);l(`?${d}`,{replace:!0})};p.useEffect(()=>{G()},[o,I]);const _=ot({data:K,columns:r,getCoreRowModel:ct(),manualPagination:!0,onPaginationChange:c,state:{pagination:y},rowCount:j}),B=p.Children.map(L,f=>p.isValidElement(f)?p.cloneElement(f,{table:_,searchInputField:v,filterField:u,filterFieldName:D,filterCategoriesList:R}):f);return e.jsxs("div",{className:"space-y-4",children:[B,e.jsx("div",{className:"overflow-y-auto rounded-md border",children:e.jsxs(Ie,{children:[e.jsx(Ae,{children:_.getHeaderGroups().map(f=>e.jsx(le,{children:f.headers.map(d=>e.jsx(X,{className:"px-4 py-2 bg-newprimaryColor text-white font-raleway",colSpan:d.colSpan,children:d.isPlaceholder?null:Be(d.column.columnDef.header,d.getContext())},d.id))},f.id))}),e.jsx(Me,{className:"bg-adminBreadCrumbsBg font-raleway",children:(F=_.getRowModel().rows)!=null&&F.length?_.getRowModel().rows.map(f=>e.jsx(le,{"data-state":f.getIsSelected()&&"selected",children:f.getVisibleCells().map(d=>e.jsx(w,{className:"px-4 py-2",children:Be(d.column.columnDef.cell,d.getContext())},d.id))},f.id)):e.jsx(le,{children:e.jsx(w,{colSpan:r.length,className:"h-24 text-center bg-adminBreadCrumbsBg font-raleway",children:"No results."})})})]})}),e.jsx(Ut,{table:_,totalRecord:j})]})}const it=[{id:"srno",header:()=>e.jsx("p",{className:!0,children:"Sr. No."}),cell:r=>e.jsx("p",{children:r.row.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:()=>e.jsx("div",{className:!0,children:"Member Name"}),cell:({row:r})=>e.jsxs("p",{className:"text-sm font-medium",children:[r.original.firstName," ",r.original.lastName]}),enableSorting:!1,enableHiding:!1},{accessorKey:"paidAmount",header:()=>e.jsx("div",{className:!0,children:"Amount Paid"}),cell:({row:r})=>e.jsx("p",{className:"text-sm font-medium",children:r.original.paidAmount}),enableSorting:!1,enableHiding:!1},{accessorKey:"balanceAmount",header:()=>e.jsx("div",{className:!0,children:"Balance"}),cell:({row:r})=>e.jsx("p",{className:"text-sm font-medium",children:r.original.balanceAmount}),enableSorting:!1,enableHiding:!1},{accessorKey:"packageName",header:()=>e.jsx("div",{className:!0,children:"Package Name"}),cell:({row:r})=>e.jsx("p",{className:"text-sm font-medium",children:r.original.packageName}),enableSorting:!1,enableHiding:!1},{accessorKey:"paymentType",header:()=>e.jsx("div",{className:!0,children:"Payment Type"}),cell:({row:r})=>e.jsx("p",{className:"text-sm font-medium",children:r.original.paymentType}),enableSorting:!1,enableHiding:!1},{accessorKey:"paymentReceivedByName",header:()=>e.jsx("div",{className:!0,children:"Collected By"}),cell:({row:r})=>e.jsx("p",{className:"text-sm font-medium",children:r.original.paymentReceivedByName}),enableSorting:!1,enableHiding:!1},{accessorKey:"approvedByName",header:()=>e.jsx("div",{className:!0,children:"Approved By"}),cell:({row:r})=>e.jsx("p",{className:"text-sm font-medium",children:r.original.approvedByName}),enableSorting:!1,enableHiding:!1},{accessorKey:"transactionDate",header:()=>e.jsx("div",{className:!0,children:"Date"}),cell:({row:r})=>{const K=new Date(r.original.transactionDate);return e.jsx("p",{className:"text-sm font-medium",children:Rt(K)})},enableSorting:!1,enableHiding:!1},{accessorKey:"approvalStatus",header:()=>e.jsx("div",{className:!0,children:"Approval Status"}),cell:({row:r})=>e.jsx("p",{className:"text-sm font-medium",children:r.original.approvalStatus})}];var zt={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(r,K){((v,u)=>{r.exports=u()})(Ce,function v(){var u=typeof self<"u"?self:typeof window<"u"?window:u!==void 0?u:{},D,R=!u.document&&!!u.postMessage,j=u.IS_PAPA_WORKER||!1,L={},l=0,o={};function c(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(s){var n=O(s);n.chunkSize=parseInt(n.chunkSize),s.step||s.chunk||(n.chunkSize=null),this._handle=new _(n),(this._handle.streamer=this)._config=n}).call(this,t),this.parseChunk=function(s,n){var i=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<i){let h=this._config.newline;h||(a=this._config.quoteChar||'"',h=this._handle.guessLineEndings(s,a)),s=[...s.split(h).slice(i)].join(h)}this.isFirstChunk&&T(this._config.beforeFirstChunk)&&(a=this._config.beforeFirstChunk(s))!==void 0&&(s=a),this.isFirstChunk=!1,this._halted=!1;var i=this._partialLine+s,a=(this._partialLine="",this._handle.parse(i,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(s=a.meta.cursor,i=(this._finished||(this._partialLine=i.substring(s-this._baseIndex),this._baseIndex=s),a&&a.data&&(this._rowCount+=a.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),j)u.postMessage({results:a,workerId:o.WORKER_ID,finished:i});else if(T(this._config.chunk)&&!n){if(this._config.chunk(a,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=a=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(a.data),this._completeResults.errors=this._completeResults.errors.concat(a.errors),this._completeResults.meta=a.meta),this._completed||!i||!T(this._config.complete)||a&&a.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),i||a&&a.meta.paused||this._nextChunk(),a}this._halted=!0},this._sendError=function(s){T(this._config.error)?this._config.error(s):j&&this._config.error&&u.postMessage({workerId:o.WORKER_ID,error:s,finished:!1})}}function I(t){var s;(t=t||{}).chunkSize||(t.chunkSize=o.RemoteChunkSize),c.call(this,t),this._nextChunk=R?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(n){this._input=n,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest,this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),R||(s.onload=Y(this._chunkLoaded,this),s.onerror=Y(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!R),this._config.downloadRequestHeaders){var n,i=this._config.downloadRequestHeaders;for(n in i)s.setRequestHeader(n,i[n])}var a;this._config.chunkSize&&(a=this._start+this._config.chunkSize-1,s.setRequestHeader("Range","bytes="+this._start+"-"+a));try{s.send(this._config.downloadRequestBody)}catch(h){this._chunkError(h.message)}R&&s.status===0&&this._chunkError()}},this._chunkLoaded=function(){s.readyState===4&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize||s.responseText.length,this._finished=!this._config.chunkSize||this._start>=(n=>(n=n.getResponseHeader("Content-Range"))!==null?parseInt(n.substring(n.lastIndexOf("/")+1)):-1)(s),this.parseChunk(s.responseText)))},this._chunkError=function(n){n=s.statusText||n,this._sendError(new Error(n))}}function y(t){(t=t||{}).chunkSize||(t.chunkSize=o.LocalChunkSize),c.call(this,t);var s,n,i=typeof FileReader<"u";this.stream=function(a){this._input=a,n=a.slice||a.webkitSlice||a.mozSlice,i?((s=new FileReader).onload=Y(this._chunkLoaded,this),s.onerror=Y(this._chunkError,this)):s=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var a=this._input,h=(this._config.chunkSize&&(h=Math.min(this._start+this._config.chunkSize,this._input.size),a=n.call(a,this._start,h)),s.readAsText(a,this._config.encoding));i||this._chunkLoaded({target:{result:h}})},this._chunkLoaded=function(a){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(a.target.result)},this._chunkError=function(){this._sendError(s.error)}}function g(t){var s;c.call(this,t=t||{}),this.stream=function(n){return s=n,this._nextChunk()},this._nextChunk=function(){var n,i;if(!this._finished)return n=this._config.chunkSize,s=n?(i=s.substring(0,n),s.substring(n)):(i=s,""),this._finished=!s,this.parseChunk(i)}}function G(t){c.call(this,t=t||{});var s=[],n=!0,i=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(a){this._input=a,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){i&&s.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):n=!0},this._streamData=Y(function(a){try{s.push(typeof a=="string"?a:a.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(h){this._streamError(h)}},this),this._streamError=Y(function(a){this._streamCleanUp(),this._sendError(a)},this),this._streamEnd=Y(function(){this._streamCleanUp(),i=!0,this._streamData("")},this),this._streamCleanUp=Y(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function _(t){var s,n,i,a,h=Math.pow(2,53),A=-h,Q=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,q=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,b=this,H=0,m=0,ee=!1,S=!1,k=[],x={data:[],errors:[],meta:{}};function te(E){return t.skipEmptyLines==="greedy"?E.join("").trim()==="":E.length===1&&E[0].length===0}function Z(){if(x&&i&&(de("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),i=!1),t.skipEmptyLines&&(x.data=x.data.filter(function(N){return!te(N)})),re()){let N=function(J,se){T(t.transformHeader)&&(J=t.transformHeader(J,se)),k.push(J)};if(x)if(Array.isArray(x.data[0])){for(var E=0;re()&&E<x.data.length;E++)x.data[E].forEach(N);x.data.splice(0,1)}else x.data.forEach(N)}function M(N,J){for(var se=t.header?{}:[],$=0;$<N.length;$++){var z=$,P=N[$],P=((ue,C)=>(W=>(t.dynamicTypingFunction&&t.dynamicTyping[W]===void 0&&(t.dynamicTyping[W]=t.dynamicTypingFunction(W)),(t.dynamicTyping[W]||t.dynamicTyping)===!0))(ue)?C==="true"||C==="TRUE"||C!=="false"&&C!=="FALSE"&&((W=>{if(Q.test(W)&&(W=parseFloat(W),A<W&&W<h))return 1})(C)?parseFloat(C):q.test(C)?new Date(C):C===""?null:C):C)(z=t.header?$>=k.length?"__parsed_extra":k[$]:z,P=t.transform?t.transform(P,z):P);z==="__parsed_extra"?(se[z]=se[z]||[],se[z].push(P)):se[z]=P}return t.header&&($>k.length?de("FieldMismatch","TooManyFields","Too many fields: expected "+k.length+" fields but parsed "+$,m+J):$<k.length&&de("FieldMismatch","TooFewFields","Too few fields: expected "+k.length+" fields but parsed "+$,m+J)),se}var V;x&&(t.header||t.dynamicTyping||t.transform)&&(V=1,!x.data.length||Array.isArray(x.data[0])?(x.data=x.data.map(M),V=x.data.length):x.data=M(x.data,0),t.header&&x.meta&&(x.meta.fields=k),m+=V)}function re(){return t.header&&k.length===0}function de(E,M,V,N){E={type:E,code:M,message:V},N!==void 0&&(E.row=N),x.errors.push(E)}T(t.step)&&(a=t.step,t.step=function(E){x=E,re()?Z():(Z(),x.data.length!==0&&(H+=E.data.length,t.preview&&H>t.preview?n.abort():(x.data=x.data[0],a(x,b))))}),this.parse=function(E,M,V){var N=t.quoteChar||'"',N=(t.newline||(t.newline=this.guessLineEndings(E,N)),i=!1,t.delimiter?T(t.delimiter)&&(t.delimiter=t.delimiter(E),x.meta.delimiter=t.delimiter):((N=((J,se,$,z,P)=>{var ue,C,W,ge;P=P||[",","	","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var Se=0;Se<P.length;Se++){for(var me,ke=P[Se],ie=0,pe=0,ae=0,ce=(W=void 0,new F({comments:z,delimiter:ke,newline:se,preview:10}).parse(J)),xe=0;xe<ce.data.length;xe++)$&&te(ce.data[xe])?ae++:(me=ce.data[xe].length,pe+=me,W===void 0?W=me:0<me&&(ie+=Math.abs(me-W),W=me));0<ce.data.length&&(pe/=ce.data.length-ae),(C===void 0||ie<=C)&&(ge===void 0||ge<pe)&&1.99<pe&&(C=ie,ue=ke,ge=pe)}return{successful:!!(t.delimiter=ue),bestDelimiter:ue}})(E,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=N.bestDelimiter:(i=!0,t.delimiter=o.DefaultDelimiter),x.meta.delimiter=t.delimiter),O(t));return t.preview&&t.header&&N.preview++,s=E,n=new F(N),x=n.parse(s,M,V),Z(),ee?{meta:{paused:!0}}:x||{meta:{paused:!1}}},this.paused=function(){return ee},this.pause=function(){ee=!0,n.abort(),s=T(t.chunk)?"":s.substring(n.getCharIndex())},this.resume=function(){b.streamer._halted?(ee=!1,b.streamer.parseChunk(s,!0)):setTimeout(b.resume,3)},this.aborted=function(){return S},this.abort=function(){S=!0,n.abort(),x.meta.aborted=!0,T(t.complete)&&t.complete(x),s=""},this.guessLineEndings=function(J,N){J=J.substring(0,1048576);var N=new RegExp(B(N)+"([^]*?)"+B(N),"gm"),V=(J=J.replace(N,"")).split("\r"),N=J.split(`
`),J=1<N.length&&N[0].length<V[0].length;if(V.length===1||J)return`
`;for(var se=0,$=0;$<V.length;$++)V[$][0]===`
`&&se++;return se>=V.length/2?`\r
`:"\r"}}function B(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function F(t){var s=(t=t||{}).delimiter,n=t.newline,i=t.comments,a=t.step,h=t.preview,A=t.fastMode,Q=null,q=!1,b=t.quoteChar==null?'"':t.quoteChar,H=b;if(t.escapeChar!==void 0&&(H=t.escapeChar),(typeof s!="string"||-1<o.BAD_DELIMITERS.indexOf(s))&&(s=","),i===s)throw new Error("Comment character same as delimiter");i===!0?i="#":(typeof i!="string"||-1<o.BAD_DELIMITERS.indexOf(i))&&(i=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var m=0,ee=!1;this.parse=function(S,k,x){if(typeof S!="string")throw new Error("Input must be a string");var te=S.length,Z=s.length,re=n.length,de=i.length,E=T(a),M=[],V=[],N=[],J=m=0;if(!S)return ie();if(A||A!==!1&&S.indexOf(b)===-1){for(var se=S.split(n),$=0;$<se.length;$++){if(N=se[$],m+=N.length,$!==se.length-1)m+=n.length;else if(x)return ie();if(!i||N.substring(0,de)!==i){if(E){if(M=[],ge(N.split(s)),pe(),ee)return ie()}else ge(N.split(s));if(h&&h<=$)return M=M.slice(0,h),ie(!0)}}return ie()}for(var z=S.indexOf(s,m),P=S.indexOf(n,m),ue=new RegExp(B(H)+B(b),"g"),C=S.indexOf(b,m);;)if(S[m]===b)for(C=m,m++;;){if((C=S.indexOf(b,C+1))===-1)return x||V.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:M.length,index:m}),me();if(C===te-1)return me(S.substring(m,C).replace(ue,b));if(b===H&&S[C+1]===H)C++;else if(b===H||C===0||S[C-1]!==H){z!==-1&&z<C+1&&(z=S.indexOf(s,C+1));var W=Se((P=P!==-1&&P<C+1?S.indexOf(n,C+1):P)===-1?z:Math.min(z,P));if(S.substr(C+1+W,Z)===s){N.push(S.substring(m,C).replace(ue,b)),S[m=C+1+W+Z]!==b&&(C=S.indexOf(b,m)),z=S.indexOf(s,m),P=S.indexOf(n,m);break}if(W=Se(P),S.substring(C+1+W,C+1+W+re)===n){if(N.push(S.substring(m,C).replace(ue,b)),ke(C+1+W+re),z=S.indexOf(s,m),C=S.indexOf(b,m),E&&(pe(),ee))return ie();if(h&&M.length>=h)return ie(!0);break}V.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:M.length,index:m}),C++}}else if(i&&N.length===0&&S.substring(m,m+de)===i){if(P===-1)return ie();m=P+re,P=S.indexOf(n,m),z=S.indexOf(s,m)}else if(z!==-1&&(z<P||P===-1))N.push(S.substring(m,z)),m=z+Z,z=S.indexOf(s,m);else{if(P===-1)break;if(N.push(S.substring(m,P)),ke(P+re),E&&(pe(),ee))return ie();if(h&&M.length>=h)return ie(!0)}return me();function ge(ae){M.push(ae),J=m}function Se(ae){var ce=0;return ce=ae!==-1&&(ae=S.substring(C+1,ae))&&ae.trim()===""?ae.length:ce}function me(ae){return x||(ae===void 0&&(ae=S.substring(m)),N.push(ae),m=te,ge(N),E&&pe()),ie()}function ke(ae){m=ae,ge(N),N=[],P=S.indexOf(n,m)}function ie(ae){if(t.header&&!k&&M.length&&!q){var ce=M[0],xe=Object.create(null),He=new Set(ce);let Ze=!1;for(let _e=0;_e<ce.length;_e++){let fe=ce[_e];if(xe[fe=T(t.transformHeader)?t.transformHeader(fe,_e):fe]){let Re,et=xe[fe];for(;Re=fe+"_"+et,et++,He.has(Re););He.add(Re),ce[_e]=Re,xe[fe]++,Ze=!0,(Q=Q===null?{}:Q)[Re]=fe}else xe[fe]=1,ce[_e]=fe;He.add(fe)}Ze&&console.warn("Duplicate headers found and renamed."),q=!0}return{data:M,errors:V,meta:{delimiter:s,linebreak:n,aborted:ee,truncated:!!ae,cursor:J+(k||0),renamedHeaders:Q}}}function pe(){a(ie()),M=[],V=[]}},this.abort=function(){ee=!0},this.getCharIndex=function(){return m}}function f(t){var s=t.data,n=L[s.workerId],i=!1;if(s.error)n.userError(s.error,s.file);else if(s.results&&s.results.data){var a={abort:function(){i=!0,d(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:U,resume:U};if(T(n.userStep)){for(var h=0;h<s.results.data.length&&(n.userStep({data:s.results.data[h],errors:s.results.errors,meta:s.results.meta},a),!i);h++);delete s.results}else T(n.userChunk)&&(n.userChunk(s.results,a,s.file),delete s.results)}s.finished&&!i&&d(s.workerId,s.results)}function d(t,s){var n=L[t];T(n.userComplete)&&n.userComplete(s),n.terminate(),delete L[t]}function U(){throw new Error("Not implemented.")}function O(t){if(typeof t!="object"||t===null)return t;var s,n=Array.isArray(t)?[]:{};for(s in t)n[s]=O(t[s]);return n}function Y(t,s){return function(){t.apply(s,arguments)}}function T(t){return typeof t=="function"}return o.parse=function(t,s){var n=(s=s||{}).dynamicTyping||!1;if(T(n)&&(s.dynamicTypingFunction=n,n={}),s.dynamicTyping=n,s.transform=!!T(s.transform)&&s.transform,!s.worker||!o.WORKERS_SUPPORTED)return n=null,o.NODE_STREAM_INPUT,typeof t=="string"?(t=(i=>i.charCodeAt(0)!==65279?i:i.slice(1))(t),n=new(s.download?I:g)(s)):t.readable===!0&&T(t.read)&&T(t.on)?n=new G(s):(u.File&&t instanceof File||t instanceof Object)&&(n=new y(s)),n.stream(t);(n=(()=>{var i;return!!o.WORKERS_SUPPORTED&&(i=(()=>{var a=u.URL||u.webkitURL||null,h=v.toString();return o.BLOB_URL||(o.BLOB_URL=a.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",h,")();"],{type:"text/javascript"})))})(),(i=new u.Worker(i)).onmessage=f,i.id=l++,L[i.id]=i)})()).userStep=s.step,n.userChunk=s.chunk,n.userComplete=s.complete,n.userError=s.error,s.step=T(s.step),s.chunk=T(s.chunk),s.complete=T(s.complete),s.error=T(s.error),delete s.worker,n.postMessage({input:t,config:s,workerId:n.id})},o.unparse=function(t,s){var n=!1,i=!0,a=",",h=`\r
`,A='"',Q=A+A,q=!1,b=null,H=!1,m=((()=>{if(typeof s=="object"){if(typeof s.delimiter!="string"||o.BAD_DELIMITERS.filter(function(k){return s.delimiter.indexOf(k)!==-1}).length||(a=s.delimiter),typeof s.quotes!="boolean"&&typeof s.quotes!="function"&&!Array.isArray(s.quotes)||(n=s.quotes),typeof s.skipEmptyLines!="boolean"&&typeof s.skipEmptyLines!="string"||(q=s.skipEmptyLines),typeof s.newline=="string"&&(h=s.newline),typeof s.quoteChar=="string"&&(A=s.quoteChar),typeof s.header=="boolean"&&(i=s.header),Array.isArray(s.columns)){if(s.columns.length===0)throw new Error("Option columns is empty");b=s.columns}s.escapeChar!==void 0&&(Q=s.escapeChar+A),s.escapeFormulae instanceof RegExp?H=s.escapeFormulae:typeof s.escapeFormulae=="boolean"&&s.escapeFormulae&&(H=/^[=+\-@\t\r].*$/)}})(),new RegExp(B(A),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return ee(null,t,q);if(typeof t[0]=="object")return ee(b||Object.keys(t[0]),t,q)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||b),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),ee(t.fields||[],t.data||[],q);throw new Error("Unable to serialize unrecognized input");function ee(k,x,te){var Z="",re=(typeof k=="string"&&(k=JSON.parse(k)),typeof x=="string"&&(x=JSON.parse(x)),Array.isArray(k)&&0<k.length),de=!Array.isArray(x[0]);if(re&&i){for(var E=0;E<k.length;E++)0<E&&(Z+=a),Z+=S(k[E],E);0<x.length&&(Z+=h)}for(var M=0;M<x.length;M++){var V=(re?k:x[M]).length,N=!1,J=re?Object.keys(x[M]).length===0:x[M].length===0;if(te&&!re&&(N=te==="greedy"?x[M].join("").trim()==="":x[M].length===1&&x[M][0].length===0),te==="greedy"&&re){for(var se=[],$=0;$<V;$++){var z=de?k[$]:$;se.push(x[M][z])}N=se.join("").trim()===""}if(!N){for(var P=0;P<V;P++){0<P&&!J&&(Z+=a);var ue=re&&de?k[P]:P;Z+=S(x[M][ue],P)}M<x.length-1&&(!te||0<V&&!J)&&(Z+=h)}}return Z}function S(k,x){var te,Z;return k==null?"":k.constructor===Date?JSON.stringify(k).slice(1,25):(Z=!1,H&&typeof k=="string"&&H.test(k)&&(k="'"+k,Z=!0),te=k.toString().replace(m,Q),(Z=Z||n===!0||typeof n=="function"&&n(k,x)||Array.isArray(n)&&n[x]||((re,de)=>{for(var E=0;E<de.length;E++)if(-1<re.indexOf(de[E]))return!0;return!1})(te,o.BAD_DELIMITERS)||-1<te.indexOf(a)||te.charAt(0)===" "||te.charAt(te.length-1)===" ")?A+te+A:te)}},o.RECORD_SEP="",o.UNIT_SEP="",o.BYTE_ORDER_MARK="\uFEFF",o.BAD_DELIMITERS=["\r",`
`,'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!R&&!!u.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=F,o.ParserHandle=_,o.NetworkStreamer=I,o.FileStreamer=y,o.StringStreamer=g,o.ReadableStreamStreamer=G,u.jQuery&&((D=u.jQuery).fn.parse=function(t){var s=t.config||{},n=[];return this.each(function(h){if(!(D(this).prop("tagName").toUpperCase()==="INPUT"&&D(this).attr("type").toLowerCase()==="file"&&u.FileReader)||!this.files||this.files.length===0)return!0;for(var A=0;A<this.files.length;A++)n.push({file:this.files[A],inputElem:this,instanceConfig:D.extend({},s)})}),i(),this;function i(){if(n.length===0)T(t.complete)&&t.complete();else{var h,A,Q,q,b=n[0];if(T(t.before)){var H=t.before(b.file,b.inputElem);if(typeof H=="object"){if(H.action==="abort")return h="AbortError",A=b.file,Q=b.inputElem,q=H.reason,void(T(t.error)&&t.error({name:h},A,Q,q));if(H.action==="skip")return void a();typeof H.config=="object"&&(b.instanceConfig=D.extend(b.instanceConfig,H.config))}else if(H==="skip")return void a()}var m=b.instanceConfig.complete;b.instanceConfig.complete=function(ee){T(m)&&m(ee,b.file,b.inputElem),a()},o.parse(b.file,b.instanceConfig)}}function a(){n.splice(0,1),i()}}),j&&(u.onmessage=function(t){t=t.data,o.WORKER_ID===void 0&&t&&(o.WORKER_ID=t.workerId),typeof t.input=="string"?u.postMessage({workerId:o.WORKER_ID,results:o.parse(t.input,t.config),finished:!0}):(u.File&&t.input instanceof File||t.input instanceof Object)&&(t=o.parse(t.input,t.config))&&u.postMessage({workerId:o.WORKER_ID,results:t,finished:!0})}),(I.prototype=Object.create(c.prototype)).constructor=I,(y.prototype=Object.create(c.prototype)).constructor=y,(g.prototype=Object.create(g.prototype)).constructor=g,(G.prototype=Object.create(c.prototype)).constructor=G,o})})(zt);const Kt=()=>{const r=Ue(),[K,v]=p.useState([]),[u,D]=p.useState(!0),{chapterData:R}=Oe(),j=new URLSearchParams(r.search),[L,l]=p.useState(null),o=j.get("rows")||5,c=j.get("page")||1,[I,y]=p.useState(!1),[g,G]=p.useState(null),[_,B]=p.useState(null),F=it.map(({accessorKey:a,header:h})=>({label:h().props.children,key:a})),[f,d]=p.useState(F.map(({label:a})=>a)),{downloadFromResponse:U,downloadDialogState:O,closeDownloadDialog:Y}=De();p.useEffect(()=>{R&&T()},[R,o,c,r.search]);const T=()=>{R.chapterId&&oe.get(`/api/report/${R.chapterId}/member-transactions-report?rows=${o}&page=${c}  `,{params:{chapterId:R.chapterId,rows:o,page:c}}).then(a=>{v(a.data.data),l(a.data.totalRecords),D(!1)}).catch(a=>{console.error("Error fetching reports:",a),D(!1)})},t=a=>{d(h=>h.includes(a)?h.filter(A=>A!==a):[...h,a])},s=async()=>{const a=F.filter(({label:h})=>f.includes(h)).map(({key:h})=>h);try{const h=await oe.post(`/api/report/${R.chapterId}/member-transactions-report/export`,{startDate:g,endDate:_,type:"excel",selectedColumns:a,chapterId:R.chapterId},{responseType:"blob"});U(h,`Member Transactions Report ${he(new Date(g),"dd-MM-yyyy")} - ${he(new Date(_),"dd-MM-yyyy")}.xlsx`),ye.success("Excel file downloaded successfully.")}catch(h){console.error("Error exporting Excel:",h),ye.error("Failed to export Excel. Please try again later.")}},n=async()=>{var A,Q;y(!1);const a=F.filter(({label:q})=>f.includes(q)).map(({key:q})=>q),h={startDate:g,endDate:_,type:"pdf",selectedColumns:a,chapterId:R.chapterId};try{const q=await oe.post(`/api/report/${R.chapterId}/member-transactions-report/export`,h,{responseType:"blob"});U(q,`Member Transactions Report ${he(new Date(g),"dd-MM-yyyy")} - ${he(new Date(_),"dd-MM-yyyy")}.pdf`),ye.success("PDF file downloaded successfully.")}catch(q){console.error("Error exporting PDF:",q),ye.error(((Q=(A=q.response)==null?void 0:A.data)==null?void 0:Q.error)||"Failed to export PDF")}},i=async()=>{O.shareCallback&&await O.shareCallback()};return e.jsxs("div",{className:"p-6",children:[e.jsx(Le,{isOpen:O.isOpen,onClose:Y,filename:O.filename,onShare:i}),e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Member Transactions Report"}),e.jsxs("div",{className:"mb-4 p-4 border rounded-md bg-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Select Columns to Export"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:F.map(({label:a})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{checked:f.includes(a),onCheckedChange:()=>t(a)}),e.jsx("label",{className:"text-sm",children:a})]},a))})]}),e.jsx("div",{className:"flex gap-4 mb-4",children:e.jsxs(Pt,{open:I,onOpenChange:y,children:[e.jsx(Tt,{asChild:!0,children:e.jsx(ne,{className:"bg-blue-600 text-white",children:"Export"})}),e.jsxs(It,{children:[e.jsx(At,{children:e.jsx(Mt,{children:"Export Options"})}),e.jsxs("div",{className:"flex flex-col gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(We,{htmlFor:"fromDate",children:"From Date"}),e.jsxs(Ge,{children:[e.jsx(Qe,{asChild:!0,children:e.jsxs(ne,{variant:"outline",className:tt("w-full justify-start text-left font-normal",!g&&"text-muted-foreground"),children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),g?he(new Date(g),"PPP"):"Pick a date"]})}),e.jsx(Ve,{className:"w-auto p-0",children:e.jsx(Je,{mode:"single",selected:g,onSelect:G,initialFocus:!0,disabled:a=>a>new Date})})]})]}),e.jsxs("div",{children:[e.jsx(We,{htmlFor:"toDate",children:"To Date"}),e.jsxs(Ge,{children:[e.jsx(Qe,{asChild:!0,children:e.jsxs(ne,{variant:"outline",className:tt("w-full justify-start text-left font-normal",!_&&"text-muted-foreground"),children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),_?he(new Date(_),"PPP"):"Pick a date"]})}),e.jsx(Ve,{className:"w-auto p-0",children:e.jsx(Je,{mode:"single",selected:_,onSelect:B,initialFocus:!0,disabled:a=>a>new Date})})]})]})]}),e.jsxs(Ot,{className:"flex justify-between gap-2",children:[e.jsx(ne,{onClick:n,className:"bg-red-500 text-white",disabled:!g||!_,children:"Export PDF"}),e.jsx(ne,{onClick:()=>{y(!1),s()},className:"bg-green-700 text-white",disabled:!g||!_,children:"Export Excel"})]})]})]})}),u?e.jsx("p",{className:"text-gray-600",children:"Loading..."}):K.length===0?e.jsx("p",{className:"text-gray-600",children:"No reports available."}):e.jsx(Ht,{data:K,columns:it,searchInputField:"firstName",totalRecord:L,pagination:{pageSize:o,pageIndex:c},state:{pagination:{pageSize:o,pageIndex:c}}})]})},qt=()=>{const{chapterData:r}=Oe(),{downloadFromResponse:K,downloadDialogState:v,closeDownloadDialog:u}=De(),[D,R]=p.useState(new Date),[j,L]=p.useState(!1),[l,o]=p.useState(null),[c,I]=p.useState(!1),[y,g]=p.useState(null),[G,_]=p.useState(!1),B=async()=>{try{I(!0),g(null);const d=he(D,"yyyy-MM-dd"),U=await oe.get(`/api/report/${r==null?void 0:r.chapterId}/receiver-daywise-json-report`,{params:{date:d}});o(U.data)}catch(d){g(d.message||"An unknown error occurred"),ye.error("Error fetching data")}finally{I(!1)}},F=async()=>{_(!0);try{const d=he(D,"yyyy-MM-dd"),U=await oe.get(`/api/report/${r==null?void 0:r.chapterId}/receiver-daywise-report`,{params:{date:d},responseType:"blob"}),O=`ReceiverDaywiseReport-${d}.xlsx`;await K(U,O,{showSuccessToast:!0,allowShare:!0})}catch(d){console.error("Error exporting data:",d)}finally{_(!1)}};p.useEffect(()=>{r!=null&&r.chapterId&&B()},[D,r]);const f=async()=>{v.shareCallback&&await v.shareCallback()};return e.jsxs("div",{className:"flex flex-col gap-4 mt-5",children:[e.jsx(Le,{isOpen:v.isOpen,onClose:u,filename:v.filename,onShare:f}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Ge,{open:j,onOpenChange:L,children:[e.jsx(Qe,{asChild:!0,children:e.jsxs(ne,{variant:"outline",className:"w-[200px] justify-start text-left font-normal",children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),D?he(D,"PPP"):e.jsx("span",{children:"Select date"})]})}),e.jsx(Ve,{className:"w-auto p-0",children:e.jsx(Je,{mode:"single",selected:D,onSelect:d=>{R(d||new Date),L(!1)},disabled:d=>d>new Date})})]}),e.jsx(ne,{onClick:F,disabled:G||(l==null?void 0:l.data.transactions.length)===0,children:G?"Exporting...":"Export Data"})]}),c&&e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((d,U)=>e.jsxs($e,{children:[e.jsx(ze,{children:e.jsx(Ee,{className:"h-6 w-[200px]"})}),e.jsx(Ke,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ee,{className:"h-4 w-full"}),e.jsx(Ee,{className:"h-4 w-full"}),e.jsx(Ee,{className:"h-4 w-full"})]})})]},U))}),y&&e.jsxs("div",{className:"text-red-500",children:["Error: ",y]}),l&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Transaction Report for ",l==null?void 0:l.data.date]}),(l==null?void 0:l.data.transactions.length)===0&&e.jsx("div",{className:"text-center text-lg font-semibold text-gray-500",children:"No transactions found for the selected date."}),l==null?void 0:l.data.transactions.map((d,U)=>e.jsxs($e,{children:[e.jsx(ze,{children:e.jsxs(st,{children:[d.receiverName," (",d.paymentType,")"]})}),e.jsx(Ke,{children:e.jsxs(Ie,{children:[e.jsx(Ae,{children:e.jsxs(le,{children:[e.jsx(X,{children:"Sr No"}),e.jsx(X,{children:"Receiver Name"}),e.jsx(X,{children:"Member Name"}),e.jsx(X,{children:"Payment Type"}),e.jsx(X,{children:"Paid Amount"}),e.jsx(X,{children:"Receiver Fee"}),e.jsx(X,{children:"Platform Fee"}),e.jsx(X,{children:"Penalty Amount"}),e.jsx(X,{children:"Discount Amount"}),e.jsx(X,{children:"Status"})]})}),e.jsxs(Me,{children:[d.data.map((O,Y)=>e.jsxs(le,{children:[e.jsx(w,{children:Y+1}),e.jsx(w,{children:d.receiverName}),e.jsx(w,{children:O.membername}),e.jsx(w,{children:O.paymentType}),e.jsx(w,{children:O.paidAmount}),e.jsx(w,{children:O.receiverFee}),e.jsx(w,{children:O.platformFee}),e.jsx(w,{children:O.penaltyAmount}),e.jsx(w,{children:O.discountAmount}),e.jsx(w,{children:O.status})]},O.memberid)),e.jsxs(le,{className:"font-bold bg-muted/50",children:[e.jsx(w,{colSpan:3,children:"Total:"}),e.jsx(w,{children:d.paymentType}),e.jsx(w,{children:d.totals.amountPaid}),e.jsx(w,{children:d.totals.receiverFee}),e.jsx(w,{children:d.totals.platformFee}),e.jsx(w,{children:d.totals.penaltyAmount}),e.jsx(w,{children:d.totals.discountAmount}),e.jsx(w,{})]})]})]})})]},`${d.receiverName}-${d.paymentType}-${U}`)),(l==null?void 0:l.data.transactions.length)>0&&e.jsxs($e,{children:[e.jsx(ze,{children:e.jsx(st,{children:"Grand Totals"})}),e.jsx(Ke,{children:e.jsxs(Ie,{children:[e.jsx(Ae,{children:e.jsxs(le,{children:[e.jsx(X,{children:"Payment Type"}),e.jsx(X,{children:"Paid Amount"}),e.jsx(X,{children:"Receiver Fee"}),e.jsx(X,{children:"Platform Fee"}),e.jsx(X,{children:"Penalty Amount"}),e.jsx(X,{children:"Discount Amount"})]})}),e.jsxs(Me,{children:[e.jsxs(le,{children:[e.jsx(w,{children:"Cash"}),e.jsx(w,{children:l==null?void 0:l.data.totals.cash.amountPaid}),e.jsx(w,{children:l==null?void 0:l.data.totals.cash.receiverFee}),e.jsx(w,{children:l==null?void 0:l.data.totals.cash.platformFee}),e.jsx(w,{children:l==null?void 0:l.data.totals.cash.penaltyAmount}),e.jsx(w,{children:l==null?void 0:l.data.totals.cash.discountAmount})]}),e.jsxs(le,{children:[e.jsx(w,{children:"Online"}),e.jsx(w,{children:l==null?void 0:l.data.totals.online.amountPaid}),e.jsx(w,{children:l==null?void 0:l.data.totals.online.receiverFee}),e.jsx(w,{children:l==null?void 0:l.data.totals.online.platformFee}),e.jsx(w,{children:l==null?void 0:l.data.totals.online.penaltyAmount}),e.jsx(w,{children:l==null?void 0:l.data.totals.online.discountAmount})]}),e.jsxs(le,{className:"font-bold bg-muted/50",children:[e.jsx(w,{children:"Grand Total"}),e.jsx(w,{children:l==null?void 0:l.data.totals.grand.amountPaid}),e.jsx(w,{children:l==null?void 0:l.data.totals.grand.receiverFee}),e.jsx(w,{children:l==null?void 0:l.data.totals.grand.platformFee}),e.jsx(w,{children:l==null?void 0:l.data.totals.grand.penaltyAmount}),e.jsx(w,{children:l==null?void 0:l.data.totals.grand.discountAmount})]})]})]})})]})]})]})};var Wt={exports:{}};(function(r,K){(function(v,u){u()})(Ce,function(){function v(o,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function u(o,c,I){var y=new XMLHttpRequest;y.open("GET",o),y.responseType="blob",y.onload=function(){l(y.response,c,I)},y.onerror=function(){console.error("could not download file")},y.send()}function D(o){var c=new XMLHttpRequest;c.open("HEAD",o,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function R(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(c)}}var j=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Ce=="object"&&Ce.global===Ce?Ce:void 0,L=j.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=j.saveAs||(typeof window!="object"||window!==j?function(){}:"download"in HTMLAnchorElement.prototype&&!L?function(o,c,I){var y=j.URL||j.webkitURL,g=document.createElement("a");c=c||o.name||"download",g.download=c,g.rel="noopener",typeof o=="string"?(g.href=o,g.origin===location.origin?R(g):D(g.href)?u(o,c,I):R(g,g.target="_blank")):(g.href=y.createObjectURL(o),setTimeout(function(){y.revokeObjectURL(g.href)},4e4),setTimeout(function(){R(g)},0))}:"msSaveOrOpenBlob"in navigator?function(o,c,I){if(c=c||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(v(o,I),c);else if(D(o))u(o,c,I);else{var y=document.createElement("a");y.href=o,y.target="_blank",setTimeout(function(){R(y)})}}:function(o,c,I,y){if(y=y||open("","_blank"),y&&(y.document.title=y.document.body.innerText="downloading..."),typeof o=="string")return u(o,c,I);var g=o.type==="application/octet-stream",G=/constructor/i.test(j.HTMLElement)||j.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||g&&G||L)&&typeof FileReader<"u"){var B=new FileReader;B.onloadend=function(){var d=B.result;d=_?d:d.replace(/^data:[^;]*;/,"data:attachment/file;"),y?y.location.href=d:location=d,y=null},B.readAsDataURL(o)}else{var F=j.URL||j.webkitURL,f=F.createObjectURL(o);y?y.location=f:location.href=f,y=null,setTimeout(function(){F.revokeObjectURL(f)},4e4)}});j.saveAs=l.saveAs=l,r.exports=l})})(Wt);const Gt=[{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"3monthly",label:"3 Monthly"}],Qt=()=>{const{chapterData:r}=Oe(),{downloadFromResponse:K,downloadDialogState:v,closeDownloadDialog:u}=De(),[D,R]=p.useState([]),[j,L]=p.useState(""),[l,o]=p.useState("monthly"),[c,I]=p.useState(null),[y,g]=p.useState(!1),[G,_]=p.useState(!1),[B,F]=p.useState(""),[f,d]=p.useState(!1),[U,O]=p.useState(""),[Y,T]=p.useState("");p.useEffect(()=>{r!=null&&r.chapterId&&oe.get(`/api/term/chapter/${r.chapterId}`).then(i=>R(i.data)).catch(()=>R([]))},[r]),p.useEffect(()=>{if(!(r!=null&&r.chapterId)||!j&&!f)return;g(!0);const i={period:l,...j&&!f?{termId:j}:{},...f?{startDate:U,endDate:Y}:{}};oe.get(`/api/report/${r.chapterId}/member-payment-summary-report`,{params:i}).then(a=>I(a.data)).catch(()=>I(null)).finally(()=>g(!1))},[r,j,l,f,U,Y]);const t=c==null?void 0:c.members.map((i,a)=>({...i,idx:a})).filter(i=>i.name.toLowerCase().includes(B.toLowerCase())),s=async()=>{_(!0);try{const i={period:l,...j&&!f?{termId:j}:{},...f?{startDate:U,endDate:Y}:{}},a=await oe.get(`/api/report/${r.chapterId}/member-payment-summary-report/export`,{params:i,responseType:"blob"});await K(a,"Member_Payment_Summary_Report.xlsx",{showSuccessToast:!0,allowShare:!0})}catch(i){console.error("Error exporting data:",i)}finally{_(!1)}},n=async()=>{v.shareCallback&&await v.shareCallback()};return e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[e.jsx(Le,{isOpen:v.isOpen,onClose:u,filename:v.filename,onShare:n}),e.jsx("h2",{className:"text-title-md2 font-semibold text-black dark:text-white",children:"Member Payment Summary Report"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-center",children:[e.jsxs(je,{value:j,onValueChange:L,disabled:f,children:[e.jsx(be,{className:"w-[180px]",children:e.jsx(we,{placeholder:"Select Term"})}),e.jsx(ve,{children:e.jsxs(Pe,{children:[e.jsx(Te,{children:"Term"}),D.map(i=>e.jsx(Ne,{value:i.termId||i.id,children:i.termName||i.name||i.termId},i.termId||i.id))]})})]}),e.jsxs(je,{value:l,onValueChange:o,children:[e.jsx(be,{className:"w-[180px]",children:e.jsx(we,{placeholder:"Select Period"})}),e.jsx(ve,{children:e.jsxs(Pe,{children:[e.jsx(Te,{children:"Period"}),Gt.map(i=>e.jsx(Ne,{value:i.value,children:i.label},i.value))]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{htmlFor:"customRange",children:"Custom Date?"}),e.jsx(Dt,{id:"customRange",checked:f,onCheckedChange:d})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{type:"date",value:U,onChange:i=>O(i.target.value)}),e.jsx(qe,{type:"date",value:Y,onChange:i=>T(i.target.value)})]}),c&&c.periodLabels&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx(ne,{variant:"outline",onClick:s,disabled:G,children:G?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"animate-spin w-4 h-4 mr-2 inline"})," ","Exporting..."]}):"Export to Excel"})})]}),e.jsx(qe,{type:"text",placeholder:"Search member...",value:B,onChange:i=>F(i.target.value),className:"w-full max-w-md"}),y?e.jsxs("div",{className:"flex justify-center items-center py-16 text-muted-foreground",children:[e.jsx(at,{className:"animate-spin w-6 h-6 mr-2"}),"Loading report..."]}):c&&c.periodLabels?e.jsxs($e,{className:"overflow-auto p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4",children:["Total Transactions (",c.period,")"]}),e.jsx("div",{className:"overflow-y-auto rounded-md border",children:e.jsxs(Ie,{className:"text-sm",children:[e.jsx(Ae,{children:e.jsxs(le,{children:[e.jsx(X,{children:"Member"}),c.periodLabels.map((i,a)=>{var h;return e.jsx(X,{className:"text-right",children:i.includes("-")?i:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{children:i}),e.jsx("span",{className:"text-xs text-gray-400",children:((h=c.periodDates)==null?void 0:h[a])&&`(${he(new Date(c.periodDates[a].start),"d MMM")} - ${he(new Date(c.periodDates[a].end),"d MMM")})`})]})},a)}),e.jsx(X,{className:"text-right font-bold",children:"Total"})]})}),e.jsxs(Me,{children:[(t??[]).map(({memberId:i,name:a,idx:h})=>e.jsxs(le,{children:[e.jsx(w,{className:"font-medium",children:a}),c.matrix[h].map((A,Q)=>e.jsxs(w,{className:"text-right",children:["₹",A]},Q)),e.jsxs(w,{className:"text-right font-bold",children:["₹",c.totals[h]]})]},i)),!B&&e.jsxs(le,{className:"bg-muted/40 font-semibold",children:[e.jsx(w,{children:"Grand Total"}),c.periodLabels.map((i,a)=>{const h=c.matrix.reduce((A,Q)=>A+(Q[a]||0),0);return e.jsxs(w,{className:"text-right",children:["₹",h]},a)}),e.jsxs(w,{className:"text-right text-primary",children:["₹",c.grandTotal]})]})]})]})})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No data to display. Please select a term or date range and period."})]})},lt=[{label:"Member Wise Report",reports:[{value:"member_due_summary",label:"Member Due Summary Report",component:$t},{value:"member_ledger",label:"Member Ledger",component:Bt},{value:"member_payment_summary_report",label:"Member Payment Summary Report",component:Qt}]},{label:"Chapter Report",reports:[{value:"all_transactions",label:"All Transactions",component:Kt},{value:"receiver_daywise_report",label:"Receiver Daily Report",component:qt}]}],$s=()=>{const[r,K]=xt();Xe();const v=r.get("type")||"",u=j=>{K({type:j})},R=lt.flatMap(j=>j.reports).find(j=>j.value===v);return e.jsxs(e.Fragment,{children:[e.jsx(gt,{items:[{name:"Reports"}]}),e.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-3 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-lg font-medium dark:text-white",children:"View Your Chapter's Reports"})}),e.jsx("div",{children:e.jsxs(je,{value:v,onValueChange:u,className:"w-full",children:[e.jsx(be,{className:"w-[280px]",children:e.jsx(we,{placeholder:"Select a report type you want to view"})}),e.jsx(ve,{children:lt.map(j=>e.jsxs(Pe,{children:[e.jsx(Te,{children:j.label}),j.reports.map(L=>e.jsx(Ne,{value:L.value,children:L.label},L.value))]},j.label))})]})}),R&&e.jsx(R.component,{})]})]})};export{$s as default};
