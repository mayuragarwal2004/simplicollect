import{e as Ue,u as Be,r,j as e,B as n,C as v,i as N,Q as o}from"./index.js";import{I as Le}from"./input.js";import{B as f}from"./badge.js";import{S as A,a as k,b as R,c as M,d as i}from"./select.js";import{D as B,a as L,b as V,c as z}from"./dialog.js";import{T as ie}from"./textarea.js";import{S as ne}from"./separator.js";import{A as Ve,e as ze,a as He,b as _e,c as $e,f as qe,d as Ge,g as We,h as Ye}from"./alert-dialog.js";import{C as Ze,t as Je,x as h}from"./categories.js";import{R as D}from"./refresh-cw.js";import{M as ce,P as oe}from"./phone.js";import{C as Ke}from"./clock.js";import{E as de}from"./eye.js";import{C as Xe}from"./circle-check-big.js";import{S as es}from"./search.js";import{U as me}from"./user.js";import{M as xe}from"./mail.js";import{C as ss}from"./calendar.js";import{S as as}from"./square-pen.js";import{T as ts}from"./trash-2.js";import"./index10.js";import"./index4.js";import"./index11.js";import"./index9.js";import"./index5.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./check.js";import"./chevron-up.js";import"./index3.js";import"./index6.js";const Qs=()=>{const{queryId:d}=Ue(),X=Be(),[y,u]=r.useState([]),[b,he]=r.useState(null),[w,ee]=r.useState(!0),[a,x]=r.useState(null),[ue,C]=r.useState(!1),[pe,se]=r.useState(!1),[T,je]=r.useState(""),[P,ge]=r.useState("all"),[F,ve]=r.useState("all"),[I,Ne]=r.useState("all"),[H,fe]=r.useState("createdAt"),[_,ye]=r.useState("desc"),[p,ae]=r.useState(1),[be,we]=r.useState(!0),Ce=20,[Se,E]=r.useState(!1),[Ae,O]=r.useState(!1),[ke,Q]=r.useState(!1),[j,g]=r.useState(null),[$,q]=r.useState(""),[G,W]=r.useState(""),[Y,Z]=r.useState(""),te={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",under_review:"bg-blue-100 text-blue-800 border-blue-200",resolved:"bg-green-100 text-green-800 border-green-200",closed:"bg-gray-100 text-gray-800 border-gray-200"},re={low:"bg-gray-100 text-gray-700",medium:"bg-blue-100 text-blue-700",high:"bg-orange-100 text-orange-700",urgent:"bg-red-100 text-red-700"},S=async(s=!1,t=1)=>{try{ee(!0);const l={page:t-1,limit:Ce,...T&&{search:T},...P!=="all"&&{status:P},...F!=="all"&&{category:F},...I!=="all"&&{priority:I},sortBy:H,sortOrder:_},c=await h.getContactQueries(l);s||t===1?(u(c.data),ae(1)):u(c.data),we(c.pagination.hasMore),ae(t)}catch(l){console.error("Error fetching queries:",l),o.error(l.message||"Failed to fetch contact queries",{position:"top-right",autoClose:5e3})}finally{ee(!1)}},J=async()=>{try{const s=await h.getContactQueryStats();he(s)}catch(s){console.error("Error fetching stats:",s)}},Re=async s=>{se(!0);try{const t=await h.getContactQuery(s);x(t),C(!0),o.success(`Query loaded successfully (ID: ${s.substring(0,8)}...)`,{position:"top-right",autoClose:3e3}),window.scrollTo({top:0,behavior:"smooth"})}catch(t){console.error("Error fetching specific query:",t),o.error(t.message||"Failed to load the requested query. The query may not exist or you may not have permission to view it.",{position:"top-right",autoClose:8e3}),setTimeout(()=>{X("/admin/contact-queries")},3e3)}finally{se(!1)}},Me=async(s,t,l)=>{try{const c=await h.updateContactQueryStatus(s,t,l);u(m=>m.map(K=>K.queryId===s?{...K,...c}:K)),(a==null?void 0:a.queryId)===s&&x({...a,...c}),o.success(`Query status updated to ${t}`,{position:"top-right",autoClose:3e3}),J()}catch(c){console.error("Error updating status:",c),o.error(c.message||"Failed to update query status",{position:"top-right",autoClose:5e3})}},De=async(s,t)=>{try{const l=await h.addAdminNotes(s,t);u(c=>c.map(m=>m.queryId===s?{...m,...l}:m)),(a==null?void 0:a.queryId)===s&&x({...a,...l}),o.success("Admin notes have been saved",{position:"top-right",autoClose:3e3})}catch(l){console.error("Error adding notes:",l),o.error(l.message||"Failed to add admin notes",{position:"top-right",autoClose:5e3})}},Te=async(s,t)=>{try{const l=await h.addResponseMessage(s,t);u(c=>c.map(m=>m.queryId===s?{...m,...l}:m)),(a==null?void 0:a.queryId)===s&&x({...a,...l}),o.success("Your response has been sent to the user",{position:"top-right",autoClose:3e3})}catch(l){console.error("Error sending response:",l),o.error(l.message||"Failed to send response",{position:"top-right",autoClose:5e3})}},Pe=async s=>{try{await h.markAsSpam(s),u(t=>t.filter(l=>l.queryId!==s)),(a==null?void 0:a.queryId)===s&&(C(!1),x(null)),o.success("Query has been marked as spam and removed",{position:"top-right",autoClose:3e3}),J()}catch(t){console.error("Error marking as spam:",t),o.error(t.message||"Failed to mark query as spam",{position:"top-right",autoClose:5e3})}};r.useEffect(()=>{S(!0,1),J()},[T,P,F,I,H,_]),r.useEffect(()=>{d&&Re(d)},[d]);const Fe=()=>{j&&$&&(Me(j.queryId,$),E(!1),g(null),q(""))},Ie=()=>{j&&G.trim()&&(De(j.queryId,G.trim()),O(!1),g(null),W(""))},Ee=()=>{j&&Y.trim()&&(Te(j.queryId,Y.trim()),Q(!1),g(null),Z(""))},le=s=>{g(s),q(s.status),E(!0)},Oe=s=>{g(s),W(s.adminNotes||""),O(!0)},Qe=s=>{g(s),Z(""),Q(!0)},U=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Contact Queries"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Manage customer queries and support requests",d&&e.jsxs("span",{className:"ml-2 text-blue-600 font-medium",children:["â€¢ Viewing Query: ",d.substring(0,8),"..."]})]}),pe&&e.jsxs("div",{className:"flex items-center mt-2 text-blue-600",children:[e.jsx(D,{className:"w-4 h-4 animate-spin mr-2"}),"Loading specific query..."]})]}),e.jsxs("div",{className:"flex gap-3",children:[d&&e.jsx(n,{onClick:()=>{X("/admin/contact-queries"),x(null),C(!1),S(!0,1)},variant:"secondary",className:"flex items-center gap-2",children:"â† Back to All Queries"}),e.jsxs(n,{onClick:()=>S(!0,p),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Refresh"]})]})]}),b&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(v,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Queries"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.total})]}),e.jsx(ce,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:b.pending})]}),e.jsx(Ke,{className:"w-8 h-8 text-yellow-600"})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Under Review"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b.underReview})]}),e.jsx(de,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Resolved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:b.resolved})]}),e.jsx(Xe,{className:"w-8 h-8 text-green-600"})]})})})]}),e.jsx(v,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(es,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Le,{placeholder:"Search queries...",value:T,onChange:s=>je(s.target.value),className:"pl-10"})]})}),e.jsxs(A,{value:P,onValueChange:ge,children:[e.jsx(k,{children:e.jsx(R,{placeholder:"Status"})}),e.jsxs(M,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"under_review",children:"Under Review"}),e.jsx(i,{value:"resolved",children:"Resolved"}),e.jsx(i,{value:"closed",children:"Closed"})]})]}),e.jsxs(A,{value:F,onValueChange:ve,children:[e.jsx(k,{children:e.jsx(R,{placeholder:"Category"})}),e.jsxs(M,{children:[e.jsx(i,{value:"all",children:"All Categories"}),Ze.map(s=>e.jsx(i,{value:s.value,children:s.label},s.value))]})]}),e.jsxs(A,{value:I,onValueChange:Ne,children:[e.jsx(k,{children:e.jsx(R,{placeholder:"Priority"})}),e.jsxs(M,{children:[e.jsx(i,{value:"all",children:"All Priorities"}),e.jsx(i,{value:"low",children:"Low"}),e.jsx(i,{value:"medium",children:"Medium"}),e.jsx(i,{value:"high",children:"High"}),e.jsx(i,{value:"urgent",children:"Urgent"})]})]}),e.jsxs(A,{value:`${H}-${_}`,onValueChange:s=>{const[t,l]=s.split("-");fe(t),ye(l)},children:[e.jsx(k,{children:e.jsx(R,{placeholder:"Sort by"})}),e.jsxs(M,{children:[e.jsx(i,{value:"createdAt-desc",children:"Newest First"}),e.jsx(i,{value:"createdAt-asc",children:"Oldest First"}),e.jsx(i,{value:"priority-desc",children:"High Priority First"}),e.jsx(i,{value:"status-asc",children:"Status A-Z"})]})]})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-0",children:w&&y.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"w-8 h-8 animate-spin text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading queries..."})]})}):y.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No queries found"})]})}):e.jsxs("div",{className:"divide-y divide-gray-200",children:[y.map((s,t)=>e.jsx(Je.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},className:"p-6 hover:bg-gray-50 transition-colors duration-200",children:e.jsxs("div",{className:`flex items-start justify-between ${d===s.queryId?"bg-blue-50 border-2 border-blue-200 rounded-lg p-4 -m-2":""}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate max-w-md",children:s.subject}),d===s.queryId&&e.jsx(f,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"ðŸ“§ From Email"}),e.jsx(f,{className:te[s.status],children:s.status.replace("_"," ")}),e.jsx(f,{variant:"outline",className:re[s.priority],children:s.priority}),s.category&&e.jsx(f,{variant:"secondary",children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-4 h-4"}),s.name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),s.email]}),s.phoneNumber&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),s.phoneNumber]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ss,{className:"w-4 h-4"}),U(s.createdAt)]})]}),e.jsx("p",{className:"text-gray-700 line-clamp-2 mb-3",children:s.message}),s.assignedToName&&e.jsxs("p",{className:"text-sm text-blue-600",children:["Assigned to: ",s.assignedToName]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>{x(s),C(!0)},children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>le(s),children:e.jsx(as,{className:"w-4 h-4"})}),e.jsxs(Ve,{children:[e.jsx(ze,{asChild:!0,children:e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(ts,{className:"w-4 h-4 text-red-600"})})}),e.jsxs(He,{children:[e.jsxs(_e,{children:[e.jsx($e,{children:"Mark as Spam?"}),e.jsx(qe,{children:"This will mark the query as spam and remove it from the list. This action cannot be undone."})]}),e.jsxs(Ge,{children:[e.jsx(We,{children:"Cancel"}),e.jsx(Ye,{onClick:()=>Pe(s.queryId),className:"bg-red-600 hover:bg-red-700",children:"Mark as Spam"})]})]})]})]})]})},s.queryId)),y.length>0&&e.jsx("div",{className:"p-6 text-center border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",p," â€¢ Showing ",y.length," queries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{onClick:()=>S(!1,p-1),variant:"outline",size:"sm",disabled:p<=1||w,children:[w?e.jsx(D,{className:"w-3 h-3 animate-spin mr-1"}):null,"Previous"]}),e.jsxs("span",{className:"text-sm text-gray-500 px-3",children:["Page ",p]}),e.jsxs(n,{onClick:()=>S(!1,p+1),variant:"outline",size:"sm",disabled:!be||w,children:["Next",w?e.jsx(D,{className:"w-3 h-3 animate-spin ml-1"}):null]})]})]})})]})})}),e.jsx(B,{open:ue,onOpenChange:C,children:e.jsxs(L,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(V,{children:e.jsxs(z,{children:["Query Details",d&&e.jsx("span",{className:"ml-2 text-blue-600 font-normal text-sm",children:"(Accessed via email link)"})]})}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:a.subject}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a.email})]}),a.phoneNumber&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a.phoneNumber})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:te[a.status],children:a.status.replace("_"," ")}),e.jsx(f,{variant:"outline",className:re[a.priority],children:a.priority})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Created: ",U(a.createdAt)]}),e.jsxs("p",{children:["Updated: ",U(a.updatedAt)]}),a.resolvedAt&&e.jsxs("p",{children:["Resolved: ",U(a.resolvedAt)]})]})]})]}),e.jsx(ne,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Message"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsx("p",{className:"whitespace-pre-wrap",children:a.message})})]}),a.adminNotes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Admin Notes"}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsx("p",{className:"whitespace-pre-wrap",children:a.adminNotes})})]}),a.responseMessage&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Response Sent"}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsx("p",{className:"whitespace-pre-wrap",children:a.responseMessage})})]}),e.jsx(ne,{}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(n,{onClick:()=>le(a),variant:"outline",children:"Update Status"}),e.jsx(n,{onClick:()=>Oe(a),variant:"outline",children:"Add Notes"}),e.jsx(n,{onClick:()=>Qe(a),className:"bg-blue-600 hover:bg-blue-700",children:"Send Response"})]})]})]})}),e.jsx(B,{open:Se,onOpenChange:E,children:e.jsxs(L,{children:[e.jsx(V,{children:e.jsx(z,{children:"Update Status"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(A,{value:$,onValueChange:q,children:[e.jsx(k,{children:e.jsx(R,{placeholder:"Select new status"})}),e.jsxs(M,{children:[e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"under_review",children:"Under Review"}),e.jsx(i,{value:"resolved",children:"Resolved"}),e.jsx(i,{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(n,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),e.jsx(n,{onClick:Fe,children:"Update Status"})]})]})]})}),e.jsx(B,{open:Ae,onOpenChange:O,children:e.jsxs(L,{children:[e.jsx(V,{children:e.jsx(z,{children:"Add Admin Notes"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ie,{value:G,onChange:s=>W(s.target.value),placeholder:"Add internal notes about this query...",rows:6}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(n,{variant:"outline",onClick:()=>O(!1),children:"Cancel"}),e.jsx(n,{onClick:Ie,children:"Save Notes"})]})]})]})}),e.jsx(B,{open:ke,onOpenChange:Q,children:e.jsxs(L,{children:[e.jsx(V,{children:e.jsx(z,{children:"Send Response"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ie,{value:Y,onChange:s=>Z(s.target.value),placeholder:"Type your response to the user...",rows:8}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(n,{variant:"outline",onClick:()=>Q(!1),children:"Cancel"}),e.jsx(n,{onClick:Ee,children:"Send Response"})]})]})]})})]})};export{Qs as default};
