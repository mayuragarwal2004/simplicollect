import{g as G,r as m,c as $,Q as E,j as a,B as V,n as Ge,w as Xe,_ as Ze,s as Je,R as M,K as Q,H as X,e as oe}from"./index-CcyABReA.js";import{B as et}from"./Breadcrumb-Bt9gBFUs.js";import{f as z,C as tt}from"./ChooseMemberPopoverCommand-CxOK0rqG.js";import{T as at,a as st,b as fe,c as pe}from"./tabs-BznFmhnr.js";import{B as nt}from"./badge-BDjuXPks.js";import{C as te}from"./circle-alert-DP4OfBmj.js";import{B as ae}from"./banknote-0BhYRU4A.js";import{C as se}from"./credit-card-DOeWIGKD.js";import{C as ve}from"./chevron-right-w6QnsD3M.js";import{U as rt}from"./user-3DWMXxSa.js";import{S as ot}from"./skeleton-C2KhqAQG.js";import{S as it}from"./switch-Cyf8udgh.js";import{L as lt}from"./label-DkJgDQ9K.js";import{C as ct,S as dt,a as mt,b as ut,c as ht,d as ft}from"./select-B3urF3Hi.js";import{C as ye}from"./chevron-down-D_eirmdc.js";import{U as pt}from"./upload-Ak7A49ou.js";import{C as be}from"./chevron-left-D1BS-Pp4.js";import{A as gt,a as xt,b as vt,c as yt,f as bt,d as wt,g as jt,h as Ct}from"./alert-dialog-cHXoqju4.js";import{D as Nt,f as It,a as Pt}from"./dialog-BhvudPjP.js";import{B as Y,T as St,a as At}from"./Tabs-DyRzPKHu.js";import{B as _t}from"./Button-cjTG5LGp.js";import{I as Rt}from"./input-DI8PfTs9.js";import"./popover-XWgxwwby.js";import"./index-BXwgaSlv.js";import"./index-Bnm6sZYZ.js";import"./index-sjTRltFJ.js";import"./index-CWw0P0dO.js";import"./index-BiMNnMJT.js";import"./command-DzESqg9Q.js";import"./index-Bf-H7HrM.js";import"./search-Bl5VJYkV.js";import"./chevrons-up-down-BS_U-1YP.js";import"./index-BBmkKsXB.js";import"./index-B2Rd_dEO.js";import"./index-DshIeolU.js";import"./index-BdQq_4o_.js";import"./TransitionGroupContext-IJns4cnm.js";import"./useTheme-C2X5xctb.js";import"./CircularProgress-gEXcoAyw.js";const we=(r,e,t,s)=>{const n=new Date(e.packagePayableEndDate);if(typeof e.meetingIds=="string"&&(e.meetingIds=JSON.parse(e.meetingIds)),e.status==="pending")return{message:"You have applied for this package. Please wait for approval",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(e.status==="rejected")return{message:"Your package application has been rejected",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(e.status==="approved")return{message:"Your package application has been approved",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(e.packagePayableStartDate&&r<new Date(e.packagePayableStartDate))return{message:"Package is not open to payable yet",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(!e.allowAfterEndDate&&r>n)return{message:"Package is not open to payable anymore",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};if(e.allowPackagePurchaseIfFeesPaid&&Dt(e,t))return{message:"Package has overlapping payments",totalAmount:null,penaltyAmount:null,discountAmount:null,isDisabled:!0};let i=e.packageFeeAmount,o=0,l=0;const c=(d,v)=>{switch(d){case"Daily":return v;case"Weekly":return Math.ceil(v/7);case"Monthly":return Math.ceil(v/30);case"Quarterly":return Math.ceil(v/90);case"lumpsum":case"Meetingly":return 1;default:return 0}};if(r<=new Date(e.discountEndDate)){const d=Math.ceil((new Date(e.discountEndDate)-r)/864e5);l=c(e.discountType,d)*e.discountAmount}if(r>n&&e.allowPenaltyPayableAfterEndDate){const d=Math.ceil((r-n)/864e5);o=c(e.penaltyType,d)*e.penaltyAmount}let p=i+o-l,u=0;return u=Array.isArray(e.meetingIds)?e.meetingIds.reduce((d,v)=>{const w=t.find(f=>f.meetingId===v);return d+(w&&w.isPaid?w.meetingFeeMembers:0)},0):0,{totalAmount:p-s,penaltyAmount:o,discountAmount:l,paidFees:u,previousBalance:s,isDisabled:!e.allowAfterEndDate&&r>n}},Dt=(r,e)=>{var t;return(t=r.meetingIds)==null?void 0:t.some(s=>{const n=e.find(i=>i.meetingId===s);return n&&n.isPaid})},je=m.createContext(),Mt=({children:r})=>{const{chapterData:e}=G(),[t,s]=m.useState(new Date),n=m.useRef(!0),i=m.useRef(!1),[o,l]=m.useState({selectedReceiver:null,saveReceiverSelection:!1,selectedReceiverObject:null,receivers:[],selectedPackage:null,pendingPayments:[],packageData:null,parentType:null,packageParents:[],chapterMeetings:void 0,balance:void 0,lastUpdated:null,lastSelectedPackageTime:null,selectedMemberId:null,terms:[],selectedTermId:null}),c=()=>{l(x=>({...x,selectedPackage:null,selectedReceiver:null,selectedReceiverObject:null,saveReceiverSelection:!1,lastSelectedPackageTime:null}))},p=x=>{l(y=>({...y,selectedPackage:x,lastSelectedPackageTime:new Date}))},u=m.useCallback(async()=>{if(e!=null&&e.chapterId)try{const x=await $.get(`/api/feeReceiver/current/${e.chapterId}`,{params:{date:z(t)}});l(y=>({...y,receivers:x.data}))}catch(x){console.error("Error fetching current receivers:",x),E.error("Failed to fetch fee receivers")}},[e==null?void 0:e.chapterId,t]),h=async()=>{if(!(e!=null&&e.chapterId)){console.warn("Chapter ID is not available. Skipping terms fetch.");return}try{const x=await $.get(`/api/term/chapter/${e.chapterId}`),y=x.data.filter(I=>I.status==="active");let N=o.selectedTermId;if(!N||!y.find(I=>I.termId===N)){const I=new Date,S=y.find(P=>{const R=new Date(P.startDate),D=new Date(P.endDate);return I>=R&&I<=D});if(S)N=S.termId;else if(y.length>0){const P=y.filter(R=>new Date(R.startDate)>I);P.length>0?N=P.reduce((D,T)=>new Date(D.startDate)<new Date(T.startDate)?D:T).termId:N=y[0].termId}}l(I=>({...I,terms:x.data,selectedTermId:N}))}catch(x){console.error("Error fetching terms:",x),E.error("Failed to fetch terms")}},d=m.useCallback(async(x,y=null)=>{if(!(y||o.selectedTermId)||!(e!=null&&e.chapterId)){console.warn("No term selected or chapter ID missing. Skipping meetings fetch.");return}try{const I=await $.get(`/api/meetings/meetings/${e.chapterId}`,{params:{memberId:x||""}});l(S=>({...S,chapterMeetings:I.data}))}catch(I){console.error("Error fetching chapter meetings:",I),E.error("Failed to fetch meetings")}},[e==null?void 0:e.chapterId,o.selectedTermId]),v=m.useCallback(async x=>{if(e!=null&&e.chapterId)try{const y=await $.get(`/api/payment/balance/${e.chapterId}`,{params:{memberId:x||""}});l(N=>({...N,balance:y.data.balance}))}catch(y){console.error("Error fetching balance amounts:",y),E.error("Failed to fetch balance")}},[e==null?void 0:e.chapterId]),w=m.useCallback(async(x,y=null,N=null,I=null)=>{var D;const S=y||o.selectedTermId,P=N||o.chapterMeetings,R=I!==null?I:o.balance;if(!S||!(e!=null&&e.chapterId)){console.warn("No term selected or chapter ID missing. Skipping packages fetch.");return}try{const T=await $.get(`/api/packages/all/${e.chapterId}/term/${S}`,{params:{memberId:x||"",date:z(t)}}),F=[...new Set(T.data.map(j=>j.packageParent))].sort((j,k)=>j.localeCompare(k));console.log("Processing packages with:",{packages:((D=T.data)==null?void 0:D.length)||0,meetings:(P==null?void 0:P.length)||0,balance:R});const B=f(T.data,R,P);l(j=>({...j,packageParents:F,packageData:B,lastUpdated:new Date}))}catch(T){console.error("Error fetching packages:",T),E.error("Failed to fetch packages")}},[e==null?void 0:e.chapterId,o.selectedTermId,o.chapterMeetings,o.balance,t]),f=(x,y,N)=>(console.log("processPackageData called with:",{packagesCount:(x==null?void 0:x.length)||0,packagesValid:Array.isArray(x),meetingsCount:(N==null?void 0:N.length)||0,meetingsValid:!!N,balance:y}),!N||!Array.isArray(x)?(console.warn("Missing required data for package processing",{meetings:!!N,packages:Array.isArray(x)}),[]):x.map(I=>{const S=we(t,I,N,y||0);return{...I,...S}})),C=m.useCallback(async x=>{try{const y=await $.get("/api/payment/pendingPayments",{params:{memberId:x||""}});l(N=>({...N,pendingPayments:y.data}))}catch(y){console.error("Error fetching pending payments:",y),E.error("Failed to fetch pending payments")}},[]),g=async x=>{try{await $.delete(`/api/payment/deleteRequest/${x}`),await b(o.selectedMemberId),E.success("Request deleted successfully")}catch(y){console.error("Error deleting request:",y),E.error("Failed to delete request")}},b=m.useCallback(async(x=o.selectedMemberId)=>{var y;if(!(e!=null&&e.chapterId)||i.current){console.warn("Chapter ID not available or already loading");return}i.current=!0,console.log("Starting fetchAllData for member:",x);try{l(P=>({...P,selectedMemberId:x})),await Promise.all([u(),C(x)]);const N=await $.get(`/api/term/chapter/${e.chapterId}`),I=N.data.filter(P=>P.status==="active");let S=o.selectedTermId;if(!S||!I.find(P=>P.termId===S)){const P=new Date,R=I.find(D=>{const T=new Date(D.startDate),F=new Date(D.endDate);return P>=T&&P<=F});if(R)S=R.termId;else if(I.length>0){const D=I.filter(T=>new Date(T.startDate)>P);D.length>0?S=D.reduce((F,B)=>new Date(F.startDate)<new Date(B.startDate)?F:B).termId:S=I[0].termId}}if(console.log("Selected term ID:",S),l(P=>({...P,terms:N.data,selectedTermId:S})),S){console.log("Fetching meetings and balance...");const[P,R]=await Promise.all([$.get(`/api/meetings/meetings/${e.chapterId}`,{params:{memberId:x||""}}),$.get(`/api/payment/balance/${e.chapterId}`,{params:{memberId:x||""}})]);console.log("Meetings fetched:",((y=P.data)==null?void 0:y.length)||0),console.log("Balance fetched:",R.data.balance),l(D=>({...D,chapterMeetings:P.data,balance:R.data.balance})),console.log("Fetching packages with fresh data..."),await w(x,S,P.data,R.data.balance),console.log("All data fetched successfully")}else console.warn("No term ID available to fetch dependent data")}catch(N){console.error("Error in fetchAllData:",N),E.error("Failed to fetch payment data")}finally{i.current=!1,n.current=!1}},[e==null?void 0:e.chapterId,o.selectedTermId,u,C,w]);return m.useEffect(()=>{e!=null&&e.chapterId&&n.current&&(console.log("Initial load triggered for chapter:",e.chapterId),b(o.selectedMemberId))},[e==null?void 0:e.chapterId,b]),m.useEffect(()=>{!n.current&&(e!=null&&e.chapterId)&&(console.log("Calculation date changed, refetching data"),b(o.selectedMemberId))},[t]),m.useEffect(()=>{o.selectedTermId&&o.selectedMemberId&&(d(o.selectedMemberId,o.selectedTermId),v(o.selectedMemberId))},[o.selectedTermId]),m.useEffect(()=>{if(o.selectedReceiver){const x=o.receivers.find(y=>y.receiverId===o.selectedReceiver);l(y=>({...y,selectedReceiverObject:x}))}},[o.selectedReceiver]),m.useEffect(()=>{const N=setInterval(()=>{const I=new Date,S=o.lastUpdated,P=o.lastSelectedPackageTime;S&&I-S>3e5&&(o.selectedPackage&&P?I-P>6e5?(E.warn("Payment window will timeout in 10 seconds..."),setTimeout(()=>{E.warn("Payment window has timed out. Refreshing data now..."),c(),b(o.selectedMemberId)},1e4)):E.info("Data will be refreshed soon due to inactivity"):(E.info("Data is stale. Refreshing now..."),b(o.selectedMemberId)))},6e4);return()=>clearInterval(N)},[o.lastUpdated,o.lastSelectedPackageTime,o.selectedPackage,o.selectedMemberId]),console.log({mainData:o.packageData}),a.jsx(je.Provider,{value:{calculationDate:t,setCalculationDate:s,paymentData:o,setPaymentData:l,resetPaymentData:c,selectPackage:p,fetchAllData:b,handleDeletePendingRequest:g,setSelectedTermId:x=>l(y=>({...y,selectedTermId:x})),fetchCurrentReceivers:u,fetchTerms:h,fetchMeetings:d,fetchDueAmount:v,fetchPackages:w,fetchPendingPayments:C},children:r})},W=()=>{const r=m.useContext(je);if(!r)throw new Error("usePaymentData must be used within a PaymentDataProvider");return r},kt=({setStep:r,handlePackagePayModalClose:e})=>{const{paymentData:t,setPaymentData:s}=W(),[n,i]=m.useState(!1),[o,l]=m.useState(""),c=()=>{t.paymentMethod?t.selectedReceiver?t.receivers.filter(u=>u.receiverId===t.selectedReceiver&&u.paymentType===t.paymentMethod).length===0?l("Invalid Receiver for the selected payment method"):(l(""),r(2)):l("Please select a receiver"):l("Please select a payment method")},p=u=>{const h=t.receivers.filter(d=>d.paymentType===u);return h.length===0?a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"flex items-center justify-center p-8 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx(te,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["No ",u==="cash"?"Cash":"Online"," Receivers Available"]}),a.jsxs("p",{className:"text-gray-500 mb-4",children:["There are currently no ",u==="cash"?"cash collection":"online payment"," receivers set up for this chapter."]}),a.jsxs("p",{className:"text-sm text-gray-400",children:["Please contact your chapter admin to set up ",u==="cash"?"cash":"online"," receivers."]})]})})}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[u==="cash"?a.jsx(ae,{className:"h-5 w-5 text-green-600"}):a.jsx(se,{className:"h-5 w-5 text-blue-600"}),a.jsxs("h3",{className:"text-lg font-medium",children:["Select a ",u==="cash"?"Cash":"Online"," Receiver"]})]}),a.jsx("div",{className:"grid gap-3 max-h-60 overflow-y-auto pr-2",children:h.map(d=>a.jsx(Ge,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${t.selectedReceiver===d.receiverId?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300"}`,onClick:()=>{s(v=>({...v,selectedReceiver:d.receiverId})),l("")},children:a.jsx(Xe,{className:"p-3 sm:p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center ${t.selectedReceiver===d.receiverId?"bg-blue-100":"bg-gray-100"}`,children:a.jsx(rt,{className:`h-4 w-4 sm:h-5 sm:w-5 ${t.selectedReceiver===d.receiverId?"text-blue-600":"text-gray-600"}`})})}),a.jsx("div",{className:"min-w-0 flex-1",children:a.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:d.receiverName})})]}),t.selectedReceiver===d.receiverId&&a.jsx("div",{className:"flex-shrink-0 ml-2",children:a.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-blue-500 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]})})},d.receiverId))}),o&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[a.jsx(te,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),a.jsx("p",{className:"text-red-700 text-sm",children:o})]})]})};return m.useEffect(()=>{const u=t.receivers.filter(d=>d.paymentType==="cash"),h=t.receivers.filter(d=>d.paymentType==="online");u.length>0&&h.length>0?(s(d=>({...d,paymentMethod:d.paymentMethod||"cash"})),i(!0)):u.length>0?(s(d=>({...d,paymentMethod:"cash"})),i(!1)):(h.length>0&&s(d=>({...d,paymentMethod:"online"})),i(!1))},[t.receivers]),a.jsxs("div",{className:"flex flex-col h-full max-h-[80vh] overflow-hidden",children:[a.jsxs("div",{className:"flex-shrink-0 pb-4 border-b border-gray-200",children:[a.jsx("h2",{className:"text-xl font-semibold mb-2",children:n?"Select Payment Method":"Payment Method"}),t.receivers.length===0&&a.jsx("p",{className:"text-gray-600 text-sm",children:"Choose how you'd like to make your payment"})]}),a.jsx("div",{className:"flex-1 overflow-y-auto py-4 space-y-6 min-h-0",children:t.receivers.length===0?a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"flex items-center justify-center p-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:a.jsxs("div",{className:"text-center max-w-md",children:[a.jsx(te,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-3",children:"No Payment Receivers Available"}),a.jsx("p",{className:"text-gray-600 mb-4 leading-relaxed",children:"There are currently no payment receivers set up for this chapter. Payment receivers are required to process your fee payment."}),a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[a.jsx("p",{className:"text-blue-800 text-sm font-medium mb-2",children:"What you can do:"}),a.jsxs("ul",{className:"text-blue-700 text-sm space-y-1 text-left",children:[a.jsx("li",{children:"• Contact your chapter administrator"}),a.jsx("li",{children:"• Ask them to set up cash or online receivers"}),a.jsx("li",{children:"• Try again once receivers are configured"})]})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Chapter admins can set up receivers in the Fee Receiver management section"})]})})}):a.jsxs(at,{value:t.paymentMethod,className:"w-full",onValueChange:u=>{s(h=>({...h,paymentMethod:u,selectedReceiver:""})),l("")},children:[n?a.jsxs(st,{className:"grid w-full grid-cols-2 mb-6",children:[a.jsxs(fe,{value:"cash",className:"flex items-center gap-2",children:[a.jsx(ae,{className:"h-4 w-4"}),"Cash"]}),a.jsxs(fe,{value:"online",className:"flex items-center gap-2",children:[a.jsx(se,{className:"h-4 w-4"}),"Online"]})]}):a.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-blue-50 border-blue-200",children:a.jsxs("div",{className:"flex items-center gap-2",children:[t.paymentMethod==="cash"?a.jsx(ae,{className:"h-5 w-5 text-blue-600"}):a.jsx(se,{className:"h-5 w-5 text-blue-600"}),a.jsx("span",{className:"font-medium text-blue-900",children:t.paymentMethod==="cash"?"Cash Payment":"Online Payment"}),a.jsx(nt,{variant:"secondary",className:"ml-auto",children:"Only Available Method"})]})}),a.jsx(pe,{value:"cash",className:"mt-0",children:p("cash")}),a.jsx(pe,{value:"online",className:"mt-0",children:p("online")})]})}),a.jsx("div",{className:"flex-shrink-0 pt-4 border-t border-gray-200",children:a.jsxs("div",{className:"flex justify-between",children:[a.jsx(V,{variant:"outline",onClick:()=>e(),children:"Cancel"}),t.receivers.length>0&&a.jsxs(V,{onClick:c,disabled:!t.selectedReceiver,children:["Next",a.jsx(ve,{className:"h-4 w-4 ml-1"})]})]})})]})};class A{constructor(e,t,s,n,i){this._legacyCanvasSize=A.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),s&&typeof s=="object"?this._onDecode=t:(console.warn(s||n||i?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t=typeof s=="object"?s:{},this._onDecodeError=t.onDecodeError||(typeof s=="function"?s:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||(typeof n=="function"?n:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||i||this._preferredCamera,this._legacyCanvasSize=typeof s=="number"?s:typeof n=="number"?n:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let o=!1;if(e.hidden&&(e.hidden=!1,o=!0),document.body.contains(e)||(document.body.appendChild(e),o=!0),s=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(n=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),i=this.$overlay.style,i.position="absolute",i.display="none",i.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!n&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}s.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let l=window.getComputedStyle(e);l.display==="none"&&(e.style.setProperty("display","block","important"),o=!0),l.visibility!=="visible"&&(e.style.setProperty("visibility","visible","important"),o=!0),o&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=A.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await A.listCameras(!1)).length}catch{return!1}}static async listCameras(e=!1){if(!navigator.mediaDevices)return[];let t=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput"),s;try{e&&(await t()).every(n=>!n.label)&&(s=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await t()).map((n,i)=>({id:n.deviceId,label:n.label||(i===0?"Default Camera":`Camera ${i+1}`)}))}finally{s&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),A._stopVideoStream(s))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch{return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),A._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),A._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?A._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}}stop(){this.pause(),this._active=!1}async pause(e=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(A._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(s=>setTimeout(s,300)),this._paused?(t(),!0):!1)}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,s,n,i=!1,o=!1){let l,c=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(l=t.scanRegion,s=t.qrEngine,n=t.canvas,i=t.disallowCanvasResizing||!1,o=t.alsoTryWithoutScanRegion||!1,c=!0):console.warn(t||s||n||i||o?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!s;try{let p,u;[s,p]=await Promise.all([s||A.createQrEngine(),A._loadImage(e)]),[n,u]=A._drawToCanvas(p,l,n,i);let h;if(s instanceof Worker){let d=s;t||A._postWorkerMessageSync(d,"inversionMode","both"),h=await new Promise((v,w)=>{let f,C,g,b=-1;C=y=>{y.data.id===b&&(d.removeEventListener("message",C),d.removeEventListener("error",g),clearTimeout(f),y.data.data!==null?v({data:y.data.data,cornerPoints:A._convertPoints(y.data.cornerPoints,l)}):w(A.NO_QR_CODE_FOUND))},g=y=>{d.removeEventListener("message",C),d.removeEventListener("error",g),clearTimeout(f),w("Scanner error: "+(y?y.message||y:"Unknown Error"))},d.addEventListener("message",C),d.addEventListener("error",g),f=setTimeout(()=>g("timeout"),1e4);let x=u.getImageData(0,0,n.width,n.height);b=A._postWorkerMessageSync(d,"decode",x,[x.data.buffer])})}else h=await Promise.race([new Promise((d,v)=>window.setTimeout(()=>v("Scanner error: timeout"),1e4)),(async()=>{try{var[d]=await s.detect(n);if(!d)throw A.NO_QR_CODE_FOUND;return{data:d.rawValue,cornerPoints:A._convertPoints(d.cornerPoints,l)}}catch(v){if(d=v.message||v,/not implemented|service unavailable/.test(d))return A._disableBarcodeDetector=!0,A.scanImage(e,{scanRegion:l,canvas:n,disallowCanvasResizing:i,alsoTryWithoutScanRegion:o});throw`Scanner error: ${d}`}})()]);return c?h:h.data}catch(p){if(!l||!o)throw p;let u=await A.scanImage(e,{qrEngine:s,canvas:n,disallowCanvasResizing:i});return c?u:u.data}finally{t||A._postWorkerMessage(s,"close")}}setGrayscaleWeights(e,t,s,n=!0){A._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:s,useIntegerApproximation:n})}setInversionMode(e){A._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>Ze(()=>import("./qr-scanner-worker.min-D85Z9gVD.js"),[]).then(s=>s.createWorker()),!(!A._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:s})=>/Chromium/i.test(s))&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:s,platformVersion:n})=>/arm/i.test(s||"arm")&&13<=parseInt(n||"13")).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(.6666666666666666*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,s=e.videoHeight,n=e.offsetWidth,i=e.offsetHeight,o=e.offsetLeft,l=e.offsetTop,c=window.getComputedStyle(e),p=c.objectFit,u=t/s,h=n/i;switch(p){case"none":var d=t,v=s;break;case"fill":d=n,v=i;break;default:(p==="cover"?u>h:u<h)?(v=i,d=v*u):(d=n,v=d/u),p==="scale-down"&&(d=Math.min(d,t),v=Math.min(v,s))}var[w,f]=c.objectPosition.split(" ").map((g,b)=>{const x=parseFloat(g);return g.endsWith("%")?(b?i-v:n-d)*x/100:x});c=this._scanRegion.width||t,h=this._scanRegion.height||s,p=this._scanRegion.x||0;var C=this._scanRegion.y||0;u=this.$overlay.style,u.width=`${c/t*d}px`,u.height=`${h/s*v}px`,u.top=`${l+f+C/s*v}px`,s=/scaleX\(-1\)/.test(e.style.transform),u.left=`${o+(s?n-w-d:w)+(s?t-p-c:p)/t*d}px`,u.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let s=t.x||0,n=t.y||0,i=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let o of e)o.x=o.x*i+s,o.y=o.y*t+n;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(n=>setTimeout(n,t-e)),this._lastScanTimestamp=Date.now();try{var s=await A.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(n){if(!this._active)return;this._onDecodeError(n)}!A._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=A.createQrEngine()),s?(this._onDecode?this._onDecode(s):this._legacyOnDecode&&this._legacyOnDecode(s.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",s.cornerPoints.map(({x:n,y:i})=>`${n},${i}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==A.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],s=t.map(n=>Object.assign({},n,{[e]:{exact:this._preferredCamera}}));for(let n of[...s,...t])try{let i=await navigator.mediaDevices.getUserMedia({video:n,audio:!1}),o=this._getFacingMode(i)||(n.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:i,facingMode:o}}catch{}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+(e==="user"?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,s,n=!1){s=s||document.createElement("canvas");let i=t&&t.x?t.x:0,o=t&&t.y?t.y:0,l=t&&t.width?t.width:e.videoWidth||e.width,c=t&&t.height?t.height:e.videoHeight||e.height;return n||(n=t&&t.downScaledWidth?t.downScaledWidth:l,t=t&&t.downScaledHeight?t.downScaledHeight:c,s.width!==n&&(s.width=n),s.height!==t&&(s.height=t)),t=s.getContext("2d",{alpha:!1}),t.imageSmoothingEnabled=!1,t.drawImage(e,i,o,l,c,0,0,s.width,s.height),[s,t]}static async _loadImage(e){if(e instanceof Image)return await A._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(e instanceof File||e instanceof Blob||e instanceof URL||typeof e=="string"){let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await A._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(e){e.complete&&e.naturalWidth!==0||await new Promise((t,s)=>{let n=i=>{e.removeEventListener("load",n),e.removeEventListener("error",n),i instanceof ErrorEvent?s("Image load error"):t()};e.addEventListener("load",n),e.addEventListener("error",n)})}static async _postWorkerMessage(e,t,s,n){return A._postWorkerMessageSync(await e,t,s,n)}static _postWorkerMessageSync(e,t,s,n){if(!(e instanceof Worker))return-1;let i=A._workerMessageId++;return e.postMessage({id:i,type:t,data:s},n),i}}A.DEFAULT_CANVAS_SIZE=400;A.NO_QR_CODE_FOUND="No QR code found";A._disableBarcodeDetector=!1;A._workerMessageId=0;const Et=({onClose:r,onPaymentSuccess:e,setStep:t,handlePackagePayModalClose:s})=>{const{paymentData:{selectedPackage:n,chapterMeetings:i,receivers:o,selectedReceiver:l,selectedReceiverObject:c,receiverFeeAmount:p,paymentProof:u,platformFee:h,platformFeeAmount:d,platformFeeType:v},setPaymentData:w}=W(),{chapterData:f}=G(),[C]=m.useState(new Date().toLocaleDateString()),[g,b]=m.useState(!1),[x,y]=m.useState([]),[N,I]=m.useState(!1),[S,P]=m.useState(!0),[R,D]=m.useState(n.totalAmount),[T,F]=m.useState(0);m.useEffect(()=>{if(n.meetingIds&&i){const j=i.filter(k=>n.meetingIds.includes(k.meetingId));y(j)}},[n.meetingIds,i]),m.useEffect(()=>{if(c)if(c.receiverAmountType==="lumpsum"&&S)w(j=>({...j,receiverFeeAmount:c.receiverAmount}));else if(c.receiverAmountType==="percentage"&&S){const j=n.totalAmount*c.receiverAmount/100;w(k=>({...k,receiverFeeAmount:j}))}else w(j=>({...j,receiverFeeAmount:0}))},[c,n,S]),m.useEffect(()=>{if(f)if(f.platformFeeCase!=="per-payment")w(j=>({...j,platformFeeAmount:0}));else if(f.platformFeeType==="Lumpsum")w(j=>({...j,platformFeeAmount:f.platformFee}));else if(f.platformFeeType==="Percentage"){const j=n.totalAmount*f.platformFee;w(k=>({...k,platformFeeAmount:j}))}else w(j=>({...j,platformFeeAmount:0}))},[f,n]);const B=j=>{const k=j.target.files[0];k&&w(L=>({...L,paymentProof:k}))};return a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[1000]",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg shadow-xl relative max-h-[90vh] overflow-y-auto",children:[a.jsx("h2",{className:"text-2xl font-semibold text-gray-800 text-center mb-4",children:"Payment Overview"}),a.jsxs("div",{className:"border p-4 rounded-lg mb-4 bg-gray-50",children:[a.jsx("p",{className:"text-gray-700 font-semibold text-lg",children:"Total Payable Amount:"}),a.jsxs("p",{className:"text-3xl font-bold text-blue-600",children:["₹",parseInt(n.totalAmount)+(parseInt(p)||0)+(parseInt(d)||0)]}),a.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[a.jsxs("p",{children:["₹",n.packageFeeAmount," (Original Amount)"]}),n.penaltyAmount>0&&a.jsxs("p",{className:"text-red-500",children:["+ ₹",n.penaltyAmount," (Penalty)"]}),n.discountAmount>0&&a.jsxs("p",{className:"text-green-500",children:["- ₹",n.discountAmount," (Discount)"]}),n.previousBalance!==0&&a.jsxs("p",{className:"text-orange-500",children:[" ",n.previousBalance>0?"-":"+"," ₹",Math.abs(n.previousBalance)," (",n.previousBalance>0?"Advance":"Previous Due",")"]}),n.paidFees>0&&a.jsxs("p",{className:"text-blue-500",children:["- ₹",n.paidFees," (Paid Previously)"]}),p>0&&a.jsxs("p",{className:"text-blue-500",children:["+ ₹",p," (Receiver Fee)"]}),d>0&&a.jsxs("p",{className:"text-blue-500",children:["+ ₹",d," (Platform Fee)"]})]})]}),c.receiverFeeOptional!==0&&(c==null?void 0:c.receiverFeeOptional)&&a.jsxs("div",{className:"flex items-center space-x-4 my-4",children:[a.jsx(it,{checked:S,onCheckedChange:j=>P(j),className:"h-5"}),a.jsx(lt,{className:"text-lg",children:(c==null?void 0:c.receiverFeeOptionalMessage)||"Would you like to pay the receiver fee? (charges applicable)"})," "]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("p",{className:"text-gray-700 font-semibold",children:"Meetings Included:"}),a.jsxs("button",{onClick:()=>b(!g),className:"flex items-center text-lg font-medium text-blue-500 hover:underline focus:outline-none",children:[x.length," Meetings",g?a.jsx(ct,{className:"ml-2",size:18}):a.jsx(ye,{className:"ml-2",size:18})]}),g&&a.jsx("div",{className:"mt-2 max-h-[200px] overflow-y-auto",children:x.length>0?x==null?void 0:x.map(j=>a.jsxs("div",{className:`border p-2 rounded mb-2 ${j.isPaid?"bg-green-100":""}`,children:[a.jsx("p",{children:a.jsx("strong",{children:j.meetingName})}),a.jsxs("p",{children:[z(j.meetingDate)," at"," ",j.meetingTime]}),j.isPaid&&a.jsx("p",{className:"text-green-500 font-semibold",children:"Paid"})]},j.meetingId)):a.jsx("p",{children:"No meetings found"})})]}),a.jsxs("div",{children:["You are paying to ",c==null?void 0:c.receiverName,".",a.jsx("p",{className:"text-blue-500 cursor-pointer",onClick:()=>t(1),children:"Click here to change receiver."})]}),c&&c.qrImageLink&&a.jsxs("div",{className:"mt-4",children:[a.jsx(Tt,{imageUrl:c.qrImageLink}),a.jsxs("div",{className:"flex justify-between mb-4",children:[a.jsx(V,{variant:"outline",onClick:()=>{E.warn("This feature may not work on all browsers. If it doesn't work, please download the QR Code and scan it using a QR Code scanner app."),fetch(c.qrImageLink).then(j=>j.blob()).then(j=>{const k=URL.createObjectURL(j),L=new Image;L.crossOrigin="Anonymous",L.src=k,L.onload=async()=>{try{const _=await A.scanImage(L);URL.revokeObjectURL(k),_.indexOf("://")||_.startsWith("http://")||_.startsWith("https://")?window.open(_,"_blank"):E.error("QR Code does not contain a valid link.")}catch(_){console.error("QR decoding failed:",_),E.error("Failed to decode QR Code.")}}}).catch(j=>{E.error("Error fetching QR Code image"),console.error(j)})},children:"Open QR Link"}),a.jsx(V,{variant:"outline",onClick:()=>{fetch(c.qrImageLink).then(j=>j.blob()).then(j=>{const k=document.createElement("a");k.href=URL.createObjectURL(j);const L=`QR_Code_${c.receiverName}.png`;k.download=L,k.click(),URL.revokeObjectURL(k.href)}).catch(j=>{E.error("Error downloading QR Code"),console.error(j)})},children:"Download QR Code"})]}),a.jsx("p",{className:"text-gray-700 font-semibold",children:"Upload Payment Proof:"}),a.jsxs("label",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 p-4 rounded-lg cursor-pointer hover:bg-gray-100 transition",children:[a.jsx(pt,{className:"text-gray-500",size:24}),a.jsx("span",{className:"text-gray-600 mt-2 text-sm",children:"Click to select or drag and drop an image here"}),a.jsx("input",{type:"file",name:"file",accept:"image/*",onChange:B,className:"hidden"})]}),u&&a.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Uploaded: ",u.name]})]}),a.jsxs("div",{className:"flex justify-between mt-2",children:[a.jsxs(V,{variant:"outline",onClick:()=>t(1),children:[a.jsx(be,{}),"Back"]}),a.jsxs(V,{onClick:()=>{w(j=>({...j,totalPayableAmount:(parseInt(n.totalAmount)||0)+(parseInt(p)||0)+(parseInt(d)||0)})),t(3)},children:["Next",a.jsx(ve,{})]})]})]})})},Tt=({imageUrl:r})=>{const[e,t]=m.useState(!0);return a.jsxs("div",{className:"relative",children:[e&&a.jsx(ot,{className:"w-full h-32 rounded-lg"})," ",a.jsx("img",{src:r,alt:"QR Code",className:`mb-2 rounded-lg ${e?"hidden":"block"}`,onLoad:()=>t(!1)})]})},$t=({setStep:r,handlePackagePayModalClose:e})=>{const{paymentData:{selectedPackage:t,chapterMeetings:s,receivers:n,selectedReceiver:i,paymentProof:o,paymentDate:l,selectedReceiverObject:c,receiverFeeAmount:p,platformFeeAmount:u,totalPayableAmount:h,selectedMemberId:d},fetchAllData:v}=W(),{chapterData:w}=G(),[f,C]=m.useState(h),g=f-h,[b,x]=m.useState(!1),[y,N]=m.useState(!1),I=async()=>{N(!0);let S="";if(o){const R=new FormData;R.append("image",o),R.append("folderName","memberPaymentProofs"),S=await $.post("/api/image-upload",R,{headers:{"Content-Type":"multipart/form-data"}}).then(D=>D.data.imageUrl)}const P={memberId:d,packageId:t.packageId,meetingIds:t.meetingIds,chapterId:w.chapterId,transactionType:"Package Payment",paidAmount:f,payableAmount:h,originalPayableAmount:parseFloat(t.packageFeeAmount),discountAmount:t.discountAmount,penaltyAmount:t.penaltyAmount,receiverFee:p,amountPaidToChapter:(parseFloat(f)||0)-(parseFloat(u)||0)-(parseFloat(p)||0),amountExpectedToChapter:t.totalAmount,platformFee:u,balanceAmount:g,paymentType:c==null?void 0:c.paymentType,paymentDate:l,paymentImageLink:S,paymentReceivedById:(c==null?void 0:c.memberId)||"",paymentReceivedByName:(c==null?void 0:c.receiverName)||""};await $.post("/api/payment/addPayment",P).then(R=>{v(),e(),E.success("Payment submitted successfully")}).catch(R=>{console.error("Error submitting payment:",R),N(!1)}).finally(()=>{N(!1)})};return a.jsxs("div",{className:"p-6 max-w-md mx-auto bg-white rounded-xl shadow-md space-y-4",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Total Payable Amount: ₹",h]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:"Enter Amount to Pay:"}),a.jsx("input",{type:"number",value:f,onChange:S=>{let P=Number(S.target.value);P<0&&(P=0),C(P)},className:"w-full p-2 border border-gray-300 rounded text-center"})]}),f===h?a.jsx("h3",{className:"text-xl font-semibold text-green-700",children:"You have paid the exact amount"}):f<h?a.jsxs("h3",{className:"text-xl font-semibold text-red-700",children:["You will be due by ₹",Math.abs(g)]}):a.jsxs("h3",{className:"text-xl font-semibold text-green-700",children:["You will pay advance of ₹",Math.abs(g)]}),a.jsxs("h5",{className:"text-sm font-semibold text-gray-700",children:["Amount will be received by: ",c==null?void 0:c.receiverName]}),a.jsxs(gt,{open:b,onOpenChange:x,children:[a.jsxs("div",{className:"flex justify-between mt-2",children:[a.jsxs(V,{variant:"outline",onClick:()=>r(2),children:[a.jsx(be,{}),"Back"]}),a.jsx(V,{onClick:()=>x(!0),children:"Confirm"})]}),a.jsxs(xt,{children:[a.jsxs(vt,{children:[a.jsx(yt,{children:"Confirm Payment"}),a.jsxs(bt,{children:["Are you sure you want to confirm payment of ₹",f,"?",f>h&&a.jsxs("div",{className:"mt-2 text-green-700 font-semibold",children:["(You are paying ₹",Math.abs(g)," advance)"]}),f<h&&a.jsxs("div",{className:"mt-2 text-red-700 font-semibold",children:["(You will be due by ₹",Math.abs(g),")"]})]})]}),a.jsxs(wt,{children:[a.jsx(jt,{disabled:y,children:"Cancel"}),a.jsxs(Ct,{onClick:I,disabled:y,className:"flex items-center justify-center",children:[y&&a.jsx(Je,{className:"mr-2 h-4 w-4 animate-spin"}),y?"Processing...":"Confirm"]})]})]})]})]})},Ot=({selectedPackage:r,pendingPayments:e,packageData:t,paymentSuccessHandler:s,parentType:n,chapterMeetings:i,handlePackagePayModalClose:o})=>{const{receivers:l}=W(),[c,p]=m.useState(1),[u,h]=m.useState(null),d=()=>{o()};return a.jsxs("div",{children:[c===1&&a.jsx(kt,{selectedReceiver:u,setSelectedReceiver:h,packageData:t,setStep:p,handlePackagePayModalClose:o}),c===2&&a.jsx(Et,{selectedPackage:r,pendingPayments:e,packageData:t,paymentSuccessHandler:s,parentType:n,chapterMeetings:i,receivers:l,setStep:p,handlePackagePayModalClose:d}),c===3&&a.jsx($t,{setStep:p,handlePackagePayModalClose:d})]})},Ft=({pendingPayments:r,parentType:e,paymentSuccessHandler:t})=>{const{paymentData:{receivers:s,chapterMeetings:n,packageParents:i,selectedPackage:o,packageData:l},resetPaymentData:c,setPaymentData:p}=W(),[u,h]=m.useState(!1),[d,v]=m.useState(!0),w=()=>{c(),v(!1)};m.useEffect(()=>{v(!!o)},[o]);const f=g=>{v(!0),p(b=>({...b,selectedPackage:g,lastSelectedPackageTime:new Date}))},C=l.filter(g=>g.packageParent===e).filter(g=>!u||!g.isPaid).sort((g,b)=>g.isDisabled!==b.isDisabled?g.isDisabled-b.isDisabled:0);return a.jsxs("div",{children:[a.jsx("div",{className:"flex justify-between items-center p-4 hidden",children:a.jsx("div",{className:"flex justify-end",children:a.jsxs("label",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",checked:u,onChange:()=>h(!u),className:"form-checkbox"}),a.jsx("span",{children:"Show Unpaid Only"})]})})}),a.jsx(Y,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-4",children:C.map(g=>a.jsxs("div",{className:`bg-white shadow-md rounded-lg p-6 border border-gray-200 hover:shadow-lg ${g.isDisabled?"opacity-50 cursor-not-allowed":""}`,children:[a.jsx("h2",{className:"text-xl font-bold mb-2",children:g.packageName}),!g.isDisabled&&g.totalAmount!==null&&g.status!=="approved"?a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"text-gray-700 mb-1",children:[`₹${g.packageFeeAmount}`,g.penaltyAmount>0&&a.jsxs("span",{className:"text-red-500",children:[" ","+ ₹",g.penaltyAmount]}),g.discountAmount>0&&a.jsxs("span",{className:"text-green-500",children:[" ","- ₹",g.discountAmount]}),g.previousBalance!==0&&a.jsxs("span",{className:"text-orange-500",children:[" ",g.previousBalance>0?"-":"+"," ₹",Math.abs(g.previousBalance)," (",g.previousBalance>0?"Advance":"Previous Due",")"]}),"= ₹",g.totalAmount]}),a.jsxs("p",{className:"text-gray-700 mb-1",children:["Payable End Date:"," ",z(g.packagePayableEndDate)]}),a.jsx(_t,{className:"mt-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700",variant:"contained",onClick:()=>f(g),disabled:g.isDisabled||(r==null?void 0:r.length)>0,children:"Pay Now"})]}):g.status==="approved"?a.jsx(a.Fragment,{children:a.jsxs("div",{children:["You have paid ₹",g.paidAmount," for this package on"," ",new Date(g.paymentDate).toLocaleDateString()," to"," ",a.jsx("b",{children:g.paymentReceivedByName})," by"," ",a.jsx("b",{children:g.paymentType})]})}):a.jsx("p",{className:"text-gray-700 mb-1",children:g.message||"Payment Not Allowed"})]},g.packageId))}),o&&s&&a.jsxs(Nt,{open:d,onOpenChange:w,children:[a.jsx(It,{}),a.jsx(Pt,{className:"sm:max-w-[425px] p-4 max-w-[90%] rounded-lg",children:a.jsx(Ot,{selectedPackage:o,pendingPayments:r,packageData:l,paymentSuccessHandler:t,parentType:e,chapterMeetings:n,receivers:s,handlePackagePayModalClose:w})})]})]})};function Ce(r,e=[]){let t=[];function s(i,o){const l=m.createContext(o),c=t.length;t=[...t,o];const p=h=>{var g;const{scope:d,children:v,...w}=h,f=((g=d==null?void 0:d[r])==null?void 0:g[c])||l,C=m.useMemo(()=>w,Object.values(w));return a.jsx(f.Provider,{value:C,children:v})};p.displayName=i+"Provider";function u(h,d){var f;const v=((f=d==null?void 0:d[r])==null?void 0:f[c])||l,w=m.useContext(v);if(w)return w;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[p,u]}const n=()=>{const i=t.map(o=>m.createContext(o));return function(l){const c=(l==null?void 0:l[r])||i;return m.useMemo(()=>({[`__scope${r}`]:{...l,[r]:c}}),[l,c])}};return n.scopeName=r,[s,Lt(n,...e)]}function Lt(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const s=r.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const o=s.reduce((l,{useScope:c,scopeName:p})=>{const h=c(i)[`__scope${p}`];return{...l,...h}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function ge(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function Ut(...r){return e=>{let t=!1;const s=r.map(n=>{const i=ge(n,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let n=0;n<s.length;n++){const i=s[n];typeof i=="function"?i():ge(r[n],null)}}}}function ne(...r){return m.useCallback(Ut(...r),r)}function Bt(r){const e=r+"CollectionProvider",[t,s]=Ce(e),[n,i]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=f=>{const{scope:C,children:g}=f,b=M.useRef(null),x=M.useRef(new Map).current;return a.jsx(n,{scope:C,itemMap:x,collectionRef:b,children:g})};o.displayName=e;const l=r+"CollectionSlot",c=Q(l),p=M.forwardRef((f,C)=>{const{scope:g,children:b}=f,x=i(l,g),y=ne(C,x.collectionRef);return a.jsx(c,{ref:y,children:b})});p.displayName=l;const u=r+"CollectionItemSlot",h="data-radix-collection-item",d=Q(u),v=M.forwardRef((f,C)=>{const{scope:g,children:b,...x}=f,y=M.useRef(null),N=ne(C,y),I=i(u,g);return M.useEffect(()=>(I.itemMap.set(y,{ref:y,...x}),()=>void I.itemMap.delete(y))),a.jsx(d,{[h]:"",ref:N,children:b})});v.displayName=u;function w(f){const C=i(r+"CollectionConsumer",f);return M.useCallback(()=>{const b=C.collectionRef.current;if(!b)return[];const x=Array.from(b.querySelectorAll(`[${h}]`));return Array.from(C.itemMap.values()).sort((I,S)=>x.indexOf(I.ref.current)-x.indexOf(S.ref.current))},[C.collectionRef,C.itemMap])}return[{Provider:o,Slot:p,ItemSlot:v},w,s]}function Vt(r,e,{checkForDefaultPrevented:t=!0}={}){return function(n){if(r==null||r(n),t===!1||!n.defaultPrevented)return e==null?void 0:e(n)}}var Ne=globalThis!=null&&globalThis.document?m.useLayoutEffect:()=>{},Wt=X[" useInsertionEffect ".trim().toString()]||Ne;function Ie({prop:r,defaultProp:e,onChange:t=()=>{},caller:s}){const[n,i,o]=qt({defaultProp:e,onChange:t}),l=r!==void 0,c=l?r:n;{const u=m.useRef(r!==void 0);m.useEffect(()=>{const h=u.current;h!==l&&console.warn(`${s} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,s])}const p=m.useCallback(u=>{var h;if(l){const d=Ht(u)?u(r):u;d!==r&&((h=o.current)==null||h.call(o,d))}else i(u)},[l,r,i,o]);return[c,p]}function qt({defaultProp:r,onChange:e}){const[t,s]=m.useState(r),n=m.useRef(t),i=m.useRef(e);return Wt(()=>{i.current=e},[e]),m.useEffect(()=>{var o;n.current!==t&&((o=i.current)==null||o.call(i,t),n.current=t)},[t,n]),[t,s,i]}function Ht(r){return typeof r=="function"}var Qt=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Pe=Qt.reduce((r,e)=>{const t=Q(`Primitive.${e}`),s=m.forwardRef((n,i)=>{const{asChild:o,...l}=n,c=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(c,{...l,ref:i})});return s.displayName=`Primitive.${e}`,{...r,[e]:s}},{});function zt(r,e,{checkForDefaultPrevented:t=!0}={}){return function(n){if(r==null||r(n),t===!1||!n.defaultPrevented)return e==null?void 0:e(n)}}function Yt(r,e=[]){let t=[];function s(i,o){const l=m.createContext(o),c=t.length;t=[...t,o];const p=h=>{var g;const{scope:d,children:v,...w}=h,f=((g=d==null?void 0:d[r])==null?void 0:g[c])||l,C=m.useMemo(()=>w,Object.values(w));return a.jsx(f.Provider,{value:C,children:v})};p.displayName=i+"Provider";function u(h,d){var f;const v=((f=d==null?void 0:d[r])==null?void 0:f[c])||l,w=m.useContext(v);if(w)return w;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[p,u]}const n=()=>{const i=t.map(o=>m.createContext(o));return function(l){const c=(l==null?void 0:l[r])||i;return m.useMemo(()=>({[`__scope${r}`]:{...l,[r]:c}}),[l,c])}};return n.scopeName=r,[s,Kt(n,...e)]}function Kt(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const s=r.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const o=s.reduce((l,{useScope:c,scopeName:p})=>{const h=c(i)[`__scope${p}`];return{...l,...h}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}var q=globalThis!=null&&globalThis.document?m.useLayoutEffect:()=>{},Gt=X[" useInsertionEffect ".trim().toString()]||q;function Xt({prop:r,defaultProp:e,onChange:t=()=>{},caller:s}){const[n,i,o]=Zt({defaultProp:e,onChange:t}),l=r!==void 0,c=l?r:n;{const u=m.useRef(r!==void 0);m.useEffect(()=>{const h=u.current;h!==l&&console.warn(`${s} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,s])}const p=m.useCallback(u=>{var h;if(l){const d=Jt(u)?u(r):u;d!==r&&((h=o.current)==null||h.call(o,d))}else i(u)},[l,r,i,o]);return[c,p]}function Zt({defaultProp:r,onChange:e}){const[t,s]=m.useState(r),n=m.useRef(t),i=m.useRef(e);return Gt(()=>{i.current=e},[e]),m.useEffect(()=>{var o;n.current!==t&&((o=i.current)==null||o.call(i,t),n.current=t)},[t,n]),[t,s,i]}function Jt(r){return typeof r=="function"}function xe(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function ea(...r){return e=>{let t=!1;const s=r.map(n=>{const i=xe(n,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let n=0;n<s.length;n++){const i=s[n];typeof i=="function"?i():xe(r[n],null)}}}}function Se(...r){return m.useCallback(ea(...r),r)}var ta=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ie=ta.reduce((r,e)=>{const t=Q(`Primitive.${e}`),s=m.forwardRef((n,i)=>{const{asChild:o,...l}=n,c=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(c,{...l,ref:i})});return s.displayName=`Primitive.${e}`,{...r,[e]:s}},{});function aa(r,e){return m.useReducer((t,s)=>e[t][s]??t,r)}var Ae=r=>{const{present:e,children:t}=r,s=sa(e),n=typeof t=="function"?t({present:s.isPresent}):m.Children.only(t),i=Se(s.ref,na(n));return typeof t=="function"||s.isPresent?m.cloneElement(n,{ref:i}):null};Ae.displayName="Presence";function sa(r){const[e,t]=m.useState(),s=m.useRef(null),n=m.useRef(r),i=m.useRef("none"),o=r?"mounted":"unmounted",[l,c]=aa(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const p=H(s.current);i.current=l==="mounted"?p:"none"},[l]),q(()=>{const p=s.current,u=n.current;if(u!==r){const d=i.current,v=H(p);r?c("MOUNT"):v==="none"||(p==null?void 0:p.display)==="none"?c("UNMOUNT"):c(u&&d!==v?"ANIMATION_OUT":"UNMOUNT"),n.current=r}},[r,c]),q(()=>{if(e){let p;const u=e.ownerDocument.defaultView??window,h=v=>{const f=H(s.current).includes(v.animationName);if(v.target===e&&f&&(c("ANIMATION_END"),!n.current)){const C=e.style.animationFillMode;e.style.animationFillMode="forwards",p=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=C)})}},d=v=>{v.target===e&&(i.current=H(s.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(p),e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:m.useCallback(p=>{s.current=p?getComputedStyle(p):null,t(p)},[])}}function H(r){return(r==null?void 0:r.animationName)||"none"}function na(r){var s,n;let e=(s=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(n=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var ra=X[" useId ".trim().toString()]||(()=>{}),oa=0;function ia(r){const[e,t]=m.useState(ra());return q(()=>{t(s=>s??String(oa++))},[r]),r||(e?`radix-${e}`:"")}var Z="Collapsible",[la,_e]=Yt(Z),[ca,le]=la(Z),Re=m.forwardRef((r,e)=>{const{__scopeCollapsible:t,open:s,defaultOpen:n,disabled:i,onOpenChange:o,...l}=r,[c,p]=Xt({prop:s,defaultProp:n??!1,onChange:o,caller:Z});return a.jsx(ca,{scope:t,disabled:i,contentId:ia(),open:c,onOpenToggle:m.useCallback(()=>p(u=>!u),[p]),children:a.jsx(ie.div,{"data-state":de(c),"data-disabled":i?"":void 0,...l,ref:e})})});Re.displayName=Z;var De="CollapsibleTrigger",Me=m.forwardRef((r,e)=>{const{__scopeCollapsible:t,...s}=r,n=le(De,t);return a.jsx(ie.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":de(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...s,ref:e,onClick:zt(r.onClick,n.onOpenToggle)})});Me.displayName=De;var ce="CollapsibleContent",ke=m.forwardRef((r,e)=>{const{forceMount:t,...s}=r,n=le(ce,r.__scopeCollapsible);return a.jsx(Ae,{present:t||n.open,children:({present:i})=>a.jsx(da,{...s,ref:e,present:i})})});ke.displayName=ce;var da=m.forwardRef((r,e)=>{const{__scopeCollapsible:t,present:s,children:n,...i}=r,o=le(ce,t),[l,c]=m.useState(s),p=m.useRef(null),u=Se(e,p),h=m.useRef(0),d=h.current,v=m.useRef(0),w=v.current,f=o.open||l,C=m.useRef(f),g=m.useRef(void 0);return m.useEffect(()=>{const b=requestAnimationFrame(()=>C.current=!1);return()=>cancelAnimationFrame(b)},[]),q(()=>{const b=p.current;if(b){g.current=g.current||{transitionDuration:b.style.transitionDuration,animationName:b.style.animationName},b.style.transitionDuration="0s",b.style.animationName="none";const x=b.getBoundingClientRect();h.current=x.height,v.current=x.width,C.current||(b.style.transitionDuration=g.current.transitionDuration,b.style.animationName=g.current.animationName),c(s)}},[o.open,s]),a.jsx(ie.div,{"data-state":de(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!f,...i,ref:u,style:{"--radix-collapsible-content-height":d?`${d}px`:void 0,"--radix-collapsible-content-width":w?`${w}px`:void 0,...r.style},children:f&&n})});function de(r){return r?"open":"closed"}var ma=Re,ua=Me,ha=ke,fa=X[" useId ".trim().toString()]||(()=>{}),pa=0;function ga(r){const[e,t]=m.useState(fa());return Ne(()=>{t(s=>s??String(pa++))},[r]),e?`radix-${e}`:""}var xa=m.createContext(void 0);function va(r){const e=m.useContext(xa);return r||e||"ltr"}var O="Accordion",ya=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[me,ba,wa]=Bt(O),[J,ws]=Ce(O,[wa,_e]),ue=_e(),Ee=M.forwardRef((r,e)=>{const{type:t,...s}=r,n=s,i=s;return a.jsx(me.Provider,{scope:r.__scopeAccordion,children:t==="multiple"?a.jsx(Ia,{...i,ref:e}):a.jsx(Na,{...n,ref:e})})});Ee.displayName=O;var[Te,ja]=J(O),[$e,Ca]=J(O,{collapsible:!1}),Na=M.forwardRef((r,e)=>{const{value:t,defaultValue:s,onValueChange:n=()=>{},collapsible:i=!1,...o}=r,[l,c]=Ie({prop:t,defaultProp:s??"",onChange:n,caller:O});return a.jsx(Te,{scope:r.__scopeAccordion,value:M.useMemo(()=>l?[l]:[],[l]),onItemOpen:c,onItemClose:M.useCallback(()=>i&&c(""),[i,c]),children:a.jsx($e,{scope:r.__scopeAccordion,collapsible:i,children:a.jsx(Oe,{...o,ref:e})})})}),Ia=M.forwardRef((r,e)=>{const{value:t,defaultValue:s,onValueChange:n=()=>{},...i}=r,[o,l]=Ie({prop:t,defaultProp:s??[],onChange:n,caller:O}),c=M.useCallback(u=>l((h=[])=>[...h,u]),[l]),p=M.useCallback(u=>l((h=[])=>h.filter(d=>d!==u)),[l]);return a.jsx(Te,{scope:r.__scopeAccordion,value:o,onItemOpen:c,onItemClose:p,children:a.jsx($e,{scope:r.__scopeAccordion,collapsible:!0,children:a.jsx(Oe,{...i,ref:e})})})}),[Pa,ee]=J(O),Oe=M.forwardRef((r,e)=>{const{__scopeAccordion:t,disabled:s,dir:n,orientation:i="vertical",...o}=r,l=M.useRef(null),c=ne(l,e),p=ba(t),h=va(n)==="ltr",d=Vt(r.onKeyDown,v=>{var P;if(!ya.includes(v.key))return;const w=v.target,f=p().filter(R=>{var D;return!((D=R.ref.current)!=null&&D.disabled)}),C=f.findIndex(R=>R.ref.current===w),g=f.length;if(C===-1)return;v.preventDefault();let b=C;const x=0,y=g-1,N=()=>{b=C+1,b>y&&(b=x)},I=()=>{b=C-1,b<x&&(b=y)};switch(v.key){case"Home":b=x;break;case"End":b=y;break;case"ArrowRight":i==="horizontal"&&(h?N():I());break;case"ArrowDown":i==="vertical"&&N();break;case"ArrowLeft":i==="horizontal"&&(h?I():N());break;case"ArrowUp":i==="vertical"&&I();break}const S=b%g;(P=f[S].ref.current)==null||P.focus()});return a.jsx(Pa,{scope:t,disabled:s,direction:n,orientation:i,children:a.jsx(me.Slot,{scope:t,children:a.jsx(Pe.div,{...o,"data-orientation":i,ref:c,onKeyDown:s?void 0:d})})})}),K="AccordionItem",[Sa,he]=J(K),Fe=M.forwardRef((r,e)=>{const{__scopeAccordion:t,value:s,...n}=r,i=ee(K,t),o=ja(K,t),l=ue(t),c=ga(),p=s&&o.value.includes(s)||!1,u=i.disabled||r.disabled;return a.jsx(Sa,{scope:t,open:p,disabled:u,triggerId:c,children:a.jsx(ma,{"data-orientation":i.orientation,"data-state":qe(p),...l,...n,ref:e,disabled:u,open:p,onOpenChange:h=>{h?o.onItemOpen(s):o.onItemClose(s)}})})});Fe.displayName=K;var Le="AccordionHeader",Ue=M.forwardRef((r,e)=>{const{__scopeAccordion:t,...s}=r,n=ee(O,t),i=he(Le,t);return a.jsx(Pe.h3,{"data-orientation":n.orientation,"data-state":qe(i.open),"data-disabled":i.disabled?"":void 0,...s,ref:e})});Ue.displayName=Le;var re="AccordionTrigger",Be=M.forwardRef((r,e)=>{const{__scopeAccordion:t,...s}=r,n=ee(O,t),i=he(re,t),o=Ca(re,t),l=ue(t);return a.jsx(me.ItemSlot,{scope:t,children:a.jsx(ua,{"aria-disabled":i.open&&!o.collapsible||void 0,"data-orientation":n.orientation,id:i.triggerId,...l,...s,ref:e})})});Be.displayName=re;var Ve="AccordionContent",We=M.forwardRef((r,e)=>{const{__scopeAccordion:t,...s}=r,n=ee(O,t),i=he(Ve,t),o=ue(t);return a.jsx(ha,{role:"region","aria-labelledby":i.triggerId,"data-orientation":n.orientation,...o,...s,ref:e,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...r.style}})});We.displayName=Ve;function qe(r){return r?"open":"closed"}var Aa=Ee,_a=Fe,Ra=Ue,He=Be,Qe=We;const Da=Aa,ze=m.forwardRef(({className:r,...e},t)=>a.jsx(_a,{ref:t,className:oe("border-b",r),...e}));ze.displayName="AccordionItem";const Ye=m.forwardRef(({className:r,children:e,...t},s)=>a.jsx(Ra,{className:"flex",children:a.jsxs(He,{ref:s,className:oe("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",r),...t,children:[e,a.jsx(ye,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Ye.displayName=He.displayName;const Ke=m.forwardRef(({className:r,children:e,...t},s)=>a.jsx(Qe,{ref:s,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...t,children:a.jsx("div",{className:oe("pb-4 pt-0",r),children:e})}));Ke.displayName=Qe.displayName;const Ma=({pendingPayments:r,handleDeletePendingRequest:e,fetchAllData:t})=>r.length===0?null:a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-yellow-100 rounded-md",children:[a.jsxs("p",{className:"text-base font-medium text-yellow-800 dark:text-yellow-200",children:["You have ",a.jsx("strong",{children:"pending payments"}),". Please contact admin to approve requests to continue."]}),a.jsx("button",{className:"px-4 py-2 text-sm font-semibold text-yellow-800 bg-yellow-300 rounded-md hover:bg-yellow-400 dark:text-yellow-200 dark:bg-yellow-400 transition-colors",onClick:t,children:"Refresh"})]}),a.jsx("div",{className:"mt-4 space-y-4",children:r.map(s=>{var n,i,o,l;return a.jsxs("div",{className:"p-4 sm:p-6 border border-yellow-300 rounded-lg bg-yellow-50 dark:bg-yellow-900/20",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-xl sm:text-2xl font-semibold text-yellow-900 dark:text-yellow-100 mb-1",children:s.packageName}),a.jsxs("p",{className:"text-base text-yellow-700 dark:text-yellow-300",children:[s.packageFeeType," • ",new Date(s.paymentDate).toLocaleDateString()]})]}),a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200 self-start sm:self-center",children:s.status.toUpperCase()})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[s.paidAmount===s.payableAmount?a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Amount:"}),a.jsxs("span",{className:"text-lg font-semibold text-blue-700 dark:text-blue-400",children:["₹",(n=s.paidAmount)==null?void 0:n.toLocaleString()]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Paid:"}),a.jsxs("span",{className:"text-lg font-semibold text-green-700 dark:text-green-400",children:["₹",(i=s.paidAmount)==null?void 0:i.toLocaleString()]})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Original Amount:"}),a.jsxs("span",{className:"text-lg font-semibold text-blue-700 dark:text-blue-400",children:["₹",(o=s.payableAmount)==null?void 0:o.toLocaleString()]})]})]}),s.balanceAmount!==0&&a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base text-yellow-700 dark:text-yellow-300 mb-1",children:"Balance:"}),a.jsxs("span",{className:`text-lg font-semibold ${s.balanceAmount<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:["₹",(l=Math.abs(s.balanceAmount))==null?void 0:l.toLocaleString(),s.balanceAmount<0?" Due":" Advance"]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center pt-4 border-t border-yellow-200 gap-3",children:[a.jsxs("div",{className:"text-base text-yellow-700 dark:text-yellow-300",children:[a.jsx("span",{className:"capitalize font-medium",children:s.paymentType}),a.jsx("span",{className:"mx-2",children:"•"}),a.jsx("span",{children:s.paymentReceivedByName||"Unknown"})]}),a.jsx("button",{className:"px-4 py-2 text-base font-medium text-red-700 bg-red-100 border border-red-300 rounded-md hover:bg-red-200 dark:bg-red-900/30 dark:text-red-200 dark:border-red-600 transition-colors self-start sm:self-center",onClick:()=>e(s.transactionId),children:"Delete Request"})]})]},s.transactionId)})})]}),ka=()=>{const{paymentData:{receivers:r,chapterMeetings:e,balance:t,packageParents:s,packageData:n,pendingPayments:i,terms:o,selectedTermId:l},calculationDate:c,setCalculationDate:p,setPaymentData:u,fetchAllData:h,handleDeletePendingRequest:d,setSelectedTermId:v}=W(),{chapterData:w,memberData:f}=G(),[C,g]=M.useState(0),[b,x]=m.useState({value:f==null?void 0:f.memberId,label:`${f==null?void 0:f.firstName} ${f==null?void 0:f.lastName}`}),[y,N]=m.useState([]),[I,S]=m.useState([]),[P,R]=m.useState(!1),[D,T]=m.useState(!1),[F,B]=m.useState(!1);m.useEffect(()=>{f!=null&&f.memberId&&!b.value&&x({value:f==null?void 0:f.memberId,label:`${f==null?void 0:f.firstName} ${f==null?void 0:f.lastName}`})},[f]);const j=()=>{h(b.value)},k=(_,U)=>{g(U)},L=async()=>{try{const _=await $.get("/api/member/all",{params:{chapterId:w==null?void 0:w.chapterId}});S(_.data),N(_.data)}catch{toast.error("Error fetching members")}};return m.useEffect(()=>{w!=null&&w.chapterId&&D&&L()},[w,D]),m.useEffect(()=>{b&&(h(b.value),u(_=>({..._,selectedMemberId:b.value,selectedMemberName:b.label})))},[b]),m.useEffect(()=>{w!=null&&w.chapterId&&($.get(`/api/rights/anyMemberMaketransaction/${w.chapterId}`).then(_=>{T(_.data.allowed)}).catch(_=>{console.error("Error fetching member transaction rights:",_)}),$.get(`/api/rights/changeDate/${w.chapterId}`).then(_=>{B(_.data.allowed)}).catch(_=>{console.error("Error fetching change date rights:",_)}))},[w]),a.jsxs("div",{className:"rounded-sm border border-stroke bg-white p-3 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:[a.jsx(Ma,{pendingPayments:i,handleDeletePendingRequest:d,fetchAllData:()=>h(b.value)}),a.jsxs("div",{className:"flex justify-between items-start flex-wrap",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 text-nowrap",children:"Current Date:"}),a.jsx("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 text-nowrap",children:a.jsx(Ta,{})})]}),(F||D)&&a.jsx(Da,{type:"single",collapsible:!0,children:a.jsxs(ze,{value:"item-1",children:[a.jsx(Ye,{children:"Additional Settings"}),a.jsxs(Ke,{children:[F&&a.jsx("div",{className:"flex items-center space-x-4",children:a.jsx(Rt,{type:"date",value:c.toISOString().split("T")[0],onChange:_=>{const U=new Date(_.target.value);p(U),we(U,n,e,u)},placeholder:"Calculation Date"})}),D&&a.jsx("div",{className:"flex items-center space-x-4 mt-4",children:a.jsx(tt,{members:I,selectedMember:b,setSelectedMember:x})})]})]})}),o&&o.filter(_=>_.status==="active").length>1&&a.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[a.jsx("label",{className:"text-md font-semibold",children:"Select Active Term:"}),a.jsxs(dt,{value:l||"",onValueChange:_=>{v(_),h(b==null?void 0:b.value)},children:[a.jsx(mt,{className:"w-[200px]",children:a.jsx(ut,{placeholder:"Select term"})}),a.jsx(ht,{children:o.filter(_=>_.status==="active").map(_=>a.jsx(ft,{value:_.termId,children:_.termName},_.termId))})]})]})]}),!!t&&a.jsx("div",{className:"flex items-center justify-end",children:a.jsxs("div",{className:"flex items-center space-x-2 text-nowrap",children:[a.jsxs("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:[t>0?"Advance Amount":"Due Amount",":"]}),a.jsxs("p",{className:`text-lg font-semibold ${t>0?"text-green-500":"text-red-500"}`,children:["₹",Math.abs(t)]})]})})]}),a.jsxs(Y,{sx:{width:"100%"},children:[a.jsx(Y,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsx(St,{value:C,onChange:k,"aria-label":"fee tabs",children:s==null?void 0:s.map((_,U)=>a.jsx(At,{label:_},U))})}),r&&(s==null?void 0:s.map((_,U)=>a.jsx(Ea,{value:C,index:U,children:a.jsx(Ft,{pendingPayments:i,packageData:n,paymentSuccessHandler:j,parentType:_,receivers:r})},U)))]})]})};function Ea(r){const{children:e,value:t,index:s,...n}=r;return a.jsx("div",{role:"tabpanel",hidden:t!==s,id:`simple-tabpanel-${s}`,"aria-labelledby":`simple-tab-${s}`,...n,children:t===s&&a.jsx(Y,{sx:{p:3},children:e})})}const Ta=()=>{const[r,e]=m.useState(new Date);return m.useEffect(()=>{const t=setInterval(()=>{e(new Date)},1e3);return()=>clearInterval(t)},[]),a.jsxs("span",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:[r.getDate(),"-",r.getMonth()+1,"-",r.getFullYear()," ",r.getHours(),":",r.getMinutes().toString().padStart(2,"0"),":",r.getSeconds().toString().padStart(2,"0")]})},js=()=>a.jsxs(a.Fragment,{children:[a.jsx(et,{items:[{name:"Packages",link:"/member/packages"}]}),a.jsx(Mt,{children:a.jsx(ka,{})})]});export{js as default};
