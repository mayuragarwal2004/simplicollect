import{k as b,r as s,c as a,j as r,B as h}from"./index.js";import{B as k}from"./Breadcrumb.js";import{S as y}from"./skeleton.js";import{A as j,b as w,a as S}from"./alert.js";import{u as I,M,a as L,D as E}from"./download-dialog.js";import{f as D}from"./format.js";import"./chevron-right.js";import"./index14.js";import"./table2.js";import"./usePagination.js";import"./select.js";import"./index10.js";import"./index4.js";import"./index11.js";import"./index9.js";import"./index5.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./check.js";import"./chevron-up.js";import"./dialog.js";import"./index3.js";import"./index6.js";import"./circle-check-big.js";import"./share.js";const N=()=>{const{chapterData:e}=b(),{downloadFromResponse:m,downloadDialogState:t,closeDownloadDialog:d}=I(),[l,p]=s.useState([]),[c,i]=s.useState(!0),[n,g]=s.useState(null);s.useEffect(()=>{!e||!(e!=null&&e.chapterId)||a.get(`/api/report/${e==null?void 0:e.chapterId}/member-ledger-json`).then(o=>{p(o.data),i(!1)}).catch(o=>{g("Failed to load ledger data"),i(!1)})},[e==null?void 0:e.chapterId,a]);const u=async()=>{try{const o=`My Ledger - ${D(new Date,"dd-MM-yyyy")}.xlsx`,f=await a.get(`/api/report/${e==null?void 0:e.chapterId}/member-ledger`,{responseType:"blob"});await m(f,o,{showSuccessToast:!0,allowShare:!0})}catch(o){console.error("[MyLedger] Export failed:",JSON.stringify({error:o.message,stack:o.stack,chapterId:e==null?void 0:e.chapterId}))}},x=async()=>{t.shareCallback&&await t.shareCallback()};return r.jsxs("div",{className:"rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:[n&&r.jsxs(j,{variant:"destructive",children:[r.jsx(w,{children:"Error"}),r.jsx(S,{children:n})]}),r.jsx(h,{onClick:u,children:"Export Data"}),c?r.jsx(y,{className:"h-10 w-full mb-4"}):r.jsx(M,{data:l,columns:L,searchInputField:"firstName",totalRecord:0,pagination:{pageSize:10,pageIndex:0},state:{pagination:{pageSize:10,pageIndex:0}}}),r.jsx(E,{isOpen:t.isOpen,onClose:d,filename:t.filename||t.fileName,onShare:x})]})},te=()=>r.jsxs(r.Fragment,{children:[r.jsx(k,{items:[{name:"Dashboard",link:"/member"},{name:"My Ledger",link:"/member/my-ledger"}]}),r.jsx(N,{})]});export{te as default};
