import{j as e,B as j,u as G,a as M,r,c as I,Q as x}from"./index.js";import{u as U,a as V,f as E}from"./index14.js";import{T as q,a as Q,b as T,c as z,d as K,e as F}from"./table2.js";import{u as W,c as J}from"./usePagination.js";import{D as X,C as Y,a as Z,b as _}from"./react-icons.esm.js";import{S as ee,a as ae,b as se,c as ne,d as te}from"./select.js";import{A as re,a as ie,b as oe,c as le,d as ce}from"./alert-dialog.js";import{B as de}from"./Breadcrumb.js";import"./index10.js";import"./index4.js";import"./index11.js";import"./index9.js";import"./index5.js";import"./index7.js";import"./index8.js";import"./index12.js";import"./chevron-down.js";import"./check.js";import"./chevron-up.js";import"./index3.js";import"./index6.js";import"./chevron-right.js";function me({table:a,totalRecord:g}){return e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 px-2 lg:flex-row lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2 sm:flex-row sm:space-x-6 sm:space-y-0",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[a.getFilteredRowModel().rows.length," row(s)."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Rows per page"}),e.jsxs(ee,{value:`${a.getState().pagination.pageSize}`,onValueChange:i=>{a.setPageSize(Number(i))},children:[e.jsx(ae,{className:"h-8 w-[70px]",children:e.jsx(se,{placeholder:a.getState().pagination.pageSize})}),e.jsx(ne,{side:"top",children:[5,10,20,30,40,50].map(i=>e.jsx(te,{value:`${i}`,children:i},i))})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total Record: ",g]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",a.getState().pagination.pageIndex+1," of ",a.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(j,{variant:"outline",className:"h-8 w-8 p-0",disabled:!a.getCanPreviousPage(),onClick:()=>a.setPageIndex(0),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(X,{className:"h-4 w-4"})]}),e.jsxs(j,{variant:"outline",className:"h-8 w-8 p-0",disabled:!a.getCanPreviousPage(),onClick:a.previousPage,children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(Y,{className:"h-4 w-4"})]}),e.jsxs(j,{variant:"outline",className:"h-8 w-8 p-0",disabled:!a.getCanNextPage(),onClick:a.nextPage,children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(Z,{className:"h-4 w-4"})]}),e.jsxs(j,{variant:"outline",className:"h-8 w-8 p-0",disabled:!a.getCanNextPage(),onClick:()=>a.setPageIndex(a.getPageCount()-1),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(_,{className:"h-4 w-4"})]})]})]})]})}function ge({columns:a,data:g,searchInputField:i,filterField:C,filterFieldName:P,filterCategoriesList:v,totalRecord:o,children:N}){var p;const h=G(),{rows:u,onPaginationChange:D,page:S,pagination:k}=W(),O=M(),b=()=>{const n=new URLSearchParams(O.search),t=J({rows:u,page:S},n);h(`?${t}`,{replace:!0})};r.useEffect(()=>{b()},[u,S]);const l=U({data:g,columns:a,getCoreRowModel:V(),manualPagination:!0,onPaginationChange:D,state:{pagination:k},rowCount:o}),f=r.Children.map(N,n=>r.isValidElement(n)?r.cloneElement(n,{table:l,searchInputField:i,filterField:C,filterFieldName:P,filterCategoriesList:v}):n);return e.jsxs("div",{className:"space-y-4",children:[f,e.jsx("div",{className:"overflow-y-auto rounded-md border",children:e.jsxs(q,{children:[e.jsx(Q,{children:l.getHeaderGroups().map(n=>e.jsx(T,{children:n.headers.map(t=>e.jsx(z,{className:"px-4 py-2 bg-newprimaryColor text-white font-raleway",colSpan:t.colSpan,children:t.isPlaceholder?null:E(t.column.columnDef.header,t.getContext())},t.id))},n.id))}),e.jsx(K,{className:"bg-adminBreadCrumbsBg font-raleway",children:(p=l.getRowModel().rows)!=null&&p.length?l.getRowModel().rows.map(n=>e.jsx(T,{"data-state":n.getIsSelected()&&"selected",children:n.getVisibleCells().map(t=>e.jsx(F,{className:"px-4 py-2",children:E(t.column.columnDef.cell,t.getContext())},t.id))},n.id)):e.jsx(T,{children:e.jsx(F,{colSpan:a.length,className:"h-24 text-center bg-adminBreadCrumbsBg font-raleway",children:"No results."})})})]})}),e.jsx(me,{table:l,totalRecord:o})]})}const ue=[{id:"srno",header:()=>e.jsx("p",{className:!0,children:"Sr. No."}),cell:a=>e.jsx("p",{children:a.row.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"organisationName",header:()=>e.jsx("div",{className:!0,children:"Organisation Name"}),cell:({row:a})=>e.jsx("p",{className:"text-sm font-medium",children:a.original.organisationName}),enableSorting:!1,enableHiding:!1},{accessorKey:"numberOfChapters",header:()=>e.jsx("div",{className:!0,children:"Number of Chapters"}),cell:({row:a})=>e.jsx("p",{className:"text-sm font-medium",children:a.original.numberOfChapters}),enableSorting:!1,enableHiding:!1},{id:"actions",header:()=>e.jsx("div",{className:!0,children:"Actions"}),cell:({row:a})=>e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>a.original.onEdit(a.original),className:"text-primary hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>a.original.onDelete(a.original.organisationId),className:"text-danger hover:underline",children:"Delete"})]}),enableSorting:!1,enableHiding:!1}],pe=()=>{const[a,g]=r.useState([]),[i,C]=r.useState(!0),[P,v]=r.useState(!1),[o,N]=r.useState(null),[h,u]=r.useState(null),[D,S]=r.useState(0),k=M(),O=new URLSearchParams(k.search),b=O.get("rows")||10,l=O.get("page")||0,[f,p]=r.useState({organisationName:""});r.useEffect(()=>{n()},[b,l]);const n=()=>{I.get(`/api/admin/organisations?rows=${b}&page=${l}`).then(s=>{console.log("Fetched organisations:",s.data),g(s.data.data||s.data),S(s.data.totalRecords||s.data.length),C(!1)}).catch(s=>{console.error("Error fetching organisations:",s),x.error("Failed to fetch organisations"),C(!1)})},t=(s=null)=>{s?(p({organisationName:s.organisationName}),N(s)):(p({organisationName:""}),N(null)),v(!0)},A=()=>{v(!1),N(null),p({organisationName:""})},B=s=>{const{name:c,value:y}=s.target;console.log("Input changed:",c,y),p(d=>({...d,[c]:y}))},H=()=>f.organisationName.trim()?!0:(x.error("Organisation name is required"),!1),L=async s=>{var c,y;if(s.preventDefault(),!!H())try{const d={organisationName:f.organisationName.trim(),numberOfChapters:parseInt(f.numberOfChapters)};console.log("Sending payload:",d);let m;if(o)m=await I.put(`/api/admin/organisations/${o.organisationId}`,d),m.data&&(g(R=>R.map(w=>w.organisationId===o.organisationId?{...w,...m.data}:w)),x.success("Organisation updated successfully"));else if(m=await I.post("/api/admin/organisations",d),m.data&&m.data.organisationId){const R={...m.data};g(w=>[...w,R]),x.success("Organisation created successfully")}A(),await n()}catch(d){console.error("Error details:",d);const m=((y=(c=d.response)==null?void 0:c.data)==null?void 0:y.error)||d.message||(o?"Failed to update organisation":"Failed to create organisation");x.error(m)}},$=async()=>{if(h)try{await I.delete(`/api/admin/organisations/${h}`),g(s=>s.filter(c=>c.organisationId!==h)),x.success("Organisation deleted successfully"),u(null)}catch(s){console.error("Error deleting organisation:",s),x.error("Failed to delete organisation")}};return e.jsxs("div",{className:"rounded-2xl border border-stroke bg-white p-5 shadow-md dark:border-strokedark dark:bg-boxdark",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Super Admin Organisation Table"}),e.jsx("button",{onClick:()=>t(),className:"px-4 py-2 bg-primary text-white rounded hover:bg-opacity-90",children:"Add Organisation"})]}),i?e.jsx("p",{children:"Loading..."}):e.jsx(ge,{data:a.map(s=>({...s,onEdit:t,onDelete:c=>u(c)})),columns:ue,searchInputField:"organisationName",totalRecord:D,pagination:{pageSize:parseInt(b),pageIndex:parseInt(l)}}),e.jsx(re,{open:!!h,onOpenChange:()=>u(null),children:e.jsxs(ie,{children:[e.jsx(oe,{children:e.jsx(le,{children:"Confirm Deletion"})}),e.jsx("p",{children:"Are you sure you want to delete this organisation?"}),e.jsxs(ce,{children:[e.jsx(j,{variant:"secondary",onClick:()=>u(null),children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:$,children:"Delete"})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:o?"Edit Organisation":"Add Organisation"}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Organisation Name"}),e.jsx("input",{type:"text",name:"organisationName",value:f.organisationName,onChange:B,className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:A,className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded",children:o?"Update":"Add"})]})]})]})})]})},Be=()=>e.jsxs(e.Fragment,{children:[e.jsx(de,{items:[{name:"Dashboard",link:"/admin"},{name:"Organisations",link:"/admin/organisations"}]}),e.jsx(pe,{})]});export{Be as default};
