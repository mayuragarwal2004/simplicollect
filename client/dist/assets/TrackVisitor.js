import{r as n,e as U,j as e,C as B,f as G,g as J,i as f,B as d,c as x,Q as h}from"./index.js";import{T as K,a as O,b as u,c as j}from"./tabs.js";import{I as r}from"./input.js";import{L as a}from"./label.js";import{T as p}from"./textarea.js";import{S as X,M as Y,P as Z}from"./sticky-note.js";import{M as _}from"./mail.js";import"./index4.js";import"./index13.js";import"./index11.js";import"./index9.js";import"./index6.js";const me=()=>{const[t,b]=n.useState({}),[o,N]=n.useState(!1),[v,g]=n.useState([]),c=U().visitorId,[E,V]=n.useState(""),[w,W]=n.useState(""),[S,M]=n.useState(""),[H,z]=n.useState(""),[k,L]=n.useState(""),[I,P]=n.useState(""),[T,C]=n.useState(null),[$,F]=n.useState("");n.useEffect(()=>{const s=async()=>{try{const i=await x.get(`/api/visitor/${c}`);if(!i.data)throw new Error("Failed to fetch visitor data");b(i.data)}catch{h.error("Error fetching visitor")}},l=async()=>{try{const i=await x.get(`/api/visitor-history/getHistory/${c}`);g(i.data)}catch{h.error("Error fetching history")}};c&&(s(),l())},[c]);const m=s=>{b({...t,[s.target.name]:s.target.value})},y=async(s,l)=>{try{if(!(await x.post(`/api/visitor-history/addHistory/${c}`,{type:s,...l})).data)throw new Error("Failed to save history");h.success(`${s} history saved`);const Q=await x.get(`/api/visitor-history/getHistory/${c}`);g(Q.data)}catch(i){h.error(`Error saving ${s}: ${i.message}`)}},R=async s=>{try{await x.delete(`/api/visitor-history/deleteHistory/${c}/${s}`),h.success("History deleted");const l=await x.get(`/api/visitor-history/getHistory/${c}`);g(l.data)}catch(l){h.error(`Error deleting history: ${l.message}`)}},q=async(s,l)=>{try{await x.put(`/api/visitor-history/updateHistory/${c}/${s}`,l),h.success("History updated");const i=await x.get(`/api/visitor-history/getHistory/${c}`);g(i.data)}catch(i){h.error(`Error updating history: ${i.message}`)}},D=async()=>{try{if(!(await x.put(`/api/visitor/updateVisitor/${c}`,t)).data)throw new Error("Failed to save visitor data");N(!1),h.success("Visitor updated")}catch{h.error("Error saving visitor")}},A=s=>{switch(s){case"call":return e.jsx(Z,{className:"text-blue-500"});case"email":return e.jsx(_,{className:"text-red-500"});case"whatsapp":return e.jsx(Y,{className:"text-green-500"});case"note":return e.jsx(X,{className:"text-yellow-500"});default:return null}};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4",children:[e.jsxs(B,{className:"w-full",children:[e.jsx(G,{children:e.jsx(J,{children:"Visitor Information"})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"firstName",children:"First Name"}),e.jsx(r,{name:"firstName",value:t.firstName||"",onChange:m,disabled:!o})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"lastName",children:"Last Name"}),e.jsx(r,{name:"lastName",value:t.lastName||"",onChange:m,disabled:!o})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"email",children:"Email"}),e.jsx(r,{name:"email",value:t.email||"",onChange:m,disabled:!o})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"mobileNumber",children:"Phone"}),e.jsx(r,{name:"mobileNumber",value:t.mobileNumber||"",onChange:m,disabled:!o})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"invitedBy",children:"Invited By"}),e.jsx(r,{name:"invitedBy",value:t.invitedBy||"",onChange:m,disabled:!o})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"companyName",children:"Company Name"}),e.jsx(r,{name:"companyName",value:t.companyName||"",onChange:m,disabled:!o})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"classification",children:"Classification"}),e.jsx(r,{name:"classification",value:t.classification||"",onChange:m,disabled:!o})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"industry",children:"Industry"}),e.jsx(r,{name:"industry",value:t.industry||"",onChange:m,disabled:!o})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"heardAboutBni",children:"Heard About BNI"}),e.jsx(r,{name:"heardAboutBni",value:t.heardAboutBni||"",onChange:m,disabled:!o})]})]})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-4",children:[!o&&e.jsx(d,{className:"mt-4",variant:"outline",onClick:()=>N(!0),children:"Edit"}),o&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(d,{onClick:D,children:"Save"}),e.jsx(d,{variant:"outline",onClick:()=>N(!1),children:"Cancel"})]})]})})]}),e.jsx(B,{className:"w-full",children:e.jsx(f,{className:"mt-10",children:e.jsxs(K,{defaultValue:"history",className:"w-full",children:[e.jsxs(O,{className:"grid w-full grid-cols-5 mb-4",children:[e.jsx(u,{value:"call",children:"Call"}),e.jsx(u,{value:"note",children:"Note"}),e.jsx(u,{value:"email",children:"Email"}),e.jsx(u,{value:"whatsapp",children:"WhatsApp"}),e.jsx(u,{value:"history",children:"History"})]}),e.jsxs(j,{value:"call",children:[e.jsx(a,{children:"Phone Number"}),e.jsx(r,{value:t.mobileNumber||"",disabled:!0}),e.jsx(a,{className:"mt-2",children:"Remark"}),e.jsx(p,{placeholder:"Enter call remarks...",value:E,onChange:s=>V(s.target.value)}),e.jsx(d,{className:"mt-2",onClick:()=>y("call",{to:t.mobileNumber,content:E}),children:"Save Call Log"})]}),e.jsxs(j,{value:"note",children:[e.jsx(a,{children:"Note"}),e.jsx(p,{placeholder:"Enter note...",value:w,onChange:s=>W(s.target.value)}),e.jsx(d,{className:"mt-2",onClick:()=>y("note",{content:w}),children:"Save"})]}),e.jsxs(j,{value:"email",children:[e.jsx(a,{children:"Email"}),e.jsx(r,{value:t.email||"",disabled:!0}),e.jsx(a,{className:"mt-2",children:"Title"}),e.jsx(r,{placeholder:"Enter email title",value:S,onChange:s=>M(s.target.value)}),e.jsx(a,{className:"mt-2",children:"Subject"}),e.jsx(p,{placeholder:"Enter email subject or message...",value:H,onChange:s=>z(s.target.value)}),e.jsx(d,{className:"mt-2",onClick:()=>y("email",{to:t.email,title:S,content:H}),children:"Send Email"})]}),e.jsxs(j,{value:"whatsapp",children:[e.jsx(a,{children:"WhatsApp Number"}),e.jsx(r,{value:t.mobileNumber||"",disabled:!0}),e.jsx(a,{className:"mt-2",children:"Title"}),e.jsx(r,{placeholder:"Enter WhatsApp title",value:k,onChange:s=>L(s.target.value)}),e.jsx(a,{className:"mt-2",children:"Content"}),e.jsx(p,{placeholder:"Enter WhatsApp message content...",value:I,onChange:s=>P(s.target.value)}),e.jsx(d,{className:"mt-2",onClick:()=>y("whatsapp",{to:t.mobileNumber,title:k,content:I}),children:"Send WhatsApp"})]}),e.jsxs(j,{value:"history",children:[e.jsx("div",{className:"flex gap-4 justify-center mb-6",children:v&&v.map((s,l)=>e.jsx("div",{children:A(s.type)},l))}),e.jsx("div",{className:"space-y-6",children:v&&v.map((s,l)=>e.jsxs("div",{className:"flex flex-col gap-2 border p-2 rounded",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"pt-1",children:A(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium capitalize",children:s.type}),e.jsx("p",{className:"text-muted-foreground text-xs",children:s.createdAt}),T===s.historyId?e.jsx(p,{className:"mt-1",value:$,onChange:i=>F(i.target.value)}):e.jsx("p",{className:"mt-1",children:s.content||s.title})]})]}),e.jsx("div",{className:"flex gap-2 mt-2 ml-8",children:T===s.historyId?e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",onClick:()=>{q(s.historyId,{content:$}),C(null)},children:"Save"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>C(null),children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",onClick:()=>{C(s.historyId),F(s.content||s.title)},children:"Update"}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>R(s.historyId),children:"Delete"})]})})]},l))})]})]})})})]})};export{me as default};
